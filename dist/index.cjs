"use strict";var ne=Object.create;var X=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var le=(o,i)=>{for(var s in i)X(o,s,{get:i[s],enumerable:!0})},Z=(o,i,s,m)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of ie(i))!ae.call(o,c)&&c!==s&&X(o,c,{get:()=>i[c],enumerable:!(m=re(i,c))||m.enumerable});return o};var de=(o,i,s)=>(s=o!=null?ne(se(o)):{},Z(i||!o||!o.__esModule?X(s,"default",{value:o,enumerable:!0}):s,o)),ce=o=>Z(X({},"__esModule",{value:!0}),o);var pe={};le(pe,{CHAT_STORAGE_PREFIX:()=>j,ChatEnabled:()=>J,DefaultChatbot:()=>ee,FloatingWindow:()=>Y,clearAllConversations:()=>Q,clearConversation:()=>q,getConversationStorageKey:()=>V});module.exports=ce(pe);var T=de(require("react"),1);var I=require("react"),E=require("react/jsx-runtime"),Y=({children:o,title:i,onClose:s,position:m="bottom-right",width:c=360,height:M=480,minWidth:L=280,minHeight:H=240,offset:_=16,zIndex:S=1e3,className:y,style:D,headerClassName:h,bodyClassName:$,closeButtonAriaLabel:w="Close",closeOnEscape:P=!0,draggable:F=!0,anchorRect:d})=>{let[W,A]=(0,I.useState)(!1),C=(0,I.useRef)(null),[K,R]=(0,I.useState)(!1),v=(0,I.useRef)(null),[x,e]=(0,I.useState)(null);(0,I.useEffect)(()=>{if(!P)return;let n=p=>{p.key==="Escape"&&s?.()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[P,s]);let t=(()=>{let n=`${_}px`;switch(m){case"top-left":return{top:n,left:n};case"top-right":return{top:n,right:n};case"bottom-left":return{bottom:n,left:n};case"bottom-right":default:return{bottom:n,right:n}}})(),a=(()=>{if(m!=="auto"||!d)return null;let n=window.innerWidth,p=window.innerHeight,b=_,k=d.top<p/2,u=d.left>n/2,g=k?["bottom","top"]:["top","bottom"],U=u?["right","left"]:["left","right"],z=[`${g[0]}-${U[0]}`,`${g[0]}-${U[1]}`,`${g[1]}-${U[0]}`,`${g[1]}-${U[1]}`];for(let G of z){let O=0,B=0;if(G==="bottom-right"?(O=d.bottom+b,B=d.right-c):G==="bottom-left"?(O=d.bottom+b,B=d.left):G==="top-right"?(O=d.top-M-b,B=d.right-c):(O=d.top-M-b,B=d.left),O>=0&&B>=0&&O+M<=p&&B+c<=n)return{top:O,left:B}}let te=Math.min(Math.max(d.bottom+b,0),p-M),oe=Math.min(Math.max(d.right-c,0),n-c);return{top:te,left:oe}})(),r=n=>{if(!F)return;let p=C.current;if(!p)return;let b=p.getBoundingClientRect();v.current={x:n.clientX,y:n.clientY,top:b.top,left:b.left},e({top:b.top,left:b.left}),R(!0);let k=g=>{if(!v.current)return;let U=g.clientX-v.current.x,z=g.clientY-v.current.y;e({top:v.current.top+z,left:v.current.left+U})},u=()=>{R(!1),v.current=null,window.removeEventListener("pointermove",k),window.removeEventListener("pointerup",u)};window.addEventListener("pointermove",k),window.addEventListener("pointerup",u,{once:!0})};return(0,E.jsxs)("div",{ref:C,role:"dialog","aria-modal":"false",className:y,style:{position:"fixed",...x?{top:x.top,left:x.left}:a?{top:a.top,left:a.left}:t,width:c,height:M,minWidth:L,minHeight:H,zIndex:S,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:K?"none":void 0,...D},children:[(0,E.jsxs)("div",{className:h,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:F?"move":void 0},onPointerDown:r,children:[(0,E.jsx)("div",{style:{fontWeight:600,color:"#111827"},children:i}),(0,E.jsx)("button",{type:"button",onClick:s,"aria-label":w,onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:W?"#ef4444":void 0,transition:"color 120ms ease"},children:(0,E.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,E.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,E.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,E.jsx)("div",{className:$,style:{flex:1,overflow:"auto",background:"#ffffff"},children:o})]})};var N=require("react/jsx-runtime"),J=T.default.forwardRef(({children:o,onClick:i,label:s="Open chat",position:m="top-right",offset:c=8,icon:M,className:L,containerStyle:H,buttonClassName:_,buttonStyle:S,buttonSize:y=36,zIndex:D=10,disabled:h=!1,trigger:$,open:w,onOpenChange:P,renderButton:F,openWindowOnClick:d=!1,windowProps:W,windowContent:A},C)=>{let[K,R]=(0,T.useState)(!1),[v,x]=(0,T.useState)(!1),e=(0,T.useRef)(null),t=$??"hover",a=(0,T.useMemo)(()=>{let u={position:"absolute"},g=`${c}px`;switch(m){case"top-left":return{...u,top:g,left:g};case"top-right":return{...u,top:g,right:g};case"bottom-left":return{...u,bottom:g,left:g};case"bottom-right":default:return{...u,bottom:g,right:g}}},[m,c]),r=t==="always"?!0:t==="manual"?!!w:K,n=u=>{P&&P(u)},p={onMouseEnter:t==="hover"?()=>{R(!0),n(!0)}:void 0,onMouseLeave:t==="hover"?()=>{R(!1),n(!1)}:void 0,onFocus:t==="focus"?()=>{R(!0),n(!0)}:void 0,onBlur:t==="focus"?()=>{R(!1),n(!1)}:void 0},b=u=>{e.current=u,typeof C=="function"?C(u):C&&typeof C=="object"&&(C.current=u)},k={type:"button","aria-label":s,onClick:u=>{i?.(u),!h&&d&&x(!0)},className:_,disabled:h,style:{...a,zIndex:D,width:y,height:y,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:h?"#f3f4f6":"white",color:h?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:h?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:r?1:0,transform:r?"scale(1)":"scale(0.95)",pointerEvents:r?"auto":"none",...S},tabIndex:r?0:-1,"aria-hidden":r?void 0:!0,ref:b,visible:r};return(0,N.jsxs)("div",{className:L,style:{position:"relative",display:"inline-block",...H},...p,children:[o,F?F(k):(0,N.jsx)("button",{...k,children:M??(0,N.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(y*.5)),height:Math.max(12,Math.floor(y*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,N.jsx)("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),d&&v&&A&&(0,N.jsx)(Y,{...W,onClose:()=>{W?.onClose?.(),x(!1)},anchorRect:W?.anchorRect??(e.current?e.current.getBoundingClientRect():null),children:A})]})});J.displayName="ChatEnabled";var f=require("react");var j="ai-hud:default-chatbot:history:";function V(o){return`${j}${o}`}function q(o){try{typeof window<"u"&&window.localStorage.removeItem(V(o))}catch{}}function Q(){try{if(typeof window>"u")return;let o=[];for(let i=0;i<window.localStorage.length;i++){let s=window.localStorage.key(i);s&&s.startsWith(j)&&o.push(s)}o.forEach(i=>window.localStorage.removeItem(i))}catch{}}var l=require("react/jsx-runtime"),ue="https://api.openai.com/v1/chat/completions";async function fe(o){return new Promise((i,s)=>{let m=new FileReader;m.onload=()=>i(m.result),m.onerror=s,m.readAsDataURL(o)})}var ee=({model:o="gpt-4o-mini",placeholderApiKey:i="REPLACE_WITH_YOUR_OPENAI_API_KEY",systemPrompt:s="You are a helpful assistant.",welcome:m="Hi! How can I help you today?",className:c,style:M,conversationId:L})=>{let H=(0,f.useRef)(null);if(!L&&!H.current){let e=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();H.current=e}let _=L??H.current,S=`${j}${_}`,[y,D]=(0,f.useState)(()=>{try{let e=typeof window<"u"?window.localStorage.getItem(S):null;if(e){let t=JSON.parse(e);if(Array.isArray(t))return t}}catch{}return[{id:"welcome",role:"assistant",text:m}]}),[h,$]=(0,f.useState)(""),[w,P]=(0,f.useState)([]),[F,d]=(0,f.useState)(!1),W=(0,f.useRef)(null),A=(0,f.useCallback)(()=>{W.current?.scrollIntoView({behavior:"smooth"})},[]),C=async e=>{let t=Array.from(e.target.files||[]);if(t.length===0)return;let a=await Promise.all(t.map(fe));P(r=>[...r,...a]),e.target.value=""},K=e=>{P(t=>t.filter((a,r)=>r!==e))},R=(0,f.useCallback)((e,t)=>{let a=[];s&&a.push({role:"system",content:s});for(let r of e)if(r.role==="assistant")a.push({role:"assistant",content:r.text||""});else if((r.images?.length||0)>0){let n=[{type:"text",text:r.text||""},...r.images.map(p=>({type:"image_url",image_url:{url:p}}))];a.push({role:"user",content:n})}else a.push({role:"user",content:r.text||""});if(t)if(t.images.length>0){let r=[{type:"text",text:t.text},...t.images.map(n=>({type:"image_url",image_url:{url:n}}))];a.push({role:"user",content:r})}else a.push({role:"user",content:t.text});return a},[s]),v=(0,f.useCallback)(async()=>{let e=h.trim();if(!e&&w.length===0)return;let t={id:String(Date.now()),role:"user",text:e||void 0,images:w.length?w:void 0};D(a=>[...a,t]),$(""),P([]),d(!0);try{let a=R(y,{text:t.text||"",images:t.images||[]}),r=await fetch(ue,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:o,messages:a,temperature:.7})});if(!r.ok)throw new Error(`OpenAI error: ${r.status}`);let p=(await r.json())?.choices?.[0]?.message?.content??"",b={id:String(Date.now()+1),role:"assistant",text:typeof p=="string"?p:String(p)};D(k=>[...k,b]),setTimeout(A,0)}catch(a){let r={id:String(Date.now()+1),role:"assistant",text:`Error: ${a?.message||"Failed to contact OpenAI"}`};D(n=>[...n,r])}finally{d(!1)}},[R,h,y,w,i,o,A]),x=(0,f.useMemo)(()=>(h.trim().length>0||w.length>0)&&!F,[h,w.length,F]);return(0,f.useEffect)(()=>{try{typeof window<"u"&&window.localStorage.setItem(S,JSON.stringify(y))}catch{}},[y,S]),(0,f.useEffect)(()=>()=>{if(!L)try{typeof window<"u"&&window.localStorage.removeItem(S)}catch{}},[L,S]),(0,l.jsxs)("div",{className:c,style:{display:"flex",flexDirection:"column",height:"100%",...M},children:[(0,l.jsxs)("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[y.map(e=>(0,l.jsx)("div",{style:{marginBottom:10,display:"flex",justifyContent:e.role==="user"?"flex-end":"flex-start"},children:(0,l.jsxs)("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:e.role==="user"?"#111827":"#f3f4f6",color:e.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.text,e.images&&e.images.length>0&&(0,l.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:e.images.map((t,a)=>(0,l.jsx)("img",{src:t,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},a))})]})},e.id)),(0,l.jsx)("div",{ref:W})]}),(0,l.jsxs)("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,l.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:C,style:{display:"none"},id:"ai-hud-chatbot-file"}),(0,l.jsx)("label",{htmlFor:"ai-hud-chatbot-file",children:(0,l.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,l.jsx)("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),(0,l.jsx)("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),(0,l.jsx)("input",{value:h,onChange:e=>$(e.target.value),placeholder:"Type a message...",onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),x&&v())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),(0,l.jsx)("button",{type:"button",disabled:!x,onClick:()=>void v(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:x?"#111827":"#e5e7eb",color:x?"#ffffff":"#9ca3af",cursor:x?"pointer":"not-allowed"},children:"Send"})]}),w.length>0&&(0,l.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:w.map((e,t)=>(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsx)("img",{src:e,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),(0,l.jsx)("button",{type:"button",onClick:()=>K(t),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},t))})]})]})};0&&(module.exports={CHAT_STORAGE_PREFIX,ChatEnabled,DefaultChatbot,FloatingWindow,clearAllConversations,clearConversation,getConversationStorageKey});
//# sourceMappingURL=index.cjs.map