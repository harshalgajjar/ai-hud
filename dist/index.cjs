"use strict";var ne=Object.create;var X=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var le=(o,i)=>{for(var s in i)X(o,s,{get:i[s],enumerable:!0})},Z=(o,i,s,m)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of ie(i))!ae.call(o,c)&&c!==s&&X(o,c,{get:()=>i[c],enumerable:!(m=re(i,c))||m.enumerable});return o};var de=(o,i,s)=>(s=o!=null?ne(se(o)):{},Z(i||!o||!o.__esModule?X(s,"default",{value:o,enumerable:!0}):s,o)),ue=o=>Z(X({},"__esModule",{value:!0}),o);var pe={};le(pe,{CHAT_STORAGE_PREFIX:()=>U,ChatEnabled:()=>G,DefaultChatbot:()=>ee,FloatingWindow:()=>Y,clearAllConversations:()=>Q,clearConversation:()=>q,getConversationStorageKey:()=>V});module.exports=ue(pe);var L=de(require("react"),1);var T=require("react"),C=require("react/jsx-runtime"),Y=({children:o,title:i,onClose:s,position:m="bottom-right",width:c=360,height:R=480,minWidth:F=280,minHeight:W=240,offset:A=16,zIndex:j=1e3,className:h,style:E,headerClassName:v,bodyClassName:S,closeButtonAriaLabel:_="Close",closeOnEscape:b=!0,draggable:M=!0,anchorRect:l})=>{let[H,O]=(0,T.useState)(!1),x=(0,T.useRef)(null),[K,P]=(0,T.useState)(!1),y=(0,T.useRef)(null),[k,w]=(0,T.useState)(null);(0,T.useEffect)(()=>{if(!b)return;let e=f=>{f.key==="Escape"&&s?.()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b,s]);let t=(()=>{let e=`${A}px`;switch(m){case"top-left":return{top:e,left:e};case"top-right":return{top:e,right:e};case"bottom-left":return{bottom:e,left:e};case"bottom-right":default:return{bottom:e,right:e}}})(),n=(()=>{if(m!=="auto"||!l)return null;let e=window.innerWidth,f=window.innerHeight,u=A,I=l.top<f/2,d=l.left>e/2,g=I?["bottom","top"]:["top","bottom"],$=d?["right","left"]:["left","right"],z=[`${g[0]}-${$[0]}`,`${g[0]}-${$[1]}`,`${g[1]}-${$[0]}`,`${g[1]}-${$[1]}`];for(let J of z){let D=0,N=0;if(J==="bottom-right"?(D=l.bottom+u,N=l.right-c):J==="bottom-left"?(D=l.bottom+u,N=l.left):J==="top-right"?(D=l.top-R-u,N=l.right-c):(D=l.top-R-u,N=l.left),D>=0&&N>=0&&D+R<=f&&N+c<=e)return{top:D,left:N}}let te=Math.min(Math.max(l.bottom+u,0),f-R),oe=Math.min(Math.max(l.right-c,0),e-c);return{top:te,left:oe}})(),r=e=>{if(!M)return;let f=x.current;if(!f)return;let u=f.getBoundingClientRect();y.current={x:e.clientX,y:e.clientY,top:u.top,left:u.left},w({top:u.top,left:u.left}),P(!0);let I=g=>{if(!y.current)return;let $=g.clientX-y.current.x,z=g.clientY-y.current.y;w({top:y.current.top+z,left:y.current.left+$})},d=()=>{P(!1),y.current=null,window.removeEventListener("pointermove",I),window.removeEventListener("pointerup",d)};window.addEventListener("pointermove",I),window.addEventListener("pointerup",d,{once:!0})};return(0,C.jsxs)("div",{ref:x,role:"dialog","aria-modal":"false",className:h,style:{position:"fixed",...k?{top:k.top,left:k.left}:n?{top:n.top,left:n.left}:t,width:c,height:R,minWidth:F,minHeight:W,zIndex:j,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:K?"none":void 0,...E},children:[(0,C.jsxs)("div",{className:v,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:M?"move":void 0},onPointerDown:r,children:[(0,C.jsx)("div",{style:{fontWeight:600,color:"#111827"},children:i}),(0,C.jsx)("button",{type:"button",onClick:s,"aria-label":_,onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:H?"#ef4444":void 0,transition:"color 120ms ease"},children:(0,C.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,C.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,C.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,C.jsx)("div",{className:S,style:{flex:1,overflow:"auto",background:"#ffffff"},children:o})]})};var B=require("react/jsx-runtime"),G=L.default.forwardRef(({children:o,onClick:i,label:s="Open chat",position:m="top-right",offset:c=8,icon:R,className:F,containerStyle:W,buttonClassName:A,buttonStyle:j,buttonSize:h=36,zIndex:E=10,disabled:v=!1,trigger:S,open:_,onOpenChange:b,renderButton:M,openWindowOnClick:l=!1,windowProps:H,windowContent:O},x)=>{let[K,P]=(0,L.useState)(!1),[y,k]=(0,L.useState)(!1),w=(0,L.useRef)(null),t=S??"hover",n=(0,L.useMemo)(()=>{let d={position:"absolute"},g=`${c}px`;switch(m){case"top-left":return{...d,top:g,left:g};case"top-right":return{...d,top:g,right:g};case"bottom-left":return{...d,bottom:g,left:g};case"bottom-right":default:return{...d,bottom:g,right:g}}},[m,c]),r=t==="always"?!0:t==="manual"?!!_:K,e=d=>{b&&b(d)},f={onMouseEnter:t==="hover"?()=>{P(!0),e(!0)}:void 0,onMouseLeave:t==="hover"?()=>{P(!1),e(!1)}:void 0,onFocus:t==="focus"?()=>{P(!0),e(!0)}:void 0,onBlur:t==="focus"?()=>{P(!1),e(!1)}:void 0},u=d=>{w.current=d,typeof x=="function"?x(d):x&&typeof x=="object"&&(x.current=d)},I={type:"button","aria-label":s,onClick:d=>{i?.(d),!v&&l&&k(!0)},className:A,disabled:v,style:{...n,zIndex:E,width:h,height:h,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:v?"#f3f4f6":"white",color:v?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:v?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:r?1:0,transform:r?"scale(1)":"scale(0.95)",pointerEvents:r?"auto":"none",...j},tabIndex:r?0:-1,"aria-hidden":r?void 0:!0,ref:u,visible:r};return(0,B.jsxs)("div",{className:F,style:{position:"relative",display:"inline-block",...W},...f,children:[o,M?M(I):(0,B.jsx)("button",{...I,children:R??(0,B.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(h*.5)),height:Math.max(12,Math.floor(h*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,B.jsx)("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),l&&y&&O&&(0,B.jsx)(Y,{...H,onClose:()=>{H?.onClose?.(),k(!1)},anchorRect:H?.anchorRect??(w.current?w.current.getBoundingClientRect():null),children:O})]})});G.displayName="ChatEnabled";var p=require("react");var U="ai-hud:default-chatbot:history:";function V(o){return`${U}${o}`}function q(o){try{typeof window<"u"&&window.localStorage.removeItem(V(o))}catch{}}function Q(){try{if(typeof window>"u")return;let o=[];for(let i=0;i<window.localStorage.length;i++){let s=window.localStorage.key(i);s&&s.startsWith(U)&&o.push(s)}o.forEach(i=>window.localStorage.removeItem(i))}catch{}}var a=require("react/jsx-runtime"),ce="https://api.openai.com/v1/chat/completions";async function fe(o){return new Promise((i,s)=>{let m=new FileReader;m.onload=()=>i(m.result),m.onerror=s,m.readAsDataURL(o)})}var ee=({model:o="gpt-4o-mini",placeholderApiKey:i="REPLACE_WITH_YOUR_OPENAI_API_KEY",systemPrompt:s="You are a helpful assistant.",welcome:m="Hi! How can I help you today?",className:c,style:R,conversationId:F,context:W})=>{let A=(0,p.useRef)(null);if(!F&&!A.current){let t=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();A.current=t}let j=F??A.current,h=`${U}${j}`,[E,v]=(0,p.useState)(()=>{try{let t=typeof window<"u"?window.localStorage.getItem(h):null;if(t){let n=JSON.parse(t);if(Array.isArray(n))return n}}catch{}return[{id:"welcome",role:"assistant",text:m}]}),[S,_]=(0,p.useState)(""),[b,M]=(0,p.useState)([]),[l,H]=(0,p.useState)(!1),O=(0,p.useRef)(null),x=(0,p.useCallback)(()=>{O.current?.scrollIntoView({behavior:"smooth"})},[]),K=async t=>{let n=Array.from(t.target.files||[]);if(n.length===0)return;let r=await Promise.all(n.map(fe));M(e=>[...e,...r]),t.target.value=""},P=t=>{M(n=>n.filter((r,e)=>e!==t))},y=(0,p.useCallback)((t,n)=>{let r=[];if(s&&r.push({role:"system",content:s}),typeof W<"u"){let e="";try{e=JSON.stringify(W)}catch{e=String(W)}r.push({role:"system",content:`Context: ${e}`})}for(let e of t)if(e.role==="assistant")r.push({role:"assistant",content:e.text||""});else if((e.images?.length||0)>0){let f=[{type:"text",text:e.text||""},...e.images.map(u=>({type:"image_url",image_url:{url:u}}))];r.push({role:"user",content:f})}else r.push({role:"user",content:e.text||""});if(n)if(n.images.length>0){let e=[{type:"text",text:n.text},...n.images.map(f=>({type:"image_url",image_url:{url:f}}))];r.push({role:"user",content:e})}else r.push({role:"user",content:n.text});return r},[s,W]),k=(0,p.useCallback)(async()=>{let t=S.trim();if(!t&&b.length===0)return;let n={id:String(Date.now()),role:"user",text:t||void 0,images:b.length?b:void 0};v(r=>[...r,n]),_(""),M([]),H(!0);try{let r=y(E,{text:n.text||"",images:n.images||[]}),e=await fetch(ce,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:o,messages:r,temperature:.7})});if(!e.ok)throw new Error(`OpenAI error: ${e.status}`);let u=(await e.json())?.choices?.[0]?.message?.content??"",I={id:String(Date.now()+1),role:"assistant",text:typeof u=="string"?u:String(u)};v(d=>[...d,I]),setTimeout(x,0)}catch(r){let e={id:String(Date.now()+1),role:"assistant",text:`Error: ${r?.message||"Failed to contact OpenAI"}`};v(f=>[...f,e])}finally{H(!1)}},[y,S,E,b,i,o,x]),w=(0,p.useMemo)(()=>(S.trim().length>0||b.length>0)&&!l,[S,b.length,l]);return(0,p.useEffect)(()=>{try{typeof window<"u"&&window.localStorage.setItem(h,JSON.stringify(E))}catch{}},[E,h]),(0,p.useEffect)(()=>()=>{if(!F)try{typeof window<"u"&&window.localStorage.removeItem(h)}catch{}},[F,h]),(0,a.jsxs)("div",{className:c,style:{display:"flex",flexDirection:"column",height:"100%",...R},children:[(0,a.jsxs)("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[E.map(t=>(0,a.jsx)("div",{style:{marginBottom:10,display:"flex",justifyContent:t.role==="user"?"flex-end":"flex-start"},children:(0,a.jsxs)("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:t.role==="user"?"#111827":"#f3f4f6",color:t.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[t.text,t.images&&t.images.length>0&&(0,a.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:t.images.map((n,r)=>(0,a.jsx)("img",{src:n,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},r))})]})},t.id)),(0,a.jsx)("div",{ref:O})]}),(0,a.jsxs)("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:K,style:{display:"none"},id:"ai-hud-chatbot-file"}),(0,a.jsx)("label",{htmlFor:"ai-hud-chatbot-file",children:(0,a.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),(0,a.jsx)("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),(0,a.jsx)("input",{value:S,onChange:t=>_(t.target.value),placeholder:"Type a message...",onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),w&&k())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),(0,a.jsx)("button",{type:"button",disabled:!w,onClick:()=>void k(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:w?"#111827":"#e5e7eb",color:w?"#ffffff":"#9ca3af",cursor:w?"pointer":"not-allowed"},children:"Send"})]}),b.length>0&&(0,a.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:b.map((t,n)=>(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("img",{src:t,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),(0,a.jsx)("button",{type:"button",onClick:()=>P(n),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},n))})]})]})};0&&(module.exports={CHAT_STORAGE_PREFIX,ChatEnabled,DefaultChatbot,FloatingWindow,clearAllConversations,clearConversation,getConversationStorageKey});
//# sourceMappingURL=index.cjs.map