"use strict";var dt=Object.create;var q=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var pt=Object.getPrototypeOf,ft=Object.prototype.hasOwnProperty;var gt=(r,s)=>{for(var a in s)q(r,a,{get:s[a],enumerable:!0})},et=(r,s,a,h)=>{if(s&&typeof s=="object"||typeof s=="function")for(let g of ut(s))!ft.call(r,g)&&g!==a&&q(r,g,{get:()=>s[g],enumerable:!(h=ct(s,g))||h.enumerable});return r};var nt=(r,s,a)=>(a=r!=null?dt(pt(r)):{},et(s||!r||!r.__esModule?q(a,"default",{value:r,enumerable:!0}):a,r)),mt=r=>et(q({},"__esModule",{value:!0}),r);var bt={};gt(bt,{CHAT_STORAGE_PREFIX:()=>X,ChatEnabled:()=>Q,DefaultChatbot:()=>it,FloatingWindow:()=>Z,clearAllConversations:()=>st,clearConversation:()=>rt,getConversationStorageKey:()=>tt});module.exports=mt(bt);var m=nt(require("react"),1),ot=nt(require("html2canvas"),1);var W=require("react"),M=require("react/jsx-runtime"),Z=({children:r,title:s,onClose:a,position:h="bottom-right",width:g=360,height:S=480,minWidth:N=280,minHeight:U=240,offset:B=16,zIndex:V=1e3,className:k,style:T,headerClassName:E,bodyClassName:j,closeButtonAriaLabel:G="Close",closeOnEscape:$=!0,draggable:L=!0,anchorRect:u})=>{let[w,y]=(0,W.useState)(!1),C=(0,W.useRef)(null),[H,A]=(0,W.useState)(!1),d=(0,W.useRef)(null),[_,D]=(0,W.useState)(null);(0,W.useEffect)(()=>{if(!$)return;let l=p=>{p.key==="Escape"&&a?.()};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[$,a]);let z=(()=>{let l=`${B}px`;switch(h){case"top-left":return{top:l,left:l};case"top-right":return{top:l,right:l};case"bottom-left":return{bottom:l,left:l};case"bottom-right":default:return{bottom:l,right:l}}})(),O=(()=>{if(h!=="auto"||!u)return null;let l=window.innerWidth,p=window.innerHeight,c=B,v=u.top<p/2,I=u.left>l/2,P=v?["bottom","top"]:["top","bottom"],x=I?["right","left"]:["left","right"],K=[`${P[0]}-${x[0]}`,`${P[0]}-${x[1]}`,`${P[1]}-${x[0]}`,`${P[1]}-${x[1]}`];for(let e of K){let o=0,n=0;if(e==="bottom-right"?(o=u.bottom+c,n=u.right-g):e==="bottom-left"?(o=u.bottom+c,n=u.left):e==="top-right"?(o=u.top-S-c,n=u.right-g):(o=u.top-S-c,n=u.left),o>=0&&n>=0&&o+S<=p&&n+g<=l)return{top:o,left:n}}let R=Math.min(Math.max(u.bottom+c,0),p-S),t=Math.min(Math.max(u.right-g,0),l-g);return{top:R,left:t}})(),J=l=>{if(!L)return;let p=C.current;if(!p)return;let c=p.getBoundingClientRect();d.current={x:l.clientX,y:l.clientY,top:c.top,left:c.left},D({top:c.top,left:c.left}),A(!0);let v=P=>{if(!d.current)return;let x=P.clientX-d.current.x,K=P.clientY-d.current.y;D({top:d.current.top+K,left:d.current.left+x})},I=()=>{A(!1),d.current=null,window.removeEventListener("pointermove",v),window.removeEventListener("pointerup",I)};window.addEventListener("pointermove",v),window.addEventListener("pointerup",I,{once:!0})};return(0,M.jsxs)("div",{ref:C,role:"dialog","aria-modal":"false",className:k,style:{position:"fixed",..._?{top:_.top,left:_.left}:O?{top:O.top,left:O.left}:z,width:g,height:S,minWidth:N,minHeight:U,zIndex:V,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:H?"none":void 0,...T},children:[(0,M.jsxs)("div",{className:E,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:L?"move":void 0},onPointerDown:J,children:[(0,M.jsx)("div",{style:{fontWeight:600,color:"#111827"},children:s}),(0,M.jsx)("button",{type:"button",onClick:a,"aria-label":G,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:w?"#ef4444":void 0,transition:"color 120ms ease"},children:(0,M.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,M.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,M.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,M.jsx)("div",{className:j,style:{flex:1,overflow:"auto",background:"#ffffff"},children:r})]})};var F=require("react/jsx-runtime"),Q=m.default.forwardRef(({children:r,onClick:s,label:a="Open chat",position:h="top-right",offset:g=8,icon:S,className:N,containerStyle:U,buttonClassName:B,buttonStyle:V,buttonSize:k=36,zIndex:T=10,disabled:E=!1,trigger:j,open:G,onOpenChange:$,renderButton:L,openWindowOnClick:u=!1,windowProps:w,windowContent:y},C)=>{let[H,A]=(0,m.useState)(!1),[d,_]=(0,m.useState)(!1),D=(0,m.useRef)(null),z=(0,m.useRef)(null),O=(0,m.useRef)(null),[J,l]=(0,m.useState)(null),p=j??"hover",c=(0,m.useMemo)(()=>{let t={position:"absolute"},e=`${g}px`;switch(h){case"top-left":return{...t,top:e,left:e};case"top-right":return{...t,top:e,right:e};case"bottom-left":return{...t,bottom:e,left:e};case"bottom-right":default:return{...t,bottom:e,right:e}}},[h,g]),v=p==="always"?!0:p==="manual"?!!G:H,I=t=>{$&&$(t)},P={onMouseEnter:p==="hover"?()=>{A(!0),I(!0)}:void 0,onMouseLeave:p==="hover"?()=>{A(!1),I(!1)}:void 0,onFocus:p==="focus"?()=>{A(!0),I(!0)}:void 0,onBlur:p==="focus"?()=>{A(!1),I(!1)}:void 0},x=!!w?.sendComponentImageAsContext;(0,m.useEffect)(()=>{d&&(async()=>{if(!x)return;let e=O.current;if(e)try{await new Promise(b=>requestAnimationFrame(()=>setTimeout(b,50)));let n=(await(0,ot.default)(e,{useCORS:!0,backgroundColor:null,scale:Math.min(2,Math.max(1,Math.ceil(e.offsetWidth/280)))})).toDataURL("image/png",.92);l(n)}catch{}})()},[d,x]);let K=t=>{D.current=t,typeof C=="function"?C(t):C&&typeof C=="object"&&(C.current=t)},R={type:"button","aria-label":a,onClick:t=>{s?.(t),!E&&u&&_(!0)},className:B,disabled:E,style:{...c,zIndex:T,width:k,height:k,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:E?"#f3f4f6":"white",color:E?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:E?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:v?1:0,transform:v?"scale(1)":"scale(0.95)",pointerEvents:v?"auto":"none",...V},tabIndex:v?0:-1,"aria-hidden":v?void 0:!0,ref:K,visible:v};return(0,F.jsxs)("div",{className:N,style:{position:"relative",display:"inline-block",...U},...P,ref:z,children:[(0,F.jsx)("div",{ref:O,style:{display:"inline-block"},children:r}),L?L(R):(0,F.jsx)("button",{...R,children:S??(0,F.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(k*.5)),height:Math.max(12,Math.floor(k*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,F.jsx)("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),u&&d&&y&&(0,F.jsx)(Z,{...w,onClose:()=>{w?.onClose?.(),_(!1),l(null)},anchorRect:w?.anchorRect??(D.current?D.current.getBoundingClientRect():null),children:(()=>{if(x){if(!J)return(0,F.jsx)("div",{style:{padding:12,color:"#6b7280",fontSize:14},children:"Loading..."});if(m.default.isValidElement(y)){let e=[...y.props?.contextImages??[],J];try{return m.default.cloneElement(y,{contextImages:e})}catch{return y}}}return y})()})]})});Q.displayName="ChatEnabled";var f=require("react");var X="ai-hud:default-chatbot:history:";function tt(r){return`${X}${r}`}function rt(r){try{typeof window<"u"&&window.localStorage.removeItem(tt(r))}catch{}}function st(){try{if(typeof window>"u")return;let r=[];for(let s=0;s<window.localStorage.length;s++){let a=window.localStorage.key(s);a&&a.startsWith(X)&&r.push(a)}r.forEach(s=>window.localStorage.removeItem(s))}catch{}}var i=require("react/jsx-runtime"),ht="https://api.openai.com/v1/chat/completions";async function yt(r){return new Promise((s,a)=>{let h=new FileReader;h.onload=()=>s(h.result),h.onerror=a,h.readAsDataURL(r)})}var it=({model:r="gpt-4o-mini",placeholderApiKey:s,systemPrompt:a="You are a helpful assistant.",welcome:h="Hi! How can I help you today?",className:g,style:S,conversationId:N,context:U,contextImages:B,inputPlaceholder:V,inputValue:k,agents:T,activeAgentId:E,onAgentChange:j})=>{let $=(t=>{if(t&&t!=="REPLACE_WITH_YOUR_OPENAI_API_KEY")return t;try{let e=globalThis||{};if(typeof e.AI_HUD_OPENAI_API_KEY=="string"&&e.AI_HUD_OPENAI_API_KEY)return e.AI_HUD_OPENAI_API_KEY;if(typeof e.__AI_HUD_OPENAI_API_KEY__=="string"&&e.__AI_HUD_OPENAI_API_KEY__)return e.__AI_HUD_OPENAI_API_KEY__}catch{}try{let e=globalThis.process;if(e&&e.env&&typeof e.env.AI_HUD_OPENAI_API_KEY=="string")return e.env.AI_HUD_OPENAI_API_KEY}catch{}return null})(s),L=(0,f.useRef)(null);if(!N&&!L.current){let t=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();L.current=t}let u=N??L.current,w=`${X}${u}`,[y,C]=(0,f.useState)(()=>{try{let t=typeof window<"u"?window.localStorage.getItem(w):null;if(t){let e=JSON.parse(t);if(Array.isArray(e))return e}}catch{}return[{id:"welcome",role:"assistant",text:h}]}),[H,A]=(0,f.useState)(()=>typeof k=="string"?k:""),[d,_]=(0,f.useState)([]),[D,z]=(0,f.useState)(!1),O=(0,f.useRef)(null),[J,l]=(0,f.useState)(()=>T?.[0]?.id),p=E??J,c=T?.find(t=>t.id===p),v=(0,f.useCallback)(()=>{O.current?.scrollIntoView({behavior:"smooth"})},[]),I=async t=>{let e=Array.from(t.target.files||[]);if(e.length===0)return;let o=await Promise.all(e.map(yt));_(n=>[...n,...o]),t.target.value=""},P=t=>{_(e=>e.filter((o,n)=>n!==t))},x=(0,f.useCallback)((t,e)=>{let o=[];if(c?.systemPrompt&&o.push({role:"system",content:c.systemPrompt}),a&&o.push({role:"system",content:a}),typeof U<"u"){let n="";try{n=JSON.stringify(U)}catch{n=String(U)}o.push({role:"system",content:`Context: ${n}`})}if(typeof c?.context<"u")try{o.push({role:"system",content:`AgentContext: ${JSON.stringify(c.context)}`})}catch{o.push({role:"system",content:`AgentContext: ${String(c.context)}`})}if(Array.isArray(B)&&B.length>0){let n=B.filter(b=>typeof b=="string"&&(b.startsWith("data:image/")||b.startsWith("http")));if(n.length>0){let b=[{type:"text",text:"Context images"},...n.map(Y=>({type:"image_url",image_url:{url:Y}}))];o.push({role:"user",content:b})}}for(let n of t)if(n.role==="assistant")o.push({role:"assistant",content:n.text||""});else if((n.images?.length||0)>0){let b=[{type:"text",text:n.text||""},...n.images.map(Y=>({type:"image_url",image_url:{url:Y}}))];o.push({role:"user",content:b})}else o.push({role:"user",content:n.text||""});if(e)if(e.images.length>0){let n=[{type:"text",text:e.text},...e.images.map(b=>({type:"image_url",image_url:{url:b}}))];o.push({role:"user",content:n})}else o.push({role:"user",content:e.text});return console.log("result",o),o},[a,U,c?.systemPrompt,c?.context]),K=(0,f.useCallback)(async()=>{let t=H.trim();if(!t&&d.length===0)return;let e={id:String(Date.now()),role:"user",text:t||void 0,images:d.length?d:void 0};C(o=>[...o,e]),A(""),_([]),z(!0);try{let o=x(y,{text:e.text||"",images:e.images||[]}),n=await fetch(ht,{method:"POST",headers:{"Content-Type":"application/json",...$?{Authorization:`Bearer ${$}`}:{}},body:JSON.stringify({model:r,messages:o,temperature:.7})});if(!n.ok)throw new Error(`OpenAI error: ${n.status}`);let Y=(await n.json())?.choices?.[0]?.message?.content??"",at={id:String(Date.now()+1),role:"assistant",text:typeof Y=="string"?Y:String(Y)};C(lt=>[...lt,at]),setTimeout(v,0)}catch(o){let n={id:String(Date.now()+1),role:"assistant",text:`Error: ${o?.message||"Failed to contact OpenAI"}`};C(b=>[...b,n])}finally{z(!1)}},[x,H,y,d,s,r,v]),R=(0,f.useMemo)(()=>(H.trim().length>0||d.length>0)&&!D,[H,d.length,D]);return(0,f.useEffect)(()=>{try{typeof window<"u"&&window.localStorage.setItem(w,JSON.stringify(y))}catch{}},[y,w]),(0,f.useEffect)(()=>()=>{if(!N)try{typeof window<"u"&&window.localStorage.removeItem(w)}catch{}},[N,w]),(0,i.jsxs)("div",{className:g,style:{display:"flex",flexDirection:"column",height:"100%",...S},children:[(0,i.jsxs)("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[Array.isArray(T)&&T.length>0&&(0,i.jsx)("div",{style:{display:"flex",gap:8,marginBottom:8,flexWrap:"wrap"},children:T.map(t=>{let e=t.id===p;return(0,i.jsxs)("button",{type:"button",onClick:()=>{E&&j&&j(t.id),E||l(t.id)},style:{display:"inline-flex",alignItems:"center",gap:6,padding:"6px 10px",borderRadius:8,border:e?"1px solid #111827":"1px solid #e5e7eb",background:e?"#111827":"white",color:e?"white":"#111827",cursor:"pointer"},children:[t.icon,(0,i.jsx)("span",{children:t.name})]},t.id)})}),y.map(t=>(0,i.jsx)("div",{style:{marginBottom:10,display:"flex",justifyContent:t.role==="user"?"flex-end":"flex-start"},children:(0,i.jsxs)("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:t.role==="user"?"#111827":"#f3f4f6",color:t.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[t.text,t.images&&t.images.length>0&&(0,i.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:t.images.map((e,o)=>(0,i.jsx)("img",{src:e,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},o))})]})},t.id)),(0,i.jsx)("div",{ref:O})]}),(0,i.jsxs)("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,i.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:I,style:{display:"none"},id:"ai-hud-chatbot-file"}),(0,i.jsx)("label",{htmlFor:"ai-hud-chatbot-file",children:(0,i.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),(0,i.jsx)("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),(0,i.jsx)("input",{value:H,onChange:t=>A(t.target.value),placeholder:V??"Type a message...",onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),R&&K())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),(0,i.jsx)("button",{type:"button",disabled:!R,onClick:()=>void K(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:R?"#111827":"#e5e7eb",color:R?"#ffffff":"#9ca3af",cursor:R?"pointer":"not-allowed"},children:"Send"})]}),d.length>0&&(0,i.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:d.map((t,e)=>(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsx)("img",{src:t,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),(0,i.jsx)("button",{type:"button",onClick:()=>P(e),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},e))})]})]})};0&&(module.exports={CHAT_STORAGE_PREFIX,ChatEnabled,DefaultChatbot,FloatingWindow,clearAllConversations,clearConversation,getConversationStorageKey});
//# sourceMappingURL=index.cjs.map