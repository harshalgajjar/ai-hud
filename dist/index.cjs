"use strict";var BC=Object.create;var da=Object.defineProperty;var vC=Object.getOwnPropertyDescriptor;var CC=Object.getOwnPropertyNames;var EC=Object.getPrototypeOf,xC=Object.prototype.hasOwnProperty;var IC=(r,e,t)=>e in r?da(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Z=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ef=(r,e)=>{for(var t in e)da(r,t,{get:e[t],enumerable:!0})},em=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let A of CC(e))!xC.call(r,A)&&A!==t&&da(r,A,{get:()=>e[A],enumerable:!(n=vC(e,A))||n.enumerable});return r};var Ct=(r,e,t)=>(t=r!=null?BC(EC(r)):{},em(e||!r||!r.__esModule?da(t,"default",{value:r,enumerable:!0}):t,r)),UC=r=>em(da({},"__esModule",{value:!0}),r);var gn=(r,e,t)=>IC(r,typeof e!="symbol"?e+"":e,t);var ay=Z((N2,iy)=>{"use strict";iy.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var py=Z((L2,Hd)=>{"use strict";var pT=/[\p{Lu}]/u,hT=/[\p{Ll}]/u,oy=/^[\p{Lu}](?![\p{Lu}])/gu,ly=/([\p{Alpha}\p{N}_]|$)/u,fy=/[_.\- ]+/,mT=new RegExp("^"+fy.source),uy=new RegExp(fy.source+ly.source,"gu"),cy=new RegExp("\\d+"+ly.source,"gu"),gT=(r,e,t)=>{let n=!1,A=!1,s=!1;for(let i=0;i<r.length;i++){let a=r[i];n&&pT.test(a)?(r=r.slice(0,i)+"-"+r.slice(i),n=!1,s=A,A=!0,i++):A&&s&&hT.test(a)?(r=r.slice(0,i-1)+"-"+r.slice(i-1),s=A,A=!1,n=!0):(n=e(a)===a&&t(a)!==a,s=A,A=t(a)===a&&e(a)!==a)}return r},wT=(r,e)=>(oy.lastIndex=0,r.replace(oy,t=>e(t))),yT=(r,e)=>(uy.lastIndex=0,cy.lastIndex=0,r.replace(uy,(t,n)=>e(n)).replace(cy,t=>e(t))),dy=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(r)?r=r.map(s=>s.trim()).filter(s=>s.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),n=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=gT(r,t,n)),r=r.replace(mT,""),e.preserveConsecutiveUppercase?r=wT(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),yT(r,n))};Hd.exports=dy;Hd.exports.default=dy});var Dy=Z((Kj,Hy)=>{"use strict";function pr(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Hy.exports=pr;pr.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};pr.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};pr.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};pr.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};pr.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};pr.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};pr.prototype.start=pr.prototype.try;pr.prototype.errors=function(){return this._errors};pr.prototype.attempts=function(){return this._attempts};pr.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var A=this._errors[n],s=A.message,i=(r[s]||0)+1;r[s]=i,i>=t&&(e=A,t=i)}return e}});var My=Z(Is=>{"use strict";var kO=Dy();Is.operation=function(r){var e=Is.timeouts(r);return new kO(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Is.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],A=0;A<e.retries;A++)n.push(this.createTimeout(A,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(A,e)),n.sort(function(s,i){return s-i}),n};Is.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Is.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var A=0;A<t.length;A++){var s=t[A],i=r[s];r[s]=function(o){var u=Is.operation(e),c=Array.prototype.slice.call(arguments,1),l=c.pop();c.push(function(f){u.retry(f)||(f&&(arguments[0]=u.mainError()),l.apply(this,arguments))}),u.attempt(function(){o.apply(r,c)})}.bind(r,i),r[s].options=e}}});var jy=Z((Gj,$y)=>{"use strict";$y.exports=My()});var Bc=Z((Vj,bc)=>{"use strict";var NO=jy(),LO=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],_c=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},HO=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},DO=r=>LO.includes(r),Ky=(r,e)=>new Promise((t,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};let A=NO.operation(e);A.attempt(async s=>{try{t(await r(s))}catch(i){if(!(i instanceof Error)){n(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof _c)A.stop(),n(i.originalError);else if(i instanceof TypeError&&!DO(i.message))A.stop(),n(i);else{HO(i,s,e);try{await e.onFailedAttempt(i)}catch(a){n(a);return}A.retry(i)||n(A.mainError())}}})});bc.exports=Ky;bc.exports.default=Ky;bc.exports.AbortError=_c});var L_=Z((VK,_p)=>{"use strict";var dS=Object.prototype.hasOwnProperty,Ft="~";function mo(){}Object.create&&(mo.prototype=Object.create(null),new mo().__proto__||(Ft=!1));function pS(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function N_(r,e,t,n,A){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new pS(t,n||r,A),i=Ft?Ft+e:e;return r._events[i]?r._events[i].fn?r._events[i]=[r._events[i],s]:r._events[i].push(s):(r._events[i]=s,r._eventsCount++),r}function Dc(r,e){--r._eventsCount===0?r._events=new mo:delete r._events[e]}function bt(){this._events=new mo,this._eventsCount=0}bt.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)dS.call(t,n)&&e.push(Ft?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};bt.prototype.listeners=function(e){var t=Ft?Ft+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var A=0,s=n.length,i=new Array(s);A<s;A++)i[A]=n[A].fn;return i};bt.prototype.listenerCount=function(e){var t=Ft?Ft+e:e,n=this._events[t];return n?n.fn?1:n.length:0};bt.prototype.emit=function(e,t,n,A,s,i){var a=Ft?Ft+e:e;if(!this._events[a])return!1;var o=this._events[a],u=arguments.length,c,l;if(o.fn){switch(o.once&&this.removeListener(e,o.fn,void 0,!0),u){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,t),!0;case 3:return o.fn.call(o.context,t,n),!0;case 4:return o.fn.call(o.context,t,n,A),!0;case 5:return o.fn.call(o.context,t,n,A,s),!0;case 6:return o.fn.call(o.context,t,n,A,s,i),!0}for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];o.fn.apply(o.context,c)}else{var f=o.length,d;for(l=0;l<f;l++)switch(o[l].once&&this.removeListener(e,o[l].fn,void 0,!0),u){case 1:o[l].fn.call(o[l].context);break;case 2:o[l].fn.call(o[l].context,t);break;case 3:o[l].fn.call(o[l].context,t,n);break;case 4:o[l].fn.call(o[l].context,t,n,A);break;default:if(!c)for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];o[l].fn.apply(o[l].context,c)}}return!0};bt.prototype.on=function(e,t,n){return N_(this,e,t,n,!1)};bt.prototype.once=function(e,t,n){return N_(this,e,t,n,!0)};bt.prototype.removeListener=function(e,t,n,A){var s=Ft?Ft+e:e;if(!this._events[s])return this;if(!t)return Dc(this,s),this;var i=this._events[s];if(i.fn)i.fn===t&&(!A||i.once)&&(!n||i.context===n)&&Dc(this,s);else{for(var a=0,o=[],u=i.length;a<u;a++)(i[a].fn!==t||A&&!i[a].once||n&&i[a].context!==n)&&o.push(i[a]);o.length?this._events[s]=o.length===1?o[0]:o:Dc(this,s)}return this};bt.prototype.removeAllListeners=function(e){var t;return e?(t=Ft?Ft+e:e,this._events[t]&&Dc(this,t)):(this._events=new mo,this._eventsCount=0),this};bt.prototype.off=bt.prototype.removeListener;bt.prototype.addListener=bt.prototype.on;bt.prefixed=Ft;bt.EventEmitter=bt;typeof _p<"u"&&(_p.exports=bt)});var D_=Z((ZK,H_)=>{"use strict";H_.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var $_=Z((JK,$c)=>{"use strict";var hS=D_(),Mc=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},M_=(r,e,t)=>new Promise((n,A)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let s=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(o){A(o)}return}let i=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,a=t instanceof Error?t:new Mc(i);typeof r.cancel=="function"&&r.cancel(),A(a)},e);hS(r.then(n,A),()=>{clearTimeout(s)})});$c.exports=M_;$c.exports.default=M_;$c.exports.TimeoutError=Mc});var j_=Z(bp=>{"use strict";Object.defineProperty(bp,"__esModule",{value:!0});function mS(r,e,t){let n=0,A=r.length;for(;A>0;){let s=A/2|0,i=n+s;t(r[i],e)<=0?(n=++i,A-=s+1):A=s}return n}bp.default=mS});var K_=Z(vp=>{"use strict";Object.defineProperty(vp,"__esModule",{value:!0});var gS=j_(),Bp=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let A=gS.default(this._queue,n,(s,i)=>i.priority-s.priority);this._queue.splice(A,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};vp.default=Bp});var Kc=Z(Ep=>{"use strict";Object.defineProperty(Ep,"__esModule",{value:!0});var wS=L_(),z_=$_(),yS=K_(),jc=()=>{},_S=new z_.TimeoutError,Cp=class extends wS{constructor(e){var t,n,A,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=jc,this._resolveIdle=jc,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:yS.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(A=e.interval)===null||A===void 0?void 0:A.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=jc,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=jc,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,A)=>{let s=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&t.timeout===void 0?e():z_.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&A(_S)});n(await i)}catch(i){A(i)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Ep.default=Cp});var wo=Z((nz,Z_)=>{"use strict";var vS="2.0.0",CS=Number.MAX_SAFE_INTEGER||9007199254740991,ES=16,xS=250,IS=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Z_.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:ES,MAX_SAFE_BUILD_LENGTH:xS,MAX_SAFE_INTEGER:CS,RELEASE_TYPES:IS,SEMVER_SPEC_VERSION:vS,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var yo=Z((Az,J_)=>{"use strict";var US=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};J_.exports=US});var Gi=Z((an,W_)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Up,MAX_SAFE_BUILD_LENGTH:FS,MAX_LENGTH:QS}=wo(),TS=yo();an=W_.exports={};var OS=an.re=[],SS=an.safeRe=[],N=an.src=[],PS=an.safeSrc=[],L=an.t={},RS=0,Fp="[a-zA-Z0-9-]",kS=[["\\s",1],["\\d",QS],[Fp,FS]],NS=r=>{for(let[e,t]of kS)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},ce=(r,e,t)=>{let n=NS(e),A=RS++;TS(r,A,e),L[r]=A,N[A]=e,PS[A]=n,OS[A]=new RegExp(e,t?"g":void 0),SS[A]=new RegExp(n,t?"g":void 0)};ce("NUMERICIDENTIFIER","0|[1-9]\\d*");ce("NUMERICIDENTIFIERLOOSE","\\d+");ce("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Fp}*`);ce("MAINVERSION",`(${N[L.NUMERICIDENTIFIER]})\\.(${N[L.NUMERICIDENTIFIER]})\\.(${N[L.NUMERICIDENTIFIER]})`);ce("MAINVERSIONLOOSE",`(${N[L.NUMERICIDENTIFIERLOOSE]})\\.(${N[L.NUMERICIDENTIFIERLOOSE]})\\.(${N[L.NUMERICIDENTIFIERLOOSE]})`);ce("PRERELEASEIDENTIFIER",`(?:${N[L.NONNUMERICIDENTIFIER]}|${N[L.NUMERICIDENTIFIER]})`);ce("PRERELEASEIDENTIFIERLOOSE",`(?:${N[L.NONNUMERICIDENTIFIER]}|${N[L.NUMERICIDENTIFIERLOOSE]})`);ce("PRERELEASE",`(?:-(${N[L.PRERELEASEIDENTIFIER]}(?:\\.${N[L.PRERELEASEIDENTIFIER]})*))`);ce("PRERELEASELOOSE",`(?:-?(${N[L.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${N[L.PRERELEASEIDENTIFIERLOOSE]})*))`);ce("BUILDIDENTIFIER",`${Fp}+`);ce("BUILD",`(?:\\+(${N[L.BUILDIDENTIFIER]}(?:\\.${N[L.BUILDIDENTIFIER]})*))`);ce("FULLPLAIN",`v?${N[L.MAINVERSION]}${N[L.PRERELEASE]}?${N[L.BUILD]}?`);ce("FULL",`^${N[L.FULLPLAIN]}$`);ce("LOOSEPLAIN",`[v=\\s]*${N[L.MAINVERSIONLOOSE]}${N[L.PRERELEASELOOSE]}?${N[L.BUILD]}?`);ce("LOOSE",`^${N[L.LOOSEPLAIN]}$`);ce("GTLT","((?:<|>)?=?)");ce("XRANGEIDENTIFIERLOOSE",`${N[L.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);ce("XRANGEIDENTIFIER",`${N[L.NUMERICIDENTIFIER]}|x|X|\\*`);ce("XRANGEPLAIN",`[v=\\s]*(${N[L.XRANGEIDENTIFIER]})(?:\\.(${N[L.XRANGEIDENTIFIER]})(?:\\.(${N[L.XRANGEIDENTIFIER]})(?:${N[L.PRERELEASE]})?${N[L.BUILD]}?)?)?`);ce("XRANGEPLAINLOOSE",`[v=\\s]*(${N[L.XRANGEIDENTIFIERLOOSE]})(?:\\.(${N[L.XRANGEIDENTIFIERLOOSE]})(?:\\.(${N[L.XRANGEIDENTIFIERLOOSE]})(?:${N[L.PRERELEASELOOSE]})?${N[L.BUILD]}?)?)?`);ce("XRANGE",`^${N[L.GTLT]}\\s*${N[L.XRANGEPLAIN]}$`);ce("XRANGELOOSE",`^${N[L.GTLT]}\\s*${N[L.XRANGEPLAINLOOSE]}$`);ce("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Up}})(?:\\.(\\d{1,${Up}}))?(?:\\.(\\d{1,${Up}}))?`);ce("COERCE",`${N[L.COERCEPLAIN]}(?:$|[^\\d])`);ce("COERCEFULL",N[L.COERCEPLAIN]+`(?:${N[L.PRERELEASE]})?(?:${N[L.BUILD]})?(?:$|[^\\d])`);ce("COERCERTL",N[L.COERCE],!0);ce("COERCERTLFULL",N[L.COERCEFULL],!0);ce("LONETILDE","(?:~>?)");ce("TILDETRIM",`(\\s*)${N[L.LONETILDE]}\\s+`,!0);an.tildeTrimReplace="$1~";ce("TILDE",`^${N[L.LONETILDE]}${N[L.XRANGEPLAIN]}$`);ce("TILDELOOSE",`^${N[L.LONETILDE]}${N[L.XRANGEPLAINLOOSE]}$`);ce("LONECARET","(?:\\^)");ce("CARETTRIM",`(\\s*)${N[L.LONECARET]}\\s+`,!0);an.caretTrimReplace="$1^";ce("CARET",`^${N[L.LONECARET]}${N[L.XRANGEPLAIN]}$`);ce("CARETLOOSE",`^${N[L.LONECARET]}${N[L.XRANGEPLAINLOOSE]}$`);ce("COMPARATORLOOSE",`^${N[L.GTLT]}\\s*(${N[L.LOOSEPLAIN]})$|^$`);ce("COMPARATOR",`^${N[L.GTLT]}\\s*(${N[L.FULLPLAIN]})$|^$`);ce("COMPARATORTRIM",`(\\s*)${N[L.GTLT]}\\s*(${N[L.LOOSEPLAIN]}|${N[L.XRANGEPLAIN]})`,!0);an.comparatorTrimReplace="$1$2$3";ce("HYPHENRANGE",`^\\s*(${N[L.XRANGEPLAIN]})\\s+-\\s+(${N[L.XRANGEPLAIN]})\\s*$`);ce("HYPHENRANGELOOSE",`^\\s*(${N[L.XRANGEPLAINLOOSE]})\\s+-\\s+(${N[L.XRANGEPLAINLOOSE]})\\s*$`);ce("STAR","(<|>)?=?\\s*\\*");ce("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");ce("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Vc=Z((sz,q_)=>{"use strict";var LS=Object.freeze({loose:!0}),HS=Object.freeze({}),DS=r=>r?typeof r!="object"?LS:r:HS;q_.exports=DS});var Qp=Z((iz,eb)=>{"use strict";var X_=/^[0-9]+$/,Y_=(r,e)=>{let t=X_.test(r),n=X_.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},MS=(r,e)=>Y_(e,r);eb.exports={compareIdentifiers:Y_,rcompareIdentifiers:MS}});var Bt=Z((az,rb)=>{"use strict";var Zc=yo(),{MAX_LENGTH:tb,MAX_SAFE_INTEGER:Jc}=wo(),{safeRe:Wc,t:qc}=Gi(),$S=Vc(),{compareIdentifiers:Vi}=Qp(),Tp=class r{constructor(e,t){if(t=$S(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>tb)throw new TypeError(`version is longer than ${tb} characters`);Zc("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Wc[qc.LOOSE]:Wc[qc.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Jc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Jc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Jc||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(A=>{if(/^[0-9]+$/.test(A)){let s=+A;if(s>=0&&s<Jc)return s}return A}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Zc("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),Vi(this.major,e.major)||Vi(this.minor,e.minor)||Vi(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],A=e.prerelease[t];if(Zc("prerelease compare",t,n,A),n===void 0&&A===void 0)return 0;if(A===void 0)return 1;if(n===void 0)return-1;if(n===A)continue;return Vi(n,A)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],A=e.build[t];if(Zc("build compare",t,n,A),n===void 0&&A===void 0)return 0;if(A===void 0)return 1;if(n===void 0)return-1;if(n===A)continue;return Vi(n,A)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let A=`-${t}`.match(this.options.loose?Wc[qc.PRERELEASELOOSE]:Wc[qc.PRERELEASE]);if(!A||A[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let A=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[A];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(A)}}if(t){let s=[t,A];n===!1&&(s=[t]),Vi(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};rb.exports=Tp});var Ts=Z((oz,Ab)=>{"use strict";var nb=Bt(),jS=(r,e,t=!1)=>{if(r instanceof nb)return r;try{return new nb(r,e)}catch(n){if(!t)return null;throw n}};Ab.exports=jS});var ib=Z((uz,sb)=>{"use strict";var KS=Ts(),zS=(r,e)=>{let t=KS(r,e);return t?t.version:null};sb.exports=zS});var ob=Z((cz,ab)=>{"use strict";var GS=Ts(),VS=(r,e)=>{let t=GS(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};ab.exports=VS});var lb=Z((lz,cb)=>{"use strict";var ub=Bt(),ZS=(r,e,t,n,A)=>{typeof t=="string"&&(A=n,n=t,t=void 0);try{return new ub(r instanceof ub?r.version:r,t).inc(e,n,A).version}catch{return null}};cb.exports=ZS});var pb=Z((fz,db)=>{"use strict";var fb=Ts(),JS=(r,e)=>{let t=fb(r,null,!0),n=fb(e,null,!0),A=t.compare(n);if(A===0)return null;let s=A>0,i=s?t:n,a=s?n:t,o=!!i.prerelease.length;if(!!a.prerelease.length&&!o){if(!a.patch&&!a.minor)return"major";if(a.compareMain(i)===0)return a.minor&&!a.patch?"minor":"patch"}let c=o?"pre":"";return t.major!==n.major?c+"major":t.minor!==n.minor?c+"minor":t.patch!==n.patch?c+"patch":"prerelease"};db.exports=JS});var mb=Z((dz,hb)=>{"use strict";var WS=Bt(),qS=(r,e)=>new WS(r,e).major;hb.exports=qS});var wb=Z((pz,gb)=>{"use strict";var XS=Bt(),YS=(r,e)=>new XS(r,e).minor;gb.exports=YS});var _b=Z((hz,yb)=>{"use strict";var eP=Bt(),tP=(r,e)=>new eP(r,e).patch;yb.exports=tP});var Bb=Z((mz,bb)=>{"use strict";var rP=Ts(),nP=(r,e)=>{let t=rP(r,e);return t&&t.prerelease.length?t.prerelease:null};bb.exports=nP});var hr=Z((gz,Cb)=>{"use strict";var vb=Bt(),AP=(r,e,t)=>new vb(r,t).compare(new vb(e,t));Cb.exports=AP});var xb=Z((wz,Eb)=>{"use strict";var sP=hr(),iP=(r,e,t)=>sP(e,r,t);Eb.exports=iP});var Ub=Z((yz,Ib)=>{"use strict";var aP=hr(),oP=(r,e)=>aP(r,e,!0);Ib.exports=oP});var Xc=Z((_z,Qb)=>{"use strict";var Fb=Bt(),uP=(r,e,t)=>{let n=new Fb(r,t),A=new Fb(e,t);return n.compare(A)||n.compareBuild(A)};Qb.exports=uP});var Ob=Z((bz,Tb)=>{"use strict";var cP=Xc(),lP=(r,e)=>r.sort((t,n)=>cP(t,n,e));Tb.exports=lP});var Pb=Z((Bz,Sb)=>{"use strict";var fP=Xc(),dP=(r,e)=>r.sort((t,n)=>fP(n,t,e));Sb.exports=dP});var _o=Z((vz,Rb)=>{"use strict";var pP=hr(),hP=(r,e,t)=>pP(r,e,t)>0;Rb.exports=hP});var Yc=Z((Cz,kb)=>{"use strict";var mP=hr(),gP=(r,e,t)=>mP(r,e,t)<0;kb.exports=gP});var Op=Z((Ez,Nb)=>{"use strict";var wP=hr(),yP=(r,e,t)=>wP(r,e,t)===0;Nb.exports=yP});var Sp=Z((xz,Lb)=>{"use strict";var _P=hr(),bP=(r,e,t)=>_P(r,e,t)!==0;Lb.exports=bP});var el=Z((Iz,Hb)=>{"use strict";var BP=hr(),vP=(r,e,t)=>BP(r,e,t)>=0;Hb.exports=vP});var tl=Z((Uz,Db)=>{"use strict";var CP=hr(),EP=(r,e,t)=>CP(r,e,t)<=0;Db.exports=EP});var Pp=Z((Fz,Mb)=>{"use strict";var xP=Op(),IP=Sp(),UP=_o(),FP=el(),QP=Yc(),TP=tl(),OP=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return xP(r,t,n);case"!=":return IP(r,t,n);case">":return UP(r,t,n);case">=":return FP(r,t,n);case"<":return QP(r,t,n);case"<=":return TP(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};Mb.exports=OP});var jb=Z((Qz,$b)=>{"use strict";var SP=Bt(),PP=Ts(),{safeRe:rl,t:nl}=Gi(),RP=(r,e)=>{if(r instanceof SP)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?rl[nl.COERCEFULL]:rl[nl.COERCE]);else{let o=e.includePrerelease?rl[nl.COERCERTLFULL]:rl[nl.COERCERTL],u;for(;(u=o.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||u.index+u[0].length!==t.index+t[0].length)&&(t=u),o.lastIndex=u.index+u[1].length+u[2].length;o.lastIndex=-1}if(t===null)return null;let n=t[2],A=t[3]||"0",s=t[4]||"0",i=e.includePrerelease&&t[5]?`-${t[5]}`:"",a=e.includePrerelease&&t[6]?`+${t[6]}`:"";return PP(`${n}.${A}.${s}${i}${a}`,e)};$b.exports=RP});var zb=Z((Tz,Kb)=>{"use strict";var Rp=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let A=this.map.keys().next().value;this.delete(A)}this.map.set(e,t)}return this}};Kb.exports=Rp});var mr=Z((Oz,Jb)=>{"use strict";var kP=/\s+/g,kp=class r{constructor(e,t){if(t=LP(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Np)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(kP," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(A=>!Vb(A[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let A of this.set)if(A.length===1&&zP(A[0])){this.set=[A];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&jP)|(this.options.loose&&KP))+":"+e,A=Gb.get(n);if(A)return A;let s=this.options.loose,i=s?Mt[Qt.HYPHENRANGELOOSE]:Mt[Qt.HYPHENRANGE];e=e.replace(i,tR(this.options.includePrerelease)),Oe("hyphen replace",e),e=e.replace(Mt[Qt.COMPARATORTRIM],DP),Oe("comparator trim",e),e=e.replace(Mt[Qt.TILDETRIM],MP),Oe("tilde trim",e),e=e.replace(Mt[Qt.CARETTRIM],$P),Oe("caret trim",e);let a=e.split(" ").map(l=>GP(l,this.options)).join(" ").split(/\s+/).map(l=>eR(l,this.options));s&&(a=a.filter(l=>(Oe("loose invalid filter",l,this.options),!!l.match(Mt[Qt.COMPARATORLOOSE])))),Oe("range list",a);let o=new Map,u=a.map(l=>new Np(l,this.options));for(let l of u){if(Vb(l))return[l];o.set(l.value,l)}o.size>1&&o.has("")&&o.delete("");let c=[...o.values()];return Gb.set(n,c),c}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>Zb(n,t)&&e.set.some(A=>Zb(A,t)&&n.every(s=>A.every(i=>s.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new HP(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(rR(this.set[t],e,this.options))return!0;return!1}};Jb.exports=kp;var NP=zb(),Gb=new NP,LP=Vc(),Np=bo(),Oe=yo(),HP=Bt(),{safeRe:Mt,t:Qt,comparatorTrimReplace:DP,tildeTrimReplace:MP,caretTrimReplace:$P}=Gi(),{FLAG_INCLUDE_PRERELEASE:jP,FLAG_LOOSE:KP}=wo(),Vb=r=>r.value==="<0.0.0-0",zP=r=>r.value==="",Zb=(r,e)=>{let t=!0,n=r.slice(),A=n.pop();for(;t&&n.length;)t=n.every(s=>A.intersects(s,e)),A=n.pop();return t},GP=(r,e)=>(Oe("comp",r,e),r=JP(r,e),Oe("caret",r),r=VP(r,e),Oe("tildes",r),r=qP(r,e),Oe("xrange",r),r=YP(r,e),Oe("stars",r),r),Tt=r=>!r||r.toLowerCase()==="x"||r==="*",VP=(r,e)=>r.trim().split(/\s+/).map(t=>ZP(t,e)).join(" "),ZP=(r,e)=>{let t=e.loose?Mt[Qt.TILDELOOSE]:Mt[Qt.TILDE];return r.replace(t,(n,A,s,i,a)=>{Oe("tilde",r,n,A,s,i,a);let o;return Tt(A)?o="":Tt(s)?o=`>=${A}.0.0 <${+A+1}.0.0-0`:Tt(i)?o=`>=${A}.${s}.0 <${A}.${+s+1}.0-0`:a?(Oe("replaceTilde pr",a),o=`>=${A}.${s}.${i}-${a} <${A}.${+s+1}.0-0`):o=`>=${A}.${s}.${i} <${A}.${+s+1}.0-0`,Oe("tilde return",o),o})},JP=(r,e)=>r.trim().split(/\s+/).map(t=>WP(t,e)).join(" "),WP=(r,e)=>{Oe("caret",r,e);let t=e.loose?Mt[Qt.CARETLOOSE]:Mt[Qt.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(A,s,i,a,o)=>{Oe("caret",r,A,s,i,a,o);let u;return Tt(s)?u="":Tt(i)?u=`>=${s}.0.0${n} <${+s+1}.0.0-0`:Tt(a)?s==="0"?u=`>=${s}.${i}.0${n} <${s}.${+i+1}.0-0`:u=`>=${s}.${i}.0${n} <${+s+1}.0.0-0`:o?(Oe("replaceCaret pr",o),s==="0"?i==="0"?u=`>=${s}.${i}.${a}-${o} <${s}.${i}.${+a+1}-0`:u=`>=${s}.${i}.${a}-${o} <${s}.${+i+1}.0-0`:u=`>=${s}.${i}.${a}-${o} <${+s+1}.0.0-0`):(Oe("no pr"),s==="0"?i==="0"?u=`>=${s}.${i}.${a}${n} <${s}.${i}.${+a+1}-0`:u=`>=${s}.${i}.${a}${n} <${s}.${+i+1}.0-0`:u=`>=${s}.${i}.${a} <${+s+1}.0.0-0`),Oe("caret return",u),u})},qP=(r,e)=>(Oe("replaceXRanges",r,e),r.split(/\s+/).map(t=>XP(t,e)).join(" ")),XP=(r,e)=>{r=r.trim();let t=e.loose?Mt[Qt.XRANGELOOSE]:Mt[Qt.XRANGE];return r.replace(t,(n,A,s,i,a,o)=>{Oe("xRange",r,n,A,s,i,a,o);let u=Tt(s),c=u||Tt(i),l=c||Tt(a),f=l;return A==="="&&f&&(A=""),o=e.includePrerelease?"-0":"",u?A===">"||A==="<"?n="<0.0.0-0":n="*":A&&f?(c&&(i=0),a=0,A===">"?(A=">=",c?(s=+s+1,i=0,a=0):(i=+i+1,a=0)):A==="<="&&(A="<",c?s=+s+1:i=+i+1),A==="<"&&(o="-0"),n=`${A+s}.${i}.${a}${o}`):c?n=`>=${s}.0.0${o} <${+s+1}.0.0-0`:l&&(n=`>=${s}.${i}.0${o} <${s}.${+i+1}.0-0`),Oe("xRange return",n),n})},YP=(r,e)=>(Oe("replaceStars",r,e),r.trim().replace(Mt[Qt.STAR],"")),eR=(r,e)=>(Oe("replaceGTE0",r,e),r.trim().replace(Mt[e.includePrerelease?Qt.GTE0PRE:Qt.GTE0],"")),tR=r=>(e,t,n,A,s,i,a,o,u,c,l,f)=>(Tt(n)?t="":Tt(A)?t=`>=${n}.0.0${r?"-0":""}`:Tt(s)?t=`>=${n}.${A}.0${r?"-0":""}`:i?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,Tt(u)?o="":Tt(c)?o=`<${+u+1}.0.0-0`:Tt(l)?o=`<${u}.${+c+1}.0-0`:f?o=`<=${u}.${c}.${l}-${f}`:r?o=`<${u}.${c}.${+l+1}-0`:o=`<=${o}`,`${t} ${o}`.trim()),rR=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(Oe(r[n].semver),r[n].semver!==Np.ANY&&r[n].semver.prerelease.length>0){let A=r[n].semver;if(A.major===e.major&&A.minor===e.minor&&A.patch===e.patch)return!0}return!1}return!0}});var bo=Z((Sz,tB)=>{"use strict";var Bo=Symbol("SemVer ANY"),Dp=class r{static get ANY(){return Bo}constructor(e,t){if(t=Wb(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Hp("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Bo?this.value="":this.value=this.operator+this.semver.version,Hp("comp",this)}parse(e){let t=this.options.loose?qb[Xb.COMPARATORLOOSE]:qb[Xb.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Yb(n[2],this.options.loose):this.semver=Bo}toString(){return this.value}test(e){if(Hp("Comparator.test",e,this.options.loose),this.semver===Bo||e===Bo)return!0;if(typeof e=="string")try{e=new Yb(e,this.options)}catch{return!1}return Lp(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new eB(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new eB(this.value,t).test(e.semver):(t=Wb(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Lp(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Lp(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};tB.exports=Dp;var Wb=Vc(),{safeRe:qb,t:Xb}=Gi(),Lp=Pp(),Hp=yo(),Yb=Bt(),eB=mr()});var vo=Z((Pz,rB)=>{"use strict";var nR=mr(),AR=(r,e,t)=>{try{e=new nR(e,t)}catch{return!1}return e.test(r)};rB.exports=AR});var AB=Z((Rz,nB)=>{"use strict";var sR=mr(),iR=(r,e)=>new sR(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));nB.exports=iR});var iB=Z((kz,sB)=>{"use strict";var aR=Bt(),oR=mr(),uR=(r,e,t)=>{let n=null,A=null,s=null;try{s=new oR(e,t)}catch{return null}return r.forEach(i=>{s.test(i)&&(!n||A.compare(i)===-1)&&(n=i,A=new aR(n,t))}),n};sB.exports=uR});var oB=Z((Nz,aB)=>{"use strict";var cR=Bt(),lR=mr(),fR=(r,e,t)=>{let n=null,A=null,s=null;try{s=new lR(e,t)}catch{return null}return r.forEach(i=>{s.test(i)&&(!n||A.compare(i)===1)&&(n=i,A=new cR(n,t))}),n};aB.exports=fR});var lB=Z((Lz,cB)=>{"use strict";var Mp=Bt(),dR=mr(),uB=_o(),pR=(r,e)=>{r=new dR(r,e);let t=new Mp("0.0.0");if(r.test(t)||(t=new Mp("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let A=r.set[n],s=null;A.forEach(i=>{let a=new Mp(i.semver.version);switch(i.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||uB(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),s&&(!t||uB(t,s))&&(t=s)}return t&&r.test(t)?t:null};cB.exports=pR});var dB=Z((Hz,fB)=>{"use strict";var hR=mr(),mR=(r,e)=>{try{return new hR(r,e).range||"*"}catch{return null}};fB.exports=mR});var Al=Z((Dz,gB)=>{"use strict";var gR=Bt(),mB=bo(),{ANY:wR}=mB,yR=mr(),_R=vo(),pB=_o(),hB=Yc(),bR=tl(),BR=el(),vR=(r,e,t,n)=>{r=new gR(r,n),e=new yR(e,n);let A,s,i,a,o;switch(t){case">":A=pB,s=bR,i=hB,a=">",o=">=";break;case"<":A=hB,s=BR,i=pB,a="<",o="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(_R(r,e,n))return!1;for(let u=0;u<e.set.length;++u){let c=e.set[u],l=null,f=null;if(c.forEach(d=>{d.semver===wR&&(d=new mB(">=0.0.0")),l=l||d,f=f||d,A(d.semver,l.semver,n)?l=d:i(d.semver,f.semver,n)&&(f=d)}),l.operator===a||l.operator===o||(!f.operator||f.operator===a)&&s(r,f.semver))return!1;if(f.operator===o&&i(r,f.semver))return!1}return!0};gB.exports=vR});var yB=Z((Mz,wB)=>{"use strict";var CR=Al(),ER=(r,e,t)=>CR(r,e,">",t);wB.exports=ER});var bB=Z(($z,_B)=>{"use strict";var xR=Al(),IR=(r,e,t)=>xR(r,e,"<",t);_B.exports=IR});var CB=Z((jz,vB)=>{"use strict";var BB=mr(),UR=(r,e,t)=>(r=new BB(r,t),e=new BB(e,t),r.intersects(e,t));vB.exports=UR});var xB=Z((Kz,EB)=>{"use strict";var FR=vo(),QR=hr();EB.exports=(r,e,t)=>{let n=[],A=null,s=null,i=r.sort((c,l)=>QR(c,l,t));for(let c of i)FR(c,e,t)?(s=c,A||(A=c)):(s&&n.push([A,s]),s=null,A=null);A&&n.push([A,null]);let a=[];for(let[c,l]of n)c===l?a.push(c):!l&&c===i[0]?a.push("*"):l?c===i[0]?a.push(`<=${l}`):a.push(`${c} - ${l}`):a.push(`>=${c}`);let o=a.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return o.length<u.length?o:e}});var OB=Z((zz,TB)=>{"use strict";var IB=mr(),jp=bo(),{ANY:$p}=jp,Co=vo(),Kp=hr(),TR=(r,e,t={})=>{if(r===e)return!0;r=new IB(r,t),e=new IB(e,t);let n=!1;e:for(let A of r.set){for(let s of e.set){let i=SR(A,s,t);if(n=n||i!==null,i)continue e}if(n)return!1}return!0},OR=[new jp(">=0.0.0-0")],UB=[new jp(">=0.0.0")],SR=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===$p){if(e.length===1&&e[0].semver===$p)return!0;t.includePrerelease?r=OR:r=UB}if(e.length===1&&e[0].semver===$p){if(t.includePrerelease)return!0;e=UB}let n=new Set,A,s;for(let d of r)d.operator===">"||d.operator===">="?A=FB(A,d,t):d.operator==="<"||d.operator==="<="?s=QB(s,d,t):n.add(d.semver);if(n.size>1)return null;let i;if(A&&s){if(i=Kp(A.semver,s.semver,t),i>0)return null;if(i===0&&(A.operator!==">="||s.operator!=="<="))return null}for(let d of n){if(A&&!Co(d,String(A),t)||s&&!Co(d,String(s),t))return null;for(let p of e)if(!Co(d,String(p),t))return!1;return!0}let a,o,u,c,l=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1,f=A&&!t.includePrerelease&&A.semver.prerelease.length?A.semver:!1;l&&l.prerelease.length===1&&s.operator==="<"&&l.prerelease[0]===0&&(l=!1);for(let d of e){if(c=c||d.operator===">"||d.operator===">=",u=u||d.operator==="<"||d.operator==="<=",A){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator===">"||d.operator===">="){if(a=FB(A,d,t),a===d&&a!==A)return!1}else if(A.operator===">="&&!Co(A.semver,String(d),t))return!1}if(s){if(l&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===l.major&&d.semver.minor===l.minor&&d.semver.patch===l.patch&&(l=!1),d.operator==="<"||d.operator==="<="){if(o=QB(s,d,t),o===d&&o!==s)return!1}else if(s.operator==="<="&&!Co(s.semver,String(d),t))return!1}if(!d.operator&&(s||A)&&i!==0)return!1}return!(A&&u&&!s&&i!==0||s&&c&&!A&&i!==0||f||l)},FB=(r,e,t)=>{if(!r)return e;let n=Kp(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},QB=(r,e,t)=>{if(!r)return e;let n=Kp(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};TB.exports=TR});var kB=Z((Gz,RB)=>{"use strict";var zp=Gi(),SB=wo(),PR=Bt(),PB=Qp(),RR=Ts(),kR=ib(),NR=ob(),LR=lb(),HR=pb(),DR=mb(),MR=wb(),$R=_b(),jR=Bb(),KR=hr(),zR=xb(),GR=Ub(),VR=Xc(),ZR=Ob(),JR=Pb(),WR=_o(),qR=Yc(),XR=Op(),YR=Sp(),ek=el(),tk=tl(),rk=Pp(),nk=jb(),Ak=bo(),sk=mr(),ik=vo(),ak=AB(),ok=iB(),uk=oB(),ck=lB(),lk=dB(),fk=Al(),dk=yB(),pk=bB(),hk=CB(),mk=xB(),gk=OB();RB.exports={parse:RR,valid:kR,clean:NR,inc:LR,diff:HR,major:DR,minor:MR,patch:$R,prerelease:jR,compare:KR,rcompare:zR,compareLoose:GR,compareBuild:VR,sort:ZR,rsort:JR,gt:WR,lt:qR,eq:XR,neq:YR,gte:ek,lte:tk,cmp:rk,coerce:nk,Comparator:Ak,Range:sk,satisfies:ik,toComparators:ak,maxSatisfying:ok,minSatisfying:uk,minVersion:ck,validRange:lk,outside:fk,gtr:dk,ltr:pk,intersects:hk,simplifyRange:mk,subset:gk,SemVer:PR,re:zp.re,src:zp.src,tokens:zp.t,SEMVER_SPEC_VERSION:SB.SEMVER_SPEC_VERSION,RELEASE_TYPES:SB.RELEASE_TYPES,compareIdentifiers:PB.compareIdentifiers,rcompareIdentifiers:PB.rcompareIdentifiers}});var t0=Z((OG,e0)=>{"use strict";var XB=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,YB=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function $k(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[A,s]of Object.entries(n))e[A]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},n[A]=e[A],r.set(s[0],s[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=XB(),e.color.ansi16m=YB(),e.bgColor.ansi256=XB(10),e.bgColor.ansi16m=YB(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,A)=>t===n&&n===A?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(A/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:A}=n.groups;A.length===3&&(A=A.split("").map(i=>i+i).join(""));let s=Number.parseInt(A,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(e0,"exports",{enumerable:!0,get:$k})});var _v=Z(Hl=>{"use strict";Hl.byteLength=tN;Hl.toByteArray=nN;Hl.fromByteArray=iN;var dn=[],br=[],eN=typeof Uint8Array<"u"?Uint8Array:Array,Qh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Rs=0,wv=Qh.length;Rs<wv;++Rs)dn[Rs]=Qh[Rs],br[Qh.charCodeAt(Rs)]=Rs;var Rs,wv;br[45]=62;br[95]=63;function yv(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function tN(r){var e=yv(r),t=e[0],n=e[1];return(t+n)*3/4-n}function rN(r,e,t){return(e+t)*3/4-t}function nN(r){var e,t=yv(r),n=t[0],A=t[1],s=new eN(rN(r,n,A)),i=0,a=A>0?n-4:n,o;for(o=0;o<a;o+=4)e=br[r.charCodeAt(o)]<<18|br[r.charCodeAt(o+1)]<<12|br[r.charCodeAt(o+2)]<<6|br[r.charCodeAt(o+3)],s[i++]=e>>16&255,s[i++]=e>>8&255,s[i++]=e&255;return A===2&&(e=br[r.charCodeAt(o)]<<2|br[r.charCodeAt(o+1)]>>4,s[i++]=e&255),A===1&&(e=br[r.charCodeAt(o)]<<10|br[r.charCodeAt(o+1)]<<4|br[r.charCodeAt(o+2)]>>2,s[i++]=e>>8&255,s[i++]=e&255),s}function AN(r){return dn[r>>18&63]+dn[r>>12&63]+dn[r>>6&63]+dn[r&63]}function sN(r,e,t){for(var n,A=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),A.push(AN(n));return A.join("")}function iN(r){for(var e,t=r.length,n=t%3,A=[],s=16383,i=0,a=t-n;i<a;i+=s)A.push(sN(r,i,i+s>a?a:i+s));return n===1?(e=r[t-1],A.push(dn[e>>2]+dn[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],A.push(dn[e>>10]+dn[e>>4&63]+dn[e<<2&63]+"=")),A.join("")}});var PN={};ef(PN,{CHAT_STORAGE_PREFIX:()=>fa,ChatEnabled:()=>Yf,DefaultChatbot:()=>_C,FloatingWindow:()=>Hu,clearAllConversations:()=>yC,clearConversation:()=>wC,getConversationStorageKey:()=>qh});module.exports=UC(PN);var gt=Ct(require("react"),1);var vf=function(r,e){return vf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var A in n)Object.prototype.hasOwnProperty.call(n,A)&&(t[A]=n[A])},vf(r,e)};function xr(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");vf(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Cf=function(){return Cf=Object.assign||function(e){for(var t,n=1,A=arguments.length;n<A;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Cf.apply(this,arguments)};function Et(r,e,t,n){function A(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(c){try{u(n.next(c))}catch(l){i(l)}}function o(c){try{u(n.throw(c))}catch(l){i(l)}}function u(c){c.done?s(c.value):A(c.value).then(a,o)}u((n=n.apply(r,e||[])).next())})}function ht(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,A,s,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(u){return function(c){return o([u,c])}}function o(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,A&&(s=u[0]&2?A.return:u[0]?A.throw||((s=A.return)&&s.call(A),0):A.next)&&!(s=s.call(A,u[1])).done)return s;switch(A=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,A=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(c){u=[6,c],A=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function qo(r,e,t){if(t||arguments.length===2)for(var n=0,A=e.length,s;n<A;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||e)}var bn=(function(){function r(e,t,n,A){this.left=e,this.top=t,this.width=n,this.height=A}return r.prototype.add=function(e,t,n,A){return new r(this.left+e,this.top+t,this.width+n,this.height+A)},r.fromClientRect=function(e,t){return new r(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},r.fromDOMRectList=function(e,t){var n=Array.from(t).find(function(A){return A.width!==0});return n?new r(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r})(),Fu=function(r,e){return bn.fromClientRect(r,e.getBoundingClientRect())},FC=function(r){var e=r.body,t=r.documentElement;if(!e||!t)throw new Error("Unable to get document size");var n=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),A=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new bn(0,0,n,A)},Qu=function(r){for(var e=[],t=0,n=r.length;t<n;){var A=r.charCodeAt(t++);if(A>=55296&&A<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((A&1023)<<10)+(s&1023)+65536):(e.push(A),t--)}else e.push(A)}return e},je=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],A=-1,s="";++A<t;){var i=r[A];i<=65535?n.push(i):(i-=65536,n.push((i>>10)+55296,i%1024+56320)),(A+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},tm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",QC=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(pa=0;pa<tm.length;pa++)QC[tm.charCodeAt(pa)]=pa;var pa,rm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",va=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(ha=0;ha<rm.length;ha++)va[rm.charCodeAt(ha)]=ha;var ha,TC=function(r){var e=r.length*.75,t=r.length,n,A=0,s,i,a,o;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),c=Array.isArray(u)?u:new Uint8Array(u);for(n=0;n<t;n+=4)s=va[r.charCodeAt(n)],i=va[r.charCodeAt(n+1)],a=va[r.charCodeAt(n+2)],o=va[r.charCodeAt(n+3)],c[A++]=s<<2|i>>4,c[A++]=(i&15)<<4|a>>2,c[A++]=(a&3)<<6|o&63;return u},OC=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},SC=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},kA=5,Gf=11,tf=2,PC=Gf-kA,eg=65536>>kA,RC=1<<kA,rf=RC-1,kC=1024>>kA,NC=eg+kC,LC=NC,HC=32,DC=LC+HC,MC=65536>>Gf,$C=1<<PC,jC=$C-1,nm=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},KC=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},zC=function(r,e){var t=TC(r),n=Array.isArray(t)?SC(t):new Uint32Array(t),A=Array.isArray(t)?OC(t):new Uint16Array(t),s=24,i=nm(A,s/2,n[4]/2),a=n[5]===2?nm(A,(s+n[4])/2):KC(n,Math.ceil((s+n[4])/4));return new GC(n[0],n[1],n[2],n[3],i,a)},GC=(function(){function r(e,t,n,A,s,i){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=A,this.index=s,this.data=i}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>kA],t=(t<<tf)+(e&rf),this.data[t];if(e<=65535)return t=this.index[eg+(e-55296>>kA)],t=(t<<tf)+(e&rf),this.data[t];if(e<this.highStart)return t=DC-MC+(e>>Gf),t=this.index[t],t+=e>>kA&jC,t=this.index[t],t=(t<<tf)+(e&rf),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r})(),Am="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",VC=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(ma=0;ma<Am.length;ma++)VC[Am.charCodeAt(ma)]=ma;var ma,ZC="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",sm=50,JC=1,tg=2,rg=3,WC=4,qC=5,im=7,ng=8,am=9,Vn=10,Ef=11,om=12,xf=13,XC=14,Ca=15,If=16,Xo=17,ga=18,YC=19,um=20,Uf=21,wa=22,nf=23,Hs=24,Vt=25,Ea=26,xa=27,Ds=28,eE=29,PA=30,tE=31,Yo=32,eu=33,Ff=34,Qf=35,Tf=36,Ra=37,Of=38,hu=39,mu=40,Af=41,Ag=42,rE=43,nE=[9001,65288],sg="!",we="\xD7",tu="\xF7",Sf=zC(ZC),wn=[PA,Tf],Pf=[JC,tg,rg,qC],ig=[Vn,ng],cm=[xa,Ea],AE=Pf.concat(ig),lm=[Of,hu,mu,Ff,Qf],sE=[Ca,xf],iE=function(r,e){e===void 0&&(e="strict");var t=[],n=[],A=[];return r.forEach(function(s,i){var a=Sf.get(s);if(a>sm?(A.push(!0),a-=sm):A.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(i),t.push(If);if(a===WC||a===Ef){if(i===0)return n.push(i),t.push(PA);var o=t[i-1];return AE.indexOf(o)===-1?(n.push(n[i-1]),t.push(o)):(n.push(i),t.push(PA))}if(n.push(i),a===tE)return t.push(e==="strict"?Uf:Ra);if(a===Ag||a===eE)return t.push(PA);if(a===rE)return s>=131072&&s<=196605||s>=196608&&s<=262141?t.push(Ra):t.push(PA);t.push(a)}),[n,t,A]},sf=function(r,e,t,n){var A=n[t];if(Array.isArray(r)?r.indexOf(A)!==-1:r===A)for(var s=t;s<=n.length;){s++;var i=n[s];if(i===e)return!0;if(i!==Vn)break}if(A===Vn)for(var s=t;s>0;){s--;var a=n[s];if(Array.isArray(r)?r.indexOf(a)!==-1:r===a)for(var o=t;o<=n.length;){o++;var i=n[o];if(i===e)return!0;if(i!==Vn)break}if(a!==Vn)break}return!1},fm=function(r,e){for(var t=r;t>=0;){var n=e[t];if(n===Vn)t--;else return n}return 0},aE=function(r,e,t,n,A){if(t[n]===0)return we;var s=n-1;if(Array.isArray(A)&&A[s]===!0)return we;var i=s-1,a=s+1,o=e[s],u=i>=0?e[i]:0,c=e[a];if(o===tg&&c===rg)return we;if(Pf.indexOf(o)!==-1)return sg;if(Pf.indexOf(c)!==-1||ig.indexOf(c)!==-1)return we;if(fm(s,e)===ng)return tu;if(Sf.get(r[s])===Ef||(o===Yo||o===eu)&&Sf.get(r[a])===Ef||o===im||c===im||o===am||[Vn,xf,Ca].indexOf(o)===-1&&c===am||[Xo,ga,YC,Hs,Ds].indexOf(c)!==-1||fm(s,e)===wa||sf(nf,wa,s,e)||sf([Xo,ga],Uf,s,e)||sf(om,om,s,e))return we;if(o===Vn)return tu;if(o===nf||c===nf)return we;if(c===If||o===If)return tu;if([xf,Ca,Uf].indexOf(c)!==-1||o===XC||u===Tf&&sE.indexOf(o)!==-1||o===Ds&&c===Tf||c===um||wn.indexOf(c)!==-1&&o===Vt||wn.indexOf(o)!==-1&&c===Vt||o===xa&&[Ra,Yo,eu].indexOf(c)!==-1||[Ra,Yo,eu].indexOf(o)!==-1&&c===Ea||wn.indexOf(o)!==-1&&cm.indexOf(c)!==-1||cm.indexOf(o)!==-1&&wn.indexOf(c)!==-1||[xa,Ea].indexOf(o)!==-1&&(c===Vt||[wa,Ca].indexOf(c)!==-1&&e[a+1]===Vt)||[wa,Ca].indexOf(o)!==-1&&c===Vt||o===Vt&&[Vt,Ds,Hs].indexOf(c)!==-1)return we;if([Vt,Ds,Hs,Xo,ga].indexOf(c)!==-1)for(var l=s;l>=0;){var f=e[l];if(f===Vt)return we;if([Ds,Hs].indexOf(f)!==-1)l--;else break}if([xa,Ea].indexOf(c)!==-1)for(var l=[Xo,ga].indexOf(o)!==-1?i:s;l>=0;){var f=e[l];if(f===Vt)return we;if([Ds,Hs].indexOf(f)!==-1)l--;else break}if(Of===o&&[Of,hu,Ff,Qf].indexOf(c)!==-1||[hu,Ff].indexOf(o)!==-1&&[hu,mu].indexOf(c)!==-1||[mu,Qf].indexOf(o)!==-1&&c===mu||lm.indexOf(o)!==-1&&[um,Ea].indexOf(c)!==-1||lm.indexOf(c)!==-1&&o===xa||wn.indexOf(o)!==-1&&wn.indexOf(c)!==-1||o===Hs&&wn.indexOf(c)!==-1||wn.concat(Vt).indexOf(o)!==-1&&c===wa&&nE.indexOf(r[a])===-1||wn.concat(Vt).indexOf(c)!==-1&&o===ga)return we;if(o===Af&&c===Af){for(var d=t[s],p=1;d>0&&(d--,e[d]===Af);)p++;if(p%2!==0)return we}return o===Yo&&c===eu?we:tu},oE=function(r,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=iE(r,e.lineBreak),n=t[0],A=t[1],s=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(A=A.map(function(a){return[Vt,PA,Ag].indexOf(a)!==-1?Ra:a}));var i=e.wordBreak==="keep-all"?s.map(function(a,o){return a&&r[o]>=19968&&r[o]<=40959}):void 0;return[n,A,i]},uE=(function(){function r(e,t,n,A){this.codePoints=e,this.required=t===sg,this.start=n,this.end=A}return r.prototype.slice=function(){return je.apply(void 0,this.codePoints.slice(this.start,this.end))},r})(),cE=function(r,e){var t=Qu(r),n=oE(t,e),A=n[0],s=n[1],i=n[2],a=t.length,o=0,u=0;return{next:function(){if(u>=a)return{done:!0,value:null};for(var c=we;u<a&&(c=aE(t,s,A,++u,i))===we;);if(c!==we||u===a){var l=new uE(t,c,o,u);return o=u,{value:l,done:!1}}return{done:!0,value:null}}}},lE=1,fE=2,La=4,dm=8,yu=10,pm=47,Qa=92,dE=9,pE=32,ru=34,ya=61,hE=35,mE=36,gE=37,nu=39,Au=40,_a=41,wE=95,kt=45,yE=33,_E=60,bE=62,BE=64,vE=91,CE=93,EE=61,xE=123,su=63,IE=125,hm=124,UE=126,FE=128,mm=65533,af=42,RA=43,QE=44,TE=58,OE=59,ka=46,SE=0,PE=8,RE=11,kE=14,NE=31,LE=127,$r=-1,ag=48,og=97,ug=101,HE=102,DE=117,ME=122,cg=65,lg=69,fg=70,$E=85,jE=90,mt=function(r){return r>=ag&&r<=57},KE=function(r){return r>=55296&&r<=57343},Ms=function(r){return mt(r)||r>=cg&&r<=fg||r>=og&&r<=HE},zE=function(r){return r>=og&&r<=ME},GE=function(r){return r>=cg&&r<=jE},VE=function(r){return zE(r)||GE(r)},ZE=function(r){return r>=FE},iu=function(r){return r===yu||r===dE||r===pE},_u=function(r){return VE(r)||ZE(r)||r===wE},gm=function(r){return _u(r)||mt(r)||r===kt},JE=function(r){return r>=SE&&r<=PE||r===RE||r>=kE&&r<=NE||r===LE},Gn=function(r,e){return r!==Qa?!1:e!==yu},au=function(r,e,t){return r===kt?_u(e)||Gn(e,t):_u(r)?!0:!!(r===Qa&&Gn(r,e))},of=function(r,e,t){return r===RA||r===kt?mt(e)?!0:e===ka&&mt(t):mt(r===ka?e:r)},WE=function(r){var e=0,t=1;(r[e]===RA||r[e]===kt)&&(r[e]===kt&&(t=-1),e++);for(var n=[];mt(r[e]);)n.push(r[e++]);var A=n.length?parseInt(je.apply(void 0,n),10):0;r[e]===ka&&e++;for(var s=[];mt(r[e]);)s.push(r[e++]);var i=s.length,a=i?parseInt(je.apply(void 0,s),10):0;(r[e]===lg||r[e]===ug)&&e++;var o=1;(r[e]===RA||r[e]===kt)&&(r[e]===kt&&(o=-1),e++);for(var u=[];mt(r[e]);)u.push(r[e++]);var c=u.length?parseInt(je.apply(void 0,u),10):0;return t*(A+a*Math.pow(10,-i))*Math.pow(10,o*c)},qE={type:2},XE={type:3},YE={type:4},ex={type:13},tx={type:8},rx={type:21},nx={type:9},Ax={type:10},sx={type:11},ix={type:12},ax={type:14},ou={type:23},ox={type:1},ux={type:25},cx={type:24},lx={type:26},fx={type:27},dx={type:28},px={type:29},hx={type:31},Rf={type:32},dg=(function(){function r(){this._value=[]}return r.prototype.write=function(e){this._value=this._value.concat(Qu(e))},r.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Rf;)e.push(t),t=this.consumeToken();return e},r.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case ru:return this.consumeStringToken(ru);case hE:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),A=this.peekCodePoint(2);if(gm(t)||Gn(n,A)){var s=au(t,n,A)?fE:lE,i=this.consumeName();return{type:5,value:i,flags:s}}break;case mE:if(this.peekCodePoint(0)===ya)return this.consumeCodePoint(),ex;break;case nu:return this.consumeStringToken(nu);case Au:return qE;case _a:return XE;case af:if(this.peekCodePoint(0)===ya)return this.consumeCodePoint(),ax;break;case RA:if(of(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case QE:return YE;case kt:var a=e,o=this.peekCodePoint(0),u=this.peekCodePoint(1);if(of(a,o,u))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(au(a,o,u))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(o===kt&&u===bE)return this.consumeCodePoint(),this.consumeCodePoint(),cx;break;case ka:if(of(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case pm:if(this.peekCodePoint(0)===af)for(this.consumeCodePoint();;){var c=this.consumeCodePoint();if(c===af&&(c=this.consumeCodePoint(),c===pm))return this.consumeToken();if(c===$r)return this.consumeToken()}break;case TE:return lx;case OE:return fx;case _E:if(this.peekCodePoint(0)===yE&&this.peekCodePoint(1)===kt&&this.peekCodePoint(2)===kt)return this.consumeCodePoint(),this.consumeCodePoint(),ux;break;case BE:var l=this.peekCodePoint(0),f=this.peekCodePoint(1),d=this.peekCodePoint(2);if(au(l,f,d)){var i=this.consumeName();return{type:7,value:i}}break;case vE:return dx;case Qa:if(Gn(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case CE:return px;case EE:if(this.peekCodePoint(0)===ya)return this.consumeCodePoint(),tx;break;case xE:return sx;case IE:return ix;case DE:case $E:var p=this.peekCodePoint(0),h=this.peekCodePoint(1);return p===RA&&(Ms(h)||h===su)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case hm:if(this.peekCodePoint(0)===ya)return this.consumeCodePoint(),nx;if(this.peekCodePoint(0)===hm)return this.consumeCodePoint(),rx;break;case UE:if(this.peekCodePoint(0)===ya)return this.consumeCodePoint(),Ax;break;case $r:return Rf}return iu(e)?(this.consumeWhiteSpace(),hx):mt(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):_u(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:je(e)}},r.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},r.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},r.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},r.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Ms(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===su&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n){var A=parseInt(je.apply(void 0,e.map(function(o){return o===su?ag:o})),16),s=parseInt(je.apply(void 0,e.map(function(o){return o===su?fg:o})),16);return{type:30,start:A,end:s}}var i=parseInt(je.apply(void 0,e),16);if(this.peekCodePoint(0)===kt&&Ms(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var a=[];Ms(t)&&a.length<6;)a.push(t),t=this.consumeCodePoint();var s=parseInt(je.apply(void 0,a),16);return{type:30,start:i,end:s}}else return{type:30,start:i,end:i}},r.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===Au?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Au?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},r.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===$r)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===nu||t===ru){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===$r||this.peekCodePoint(0)===_a)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),ou)}for(;;){var A=this.consumeCodePoint();if(A===$r||A===_a)return{type:22,value:je.apply(void 0,e)};if(iu(A))return this.consumeWhiteSpace(),this.peekCodePoint(0)===$r||this.peekCodePoint(0)===_a?(this.consumeCodePoint(),{type:22,value:je.apply(void 0,e)}):(this.consumeBadUrlRemnants(),ou);if(A===ru||A===nu||A===Au||JE(A))return this.consumeBadUrlRemnants(),ou;if(A===Qa)if(Gn(A,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),ou;else e.push(A)}},r.prototype.consumeWhiteSpace=function(){for(;iu(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===_a||e===$r)return;Gn(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(e){for(var t=5e4,n="";e>0;){var A=Math.min(t,e);n+=je.apply(void 0,this._value.splice(0,A)),e-=A}return this._value.shift(),n},r.prototype.consumeStringToken=function(e){var t="",n=0;do{var A=this._value[n];if(A===$r||A===void 0||A===e)return t+=this.consumeStringSlice(n),{type:0,value:t};if(A===yu)return this._value.splice(0,n),ox;if(A===Qa){var s=this._value[n+1];s!==$r&&s!==void 0&&(s===yu?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):Gn(A,s)&&(t+=this.consumeStringSlice(n),t+=je(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var e=[],t=La,n=this.peekCodePoint(0);for((n===RA||n===kt)&&e.push(this.consumeCodePoint());mt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var A=this.peekCodePoint(1);if(n===ka&&mt(A))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=dm;mt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),A=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===lg||n===ug)&&((A===RA||A===kt)&&mt(s)||mt(A)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=dm;mt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[WE(e),t]},r.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],A=this.peekCodePoint(0),s=this.peekCodePoint(1),i=this.peekCodePoint(2);if(au(A,s,i)){var a=this.consumeName();return{type:15,number:t,flags:n,unit:a}}return A===gE?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Ms(e)){for(var t=je(e);Ms(this.peekCodePoint(0))&&t.length<6;)t+=je(this.consumeCodePoint());iu(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return n===0||KE(n)||n>1114111?mm:n}return e===$r?mm:e},r.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(gm(t))e+=je(t);else if(Gn(t,this.peekCodePoint(0)))e+=je(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},r})(),pg=(function(){function r(e){this._tokens=e}return r.create=function(e){var t=new dg;return t.write(e),new r(t.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(n.type===32||gx(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?Rf:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r})(),Ha=function(r){return r.type===15},Ws=function(r){return r.type===17},Fe=function(r){return r.type===20},mx=function(r){return r.type===0},kf=function(r,e){return Fe(r)&&r.value===e},hg=function(r){return r.type!==31},Js=function(r){return r.type!==31&&r.type!==4},jr=function(r){var e=[],t=[];return r.forEach(function(n){if(n.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}n.type!==31&&t.push(n)}),t.length&&e.push(t),e},gx=function(r,e){return e===11&&r.type===12||e===28&&r.type===29?!0:e===2&&r.type===3},Xn=function(r){return r.type===17||r.type===15},Je=function(r){return r.type===16||Xn(r)},mg=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},ct={type:17,number:0,flags:La},Vf={type:16,number:50,flags:La},Zn={type:16,number:100,flags:La},Ia=function(r,e,t){var n=r[0],A=r[1];return[Te(n,e),Te(typeof A<"u"?A:n,t)]},Te=function(r,e){if(r.type===16)return r.number/100*e;if(Ha(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},gg="deg",wg="grad",yg="rad",_g="turn",Tu={name:"angle",parse:function(r,e){if(e.type===15)switch(e.unit){case gg:return Math.PI*e.number/180;case wg:return Math.PI/200*e.number;case yg:return e.number;case _g:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},bg=function(r){return r.type===15&&(r.unit===gg||r.unit===wg||r.unit===yg||r.unit===_g)},Bg=function(r){var e=r.filter(Fe).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ct,ct];case"to top":case"bottom":return or(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ct,Zn];case"to right":case"left":return or(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Zn,Zn];case"to bottom":case"top":return or(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Zn,ct];case"to left":case"right":return or(270)}return 0},or=function(r){return Math.PI*r/180},Wn={name:"color",parse:function(r,e){if(e.type===18){var t=wx[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(r,e.values)}if(e.type===5){if(e.value.length===3){var n=e.value.substring(0,1),A=e.value.substring(1,2),s=e.value.substring(2,3);return Jn(parseInt(n+n,16),parseInt(A+A,16),parseInt(s+s,16),1)}if(e.value.length===4){var n=e.value.substring(0,1),A=e.value.substring(1,2),s=e.value.substring(2,3),i=e.value.substring(3,4);return Jn(parseInt(n+n,16),parseInt(A+A,16),parseInt(s+s,16),parseInt(i+i,16)/255)}if(e.value.length===6){var n=e.value.substring(0,2),A=e.value.substring(2,4),s=e.value.substring(4,6);return Jn(parseInt(n,16),parseInt(A,16),parseInt(s,16),1)}if(e.value.length===8){var n=e.value.substring(0,2),A=e.value.substring(2,4),s=e.value.substring(4,6),i=e.value.substring(6,8);return Jn(parseInt(n,16),parseInt(A,16),parseInt(s,16),parseInt(i,16)/255)}}if(e.type===20){var a=_n[e.value.toUpperCase()];if(typeof a<"u")return a}return _n.TRANSPARENT}},qn=function(r){return(255&r)===0},st=function(r){var e=255&r,t=255&r>>8,n=255&r>>16,A=255&r>>24;return e<255?"rgba("+A+","+n+","+t+","+e/255+")":"rgb("+A+","+n+","+t+")"},Jn=function(r,e,t,n){return(r<<24|e<<16|t<<8|Math.round(n*255)<<0)>>>0},wm=function(r,e){if(r.type===17)return r.number;if(r.type===16){var t=e===3?1:255;return e===3?r.number/100*t:Math.round(r.number/100*t)}return 0},ym=function(r,e){var t=e.filter(Js);if(t.length===3){var n=t.map(wm),A=n[0],s=n[1],i=n[2];return Jn(A,s,i,1)}if(t.length===4){var a=t.map(wm),A=a[0],s=a[1],i=a[2],o=a[3];return Jn(A,s,i,o)}return 0};function uf(r,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-r)*t*6+r:t<1/2?e:t<2/3?(e-r)*6*(2/3-t)+r:r}var _m=function(r,e){var t=e.filter(Js),n=t[0],A=t[1],s=t[2],i=t[3],a=(n.type===17?or(n.number):Tu.parse(r,n))/(Math.PI*2),o=Je(A)?A.number/100:0,u=Je(s)?s.number/100:0,c=typeof i<"u"&&Je(i)?Te(i,1):1;if(o===0)return Jn(u*255,u*255,u*255,1);var l=u<=.5?u*(o+1):u+o-u*o,f=u*2-l,d=uf(f,l,a+1/3),p=uf(f,l,a),h=uf(f,l,a-1/3);return Jn(d*255,p*255,h*255,c)},wx={hsl:_m,hsla:_m,rgb:ym,rgba:ym},Ta=function(r,e){return Wn.parse(r,pg.create(e).parseComponentValue())},_n={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},yx={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Fe(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},_x={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ou=function(r,e){var t=Wn.parse(r,e[0]),n=e[1];return n&&Je(n)?{color:t,stop:n}:{color:t,stop:null}},bm=function(r,e){var t=r[0],n=r[r.length-1];t.stop===null&&(t.stop=ct),n.stop===null&&(n.stop=Zn);for(var A=[],s=0,i=0;i<r.length;i++){var a=r[i].stop;if(a!==null){var o=Te(a,e);o>s?A.push(o):A.push(s),s=o}else A.push(null)}for(var u=null,i=0;i<A.length;i++){var c=A[i];if(c===null)u===null&&(u=i);else if(u!==null){for(var l=i-u,f=A[u-1],d=(c-f)/(l+1),p=1;p<=l;p++)A[u+p-1]=d*p;u=null}}return r.map(function(h,g){var w=h.color;return{color:w,stop:Math.max(Math.min(1,A[g]/e),0)}})},bx=function(r,e,t){var n=e/2,A=t/2,s=Te(r[0],e)-n,i=A-Te(r[1],t);return(Math.atan2(i,s)+Math.PI*2)%(Math.PI*2)},Bx=function(r,e,t){var n=typeof r=="number"?r:bx(r,e,t),A=Math.abs(e*Math.sin(n))+Math.abs(t*Math.cos(n)),s=e/2,i=t/2,a=A/2,o=Math.sin(n-Math.PI/2)*a,u=Math.cos(n-Math.PI/2)*a;return[A,s-u,s+u,i-o,i+o]},Er=function(r,e){return Math.sqrt(r*r+e*e)},Bm=function(r,e,t,n,A){var s=[[0,0],[0,e],[r,0],[r,e]];return s.reduce(function(i,a){var o=a[0],u=a[1],c=Er(t-o,n-u);return(A?c<i.optimumDistance:c>i.optimumDistance)?{optimumCorner:a,optimumDistance:c}:i},{optimumDistance:A?1/0:-1/0,optimumCorner:null}).optimumCorner},vx=function(r,e,t,n,A){var s=0,i=0;switch(r.size){case 0:r.shape===0?s=i=Math.min(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-A)):r.shape===1&&(s=Math.min(Math.abs(e),Math.abs(e-n)),i=Math.min(Math.abs(t),Math.abs(t-A)));break;case 2:if(r.shape===0)s=i=Math.min(Er(e,t),Er(e,t-A),Er(e-n,t),Er(e-n,t-A));else if(r.shape===1){var a=Math.min(Math.abs(t),Math.abs(t-A))/Math.min(Math.abs(e),Math.abs(e-n)),o=Bm(n,A,e,t,!0),u=o[0],c=o[1];s=Er(u-e,(c-t)/a),i=a*s}break;case 1:r.shape===0?s=i=Math.max(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-A)):r.shape===1&&(s=Math.max(Math.abs(e),Math.abs(e-n)),i=Math.max(Math.abs(t),Math.abs(t-A)));break;case 3:if(r.shape===0)s=i=Math.max(Er(e,t),Er(e,t-A),Er(e-n,t),Er(e-n,t-A));else if(r.shape===1){var a=Math.max(Math.abs(t),Math.abs(t-A))/Math.max(Math.abs(e),Math.abs(e-n)),l=Bm(n,A,e,t,!1),u=l[0],c=l[1];s=Er(u-e,(c-t)/a),i=a*s}break}return Array.isArray(r.size)&&(s=Te(r.size[0],n),i=r.size.length===2?Te(r.size[1],A):s),[s,i]},Cx=function(r,e){var t=or(180),n=[];return jr(e).forEach(function(A,s){if(s===0){var i=A[0];if(i.type===20&&i.value==="to"){t=Bg(A);return}else if(bg(i)){t=Tu.parse(r,i);return}}var a=Ou(r,A);n.push(a)}),{angle:t,stops:n,type:1}},uu=function(r,e){var t=or(180),n=[];return jr(e).forEach(function(A,s){if(s===0){var i=A[0];if(i.type===20&&["top","left","right","bottom"].indexOf(i.value)!==-1){t=Bg(A);return}else if(bg(i)){t=(Tu.parse(r,i)+or(270))%or(360);return}}var a=Ou(r,A);n.push(a)}),{angle:t,stops:n,type:1}},Ex=function(r,e){var t=or(180),n=[],A=1,s=0,i=3,a=[];return jr(e).forEach(function(o,u){var c=o[0];if(u===0){if(Fe(c)&&c.value==="linear"){A=1;return}else if(Fe(c)&&c.value==="radial"){A=2;return}}if(c.type===18){if(c.name==="from"){var l=Wn.parse(r,c.values[0]);n.push({stop:ct,color:l})}else if(c.name==="to"){var l=Wn.parse(r,c.values[0]);n.push({stop:Zn,color:l})}else if(c.name==="color-stop"){var f=c.values.filter(Js);if(f.length===2){var l=Wn.parse(r,f[1]),d=f[0];Ws(d)&&n.push({stop:{type:16,number:d.number*100,flags:d.flags},color:l})}}}}),A===1?{angle:(t+or(180))%or(360),stops:n,type:A}:{size:i,shape:s,stops:n,position:a,type:A}},vg="closest-side",Cg="farthest-side",Eg="closest-corner",xg="farthest-corner",Ig="circle",Ug="ellipse",Fg="cover",Qg="contain",xx=function(r,e){var t=0,n=3,A=[],s=[];return jr(e).forEach(function(i,a){var o=!0;if(a===0){var u=!1;o=i.reduce(function(l,f){if(u)if(Fe(f))switch(f.value){case"center":return s.push(Vf),l;case"top":case"left":return s.push(ct),l;case"right":case"bottom":return s.push(Zn),l}else(Je(f)||Xn(f))&&s.push(f);else if(Fe(f))switch(f.value){case Ig:return t=0,!1;case Ug:return t=1,!1;case"at":return u=!0,!1;case vg:return n=0,!1;case Fg:case Cg:return n=1,!1;case Qg:case Eg:return n=2,!1;case xg:return n=3,!1}else if(Xn(f)||Je(f))return Array.isArray(n)||(n=[]),n.push(f),!1;return l},o)}if(o){var c=Ou(r,i);A.push(c)}}),{size:n,shape:t,stops:A,position:s,type:2}},cu=function(r,e){var t=0,n=3,A=[],s=[];return jr(e).forEach(function(i,a){var o=!0;if(a===0?o=i.reduce(function(c,l){if(Fe(l))switch(l.value){case"center":return s.push(Vf),!1;case"top":case"left":return s.push(ct),!1;case"right":case"bottom":return s.push(Zn),!1}else if(Je(l)||Xn(l))return s.push(l),!1;return c},o):a===1&&(o=i.reduce(function(c,l){if(Fe(l))switch(l.value){case Ig:return t=0,!1;case Ug:return t=1,!1;case Qg:case vg:return n=0,!1;case Cg:return n=1,!1;case Eg:return n=2,!1;case Fg:case xg:return n=3,!1}else if(Xn(l)||Je(l))return Array.isArray(n)||(n=[]),n.push(l),!1;return c},o)),o){var u=Ou(r,i);A.push(u)}}),{size:n,shape:t,stops:A,position:s,type:2}},Ix=function(r){return r.type===1},Ux=function(r){return r.type===2},Zf={name:"image",parse:function(r,e){if(e.type===22){var t={url:e.value,type:0};return r.cache.addImage(e.value),t}if(e.type===18){var n=Tg[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return n(r,e.values)}throw new Error("Unsupported image type "+e.type)}};function Fx(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!Tg[r.name])}var Tg={"linear-gradient":Cx,"-moz-linear-gradient":uu,"-ms-linear-gradient":uu,"-o-linear-gradient":uu,"-webkit-linear-gradient":uu,"radial-gradient":xx,"-moz-radial-gradient":cu,"-ms-radial-gradient":cu,"-o-radial-gradient":cu,"-webkit-radial-gradient":cu,"-webkit-gradient":Ex},Qx={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(n){return Js(n)&&Fx(n)}).map(function(n){return Zf.parse(r,n)})}},Tx={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Fe(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Ox={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,e){return jr(e).map(function(t){return t.filter(Je)}).map(mg)}},Sx={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,e){return jr(e).map(function(t){return t.filter(Fe).map(function(n){return n.value}).join(" ")}).map(Px)}},Px=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Zs;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(Zs||(Zs={}));var Rx={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,e){return jr(e).map(function(t){return t.filter(kx)})}},kx=function(r){return Fe(r)||Je(r)},Su=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Nx=Su("top"),Lx=Su("right"),Hx=Su("bottom"),Dx=Su("left"),Pu=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return mg(t.filter(Je))}}},Mx=Pu("top-left"),$x=Pu("top-right"),jx=Pu("bottom-right"),Kx=Pu("bottom-left"),Ru=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},zx=Ru("top"),Gx=Ru("right"),Vx=Ru("bottom"),Zx=Ru("left"),ku=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ha(t)?t.number:0}}},Jx=ku("top"),Wx=ku("right"),qx=ku("bottom"),Xx=ku("left"),Yx={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},eI={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},tI={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,e){return e.filter(Fe).reduce(function(t,n){return t|rI(n.value)},0)}},rI=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},nI={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},AI={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},bu;(function(r){r.NORMAL="normal",r.STRICT="strict"})(bu||(bu={}));var sI={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"strict":return bu.STRICT;case"normal":default:return bu.NORMAL}}},iI={name:"line-height",initialValue:"normal",prefix:!1,type:4},vm=function(r,e){return Fe(r)&&r.value==="normal"?1.2*e:r.type===17?e*r.number:Je(r)?Te(r,e):e},aI={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,e){return e.type===20&&e.value==="none"?null:Zf.parse(r,e)}},oI={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},Nf={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Nu=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},uI=Nu("top"),cI=Nu("right"),lI=Nu("bottom"),fI=Nu("left"),dI={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,e){return e.filter(Fe).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},pI={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},Lu=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},hI=Lu("top"),mI=Lu("right"),gI=Lu("bottom"),wI=Lu("left"),yI={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},_I={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},bI={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&kf(e[0],"none")?[]:jr(e).map(function(t){for(var n={color:_n.TRANSPARENT,offsetX:ct,offsetY:ct,blur:ct},A=0,s=0;s<t.length;s++){var i=t[s];Xn(i)?(A===0?n.offsetX=i:A===1?n.offsetY=i:n.blur=i,A++):n.color=Wn.parse(r,i)}return n})}},BI={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},vI={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=xI[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},CI=function(r){var e=r.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},EI=function(r){var e=r.filter(function(o){return o.type===17}).map(function(o){return o.number}),t=e[0],n=e[1];e[2],e[3];var A=e[4],s=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var i=e[12],a=e[13];return e[14],e[15],e.length===16?[t,n,A,s,i,a]:null},xI={matrix:CI,matrix3d:EI},Cm={type:16,number:50,flags:La},II=[Cm,Cm],UI={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,e){var t=e.filter(Je);return t.length!==2?II:[t[0],t[1]]}},FI={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Oa;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(Oa||(Oa={}));var QI={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-all":return Oa.BREAK_ALL;case"keep-all":return Oa.KEEP_ALL;case"normal":default:return Oa.NORMAL}}},TI={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,e){if(e.type===20)return{auto:!0,order:0};if(Ws(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Og={name:"time",parse:function(r,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},OI={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,e){return Ws(e)?e.number:1}},SI={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},PI={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,e){return e.filter(Fe).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},RI={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,e){var t=[],n=[];return e.forEach(function(A){switch(A.type){case 20:case 0:t.push(A.value);break;case 17:t.push(A.number.toString());break;case 4:n.push(t.join(" ")),t.length=0;break}}),t.length&&n.push(t.join(" ")),n.map(function(A){return A.indexOf(" ")===-1?A:"'"+A+"'"})}},kI={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},NI={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,e){if(Ws(e))return e.number;if(Fe(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},LI={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.filter(Fe).map(function(t){return t.value})}},HI={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Xe=function(r,e){return(r&e)!==0},DI={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},MI={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var n=[],A=e.filter(hg),s=0;s<A.length;s++){var i=A[s],a=A[s+1];if(i.type===20){var o=a&&Ws(a)?a.number:1;n.push({counter:i.value,increment:o})}}return n}},$I={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return[];for(var t=[],n=e.filter(hg),A=0;A<n.length;A++){var s=n[A],i=n[A+1];if(Fe(s)&&s.value!=="none"){var a=i&&Ws(i)?i.number:0;t.push({counter:s.value,reset:a})}}return t}},jI={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,e){return e.filter(Ha).map(function(t){return Og.parse(r,t)})}},KI={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var n=[],A=e.filter(mx);if(A.length%2!==0)return null;for(var s=0;s<A.length;s+=2){var i=A[s].value,a=A[s+1].value;n.push({open:i,close:a})}return n}},Em=function(r,e,t){if(!r)return"";var n=r[Math.min(e,r.length-1)];return n?t?n.open:n.close:""},zI={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&kf(e[0],"none")?[]:jr(e).map(function(t){for(var n={color:255,offsetX:ct,offsetY:ct,blur:ct,spread:ct,inset:!1},A=0,s=0;s<t.length;s++){var i=t[s];kf(i,"inset")?n.inset=!0:Xn(i)?(A===0?n.offsetX=i:A===1?n.offsetY=i:A===2?n.blur=i:n.spread=i,A++):n.color=Wn.parse(r,i)}return n})}},GI={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,e){var t=[0,1,2],n=[];return e.filter(Fe).forEach(function(A){switch(A.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),t.forEach(function(A){n.indexOf(A)===-1&&n.push(A)}),n}},VI={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},ZI={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,e){return Ha(e)?e.number:0}},JI=(function(){function r(e,t){var n,A;this.animationDuration=k(e,jI,t.animationDuration),this.backgroundClip=k(e,yx,t.backgroundClip),this.backgroundColor=k(e,_x,t.backgroundColor),this.backgroundImage=k(e,Qx,t.backgroundImage),this.backgroundOrigin=k(e,Tx,t.backgroundOrigin),this.backgroundPosition=k(e,Ox,t.backgroundPosition),this.backgroundRepeat=k(e,Sx,t.backgroundRepeat),this.backgroundSize=k(e,Rx,t.backgroundSize),this.borderTopColor=k(e,Nx,t.borderTopColor),this.borderRightColor=k(e,Lx,t.borderRightColor),this.borderBottomColor=k(e,Hx,t.borderBottomColor),this.borderLeftColor=k(e,Dx,t.borderLeftColor),this.borderTopLeftRadius=k(e,Mx,t.borderTopLeftRadius),this.borderTopRightRadius=k(e,$x,t.borderTopRightRadius),this.borderBottomRightRadius=k(e,jx,t.borderBottomRightRadius),this.borderBottomLeftRadius=k(e,Kx,t.borderBottomLeftRadius),this.borderTopStyle=k(e,zx,t.borderTopStyle),this.borderRightStyle=k(e,Gx,t.borderRightStyle),this.borderBottomStyle=k(e,Vx,t.borderBottomStyle),this.borderLeftStyle=k(e,Zx,t.borderLeftStyle),this.borderTopWidth=k(e,Jx,t.borderTopWidth),this.borderRightWidth=k(e,Wx,t.borderRightWidth),this.borderBottomWidth=k(e,qx,t.borderBottomWidth),this.borderLeftWidth=k(e,Xx,t.borderLeftWidth),this.boxShadow=k(e,zI,t.boxShadow),this.color=k(e,Yx,t.color),this.direction=k(e,eI,t.direction),this.display=k(e,tI,t.display),this.float=k(e,nI,t.cssFloat),this.fontFamily=k(e,RI,t.fontFamily),this.fontSize=k(e,kI,t.fontSize),this.fontStyle=k(e,HI,t.fontStyle),this.fontVariant=k(e,LI,t.fontVariant),this.fontWeight=k(e,NI,t.fontWeight),this.letterSpacing=k(e,AI,t.letterSpacing),this.lineBreak=k(e,sI,t.lineBreak),this.lineHeight=k(e,iI,t.lineHeight),this.listStyleImage=k(e,aI,t.listStyleImage),this.listStylePosition=k(e,oI,t.listStylePosition),this.listStyleType=k(e,Nf,t.listStyleType),this.marginTop=k(e,uI,t.marginTop),this.marginRight=k(e,cI,t.marginRight),this.marginBottom=k(e,lI,t.marginBottom),this.marginLeft=k(e,fI,t.marginLeft),this.opacity=k(e,OI,t.opacity);var s=k(e,dI,t.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=k(e,pI,t.overflowWrap),this.paddingTop=k(e,hI,t.paddingTop),this.paddingRight=k(e,mI,t.paddingRight),this.paddingBottom=k(e,gI,t.paddingBottom),this.paddingLeft=k(e,wI,t.paddingLeft),this.paintOrder=k(e,GI,t.paintOrder),this.position=k(e,_I,t.position),this.textAlign=k(e,yI,t.textAlign),this.textDecorationColor=k(e,SI,(n=t.textDecorationColor)!==null&&n!==void 0?n:t.color),this.textDecorationLine=k(e,PI,(A=t.textDecorationLine)!==null&&A!==void 0?A:t.textDecoration),this.textShadow=k(e,bI,t.textShadow),this.textTransform=k(e,BI,t.textTransform),this.transform=k(e,vI,t.transform),this.transformOrigin=k(e,UI,t.transformOrigin),this.visibility=k(e,FI,t.visibility),this.webkitTextStrokeColor=k(e,VI,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=k(e,ZI,t.webkitTextStrokeWidth),this.wordBreak=k(e,QI,t.wordBreak),this.zIndex=k(e,TI,t.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return qn(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Xe(this.display,4)||Xe(this.display,33554432)||Xe(this.display,268435456)||Xe(this.display,536870912)||Xe(this.display,67108864)||Xe(this.display,134217728)},r})(),WI=(function(){function r(e,t){this.content=k(e,DI,t.content),this.quotes=k(e,KI,t.quotes)}return r})(),xm=(function(){function r(e,t){this.counterIncrement=k(e,MI,t.counterIncrement),this.counterReset=k(e,$I,t.counterReset)}return r})(),k=function(r,e,t){var n=new dg,A=t!==null&&typeof t<"u"?t.toString():e.initialValue;n.write(A);var s=new pg(n.read());switch(e.type){case 2:var i=s.parseComponentValue();return e.parse(r,Fe(i)?i.value:e.initialValue);case 0:return e.parse(r,s.parseComponentValue());case 1:return e.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(e.format){case"angle":return Tu.parse(r,s.parseComponentValue());case"color":return Wn.parse(r,s.parseComponentValue());case"image":return Zf.parse(r,s.parseComponentValue());case"length":var a=s.parseComponentValue();return Xn(a)?a:ct;case"length-percentage":var o=s.parseComponentValue();return Je(o)?o:ct;case"time":return Og.parse(r,s.parseComponentValue())}break}},qI="data-html2canvas-debug",XI=function(r){var e=r.getAttribute(qI);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Lf=function(r,e){var t=XI(r);return t===1||e===t},Kr=(function(){function r(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,Lf(t,3))debugger;this.styles=new JI(e,window.getComputedStyle(t,null)),Mf(t)&&(this.styles.animationDuration.some(function(n){return n>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=Fu(this.context,t),Lf(t,4)&&(this.flags|=16)}return r})(),YI="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Im="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ua=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(ba=0;ba<Im.length;ba++)Ua[Im.charCodeAt(ba)]=ba;var ba,eU=function(r){var e=r.length*.75,t=r.length,n,A=0,s,i,a,o;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),c=Array.isArray(u)?u:new Uint8Array(u);for(n=0;n<t;n+=4)s=Ua[r.charCodeAt(n)],i=Ua[r.charCodeAt(n+1)],a=Ua[r.charCodeAt(n+2)],o=Ua[r.charCodeAt(n+3)],c[A++]=s<<2|i>>4,c[A++]=(i&15)<<4|a>>2,c[A++]=(a&3)<<6|o&63;return u},tU=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},rU=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},NA=5,Jf=11,cf=2,nU=Jf-NA,Sg=65536>>NA,AU=1<<NA,lf=AU-1,sU=1024>>NA,iU=Sg+sU,aU=iU,oU=32,uU=aU+oU,cU=65536>>Jf,lU=1<<nU,fU=lU-1,Um=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},dU=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},pU=function(r,e){var t=eU(r),n=Array.isArray(t)?rU(t):new Uint32Array(t),A=Array.isArray(t)?tU(t):new Uint16Array(t),s=24,i=Um(A,s/2,n[4]/2),a=n[5]===2?Um(A,(s+n[4])/2):dU(n,Math.ceil((s+n[4])/4));return new hU(n[0],n[1],n[2],n[3],i,a)},hU=(function(){function r(e,t,n,A,s,i){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=A,this.index=s,this.data=i}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>NA],t=(t<<cf)+(e&lf),this.data[t];if(e<=65535)return t=this.index[Sg+(e-55296>>NA)],t=(t<<cf)+(e&lf),this.data[t];if(e<this.highStart)return t=uU-cU+(e>>Jf),t=this.index[t],t+=e>>NA&fU,t=this.index[t],t=(t<<cf)+(e&lf),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r})(),Fm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mU=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(Ba=0;Ba<Fm.length;Ba++)mU[Fm.charCodeAt(Ba)]=Ba;var Ba,gU=1,ff=2,df=3,Qm=4,Tm=5,wU=7,Om=8,pf=9,hf=10,Sm=11,Pm=12,Rm=13,km=14,mf=15,yU=function(r){for(var e=[],t=0,n=r.length;t<n;){var A=r.charCodeAt(t++);if(A>=55296&&A<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((A&1023)<<10)+(s&1023)+65536):(e.push(A),t--)}else e.push(A)}return e},_U=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],A=-1,s="";++A<t;){var i=r[A];i<=65535?n.push(i):(i-=65536,n.push((i>>10)+55296,i%1024+56320)),(A+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},bU=pU(YI),ir="\xD7",gf="\xF7",BU=function(r){return bU.get(r)},vU=function(r,e,t){var n=t-2,A=e[n],s=e[t-1],i=e[t];if(s===ff&&i===df)return ir;if(s===ff||s===df||s===Qm||i===ff||i===df||i===Qm)return gf;if(s===Om&&[Om,pf,Sm,Pm].indexOf(i)!==-1||(s===Sm||s===pf)&&(i===pf||i===hf)||(s===Pm||s===hf)&&i===hf||i===Rm||i===Tm||i===wU||s===gU)return ir;if(s===Rm&&i===km){for(;A===Tm;)A=e[--n];if(A===km)return ir}if(s===mf&&i===mf){for(var a=0;A===mf;)a++,A=e[--n];if(a%2===0)return ir}return gf},CU=function(r){var e=yU(r),t=e.length,n=0,A=0,s=e.map(BU);return{next:function(){if(n>=t)return{done:!0,value:null};for(var i=ir;n<t&&(i=vU(e,s,++n))===ir;);if(i!==ir||n===t){var a=_U.apply(null,e.slice(A,n));return A=n,{value:a,done:!1}}return{done:!0,value:null}}}},EU=function(r){for(var e=CU(r),t=[],n;!(n=e.next()).done;)n.value&&t.push(n.value.slice());return t},xU=function(r){var e=123;if(r.createRange){var t=r.createRange();if(t.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=e+"px",n.style.display="block",r.body.appendChild(n),t.selectNode(n);var A=t.getBoundingClientRect(),s=Math.round(A.height);if(r.body.removeChild(n),s===e)return!0}}return!1},IU=function(r){var e=r.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",r.body.appendChild(e);var t=r.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=e.firstChild,A=Qu(n.data).map(function(o){return je(o)}),s=0,i={},a=A.every(function(o,u){t.setStart(n,s),t.setEnd(n,s+o.length);var c=t.getBoundingClientRect();s+=o.length;var l=c.x>i.x||c.y>i.y;return i=c,u===0?!0:l});return r.body.removeChild(e),a},UU=function(){return typeof new Image().crossOrigin<"u"},FU=function(){return typeof new XMLHttpRequest().responseType=="string"},QU=function(r){var e=new Image,t=r.createElement("canvas"),n=t.getContext("2d");if(!n)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},Nm=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},TU=function(r){var e=r.createElement("canvas"),t=100;e.width=t,e.height=t;var n=e.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,t,t);var A=new Image,s=e.toDataURL();A.src=s;var i=Hf(t,t,0,0,A);return n.fillStyle="red",n.fillRect(0,0,t,t),Lm(i).then(function(a){n.drawImage(a,0,0);var o=n.getImageData(0,0,t,t).data;n.fillStyle="red",n.fillRect(0,0,t,t);var u=r.createElement("div");return u.style.backgroundImage="url("+s+")",u.style.height=t+"px",Nm(o)?Lm(Hf(t,t,0,0,u)):Promise.reject(!1)}).then(function(a){return n.drawImage(a,0,0),Nm(n.getImageData(0,0,t,t).data)}).catch(function(){return!1})},Hf=function(r,e,t,n,A){var s="http://www.w3.org/2000/svg",i=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject");return i.setAttributeNS(null,"width",r.toString()),i.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",t.toString()),a.setAttributeNS(null,"y",n.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),i.appendChild(a),a.appendChild(A),i},Lm=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},ut={get SUPPORT_RANGE_BOUNDS(){var r=xU(document);return Object.defineProperty(ut,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=ut.SUPPORT_RANGE_BOUNDS&&IU(document);return Object.defineProperty(ut,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=QU(document);return Object.defineProperty(ut,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?TU(document):Promise.resolve(!1);return Object.defineProperty(ut,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=UU();return Object.defineProperty(ut,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=FU();return Object.defineProperty(ut,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(ut,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(ut,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},Sa=(function(){function r(e,t){this.text=e,this.bounds=t}return r})(),OU=function(r,e,t,n){var A=RU(e,t),s=[],i=0;return A.forEach(function(a){if(t.textDecorationLine.length||a.trim().length>0)if(ut.SUPPORT_RANGE_BOUNDS){var o=Hm(n,i,a.length).getClientRects();if(o.length>1){var u=Wf(a),c=0;u.forEach(function(f){s.push(new Sa(f,bn.fromDOMRectList(r,Hm(n,c+i,f.length).getClientRects()))),c+=f.length})}else s.push(new Sa(a,bn.fromDOMRectList(r,o)))}else{var l=n.splitText(a.length);s.push(new Sa(a,SU(r,n))),n=l}else ut.SUPPORT_RANGE_BOUNDS||(n=n.splitText(a.length));i+=a.length}),s},SU=function(r,e){var t=e.ownerDocument;if(t){var n=t.createElement("html2canvaswrapper");n.appendChild(e.cloneNode(!0));var A=e.parentNode;if(A){A.replaceChild(n,e);var s=Fu(r,n);return n.firstChild&&A.replaceChild(n.firstChild,n),s}}return bn.EMPTY},Hm=function(r,e,t){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var A=n.createRange();return A.setStart(r,e),A.setEnd(r,e+t),A},Wf=function(r){if(ut.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(r)).map(function(t){return t.segment})}return EU(r)},PU=function(r,e){if(ut.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(r)).map(function(n){return n.segment})}return NU(r,e)},RU=function(r,e){return e.letterSpacing!==0?Wf(r):PU(r,e)},kU=[32,160,4961,65792,65793,4153,4241],NU=function(r,e){for(var t=cE(r,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),n=[],A,s=function(){if(A.value){var i=A.value.slice(),a=Qu(i),o="";a.forEach(function(u){kU.indexOf(u)===-1?o+=je(u):(o.length&&n.push(o),n.push(je(u)),o="")}),o.length&&n.push(o)}};!(A=t.next()).done;)s();return n},LU=(function(){function r(e,t,n){this.text=HU(t.data,n.textTransform),this.textBounds=OU(e,this.text,n,t)}return r})(),HU=function(r,e){switch(e){case 1:return r.toLowerCase();case 3:return r.replace(DU,MU);case 2:return r.toUpperCase();default:return r}},DU=/(^|\s|:|-|\(|\))([a-z])/g,MU=function(r,e,t){return r.length>0?e+t.toUpperCase():r},Pg=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;return A.src=n.currentSrc||n.src,A.intrinsicWidth=n.naturalWidth,A.intrinsicHeight=n.naturalHeight,A.context.cache.addImage(A.src),A}return e})(Kr),Rg=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;return A.canvas=n,A.intrinsicWidth=n.width,A.intrinsicHeight=n.height,A}return e})(Kr),kg=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this,s=new XMLSerializer,i=Fu(t,n);return n.setAttribute("width",i.width+"px"),n.setAttribute("height",i.height+"px"),A.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),A.intrinsicWidth=n.width.baseVal.value,A.intrinsicHeight=n.height.baseVal.value,A.context.cache.addImage(A.svg),A}return e})(Kr),Ng=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;return A.value=n.value,A}return e})(Kr),Df=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;return A.start=n.start,A.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,A}return e})(Kr),$U=[{type:15,flags:0,unit:"px",number:3}],jU=[{type:16,flags:0,number:50}],KU=function(r){return r.width>r.height?new bn(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new bn(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},zU=function(r){var e=r.type===GU?new Array(r.value.length+1).join("\u2022"):r.value;return e.length===0?r.placeholder||"":e},Bu="checkbox",vu="radio",GU="password",Dm=707406591,qf=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;switch(A.type=n.type.toLowerCase(),A.checked=n.checked,A.value=zU(n),(A.type===Bu||A.type===vu)&&(A.styles.backgroundColor=3739148031,A.styles.borderTopColor=A.styles.borderRightColor=A.styles.borderBottomColor=A.styles.borderLeftColor=2779096575,A.styles.borderTopWidth=A.styles.borderRightWidth=A.styles.borderBottomWidth=A.styles.borderLeftWidth=1,A.styles.borderTopStyle=A.styles.borderRightStyle=A.styles.borderBottomStyle=A.styles.borderLeftStyle=1,A.styles.backgroundClip=[0],A.styles.backgroundOrigin=[0],A.bounds=KU(A.bounds)),A.type){case Bu:A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=$U;break;case vu:A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=jU;break}return A}return e})(Kr),Lg=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this,s=n.options[n.selectedIndex||0];return A.value=s&&s.text||"",A}return e})(Kr),Hg=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;return A.value=n.value,A}return e})(Kr),Dg=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;A.src=n.src,A.width=parseInt(n.width,10)||0,A.height=parseInt(n.height,10)||0,A.backgroundColor=A.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){A.tree=$g(t,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?Ta(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):_n.TRANSPARENT,i=n.contentWindow.document.body?Ta(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):_n.TRANSPARENT;A.backgroundColor=qn(s)?qn(i)?A.styles.backgroundColor:i:s}}catch{}return A}return e})(Kr),VU=["OL","UL","MENU"],gu=function(r,e,t,n){for(var A=e.firstChild,s=void 0;A;A=s)if(s=A.nextSibling,jg(A)&&A.data.trim().length>0)t.textNodes.push(new LU(r,A,t.styles));else if(Vs(A))if(Vg(A)&&A.assignedNodes)A.assignedNodes().forEach(function(a){return gu(r,a,t,n)});else{var i=Mg(r,A);i.styles.isVisible()&&(ZU(A,i,n)?i.flags|=4:JU(i.styles)&&(i.flags|=2),VU.indexOf(A.tagName)!==-1&&(i.flags|=8),t.elements.push(i),A.slot,A.shadowRoot?gu(r,A.shadowRoot,i,n):!Cu(A)&&!Kg(A)&&!Eu(A)&&gu(r,A,i,n))}},Mg=function(r,e){return $f(e)?new Pg(r,e):zg(e)?new Rg(r,e):Kg(e)?new kg(r,e):WU(e)?new Ng(r,e):qU(e)?new Df(r,e):XU(e)?new qf(r,e):Eu(e)?new Lg(r,e):Cu(e)?new Hg(r,e):Gg(e)?new Dg(r,e):new Kr(r,e)},$g=function(r,e){var t=Mg(r,e);return t.flags|=4,gu(r,e,t,t),t},ZU=function(r,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||Xf(r)&&t.styles.isTransparent()},JU=function(r){return r.isPositioned()||r.isFloating()},jg=function(r){return r.nodeType===Node.TEXT_NODE},Vs=function(r){return r.nodeType===Node.ELEMENT_NODE},Mf=function(r){return Vs(r)&&typeof r.style<"u"&&!wu(r)},wu=function(r){return typeof r.className=="object"},WU=function(r){return r.tagName==="LI"},qU=function(r){return r.tagName==="OL"},XU=function(r){return r.tagName==="INPUT"},YU=function(r){return r.tagName==="HTML"},Kg=function(r){return r.tagName==="svg"},Xf=function(r){return r.tagName==="BODY"},zg=function(r){return r.tagName==="CANVAS"},Mm=function(r){return r.tagName==="VIDEO"},$f=function(r){return r.tagName==="IMG"},Gg=function(r){return r.tagName==="IFRAME"},$m=function(r){return r.tagName==="STYLE"},eF=function(r){return r.tagName==="SCRIPT"},Cu=function(r){return r.tagName==="TEXTAREA"},Eu=function(r){return r.tagName==="SELECT"},Vg=function(r){return r.tagName==="SLOT"},jm=function(r){return r.tagName.indexOf("-")>0},tF=(function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},r.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},r.prototype.pop=function(e){var t=this;e.forEach(function(n){return t.counters[n].pop()})},r.prototype.parse=function(e){var t=this,n=e.counterIncrement,A=e.counterReset,s=!0;n!==null&&n.forEach(function(a){var o=t.counters[a.counter];o&&a.increment!==0&&(s=!1,o.length||o.push(1),o[Math.max(0,o.length-1)]+=a.increment)});var i=[];return s&&A.forEach(function(a){var o=t.counters[a.counter];i.push(a.counter),o||(o=t.counters[a.counter]=[]),o.push(a.reset)}),i},r})(),Km={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},zm={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054F","\u054E","\u054D","\u054C","\u054B","\u054A","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053F","\u053E","\u053D","\u053C","\u053B","\u053A","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},rF={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05D9\u05F3","\u05D8\u05F3","\u05D7\u05F3","\u05D6\u05F3","\u05D5\u05F3","\u05D4\u05F3","\u05D3\u05F3","\u05D2\u05F3","\u05D1\u05F3","\u05D0\u05F3","\u05EA","\u05E9","\u05E8","\u05E7","\u05E6","\u05E4","\u05E2","\u05E1","\u05E0","\u05DE","\u05DC","\u05DB","\u05D9\u05D8","\u05D9\u05D7","\u05D9\u05D6","\u05D8\u05D6","\u05D8\u05D5","\u05D9","\u05D8","\u05D7","\u05D6","\u05D5","\u05D4","\u05D3","\u05D2","\u05D1","\u05D0"]},nF={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10F5","\u10F0","\u10EF","\u10F4","\u10EE","\u10ED","\u10EC","\u10EB","\u10EA","\u10E9","\u10E8","\u10E7","\u10E6","\u10E5","\u10E4","\u10F3","\u10E2","\u10E1","\u10E0","\u10DF","\u10DE","\u10DD","\u10F2","\u10DC","\u10DB","\u10DA","\u10D9","\u10D8","\u10D7","\u10F1","\u10D6","\u10D5","\u10D4","\u10D3","\u10D2","\u10D1","\u10D0"]},$s=function(r,e,t,n,A,s){return r<e||r>t?Na(r,A,s.length>0):n.integers.reduce(function(i,a,o){for(;r>=a;)r-=a,i+=n.values[o];return i},"")+s},Zg=function(r,e,t,n){var A="";do t||r--,A=n(r)+A,r/=e;while(r*e>=e);return A},$e=function(r,e,t,n,A){var s=t-e+1;return(r<0?"-":"")+(Zg(Math.abs(r),s,n,function(i){return je(Math.floor(i%s)+e)})+A)},SA=function(r,e,t){t===void 0&&(t=". ");var n=e.length;return Zg(Math.abs(r),n,!1,function(A){return e[Math.floor(A%n)]})+t},zs=1,Kn=2,zn=4,Fa=8,yn=function(r,e,t,n,A,s){if(r<-9999||r>9999)return Na(r,4,A.length>0);var i=Math.abs(r),a=A;if(i===0)return e[0]+a;for(var o=0;i>0&&o<=4;o++){var u=i%10;u===0&&Xe(s,zs)&&a!==""?a=e[u]+a:u>1||u===1&&o===0||u===1&&o===1&&Xe(s,Kn)||u===1&&o===1&&Xe(s,zn)&&r>100||u===1&&o>1&&Xe(s,Fa)?a=e[u]+(o>0?t[o-1]:"")+a:u===1&&o>0&&(a=t[o-1]+a),i=Math.floor(i/10)}return(r<0?n:"")+a},Gm="\u5341\u767E\u5343\u842C",Vm="\u62FE\u4F70\u4EDF\u842C",Zm="\u30DE\u30A4\u30CA\u30B9",wf="\uB9C8\uC774\uB108\uC2A4",Na=function(r,e,t){var n=t?". ":"",A=t?"\u3001":"",s=t?", ":"",i=t?" ":"";switch(e){case 0:return"\u2022"+i;case 1:return"\u25E6"+i;case 2:return"\u25FE"+i;case 5:var a=$e(r,48,57,!0,n);return a.length<4?"0"+a:a;case 4:return SA(r,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",A);case 6:return $s(r,1,3999,Km,3,n).toLowerCase();case 7:return $s(r,1,3999,Km,3,n);case 8:return $e(r,945,969,!1,n);case 9:return $e(r,97,122,!1,n);case 10:return $e(r,65,90,!1,n);case 11:return $e(r,1632,1641,!0,n);case 12:case 49:return $s(r,1,9999,zm,3,n);case 35:return $s(r,1,9999,zm,3,n).toLowerCase();case 13:return $e(r,2534,2543,!0,n);case 14:case 30:return $e(r,6112,6121,!0,n);case 15:return SA(r,"\u5B50\u4E11\u5BC5\u536F\u8FB0\u5DF3\u5348\u672A\u7533\u9149\u620C\u4EA5",A);case 16:return SA(r,"\u7532\u4E59\u4E19\u4E01\u620A\u5DF1\u5E9A\u8F9B\u58EC\u7678",A);case 17:case 48:return yn(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",Gm,"\u8CA0",A,Kn|zn|Fa);case 47:return yn(r,"\u96F6\u58F9\u8CB3\u53C3\u8086\u4F0D\u9678\u67D2\u634C\u7396",Vm,"\u8CA0",A,zs|Kn|zn|Fa);case 42:return yn(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",Gm,"\u8D1F",A,Kn|zn|Fa);case 41:return yn(r,"\u96F6\u58F9\u8D30\u53C1\u8086\u4F0D\u9646\u67D2\u634C\u7396",Vm,"\u8D1F",A,zs|Kn|zn|Fa);case 26:return yn(r,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u4E07",Zm,A,0);case 25:return yn(r,"\u96F6\u58F1\u5F10\u53C2\u56DB\u4F0D\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343\u4E07",Zm,A,zs|Kn|zn);case 31:return yn(r,"\uC601\uC77C\uC774\uC0BC\uC0AC\uC624\uC721\uCE60\uD314\uAD6C","\uC2ED\uBC31\uCC9C\uB9CC",wf,s,zs|Kn|zn);case 33:return yn(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u842C",wf,s,0);case 32:return yn(r,"\u96F6\u58F9\u8CB3\u53C3\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343",wf,s,zs|Kn|zn);case 18:return $e(r,2406,2415,!0,n);case 20:return $s(r,1,19999,nF,3,n);case 21:return $e(r,2790,2799,!0,n);case 22:return $e(r,2662,2671,!0,n);case 22:return $s(r,1,10999,rF,3,n);case 23:return SA(r,"\u3042\u3044\u3046\u3048\u304A\u304B\u304D\u304F\u3051\u3053\u3055\u3057\u3059\u305B\u305D\u305F\u3061\u3064\u3066\u3068\u306A\u306B\u306C\u306D\u306E\u306F\u3072\u3075\u3078\u307B\u307E\u307F\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308A\u308B\u308C\u308D\u308F\u3090\u3091\u3092\u3093");case 24:return SA(r,"\u3044\u308D\u306F\u306B\u307B\u3078\u3068\u3061\u308A\u306C\u308B\u3092\u308F\u304B\u3088\u305F\u308C\u305D\u3064\u306D\u306A\u3089\u3080\u3046\u3090\u306E\u304A\u304F\u3084\u307E\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304D\u3086\u3081\u307F\u3057\u3091\u3072\u3082\u305B\u3059");case 27:return $e(r,3302,3311,!0,n);case 28:return SA(r,"\u30A2\u30A4\u30A6\u30A8\u30AA\u30AB\u30AD\u30AF\u30B1\u30B3\u30B5\u30B7\u30B9\u30BB\u30BD\u30BF\u30C1\u30C4\u30C6\u30C8\u30CA\u30CB\u30CC\u30CD\u30CE\u30CF\u30D2\u30D5\u30D8\u30DB\u30DE\u30DF\u30E0\u30E1\u30E2\u30E4\u30E6\u30E8\u30E9\u30EA\u30EB\u30EC\u30ED\u30EF\u30F0\u30F1\u30F2\u30F3",A);case 29:return SA(r,"\u30A4\u30ED\u30CF\u30CB\u30DB\u30D8\u30C8\u30C1\u30EA\u30CC\u30EB\u30F2\u30EF\u30AB\u30E8\u30BF\u30EC\u30BD\u30C4\u30CD\u30CA\u30E9\u30E0\u30A6\u30F0\u30CE\u30AA\u30AF\u30E4\u30DE\u30B1\u30D5\u30B3\u30A8\u30C6\u30A2\u30B5\u30AD\u30E6\u30E1\u30DF\u30B7\u30F1\u30D2\u30E2\u30BB\u30B9",A);case 34:return $e(r,3792,3801,!0,n);case 37:return $e(r,6160,6169,!0,n);case 38:return $e(r,4160,4169,!0,n);case 39:return $e(r,2918,2927,!0,n);case 40:return $e(r,1776,1785,!0,n);case 43:return $e(r,3046,3055,!0,n);case 44:return $e(r,3174,3183,!0,n);case 45:return $e(r,3664,3673,!0,n);case 46:return $e(r,3872,3881,!0,n);case 3:default:return $e(r,48,57,!0,n)}},Jg="data-html2canvas-ignore",Jm=(function(){function r(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new tF,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(e,t){var n=this,A=AF(e,t);if(!A.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,i=e.defaultView.pageYOffset,a=A.contentWindow,o=a.document,u=aF(A).then(function(){return Et(n,void 0,void 0,function(){var c,l;return ht(this,function(f){switch(f.label){case 0:return this.scrolledElements.forEach(lF),a&&(a.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(a.scrollY!==t.top||a.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(a.scrollX-t.left,a.scrollY-t.top,0,0))),c=this.options.onclone,l=this.clonedReferenceElement,typeof l>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:f.sent(),f.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,iF(o)]:[3,4];case 3:f.sent(),f.label=4;case 4:return typeof c=="function"?[2,Promise.resolve().then(function(){return c(o,l)}).then(function(){return A})]:[2,A]}})})});return o.open(),o.write(uF(document.doctype)+"<html></html>"),cF(this.referenceElement.ownerDocument,s,i),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),u},r.prototype.createElementClone=function(e){if(Lf(e,2))debugger;if(zg(e))return this.createCanvasClone(e);if(Mm(e))return this.createVideoClone(e);if($m(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return $f(t)&&($f(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),jm(t)?this.createCustomElementClone(t):t},r.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return yf(e.style,t),t},r.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce(function(s,i){return i&&typeof i.cssText=="string"?s+i.cssText:s},""),A=e.cloneNode(!1);return A.textContent=n,A}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return e.cloneNode(!1)},r.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var A=e.cloneNode(!1);try{A.width=e.width,A.height=e.height;var s=e.getContext("2d"),i=A.getContext("2d");if(i)if(!this.options.allowTaint&&s)i.putImageData(s.getImageData(0,0,e.width,e.height),0,0);else{var a=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(a){var o=a.getContextAttributes();o?.preserveDrawingBuffer===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}i.drawImage(e,0,0)}return A}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return A},r.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var A=e.ownerDocument.createElement("canvas");return A.width=e.offsetWidth,A.height=e.offsetHeight,A},r.prototype.appendChildNode=function(e,t,n){(!Vs(t)||!eF(t)&&!t.hasAttribute(Jg)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!Vs(t)||!$m(t))&&e.appendChild(this.cloneNode(t,n))},r.prototype.cloneChildNodes=function(e,t,n){for(var A=this,s=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;s;s=s.nextSibling)if(Vs(s)&&Vg(s)&&typeof s.assignedNodes=="function"){var i=s.assignedNodes();i.length&&i.forEach(function(a){return A.appendChildNode(t,a,n)})}else this.appendChildNode(t,s,n)},r.prototype.cloneNode=function(e,t){if(jg(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&Vs(e)&&(Mf(e)||wu(e))){var A=this.createElementClone(e);A.style.transitionProperty="none";var s=n.getComputedStyle(e),i=n.getComputedStyle(e,":before"),a=n.getComputedStyle(e,":after");this.referenceElement===e&&Mf(A)&&(this.clonedReferenceElement=A),Xf(A)&&pF(A);var o=this.counters.parse(new xm(this.context,s)),u=this.resolvePseudoContent(e,A,i,Pa.BEFORE);jm(e)&&(t=!0),Mm(e)||this.cloneChildNodes(e,A,t),u&&A.insertBefore(u,A.firstChild);var c=this.resolvePseudoContent(e,A,a,Pa.AFTER);return c&&A.appendChild(c),this.counters.pop(o),(s&&(this.options.copyStyles||wu(e))&&!Gg(e)||t)&&yf(s,A),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([A,e.scrollLeft,e.scrollTop]),(Cu(e)||Eu(e))&&(Cu(A)||Eu(A))&&(A.value=e.value),A}return e.cloneNode(!1)},r.prototype.resolvePseudoContent=function(e,t,n,A){var s=this;if(n){var i=n.content,a=t.ownerDocument;if(!(!a||!i||i==="none"||i==="-moz-alt-content"||n.display==="none")){this.counters.parse(new xm(this.context,n));var o=new WI(this.context,n),u=a.createElement("html2canvaspseudoelement");yf(n,u),o.content.forEach(function(l){if(l.type===0)u.appendChild(a.createTextNode(l.value));else if(l.type===22){var f=a.createElement("img");f.src=l.value,f.style.opacity="1",u.appendChild(f)}else if(l.type===18){if(l.name==="attr"){var d=l.values.filter(Fe);d.length&&u.appendChild(a.createTextNode(e.getAttribute(d[0].value)||""))}else if(l.name==="counter"){var p=l.values.filter(Js),h=p[0],g=p[1];if(h&&Fe(h)){var w=s.counters.getCounterValue(h.value),m=g&&Fe(g)?Nf.parse(s.context,g.value):3;u.appendChild(a.createTextNode(Na(w,m,!1)))}}else if(l.name==="counters"){var _=l.values.filter(Js),h=_[0],B=_[1],g=_[2];if(h&&Fe(h)){var C=s.counters.getCounterValues(h.value),v=g&&Fe(g)?Nf.parse(s.context,g.value):3,x=B&&B.type===0?B.value:"",Q=C.map(function(ee){return Na(ee,v,!1)}).join(x);u.appendChild(a.createTextNode(Q))}}}else if(l.type===20)switch(l.value){case"open-quote":u.appendChild(a.createTextNode(Em(o.quotes,s.quoteDepth++,!0)));break;case"close-quote":u.appendChild(a.createTextNode(Em(o.quotes,--s.quoteDepth,!1)));break;default:u.appendChild(a.createTextNode(l.value))}}),u.className=jf+" "+Kf;var c=A===Pa.BEFORE?" "+jf:" "+Kf;return wu(t)?t.className.baseValue+=c:t.className+=c,u}}},r.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},r})(),Pa;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(Pa||(Pa={}));var AF=function(r,e){var t=r.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(Jg,"true"),r.body.appendChild(t),t},sF=function(r){return new Promise(function(e){if(r.complete){e();return}if(!r.src){e();return}r.onload=e,r.onerror=e})},iF=function(r){return Promise.all([].slice.call(r.images,0).map(sF))},aF=function(r){return new Promise(function(e,t){var n=r.contentWindow;if(!n)return t("No window assigned for iframe");var A=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){A.body.childNodes.length>0&&A.readyState==="complete"&&(clearInterval(s),e(r))},50)}})},oF=["all","d","content"],yf=function(r,e){for(var t=r.length-1;t>=0;t--){var n=r.item(t);oF.indexOf(n)===-1&&e.style.setProperty(n,r.getPropertyValue(n))}return e},uF=function(r){var e="";return r&&(e+="<!DOCTYPE ",r.name&&(e+=r.name),r.internalSubset&&(e+=r.internalSubset),r.publicId&&(e+='"'+r.publicId+'"'),r.systemId&&(e+='"'+r.systemId+'"'),e+=">"),e},cF=function(r,e,t){r&&r.defaultView&&(e!==r.defaultView.pageXOffset||t!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(e,t)},lF=function(r){var e=r[0],t=r[1],n=r[2];e.scrollLeft=t,e.scrollTop=n},fF=":before",dF=":after",jf="___html2canvas___pseudoelement_before",Kf="___html2canvas___pseudoelement_after",Wm=`{
    content: "" !important;
    display: none !important;
}`,pF=function(r){hF(r,"."+jf+fF+Wm+`
         .`+Kf+dF+Wm)},hF=function(r,e){var t=r.ownerDocument;if(t){var n=t.createElement("style");n.textContent=e,r.appendChild(n)}},Wg=(function(){function r(){}return r.getOrigin=function(e){var t=r._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r._origin="about:blank",r})(),mF=(function(){function r(e,t){this.context=e,this._options=t,this._cache={}}return r.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(bf(e)||_F(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},r.prototype.match=function(e){return this._cache[e]},r.prototype.loadImage=function(e){return Et(this,void 0,void 0,function(){var t,n,A,s,i=this;return ht(this,function(a){switch(a.label){case 0:return t=Wg.isSameOrigin(e),n=!_f(e)&&this._options.useCORS===!0&&ut.SUPPORT_CORS_IMAGES&&!t,A=!_f(e)&&!t&&!bf(e)&&typeof this._options.proxy=="string"&&ut.SUPPORT_CORS_XHR&&!n,!t&&this._options.allowTaint===!1&&!_f(e)&&!bf(e)&&!A&&!n?[2]:(s=e,A?[4,this.proxy(s)]:[3,2]);case 1:s=a.sent(),a.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(o,u){var c=new Image;c.onload=function(){return o(c)},c.onerror=u,(bF(s)||n)&&(c.crossOrigin="anonymous"),c.src=s,c.complete===!0&&setTimeout(function(){return o(c)},500),i._options.imageTimeout>0&&setTimeout(function(){return u("Timed out ("+i._options.imageTimeout+"ms) loading image")},i._options.imageTimeout)})];case 3:return[2,a.sent()]}})})},r.prototype.has=function(e){return typeof this._cache[e]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var A=e.substring(0,256);return new Promise(function(s,i){var a=ut.SUPPORT_RESPONSE_TYPE?"blob":"text",o=new XMLHttpRequest;o.onload=function(){if(o.status===200)if(a==="text")s(o.response);else{var l=new FileReader;l.addEventListener("load",function(){return s(l.result)},!1),l.addEventListener("error",function(f){return i(f)},!1),l.readAsDataURL(o.response)}else i("Failed to proxy resource "+A+" with status code "+o.status)},o.onerror=i;var u=n.indexOf("?")>-1?"&":"?";if(o.open("GET",""+n+u+"url="+encodeURIComponent(e)+"&responseType="+a),a!=="text"&&o instanceof XMLHttpRequest&&(o.responseType=a),t._options.imageTimeout){var c=t._options.imageTimeout;o.timeout=c,o.ontimeout=function(){return i("Timed out ("+c+"ms) proxying "+A)}}o.send()})},r})(),gF=/^data:image\/svg\+xml/i,wF=/^data:image\/.*;base64,/i,yF=/^data:image\/.*/i,_F=function(r){return ut.SUPPORT_SVG_DRAWING||!BF(r)},_f=function(r){return yF.test(r)},bF=function(r){return wF.test(r)},bf=function(r){return r.substr(0,4)==="blob"},BF=function(r){return r.substr(-3).toLowerCase()==="svg"||gF.test(r)},P=(function(){function r(e,t){this.type=0,this.x=e,this.y=t}return r.prototype.add=function(e,t){return new r(this.x+e,this.y+t)},r})(),js=function(r,e,t){return new P(r.x+(e.x-r.x)*t,r.y+(e.y-r.y)*t)},lu=(function(){function r(e,t,n,A){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=A}return r.prototype.subdivide=function(e,t){var n=js(this.start,this.startControl,e),A=js(this.startControl,this.endControl,e),s=js(this.endControl,this.end,e),i=js(n,A,e),a=js(A,s,e),o=js(i,a,e);return t?new r(this.start,n,i,o):new r(o,a,s,this.end)},r.prototype.add=function(e,t){return new r(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r})(),ar=function(r){return r.type===1},vF=(function(){function r(e){var t=e.styles,n=e.bounds,A=Ia(t.borderTopLeftRadius,n.width,n.height),s=A[0],i=A[1],a=Ia(t.borderTopRightRadius,n.width,n.height),o=a[0],u=a[1],c=Ia(t.borderBottomRightRadius,n.width,n.height),l=c[0],f=c[1],d=Ia(t.borderBottomLeftRadius,n.width,n.height),p=d[0],h=d[1],g=[];g.push((s+o)/n.width),g.push((p+l)/n.width),g.push((i+h)/n.height),g.push((u+f)/n.height);var w=Math.max.apply(Math,g);w>1&&(s/=w,i/=w,o/=w,u/=w,l/=w,f/=w,p/=w,h/=w);var m=n.width-o,_=n.height-f,B=n.width-l,C=n.height-h,v=t.borderTopWidth,x=t.borderRightWidth,Q=t.borderBottomWidth,F=t.borderLeftWidth,z=Te(t.paddingTop,e.bounds.width),ee=Te(t.paddingRight,e.bounds.width),ve=Te(t.paddingBottom,e.bounds.width),G=Te(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||i>0?Re(n.left+F/3,n.top+v/3,s-F/3,i-v/3,Ue.TOP_LEFT):new P(n.left+F/3,n.top+v/3),this.topRightBorderDoubleOuterBox=s>0||i>0?Re(n.left+m,n.top+v/3,o-x/3,u-v/3,Ue.TOP_RIGHT):new P(n.left+n.width-x/3,n.top+v/3),this.bottomRightBorderDoubleOuterBox=l>0||f>0?Re(n.left+B,n.top+_,l-x/3,f-Q/3,Ue.BOTTOM_RIGHT):new P(n.left+n.width-x/3,n.top+n.height-Q/3),this.bottomLeftBorderDoubleOuterBox=p>0||h>0?Re(n.left+F/3,n.top+C,p-F/3,h-Q/3,Ue.BOTTOM_LEFT):new P(n.left+F/3,n.top+n.height-Q/3),this.topLeftBorderDoubleInnerBox=s>0||i>0?Re(n.left+F*2/3,n.top+v*2/3,s-F*2/3,i-v*2/3,Ue.TOP_LEFT):new P(n.left+F*2/3,n.top+v*2/3),this.topRightBorderDoubleInnerBox=s>0||i>0?Re(n.left+m,n.top+v*2/3,o-x*2/3,u-v*2/3,Ue.TOP_RIGHT):new P(n.left+n.width-x*2/3,n.top+v*2/3),this.bottomRightBorderDoubleInnerBox=l>0||f>0?Re(n.left+B,n.top+_,l-x*2/3,f-Q*2/3,Ue.BOTTOM_RIGHT):new P(n.left+n.width-x*2/3,n.top+n.height-Q*2/3),this.bottomLeftBorderDoubleInnerBox=p>0||h>0?Re(n.left+F*2/3,n.top+C,p-F*2/3,h-Q*2/3,Ue.BOTTOM_LEFT):new P(n.left+F*2/3,n.top+n.height-Q*2/3),this.topLeftBorderStroke=s>0||i>0?Re(n.left+F/2,n.top+v/2,s-F/2,i-v/2,Ue.TOP_LEFT):new P(n.left+F/2,n.top+v/2),this.topRightBorderStroke=s>0||i>0?Re(n.left+m,n.top+v/2,o-x/2,u-v/2,Ue.TOP_RIGHT):new P(n.left+n.width-x/2,n.top+v/2),this.bottomRightBorderStroke=l>0||f>0?Re(n.left+B,n.top+_,l-x/2,f-Q/2,Ue.BOTTOM_RIGHT):new P(n.left+n.width-x/2,n.top+n.height-Q/2),this.bottomLeftBorderStroke=p>0||h>0?Re(n.left+F/2,n.top+C,p-F/2,h-Q/2,Ue.BOTTOM_LEFT):new P(n.left+F/2,n.top+n.height-Q/2),this.topLeftBorderBox=s>0||i>0?Re(n.left,n.top,s,i,Ue.TOP_LEFT):new P(n.left,n.top),this.topRightBorderBox=o>0||u>0?Re(n.left+m,n.top,o,u,Ue.TOP_RIGHT):new P(n.left+n.width,n.top),this.bottomRightBorderBox=l>0||f>0?Re(n.left+B,n.top+_,l,f,Ue.BOTTOM_RIGHT):new P(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=p>0||h>0?Re(n.left,n.top+C,p,h,Ue.BOTTOM_LEFT):new P(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||i>0?Re(n.left+F,n.top+v,Math.max(0,s-F),Math.max(0,i-v),Ue.TOP_LEFT):new P(n.left+F,n.top+v),this.topRightPaddingBox=o>0||u>0?Re(n.left+Math.min(m,n.width-x),n.top+v,m>n.width+x?0:Math.max(0,o-x),Math.max(0,u-v),Ue.TOP_RIGHT):new P(n.left+n.width-x,n.top+v),this.bottomRightPaddingBox=l>0||f>0?Re(n.left+Math.min(B,n.width-F),n.top+Math.min(_,n.height-Q),Math.max(0,l-x),Math.max(0,f-Q),Ue.BOTTOM_RIGHT):new P(n.left+n.width-x,n.top+n.height-Q),this.bottomLeftPaddingBox=p>0||h>0?Re(n.left+F,n.top+Math.min(C,n.height-Q),Math.max(0,p-F),Math.max(0,h-Q),Ue.BOTTOM_LEFT):new P(n.left+F,n.top+n.height-Q),this.topLeftContentBox=s>0||i>0?Re(n.left+F+G,n.top+v+z,Math.max(0,s-(F+G)),Math.max(0,i-(v+z)),Ue.TOP_LEFT):new P(n.left+F+G,n.top+v+z),this.topRightContentBox=o>0||u>0?Re(n.left+Math.min(m,n.width+F+G),n.top+v+z,m>n.width+F+G?0:o-F+G,u-(v+z),Ue.TOP_RIGHT):new P(n.left+n.width-(x+ee),n.top+v+z),this.bottomRightContentBox=l>0||f>0?Re(n.left+Math.min(B,n.width-(F+G)),n.top+Math.min(_,n.height+v+z),Math.max(0,l-(x+ee)),f-(Q+ve),Ue.BOTTOM_RIGHT):new P(n.left+n.width-(x+ee),n.top+n.height-(Q+ve)),this.bottomLeftContentBox=p>0||h>0?Re(n.left+F+G,n.top+C,Math.max(0,p-(F+G)),h-(Q+ve),Ue.BOTTOM_LEFT):new P(n.left+F+G,n.top+n.height-(Q+ve))}return r})(),Ue;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Ue||(Ue={}));var Re=function(r,e,t,n,A){var s=4*((Math.sqrt(2)-1)/3),i=t*s,a=n*s,o=r+t,u=e+n;switch(A){case Ue.TOP_LEFT:return new lu(new P(r,u),new P(r,u-a),new P(o-i,e),new P(o,e));case Ue.TOP_RIGHT:return new lu(new P(r,e),new P(r+i,e),new P(o,u-a),new P(o,u));case Ue.BOTTOM_RIGHT:return new lu(new P(o,e),new P(o,e+a),new P(r+i,u),new P(r,u));case Ue.BOTTOM_LEFT:default:return new lu(new P(o,u),new P(o-i,u),new P(r,e+a),new P(r,e))}},xu=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},CF=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},Iu=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},EF=(function(){function r(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return r})(),fu=(function(){function r(e,t){this.path=e,this.target=t,this.type=1}return r})(),xF=(function(){function r(e){this.opacity=e,this.type=2,this.target=6}return r})(),IF=function(r){return r.type===0},qg=function(r){return r.type===1},UF=function(r){return r.type===2},qm=function(r,e){return r.length===e.length?r.some(function(t,n){return t===e[n]}):!1},FF=function(r,e,t,n,A){return r.map(function(s,i){switch(i){case 0:return s.add(e,t);case 1:return s.add(e+n,t);case 2:return s.add(e+n,t+A);case 3:return s.add(e,t+A)}return s})},Xg=(function(){function r(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r})(),Yg=(function(){function r(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new vF(this.container),this.container.styles.opacity<1&&this.effects.push(new xF(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,A=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new EF(n,A,s))}if(this.container.styles.overflowX!==0){var i=xu(this.curves),a=Iu(this.curves);qm(i,a)?this.effects.push(new fu(i,6)):(this.effects.push(new fu(i,2)),this.effects.push(new fu(a,4)))}}return r.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,A=this.effects.slice(0);n;){var s=n.effects.filter(function(o){return!qg(o)});if(t||n.container.styles.position!==0||!n.parent){if(A.unshift.apply(A,s),t=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var i=xu(n.curves),a=Iu(n.curves);qm(i,a)||A.unshift(new fu(a,6))}}else A.unshift.apply(A,s);n=n.parent}return A.filter(function(o){return Xe(o.target,e)})},r})(),zf=function(r,e,t,n){r.container.elements.forEach(function(A){var s=Xe(A.flags,4),i=Xe(A.flags,2),a=new Yg(A,r);Xe(A.styles.display,2048)&&n.push(a);var o=Xe(A.flags,8)?[]:n;if(s||i){var u=s||A.styles.isPositioned()?t:e,c=new Xg(a);if(A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()){var l=A.styles.zIndex.order;if(l<0){var f=0;u.negativeZIndex.some(function(p,h){return l>p.element.container.styles.zIndex.order?(f=h,!1):f>0}),u.negativeZIndex.splice(f,0,c)}else if(l>0){var d=0;u.positiveZIndex.some(function(p,h){return l>=p.element.container.styles.zIndex.order?(d=h+1,!1):d>0}),u.positiveZIndex.splice(d,0,c)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(c)}else A.styles.isFloating()?u.nonPositionedFloats.push(c):u.nonPositionedInlineLevel.push(c);zf(a,c,s?c:t,o)}else A.styles.isInlineLevel()?e.inlineLevel.push(a):e.nonInlineLevel.push(a),zf(a,e,t,o);Xe(A.flags,8)&&ew(A,o)})},ew=function(r,e){for(var t=r instanceof Df?r.start:1,n=r instanceof Df?r.reversed:!1,A=0;A<e.length;A++){var s=e[A];s.container instanceof Ng&&typeof s.container.value=="number"&&s.container.value!==0&&(t=s.container.value),s.listValue=Na(t,s.container.styles.listStyleType,!0),t+=n?-1:1}},QF=function(r){var e=new Yg(r,null),t=new Xg(e),n=[];return zf(e,t,t,n),ew(e.container,n),t},Xm=function(r,e){switch(e){case 0:return ur(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return ur(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return ur(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return ur(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},TF=function(r,e){switch(e){case 0:return ur(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return ur(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return ur(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return ur(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},OF=function(r,e){switch(e){case 0:return ur(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return ur(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return ur(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return ur(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},SF=function(r,e){switch(e){case 0:return du(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return du(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return du(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return du(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},du=function(r,e){var t=[];return ar(r)?t.push(r.subdivide(.5,!1)):t.push(r),ar(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},ur=function(r,e,t,n){var A=[];return ar(r)?A.push(r.subdivide(.5,!1)):A.push(r),ar(t)?A.push(t.subdivide(.5,!0)):A.push(t),ar(n)?A.push(n.subdivide(.5,!0).reverse()):A.push(n),ar(e)?A.push(e.subdivide(.5,!1).reverse()):A.push(e),A},tw=function(r){var e=r.bounds,t=r.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},Uu=function(r){var e=r.styles,t=r.bounds,n=Te(e.paddingLeft,t.width),A=Te(e.paddingRight,t.width),s=Te(e.paddingTop,t.width),i=Te(e.paddingBottom,t.width);return t.add(n+e.borderLeftWidth,s+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+n+A),-(e.borderTopWidth+e.borderBottomWidth+s+i))},PF=function(r,e){return r===0?e.bounds:r===2?Uu(e):tw(e)},RF=function(r,e){return r===0?e.bounds:r===2?Uu(e):tw(e)},Bf=function(r,e,t){var n=PF(Gs(r.styles.backgroundOrigin,e),r),A=RF(Gs(r.styles.backgroundClip,e),r),s=kF(Gs(r.styles.backgroundSize,e),t,n),i=s[0],a=s[1],o=Ia(Gs(r.styles.backgroundPosition,e),n.width-i,n.height-a),u=NF(Gs(r.styles.backgroundRepeat,e),o,s,n,A),c=Math.round(n.left+o[0]),l=Math.round(n.top+o[1]);return[u,c,l,i,a]},Ks=function(r){return Fe(r)&&r.value===Zs.AUTO},pu=function(r){return typeof r=="number"},kF=function(r,e,t){var n=e[0],A=e[1],s=e[2],i=r[0],a=r[1];if(!i)return[0,0];if(Je(i)&&a&&Je(a))return[Te(i,t.width),Te(a,t.height)];var o=pu(s);if(Fe(i)&&(i.value===Zs.CONTAIN||i.value===Zs.COVER)){if(pu(s)){var u=t.width/t.height;return u<s!=(i.value===Zs.COVER)?[t.width,t.width/s]:[t.height*s,t.height]}return[t.width,t.height]}var c=pu(n),l=pu(A),f=c||l;if(Ks(i)&&(!a||Ks(a))){if(c&&l)return[n,A];if(!o&&!f)return[t.width,t.height];if(f&&o){var d=c?n:A*s,p=l?A:n/s;return[d,p]}var h=c?n:t.width,g=l?A:t.height;return[h,g]}if(o){var w=0,m=0;return Je(i)?w=Te(i,t.width):Je(a)&&(m=Te(a,t.height)),Ks(i)?w=m*s:(!a||Ks(a))&&(m=w/s),[w,m]}var _=null,B=null;if(Je(i)?_=Te(i,t.width):a&&Je(a)&&(B=Te(a,t.height)),_!==null&&(!a||Ks(a))&&(B=c&&l?_/n*A:t.height),B!==null&&Ks(i)&&(_=c&&l?B/A*n:t.width),_!==null&&B!==null)return[_,B];throw new Error("Unable to calculate background-size for element")},Gs=function(r,e){var t=r[e];return typeof t>"u"?r[0]:t},NF=function(r,e,t,n,A){var s=e[0],i=e[1],a=t[0],o=t[1];switch(r){case 2:return[new P(Math.round(n.left),Math.round(n.top+i)),new P(Math.round(n.left+n.width),Math.round(n.top+i)),new P(Math.round(n.left+n.width),Math.round(o+n.top+i)),new P(Math.round(n.left),Math.round(o+n.top+i))];case 3:return[new P(Math.round(n.left+s),Math.round(n.top)),new P(Math.round(n.left+s+a),Math.round(n.top)),new P(Math.round(n.left+s+a),Math.round(n.height+n.top)),new P(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new P(Math.round(n.left+s),Math.round(n.top+i)),new P(Math.round(n.left+s+a),Math.round(n.top+i)),new P(Math.round(n.left+s+a),Math.round(n.top+i+o)),new P(Math.round(n.left+s),Math.round(n.top+i+o))];default:return[new P(Math.round(A.left),Math.round(A.top)),new P(Math.round(A.left+A.width),Math.round(A.top)),new P(Math.round(A.left+A.width),Math.round(A.height+A.top)),new P(Math.round(A.left),Math.round(A.height+A.top))]}},LF="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Ym="Hidden Text",HF=(function(){function r(e){this._data={},this._document=e}return r.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),A=this._document.createElement("img"),s=this._document.createElement("span"),i=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",i.appendChild(n),A.src=LF,A.width=1,A.height=1,A.style.margin="0",A.style.padding="0",A.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(Ym)),n.appendChild(s),n.appendChild(A);var a=A.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(Ym)),n.style.lineHeight="normal",A.style.verticalAlign="super";var o=A.offsetTop-n.offsetTop+2;return i.removeChild(n),{baseline:a,middle:o}},r.prototype.getMetrics=function(e,t){var n=e+" "+t;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},r})(),rw=(function(){function r(e,t){this.context=e,this.options=t}return r})(),DF=1e4,MF=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;return A._activeEffects=[],A.canvas=n.canvas?n.canvas:document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),n.canvas||(A.canvas.width=Math.floor(n.width*n.scale),A.canvas.height=Math.floor(n.height*n.scale),A.canvas.style.width=n.width+"px",A.canvas.style.height=n.height+"px"),A.fontMetrics=new HF(document),A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-n.x,-n.y),A.ctx.textBaseline="bottom",A._activeEffects=[],A.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),A}return e.prototype.applyEffects=function(t){for(var n=this;this._activeEffects.length;)this.popEffect();t.forEach(function(A){return n.applyEffect(A)})},e.prototype.applyEffect=function(t){this.ctx.save(),UF(t)&&(this.ctx.globalAlpha=t.opacity),IF(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),qg(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return Et(this,void 0,void 0,function(){var n;return ht(this,function(A){switch(A.label){case 0:return n=t.element.container.styles,n.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return Et(this,void 0,void 0,function(){return ht(this,function(n){switch(n.label){case 0:if(Xe(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,n,A){var s=this;if(n===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+A);else{var i=Wf(t.text);i.reduce(function(a,o){return s.ctx.fillText(o,a,t.bounds.top+A),a+s.ctx.measureText(o).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var n=t.fontVariant.filter(function(i){return i==="normal"||i==="small-caps"}).join(""),A=GF(t.fontFamily).join(", "),s=Ha(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,n,t.fontWeight,s,A].join(" "),A,s]},e.prototype.renderTextNode=function(t,n){return Et(this,void 0,void 0,function(){var A,s,i,a,o,u,c,l,f=this;return ht(this,function(d){return A=this.createFontStyle(n),s=A[0],i=A[1],a=A[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",o=this.fontMetrics.getMetrics(i,a),u=o.baseline,c=o.middle,l=n.paintOrder,t.textBounds.forEach(function(p){l.forEach(function(h){switch(h){case 0:f.ctx.fillStyle=st(n.color),f.renderTextWithLetterSpacing(p,n.letterSpacing,u);var g=n.textShadow;g.length&&p.text.trim().length&&(g.slice(0).reverse().forEach(function(w){f.ctx.shadowColor=st(w.color),f.ctx.shadowOffsetX=w.offsetX.number*f.options.scale,f.ctx.shadowOffsetY=w.offsetY.number*f.options.scale,f.ctx.shadowBlur=w.blur.number,f.renderTextWithLetterSpacing(p,n.letterSpacing,u)}),f.ctx.shadowColor="",f.ctx.shadowOffsetX=0,f.ctx.shadowOffsetY=0,f.ctx.shadowBlur=0),n.textDecorationLine.length&&(f.ctx.fillStyle=st(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(w){switch(w){case 1:f.ctx.fillRect(p.bounds.left,Math.round(p.bounds.top+u),p.bounds.width,1);break;case 2:f.ctx.fillRect(p.bounds.left,Math.round(p.bounds.top),p.bounds.width,1);break;case 3:f.ctx.fillRect(p.bounds.left,Math.ceil(p.bounds.top+c),p.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&p.text.trim().length&&(f.ctx.strokeStyle=st(n.webkitTextStrokeColor),f.ctx.lineWidth=n.webkitTextStrokeWidth,f.ctx.lineJoin=window.chrome?"miter":"round",f.ctx.strokeText(p.text,p.bounds.left,p.bounds.top+u)),f.ctx.strokeStyle="",f.ctx.lineWidth=0,f.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,n,A){if(A&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var s=Uu(t),i=Iu(n);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(A,0,0,t.intrinsicWidth,t.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return Et(this,void 0,void 0,function(){var n,A,s,i,a,o,m,m,u,c,l,f,B,d,p,C,h,g,w,m,_,B,C;return ht(this,function(v){switch(v.label){case 0:this.applyEffects(t.getEffects(4)),n=t.container,A=t.curves,s=n.styles,i=0,a=n.textNodes,v.label=1;case 1:return i<a.length?(o=a[i],[4,this.renderTextNode(o,s)]):[3,4];case 2:v.sent(),v.label=3;case 3:return i++,[3,1];case 4:if(!(n instanceof Pg))return[3,8];v.label=5;case 5:return v.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return m=v.sent(),this.renderReplacedElement(n,A,m),[3,8];case 7:return v.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof Rg&&this.renderReplacedElement(n,A,n.canvas),!(n instanceof kg))return[3,12];v.label=9;case 9:return v.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return m=v.sent(),this.renderReplacedElement(n,A,m),[3,12];case 11:return v.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof Dg&&n.tree?(u=new e(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,u.render(n.tree)]):[3,14];case 13:c=v.sent(),n.width&&n.height&&this.ctx.drawImage(c,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),v.label=14;case 14:if(n instanceof qf&&(l=Math.min(n.bounds.width,n.bounds.height),n.type===Bu?n.checked&&(this.ctx.save(),this.path([new P(n.bounds.left+l*.39363,n.bounds.top+l*.79),new P(n.bounds.left+l*.16,n.bounds.top+l*.5549),new P(n.bounds.left+l*.27347,n.bounds.top+l*.44071),new P(n.bounds.left+l*.39694,n.bounds.top+l*.5649),new P(n.bounds.left+l*.72983,n.bounds.top+l*.23),new P(n.bounds.left+l*.84,n.bounds.top+l*.34085),new P(n.bounds.left+l*.39363,n.bounds.top+l*.79)]),this.ctx.fillStyle=st(Dm),this.ctx.fill(),this.ctx.restore()):n.type===vu&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+l/2,n.bounds.top+l/2,l/4,0,Math.PI*2,!0),this.ctx.fillStyle=st(Dm),this.ctx.fill(),this.ctx.restore())),$F(n)&&n.value.length){switch(f=this.createFontStyle(s),B=f[0],d=f[1],p=this.fontMetrics.getMetrics(B,d).baseline,this.ctx.font=B,this.ctx.fillStyle=st(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=KF(n.styles.textAlign),C=Uu(n),h=0,n.styles.textAlign){case 1:h+=C.width/2;break;case 2:h+=C.width;break}g=C.add(h,0,0,-C.height/2+1),this.ctx.save(),this.path([new P(C.left,C.top),new P(C.left+C.width,C.top),new P(C.left+C.width,C.top+C.height),new P(C.left,C.top+C.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Sa(n.value,g),s.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Xe(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(w=n.styles.listStyleImage,w.type!==0)return[3,18];m=void 0,_=w.url,v.label=15;case 15:return v.trys.push([15,17,,18]),[4,this.context.cache.match(_)];case 16:return m=v.sent(),this.ctx.drawImage(m,n.bounds.left-(m.width+10),n.bounds.top),[3,18];case 17:return v.sent(),this.context.logger.error("Error loading list-style-image "+_),[3,18];case 18:return[3,20];case 19:t.listValue&&n.styles.listStyleType!==-1&&(B=this.createFontStyle(s)[0],this.ctx.font=B,this.ctx.fillStyle=st(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",C=new bn(n.bounds.left,n.bounds.top+Te(n.styles.paddingTop,n.bounds.width),n.bounds.width,vm(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Sa(t.listValue,C),s.letterSpacing,vm(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),v.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return Et(this,void 0,void 0,function(){var n,A,w,s,i,w,a,o,w,u,c,w,l,f,w,d,p,w,h,g,w;return ht(this,function(m){switch(m.label){case 0:if(Xe(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:m.sent(),n=0,A=t.negativeZIndex,m.label=2;case 2:return n<A.length?(w=A[n],[4,this.renderStack(w)]):[3,5];case 3:m.sent(),m.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:m.sent(),s=0,i=t.nonInlineLevel,m.label=7;case 7:return s<i.length?(w=i[s],[4,this.renderNode(w)]):[3,10];case 8:m.sent(),m.label=9;case 9:return s++,[3,7];case 10:a=0,o=t.nonPositionedFloats,m.label=11;case 11:return a<o.length?(w=o[a],[4,this.renderStack(w)]):[3,14];case 12:m.sent(),m.label=13;case 13:return a++,[3,11];case 14:u=0,c=t.nonPositionedInlineLevel,m.label=15;case 15:return u<c.length?(w=c[u],[4,this.renderStack(w)]):[3,18];case 16:m.sent(),m.label=17;case 17:return u++,[3,15];case 18:l=0,f=t.inlineLevel,m.label=19;case 19:return l<f.length?(w=f[l],[4,this.renderNode(w)]):[3,22];case 20:m.sent(),m.label=21;case 21:return l++,[3,19];case 22:d=0,p=t.zeroOrAutoZIndexOrTransformedOrOpacity,m.label=23;case 23:return d<p.length?(w=p[d],[4,this.renderStack(w)]):[3,26];case 24:m.sent(),m.label=25;case 25:return d++,[3,23];case 26:h=0,g=t.positiveZIndex,m.label=27;case 27:return h<g.length?(w=g[h],[4,this.renderStack(w)]):[3,30];case 28:m.sent(),m.label=29;case 29:return h++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var n=this;t.forEach(function(A,s){var i=ar(A)?A.start:A;s===0?n.ctx.moveTo(i.x,i.y):n.ctx.lineTo(i.x,i.y),ar(A)&&n.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},e.prototype.renderRepeat=function(t,n,A,s){this.path(t),this.ctx.fillStyle=n,this.ctx.translate(A,s),this.ctx.fill(),this.ctx.translate(-A,-s)},e.prototype.resizeImage=function(t,n,A){var s;if(t.width===n&&t.height===A)return t;var i=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,a=i.createElement("canvas");a.width=Math.max(1,n),a.height=Math.max(1,A);var o=a.getContext("2d");return o.drawImage(t,0,0,t.width,t.height,0,0,n,A),a},e.prototype.renderBackgroundImage=function(t){return Et(this,void 0,void 0,function(){var n,A,s,i,a,o;return ht(this,function(u){switch(u.label){case 0:n=t.styles.backgroundImage.length-1,A=function(c){var l,f,d,z,Ce,Ee,G,fe,Q,p,z,Ce,Ee,G,fe,h,g,w,m,_,B,C,v,x,Q,F,z,ee,ve,G,fe,Ie,Ce,Ee,Pe,xe,j,X,K,J,Be,ge;return ht(this,function(Ne){switch(Ne.label){case 0:if(c.type!==0)return[3,5];l=void 0,f=c.url,Ne.label=1;case 1:return Ne.trys.push([1,3,,4]),[4,s.context.cache.match(f)];case 2:return l=Ne.sent(),[3,4];case 3:return Ne.sent(),s.context.logger.error("Error loading background-image "+f),[3,4];case 4:return l&&(d=Bf(t,n,[l.width,l.height,l.width/l.height]),z=d[0],Ce=d[1],Ee=d[2],G=d[3],fe=d[4],Q=s.ctx.createPattern(s.resizeImage(l,G,fe),"repeat"),s.renderRepeat(z,Q,Ce,Ee)),[3,6];case 5:Ix(c)?(p=Bf(t,n,[null,null,null]),z=p[0],Ce=p[1],Ee=p[2],G=p[3],fe=p[4],h=Bx(c.angle,G,fe),g=h[0],w=h[1],m=h[2],_=h[3],B=h[4],C=document.createElement("canvas"),C.width=G,C.height=fe,v=C.getContext("2d"),x=v.createLinearGradient(w,_,m,B),bm(c.stops,g).forEach(function(Ar){return x.addColorStop(Ar.stop,st(Ar.color))}),v.fillStyle=x,v.fillRect(0,0,G,fe),G>0&&fe>0&&(Q=s.ctx.createPattern(C,"repeat"),s.renderRepeat(z,Q,Ce,Ee))):Ux(c)&&(F=Bf(t,n,[null,null,null]),z=F[0],ee=F[1],ve=F[2],G=F[3],fe=F[4],Ie=c.position.length===0?[Vf]:c.position,Ce=Te(Ie[0],G),Ee=Te(Ie[Ie.length-1],fe),Pe=vx(c,Ce,Ee,G,fe),xe=Pe[0],j=Pe[1],xe>0&&j>0&&(X=s.ctx.createRadialGradient(ee+Ce,ve+Ee,0,ee+Ce,ve+Ee,xe),bm(c.stops,xe*2).forEach(function(Ar){return X.addColorStop(Ar.stop,st(Ar.color))}),s.path(z),s.ctx.fillStyle=X,xe!==j?(K=t.bounds.left+.5*t.bounds.width,J=t.bounds.top+.5*t.bounds.height,Be=j/xe,ge=1/Be,s.ctx.save(),s.ctx.translate(K,J),s.ctx.transform(1,0,0,Be,0,0),s.ctx.translate(-K,-J),s.ctx.fillRect(ee,ge*(ve-J)+J,G,fe*ge),s.ctx.restore()):s.ctx.fill())),Ne.label=6;case 6:return n--,[2]}})},s=this,i=0,a=t.styles.backgroundImage.slice(0).reverse(),u.label=1;case 1:return i<a.length?(o=a[i],[5,A(o)]):[3,4];case 2:u.sent(),u.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,n,A){return Et(this,void 0,void 0,function(){return ht(this,function(s){return this.path(Xm(A,n)),this.ctx.fillStyle=st(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,n,A,s){return Et(this,void 0,void 0,function(){var i,a;return ht(this,function(o){switch(o.label){case 0:return n<3?[4,this.renderSolidBorder(t,A,s)]:[3,2];case 1:return o.sent(),[2];case 2:return i=TF(s,A),this.path(i),this.ctx.fillStyle=st(t),this.ctx.fill(),a=OF(s,A),this.path(a),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return Et(this,void 0,void 0,function(){var n,A,s,i,a,o,u,c,l=this;return ht(this,function(f){switch(f.label){case 0:return this.applyEffects(t.getEffects(2)),n=t.container.styles,A=!qn(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],i=jF(Gs(n.backgroundClip,0),t.curves),A||n.boxShadow.length?(this.ctx.save(),this.path(i),this.ctx.clip(),qn(n.backgroundColor)||(this.ctx.fillStyle=st(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:f.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(d){l.ctx.save();var p=xu(t.curves),h=d.inset?0:DF,g=FF(p,-h+(d.inset?1:-1)*d.spread.number,(d.inset?1:-1)*d.spread.number,d.spread.number*(d.inset?-2:2),d.spread.number*(d.inset?-2:2));d.inset?(l.path(p),l.ctx.clip(),l.mask(g)):(l.mask(p),l.ctx.clip(),l.path(g)),l.ctx.shadowOffsetX=d.offsetX.number+h,l.ctx.shadowOffsetY=d.offsetY.number,l.ctx.shadowColor=st(d.color),l.ctx.shadowBlur=d.blur.number,l.ctx.fillStyle=d.inset?st(d.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore()}),f.label=2;case 2:a=0,o=0,u=s,f.label=3;case 3:return o<u.length?(c=u[o],c.style!==0&&!qn(c.color)&&c.width>0?c.style!==2?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,a,t.curves,2)]:[3,11]):[3,13];case 4:return f.sent(),[3,11];case 5:return c.style!==3?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,a,t.curves,3)];case 6:return f.sent(),[3,11];case 7:return c.style!==4?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,a,t.curves)];case 8:return f.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,a,t.curves)];case 10:f.sent(),f.label=11;case 11:a++,f.label=12;case 12:return o++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,n,A,s,i){return Et(this,void 0,void 0,function(){var a,o,u,c,l,f,d,p,h,g,w,m,_,B,C,v,C,v;return ht(this,function(x){return this.ctx.save(),a=SF(s,A),o=Xm(s,A),i===2&&(this.path(o),this.ctx.clip()),ar(o[0])?(u=o[0].start.x,c=o[0].start.y):(u=o[0].x,c=o[0].y),ar(o[1])?(l=o[1].end.x,f=o[1].end.y):(l=o[1].x,f=o[1].y),A===0||A===2?d=Math.abs(u-l):d=Math.abs(c-f),this.ctx.beginPath(),i===3?this.formatPath(a):this.formatPath(o.slice(0,2)),p=n<3?n*3:n*2,h=n<3?n*2:n,i===3&&(p=n,h=n),g=!0,d<=p*2?g=!1:d<=p*2+h?(w=d/(2*p+h),p*=w,h*=w):(m=Math.floor((d+h)/(p+h)),_=(d-m*p)/(m-1),B=(d-(m+1)*p)/m,h=B<=0||Math.abs(h-_)<Math.abs(h-B)?_:B),g&&(i===3?this.ctx.setLineDash([0,p+h]):this.ctx.setLineDash([p,h])),i===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=st(t),this.ctx.stroke(),this.ctx.setLineDash([]),i===2&&(ar(o[0])&&(C=o[3],v=o[0],this.ctx.beginPath(),this.formatPath([new P(C.end.x,C.end.y),new P(v.start.x,v.start.y)]),this.ctx.stroke()),ar(o[1])&&(C=o[1],v=o[2],this.ctx.beginPath(),this.formatPath([new P(C.end.x,C.end.y),new P(v.start.x,v.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return Et(this,void 0,void 0,function(){var n;return ht(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=st(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=QF(t),[4,this.renderStack(n)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}})})},e})(rw),$F=function(r){return r instanceof Hg||r instanceof Lg?!0:r instanceof qf&&r.type!==vu&&r.type!==Bu},jF=function(r,e){switch(r){case 0:return xu(e);case 2:return CF(e);case 1:default:return Iu(e)}},KF=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},zF=["-apple-system","system-ui"],GF=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(e){return zF.indexOf(e)===-1}):r},VF=(function(r){xr(e,r);function e(t,n){var A=r.call(this,t,n)||this;return A.canvas=n.canvas?n.canvas:document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),A.options=n,A.canvas.width=Math.floor(n.width*n.scale),A.canvas.height=Math.floor(n.height*n.scale),A.canvas.style.width=n.width+"px",A.canvas.style.height=n.height+"px",A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-n.x,-n.y),A.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),A}return e.prototype.render=function(t){return Et(this,void 0,void 0,function(){var n,A;return ht(this,function(s){switch(s.label){case 0:return n=Hf(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,ZF(n)];case 1:return A=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=st(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(A,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e})(rw),ZF=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},JF=(function(){function r(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,qo([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,qo([this.id,this.getTime()+"ms"],e))},r.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,qo([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,qo([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.instances={},r})(),WF=(function(){function r(e,t){var n;this.windowBounds=t,this.instanceName="#"+r.instanceCount++,this.logger=new JF({id:this.instanceName,enabled:e.logging}),this.cache=(n=e.cache)!==null&&n!==void 0?n:new mF(this,e)}return r.instanceCount=1,r})(),qF=function(r,e){return e===void 0&&(e={}),XF(r,e)};typeof window<"u"&&Wg.setContext(window);var XF=function(r,e){return Et(void 0,void 0,void 0,function(){var t,n,A,s,i,a,o,u,c,l,f,d,p,h,g,w,m,_,B,C,x,v,x,Q,F,z,ee,ve,G,fe,Ie,Ce,Ee,Pe,xe,j,X,K,J,Be;return ht(this,function(ge){switch(ge.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=r.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(n=t.defaultView,!n)throw new Error("Document is not attached to a Window");return A={allowTaint:(Q=e.allowTaint)!==null&&Q!==void 0?Q:!1,imageTimeout:(F=e.imageTimeout)!==null&&F!==void 0?F:15e3,proxy:e.proxy,useCORS:(z=e.useCORS)!==null&&z!==void 0?z:!1},s=Cf({logging:(ee=e.logging)!==null&&ee!==void 0?ee:!0,cache:e.cache},A),i={windowWidth:(ve=e.windowWidth)!==null&&ve!==void 0?ve:n.innerWidth,windowHeight:(G=e.windowHeight)!==null&&G!==void 0?G:n.innerHeight,scrollX:(fe=e.scrollX)!==null&&fe!==void 0?fe:n.pageXOffset,scrollY:(Ie=e.scrollY)!==null&&Ie!==void 0?Ie:n.pageYOffset},a=new bn(i.scrollX,i.scrollY,i.windowWidth,i.windowHeight),o=new WF(s,a),u=(Ce=e.foreignObjectRendering)!==null&&Ce!==void 0?Ce:!1,c={allowTaint:(Ee=e.allowTaint)!==null&&Ee!==void 0?Ee:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:u,copyStyles:u},o.logger.debug("Starting document clone with size "+a.width+"x"+a.height+" scrolled to "+-a.left+","+-a.top),l=new Jm(o,r,c),f=l.clonedReferenceElement,f?[4,l.toIFrame(t,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return d=ge.sent(),p=Xf(f)||YU(f)?FC(f.ownerDocument):Fu(o,f),h=p.width,g=p.height,w=p.left,m=p.top,_=YF(o,f,e.backgroundColor),B={canvas:e.canvas,backgroundColor:_,scale:(xe=(Pe=e.scale)!==null&&Pe!==void 0?Pe:n.devicePixelRatio)!==null&&xe!==void 0?xe:1,x:((j=e.x)!==null&&j!==void 0?j:0)+w,y:((X=e.y)!==null&&X!==void 0?X:0)+m,width:(K=e.width)!==null&&K!==void 0?K:Math.ceil(h),height:(J=e.height)!==null&&J!==void 0?J:Math.ceil(g)},u?(o.logger.debug("Document cloned, using foreign object rendering"),x=new VF(o,B),[4,x.render(f)]):[3,3];case 2:return C=ge.sent(),[3,5];case 3:return o.logger.debug("Document cloned, element located at "+w+","+m+" with size "+h+"x"+g+" using computed rendering"),o.logger.debug("Starting DOM parsing"),v=$g(o,f),_===v.styles.backgroundColor&&(v.styles.backgroundColor=_n.TRANSPARENT),o.logger.debug("Starting renderer for element at "+B.x+","+B.y+" with size "+B.width+"x"+B.height),x=new MF(o,B),[4,x.render(v)];case 4:C=ge.sent(),ge.label=5;case 5:return(!((Be=e.removeContainer)!==null&&Be!==void 0)||Be)&&(Jm.destroy(d)||o.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),o.logger.debug("Finished rendering"),[2,C]}})})},YF=function(r,e,t){var n=e.ownerDocument,A=n.documentElement?Ta(r,getComputedStyle(n.documentElement).backgroundColor):_n.TRANSPARENT,s=n.body?Ta(r,getComputedStyle(n.body).backgroundColor):_n.TRANSPARENT,i=typeof t=="string"?Ta(r,t):t===null?_n.TRANSPARENT:4294967295;return e===n.documentElement?qn(A)?qn(s)?i:s:A:i},nw=qF;var Bn=require("react"),zr=require("react/jsx-runtime"),Hu=({children:r,title:e,onClose:t,position:n="bottom-right",width:A=360,height:s=480,minWidth:i=280,minHeight:a=240,offset:o=16,zIndex:u=1e3,className:c,style:l,headerClassName:f,bodyClassName:d,closeButtonAriaLabel:p="Close",closeOnEscape:h=!0,draggable:g=!0,anchorRect:w})=>{let[m,_]=(0,Bn.useState)(!1),B=(0,Bn.useRef)(null),[C,v]=(0,Bn.useState)(!1),x=(0,Bn.useRef)(null),[Q,F]=(0,Bn.useState)(null);(0,Bn.useEffect)(()=>{if(!h)return;let G=fe=>{fe.key==="Escape"&&t?.()};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[h,t]);let z=(()=>{let G=`${o}px`;switch(n){case"top-left":return{top:G,left:G};case"top-right":return{top:G,right:G};case"bottom-left":return{bottom:G,left:G};case"bottom-right":default:return{bottom:G,right:G}}})(),ee=(()=>{if(n!=="auto"||!w)return null;let G=window.innerWidth,fe=window.innerHeight,Ie=o,Ce=w.top<fe/2,Ee=w.left>G/2,Pe=Ce?["bottom","top"]:["top","bottom"],xe=Ee?["right","left"]:["left","right"],j=[`${Pe[0]}-${xe[0]}`,`${Pe[0]}-${xe[1]}`,`${Pe[1]}-${xe[0]}`,`${Pe[1]}-${xe[1]}`];for(let J of j){let Be=0,ge=0;if(J==="bottom-right"?(Be=w.bottom+Ie,ge=w.right-A):J==="bottom-left"?(Be=w.bottom+Ie,ge=w.left):J==="top-right"?(Be=w.top-s-Ie,ge=w.right-A):(Be=w.top-s-Ie,ge=w.left),Be>=0&&ge>=0&&Be+s<=fe&&ge+A<=G)return{top:Be,left:ge}}let X=Math.min(Math.max(w.bottom+Ie,0),fe-s),K=Math.min(Math.max(w.right-A,0),G-A);return{top:X,left:K}})(),ve=G=>{if(!g)return;let fe=B.current;if(!fe)return;let Ie=fe.getBoundingClientRect();x.current={x:G.clientX,y:G.clientY,top:Ie.top,left:Ie.left},F({top:Ie.top,left:Ie.left}),v(!0);let Ce=Pe=>{if(!x.current)return;let xe=Pe.clientX-x.current.x,j=Pe.clientY-x.current.y;F({top:x.current.top+j,left:x.current.left+xe})},Ee=()=>{v(!1),x.current=null,window.removeEventListener("pointermove",Ce),window.removeEventListener("pointerup",Ee)};window.addEventListener("pointermove",Ce),window.addEventListener("pointerup",Ee,{once:!0})};return(0,zr.jsxs)("div",{ref:B,role:"dialog","aria-modal":"false",className:c,style:{position:"fixed",...Q?{top:Q.top,left:Q.left}:ee?{top:ee.top,left:ee.left}:z,width:A,height:s,minWidth:i,minHeight:a,zIndex:u,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:C?"none":void 0,...l},children:[(0,zr.jsxs)("div",{className:f,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:g?"move":void 0},onPointerDown:ve,children:[(0,zr.jsx)("div",{style:{fontWeight:600,color:"#111827"},children:e}),(0,zr.jsx)("button",{type:"button",onClick:t,"aria-label":p,onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:m?"#ef4444":void 0,transition:"color 120ms ease"},children:(0,zr.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,zr.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,zr.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,zr.jsx)("div",{className:d,style:{flex:1,overflow:"auto",background:"#ffffff"},children:r})]})};var vn=require("react/jsx-runtime"),Yf=gt.default.forwardRef(({children:r,onClick:e,label:t="Open chat",position:n="top-right",offset:A=8,icon:s,className:i,containerStyle:a,buttonClassName:o,buttonStyle:u,buttonSize:c=36,zIndex:l=10,disabled:f=!1,trigger:d,open:p,onOpenChange:h,renderButton:g,openWindowOnClick:w=!1,windowProps:m,windowContent:_},B)=>{let[C,v]=(0,gt.useState)(!1),[x,Q]=(0,gt.useState)(!1),F=(0,gt.useRef)(null),z=(0,gt.useRef)(null),ee=(0,gt.useRef)(null),[ve,G]=(0,gt.useState)(null),fe=d??"hover",Ie=(0,gt.useMemo)(()=>{let K={position:"absolute"},J=`${A}px`;switch(n){case"top-left":return{...K,top:J,left:J};case"top-right":return{...K,top:J,right:J};case"bottom-left":return{...K,bottom:J,left:J};case"bottom-right":default:return{...K,bottom:J,right:J}}},[n,A]),Ce=fe==="always"?!0:fe==="manual"?!!p:C,Ee=K=>{h&&h(K)},Pe={onMouseEnter:fe==="hover"?()=>{v(!0),Ee(!0)}:void 0,onMouseLeave:fe==="hover"?()=>{v(!1),Ee(!1)}:void 0,onFocus:fe==="focus"?()=>{v(!0),Ee(!0)}:void 0,onBlur:fe==="focus"?()=>{v(!1),Ee(!1)}:void 0},xe=!!m?.sendComponentImageAsContext;(0,gt.useEffect)(()=>{x&&(async()=>{if(!xe)return;let J=ee.current;if(J)try{await new Promise(Ne=>requestAnimationFrame(()=>setTimeout(Ne,50)));let ge=(await nw(J,{useCORS:!0,backgroundColor:null,scale:Math.min(2,Math.max(1,Math.ceil(J.offsetWidth/280)))})).toDataURL("image/png",.92);G(ge)}catch{}})()},[x,xe]);let j=K=>{F.current=K,typeof B=="function"?B(K):B&&typeof B=="object"&&(B.current=K)},X={type:"button","aria-label":t,onClick:K=>{e?.(K),!f&&w&&Q(!0)},className:o,disabled:f,style:{...Ie,zIndex:l,width:c,height:c,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:f?"#f3f4f6":"white",color:f?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:f?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:Ce?1:0,transform:Ce?"scale(1)":"scale(0.95)",pointerEvents:Ce?"auto":"none",...u},tabIndex:Ce?0:-1,"aria-hidden":Ce?void 0:!0,ref:j,visible:Ce};return(0,vn.jsxs)("div",{className:i,style:{position:"relative",display:"inline-block",...a},...Pe,ref:z,children:[(0,vn.jsx)("div",{ref:ee,style:{display:"inline-block"},children:r}),g?g(X):(0,vn.jsx)("button",{...X,children:s??(0,vn.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(c*.5)),height:Math.max(12,Math.floor(c*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,vn.jsx)("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),w&&x&&_&&(0,vn.jsx)(Hu,{...m,onClose:()=>{m?.onClose?.(),Q(!1),G(null)},anchorRect:m?.anchorRect??(F.current?F.current.getBoundingClientRect():null),children:(()=>{if(xe){if(!ve)return(0,vn.jsx)("div",{style:{padding:12,color:"#6b7280",fontSize:14},children:"Loading..."});if(gt.default.isValidElement(_)){let J=[..._.props?.contextImages??[],ve];try{return gt.default.cloneElement(_,{contextImages:J})}catch{return _}}}return _})()})]})});Yf.displayName="ChatEnabled";var At=require("react");function W(r,e,t,n,A){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!A)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!A:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?A.call(r,t):A?A.value=t:e.set(r,t),t}function y(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}var ed=function(){let{crypto:r}=globalThis;if(r?.randomUUID)return ed=r.randomUUID.bind(r),r.randomUUID();let e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function Da(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}var Ma=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){let e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};var D=class extends Error{},Ye=class r extends D{constructor(e,t,n,A){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=A,this.requestID=A?.get("x-request-id"),this.error=t;let s=t;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,n){let A=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&A?`${e} ${A}`:e?`${e} status code (no body)`:A||"(no status code or body)"}static generate(e,t,n,A){if(!e||!A)return new Yn({message:n,cause:Ma(t)});let s=t?.error;return e===400?new qs(e,s,n,A):e===401?new Xs(e,s,n,A):e===403?new Ys(e,s,n,A):e===404?new ei(e,s,n,A):e===409?new ti(e,s,n,A):e===422?new ri(e,s,n,A):e===429?new ni(e,s,n,A):e>=500?new Ai(e,s,n,A):new r(e,s,n,A)}},He=class extends Ye{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Yn=class extends Ye{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Gr=class extends Yn{constructor({message:e}={}){super({message:e??"Request timed out."})}},qs=class extends Ye{},Xs=class extends Ye{},Ys=class extends Ye{},ei=class extends Ye{},ti=class extends Ye{},ri=class extends Ye{},ni=class extends Ye{},Ai=class extends Ye{},si=class extends D{constructor(){super("Could not parse response content as the length limit was reached")}},ii=class extends D{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},Vr=class extends Error{constructor(e){super(e)}};var tQ=/^[a-z][a-z0-9+.-]*:/i,Aw=r=>tQ.test(r),wt=r=>(wt=Array.isArray,wt(r)),td=wt;function sw(r){return typeof r!="object"?{}:r??{}}function iw(r){if(!r)return!0;for(let e in r)return!1;return!0}function aw(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function $a(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var ow=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new D(`${r} must be an integer`);if(e<0)throw new D(`${r} must be a positive integer`);return e};var uw=r=>{try{return JSON.parse(r)}catch{return}};var Zr=r=>new Promise(e=>setTimeout(e,r));var eA="5.12.2";var dw=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function rQ(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var nQ=()=>{let r=rQ();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eA,"X-Stainless-OS":lw(Deno.build.os),"X-Stainless-Arch":cw(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eA,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eA,"X-Stainless-OS":lw(globalThis.process.platform??"unknown"),"X-Stainless-Arch":cw(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=AQ();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eA,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eA,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function AQ(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let n=t.exec(navigator.userAgent);if(n){let A=n[1]||0,s=n[2]||0,i=n[3]||0;return{browser:e,version:`${A}.${s}.${i}`}}}return null}var cw=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",lw=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),fw,pw=()=>fw??(fw=nQ());function hw(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function rd(...r){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function Du(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return rd({start(){},async pull(t){let{done:n,value:A}=await e.next();n?t.close():t.enqueue(A)},async cancel(){await e.return?.()}})}function nd(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function mw(r){if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await r[Symbol.asyncIterator]().return?.();return}let e=r.getReader(),t=e.cancel();e.releaseLock(),await t}var gw=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Mu="RFC3986",Ad=r=>String(r),$u={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:Ad},sd="RFC1738";var ju=(r,e)=>(ju=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),ju(r,e)),Jr=(()=>{let r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})();var id=1024,ww=(r,e,t,n,A)=>{if(r.length===0)return r;let s=r;if(typeof r=="symbol"?s=Symbol.prototype.toString.call(r):typeof r!="string"&&(s=String(r)),t==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let i="";for(let a=0;a<s.length;a+=id){let o=s.length>=id?s.slice(a,a+id):s,u=[];for(let c=0;c<o.length;++c){let l=o.charCodeAt(c);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||A===sd&&(l===40||l===41)){u[u.length]=o.charAt(c);continue}if(l<128){u[u.length]=Jr[l];continue}if(l<2048){u[u.length]=Jr[192|l>>6]+Jr[128|l&63];continue}if(l<55296||l>=57344){u[u.length]=Jr[224|l>>12]+Jr[128|l>>6&63]+Jr[128|l&63];continue}c+=1,l=65536+((l&1023)<<10|o.charCodeAt(c)&1023),u[u.length]=Jr[240|l>>18]+Jr[128|l>>12&63]+Jr[128|l>>6&63]+Jr[128|l&63]}i+=u.join("")}return i};function yw(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function ad(r,e){if(wt(r)){let t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}var bw={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},Bw=function(r,e){Array.prototype.push.apply(r,wt(e)?e:[e])},_w,et={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ww,encodeValuesOnly:!1,format:Mu,formatter:Ad,indices:!1,serializeDate(r){return(_w??(_w=Function.prototype.call.bind(Date.prototype.toISOString)))(r)},skipNulls:!1,strictNullHandling:!1};function aQ(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}var od={};function vw(r,e,t,n,A,s,i,a,o,u,c,l,f,d,p,h,g,w){let m=r,_=w,B=0,C=!1;for(;(_=_.get(od))!==void 0&&!C;){let z=_.get(r);if(B+=1,typeof z<"u"){if(z===B)throw new RangeError("Cyclic object value");C=!0}typeof _.get(od)>"u"&&(B=0)}if(typeof u=="function"?m=u(e,m):m instanceof Date?m=f?.(m):t==="comma"&&wt(m)&&(m=ad(m,function(z){return z instanceof Date?f?.(z):z})),m===null){if(s)return o&&!h?o(e,et.encoder,g,"key",d):e;m=""}if(aQ(m)||yw(m)){if(o){let z=h?e:o(e,et.encoder,g,"key",d);return[p?.(z)+"="+p?.(o(m,et.encoder,g,"value",d))]}return[p?.(e)+"="+p?.(String(m))]}let v=[];if(typeof m>"u")return v;let x;if(t==="comma"&&wt(m))h&&o&&(m=ad(m,o)),x=[{value:m.length>0?m.join(",")||null:void 0}];else if(wt(u))x=u;else{let z=Object.keys(m);x=c?z.sort(c):z}let Q=a?String(e).replace(/\./g,"%2E"):String(e),F=n&&wt(m)&&m.length===1?Q+"[]":Q;if(A&&wt(m)&&m.length===0)return F+"[]";for(let z=0;z<x.length;++z){let ee=x[z],ve=typeof ee=="object"&&typeof ee.value<"u"?ee.value:m[ee];if(i&&ve===null)continue;let G=l&&a?ee.replace(/\./g,"%2E"):ee,fe=wt(m)?typeof t=="function"?t(F,G):F:F+(l?"."+G:"["+G+"]");w.set(r,B);let Ie=new WeakMap;Ie.set(od,w),Bw(v,vw(ve,fe,t,n,A,s,i,a,t==="comma"&&h&&wt(m)?null:o,u,c,l,f,d,p,h,g,Ie))}return v}function oQ(r=et){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=r.charset||et.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Mu;if(typeof r.format<"u"){if(!ju($u,r.format))throw new TypeError("Unknown format option provided.");t=r.format}let n=$u[t],A=et.filter;(typeof r.filter=="function"||wt(r.filter))&&(A=r.filter);let s;if(r.arrayFormat&&r.arrayFormat in bw?s=r.arrayFormat:"indices"in r?s=r.indices?"indices":"repeat":s=et.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:et.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:et.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:et.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:et.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?et.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:et.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:et.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:et.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:et.encodeValuesOnly,filter:A,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:et.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:et.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:et.strictNullHandling}}function ud(r,e={}){let t=r,n=oQ(e),A,s;typeof n.filter=="function"?(s=n.filter,t=s("",t)):wt(n.filter)&&(s=n.filter,A=s);let i=[];if(typeof t!="object"||t===null)return"";let a=bw[n.arrayFormat],o=a==="comma"&&n.commaRoundTrip;A||(A=Object.keys(t)),n.sort&&A.sort(n.sort);let u=new WeakMap;for(let f=0;f<A.length;++f){let d=A[f];n.skipNulls&&t[d]===null||Bw(i,vw(t[d],d,a,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}let c=i.join(n.delimiter),l=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?l+="utf8=%26%2310003%3B&":l+="utf8=%E2%9C%93&"),c.length>0?l+c:""}function xw(r){let e=0;for(let A of r)e+=A.length;let t=new Uint8Array(e),n=0;for(let A of r)t.set(A,n),n+=A.length;return t}var Cw;function ai(r){let e;return(Cw??(e=new globalThis.TextEncoder,Cw=e.encode.bind(e)))(r)}var Ew;function cd(r){let e;return(Ew??(e=new globalThis.TextDecoder,Ew=e.decode.bind(e)))(r)}var Zt,Jt,LA=class{constructor(){Zt.set(this,void 0),Jt.set(this,void 0),W(this,Zt,new Uint8Array,"f"),W(this,Jt,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?ai(e):e;W(this,Zt,xw([y(this,Zt,"f"),t]),"f");let n=[],A;for(;(A=cQ(y(this,Zt,"f"),y(this,Jt,"f")))!=null;){if(A.carriage&&y(this,Jt,"f")==null){W(this,Jt,A.index,"f");continue}if(y(this,Jt,"f")!=null&&(A.index!==y(this,Jt,"f")+1||A.carriage)){n.push(cd(y(this,Zt,"f").subarray(0,y(this,Jt,"f")-1))),W(this,Zt,y(this,Zt,"f").subarray(y(this,Jt,"f")),"f"),W(this,Jt,null,"f");continue}let s=y(this,Jt,"f")!==null?A.preceding-1:A.preceding,i=cd(y(this,Zt,"f").subarray(0,s));n.push(i),W(this,Zt,y(this,Zt,"f").subarray(A.index),"f"),W(this,Jt,null,"f")}return n}flush(){return y(this,Zt,"f").length?this.decode(`
`):[]}};Zt=new WeakMap,Jt=new WeakMap;LA.NEWLINE_CHARS=new Set([`
`,"\r"]);LA.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function cQ(r,e){for(let A=e??0;A<r.length;A++){if(r[A]===10)return{preceding:A,index:A+1,carriage:!1};if(r[A]===13)return{preceding:A,index:A+1,carriage:!0}}return null}function Iw(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}var zu={off:0,error:200,warn:300,info:400,debug:500},ld=(r,e,t)=>{if(r){if(aw(zu,r))return r;Ke(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(zu))}`)}};function ja(){}function Ku(r,e,t){return!e||zu[r]>zu[t]?ja:e[r].bind(e)}var lQ={error:ja,warn:ja,info:ja,debug:ja},Uw=new WeakMap;function Ke(r){let e=r.logger,t=r.logLevel??"off";if(!e)return lQ;let n=Uw.get(e);if(n&&n[0]===t)return n[1];let A={error:Ku("error",e,t),warn:Ku("warn",e,t),info:Ku("info",e,t),debug:Ku("debug",e,t)};return Uw.set(e,[t,A]),A}var Cn=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r);var Ka,Wr=class r{constructor(e,t,n){this.iterator=e,Ka.set(this,void 0),this.controller=t,W(this,Ka,n,"f")}static fromSSEResponse(e,t,n){let A=!1,s=n?Ke(n):console;async function*i(){if(A)throw new D("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");A=!0;let a=!1;try{for await(let o of fQ(e,t))if(!a){if(o.data.startsWith("[DONE]")){a=!0;continue}if(o.event===null||!o.event.startsWith("thread.")){let u;try{u=JSON.parse(o.data)}catch(c){throw s.error("Could not parse message into JSON:",o.data),s.error("From chunk:",o.raw),c}if(u&&u.error)throw new Ye(void 0,u.error,void 0,e.headers);yield u}else{let u;try{u=JSON.parse(o.data)}catch(c){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),c}if(o.event=="error")throw new Ye(void 0,u.error,u.message,void 0);yield{event:o.event,data:u}}}a=!0}catch(o){if(Da(o))return;throw o}finally{a||t.abort()}}return new r(i,t,n)}static fromReadableStream(e,t,n){let A=!1;async function*s(){let a=new LA,o=nd(e);for await(let u of o)for(let c of a.decode(u))yield c;for(let u of a.flush())yield u}async function*i(){if(A)throw new D("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");A=!0;let a=!1;try{for await(let o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(Da(o))return;throw o}finally{a||t.abort()}}return new r(i,t,n)}[(Ka=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),A=s=>({next:()=>{if(s.length===0){let i=n.next();e.push(i),t.push(i)}return s.shift()}});return[new r(()=>A(e),this.controller,y(this,Ka,"f")),new r(()=>A(t),this.controller,y(this,Ka,"f"))]}toReadableStream(){let e=this,t;return rd({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:A,done:s}=await t.next();if(s)return n.close();let i=ai(JSON.stringify(A)+`
`);n.enqueue(i)}catch(A){n.error(A)}},async cancel(){await t.return?.()}})}};async function*fQ(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new D("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new D("Attempted to iterate over a response with no body");let t=new fd,n=new LA,A=nd(r.body);for await(let s of dQ(A))for(let i of n.decode(s)){let a=t.decode(i);a&&(yield a)}for(let s of n.flush()){let i=t.decode(s);i&&(yield i)}}async function*dQ(r){let e=new Uint8Array;for await(let t of r){if(t==null)continue;let n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?ai(t):t,A=new Uint8Array(e.length+n.length);A.set(e),A.set(n,e.length),e=A;let s;for(;(s=Iw(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}var fd=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,A]=pQ(e,":");return A.startsWith(" ")&&(A=A.substring(1)),t==="event"?this.event=A:t==="data"&&this.data.push(A),null}};function pQ(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}async function Gu(r,e){let{response:t,requestLogID:n,retryOfRequestLogID:A,startTime:s}=e,i=await(async()=>{if(e.options.stream)return Ke(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,r):Wr.fromSSEResponse(t,e.controller,r);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let o=t.headers.get("content-type")?.split(";")[0]?.trim();if(o?.includes("application/json")||o?.endsWith("+json")){let l=await t.json();return dd(l,t)}return await t.text()})();return Ke(r).debug(`[${n}] response parsed`,Cn({retryOfRequestLogID:A,url:t.url,status:t.status,body:i,durationMs:Date.now()-s})),i}function dd(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var za,HA=class r extends Promise{constructor(e,t,n=Gu){super(A=>{A(null)}),this.responsePromise=t,this.parseResponse=n,za.set(this,void 0),W(this,za,e,"f")}_thenUnwrap(e){return new r(y(this,za,"f"),this.responsePromise,async(t,n)=>dd(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(y(this,za,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};za=new WeakMap;var Vu,Zu=class{constructor(e,t,n,A){Vu.set(this,void 0),W(this,Vu,e,"f"),this.options=A,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new D("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await y(this,Vu,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Vu=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Ga=class extends HA{constructor(e,t,n){super(e,t,async(A,s)=>new n(A,s.response,await Gu(A,s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},qr=class extends Zu{constructor(e,t,n,A){super(e,t,n,A),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},de=class extends Zu{constructor(e,t,n,A){super(e,t,n,A),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...sw(this.options.query),after:t}}:null}};var hd=()=>{if(typeof File>"u"){let{process:r}=globalThis,e=typeof r?.versions?.node=="string"&&parseInt(r.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function oi(r,e,t){return hd(),new File(r,e??"unknown_file",t)}function Va(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}var md=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function";var Wt=async(r,e)=>({...r,body:await gQ(r.body,e)}),Fw=new WeakMap;function mQ(r){let e=typeof r=="function"?r:r.fetch,t=Fw.get(e);if(t)return t;let n=(async()=>{try{let A="Response"in e?e.Response:(await e("data:,")).constructor,s=new FormData;return s.toString()!==await new A(s).text()}catch{return!0}})();return Fw.set(e,n),n}var gQ=async(r,e)=>{if(!await mQ(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(r||{}).map(([n,A])=>pd(t,n,A))),t},wQ=r=>r instanceof Blob&&"name"in r;var pd=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response)r.append(e,oi([await t.blob()],Va(t)));else if(md(t))r.append(e,oi([await new Response(Du(t)).blob()],Va(t)));else if(wQ(t))r.append(e,t,Va(t));else if(Array.isArray(t))await Promise.all(t.map(n=>pd(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,A])=>pd(r,`${e}[${n}]`,A)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Qw=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",yQ=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Qw(r),_Q=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function Za(r,e,t){if(hd(),r=await r,yQ(r))return r instanceof File?r:oi([await r.arrayBuffer()],r.name);if(_Q(r)){let A=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),oi(await gd(A),e,t)}let n=await gd(r);if(e||(e=Va(r)),!t?.type){let A=n.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof A=="string"&&(t={...t,type:A})}return oi(n,e,t)}async function gd(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Qw(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if(md(r))for await(let t of r)e.push(...await gd(t));else{let t=r?.constructor?.name;throw new Error(`Unexpected data type: ${typeof r}${t?`; constructor: ${t}`:""}${bQ(r)}`)}return e}function bQ(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}var U=class{constructor(e){this._client=e}};function Ow(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Tw=Object.freeze(Object.create(null)),vQ=(r=Ow)=>function(t,...n){if(t.length===1)return t[0];let A=!1,s=[],i=t.reduce((c,l,f)=>{/[?#]/.test(l)&&(A=!0);let d=n[f],p=(A?encodeURIComponent:r)(""+d);return f!==n.length&&(d==null||typeof d=="object"&&d.toString===Object.getPrototypeOf(Object.getPrototypeOf(d.hasOwnProperty??Tw)??Tw)?.toString)&&(p=d+"",s.push({start:c.length+l.length,length:p.length,error:`Value of type ${Object.prototype.toString.call(d).slice(8,-1)} is not a valid path parameter`})),c+l+(f===n.length?"":p)},""),a=i.split(/[?#]/,1)[0],o=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,u;for(;(u=o.exec(a))!==null;)s.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(s.sort((c,l)=>c.start-l.start),s.length>0){let c=0,l=s.reduce((f,d)=>{let p=" ".repeat(d.start-c),h="^".repeat(d.length);return c=d.start+d.length,f+p+h},"");throw new D(`Path parameters result in path with invalid segments:
${s.map(f=>f.error).join(`
`)}
${i}
${l}`)}return i},E=vQ(Ow);var DA=class extends U{list(e,t={},n){return this._client.getAPIList(E`/chat/completions/${e}/messages`,de,{query:t,...n})}};function Ja(r){return r!==void 0&&"function"in r&&r.function!==void 0}function Sw(r,e){let t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Wa(r){return r?.$brand==="auto-parseable-response-format"}function MA(r){return r?.$brand==="auto-parseable-tool"}function Pw(r,e){return!e||!wd(e)?{...r,choices:r.choices.map(t=>(kw(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:qa(r,e)}function qa(r,e){let t=r.choices.map(n=>{if(n.finish_reason==="length")throw new si;if(n.finish_reason==="content_filter")throw new ii;return kw(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(A=>IQ(e,A))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?xQ(e,n.message.content):null}}});return{...r,choices:t}}function xQ(r,e){return r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function IQ(r,e){let t=r.tools?.find(n=>Ja(n)&&n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:MA(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function Rw(r,e){if(!r||!("tools"in r)||!r.tools)return!1;let t=r.tools?.find(n=>Ja(n)&&n.function?.name===e.function.name);return Ja(t)&&(MA(t)||t?.function.strict||!1)}function wd(r){return Wa(r.response_format)?!0:r.tools?.some(e=>MA(e)||e.type==="function"&&e.function.strict===!0)??!1}function kw(r){for(let e of r||[])if(e.type!=="function")throw new D(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function Nw(r){for(let e of r??[]){if(e.type!=="function")throw new D(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new D(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var ui=r=>r?.role==="assistant",yd=r=>r?.role==="tool";var _d,Ju,Wu,Xa,Ya,qu,eo,En,to,Xu,Yu,ci,Lw,tA=class{constructor(){_d.add(this),this.controller=new AbortController,Ju.set(this,void 0),Wu.set(this,()=>{}),Xa.set(this,()=>{}),Ya.set(this,void 0),qu.set(this,()=>{}),eo.set(this,()=>{}),En.set(this,{}),to.set(this,!1),Xu.set(this,!1),Yu.set(this,!1),ci.set(this,!1),W(this,Ju,new Promise((e,t)=>{W(this,Wu,e,"f"),W(this,Xa,t,"f")}),"f"),W(this,Ya,new Promise((e,t)=>{W(this,qu,e,"f"),W(this,eo,t,"f")}),"f"),y(this,Ju,"f").catch(()=>{}),y(this,Ya,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},y(this,_d,"m",Lw).bind(this))},0)}_connected(){this.ended||(y(this,Wu,"f").call(this),this._emit("connect"))}get ended(){return y(this,to,"f")}get errored(){return y(this,Xu,"f")}get aborted(){return y(this,Yu,"f")}abort(){this.controller.abort()}on(e,t){return(y(this,En,"f")[e]||(y(this,En,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=y(this,En,"f")[e];if(!n)return this;let A=n.findIndex(s=>s.listener===t);return A>=0&&n.splice(A,1),this}once(e,t){return(y(this,En,"f")[e]||(y(this,En,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{W(this,ci,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){W(this,ci,!0,"f"),await y(this,Ya,"f")}_emit(e,...t){if(y(this,to,"f"))return;e==="end"&&(W(this,to,!0,"f"),y(this,qu,"f").call(this));let n=y(this,En,"f")[e];if(n&&(y(this,En,"f")[e]=n.filter(A=>!A.once),n.forEach(({listener:A})=>A(...t))),e==="abort"){let A=t[0];!y(this,ci,"f")&&!n?.length&&Promise.reject(A),y(this,Xa,"f").call(this,A),y(this,eo,"f").call(this,A),this._emit("end");return}if(e==="error"){let A=t[0];!y(this,ci,"f")&&!n?.length&&Promise.reject(A),y(this,Xa,"f").call(this,A),y(this,eo,"f").call(this,A),this._emit("end")}}_emitFinal(){}};Ju=new WeakMap,Wu=new WeakMap,Xa=new WeakMap,Ya=new WeakMap,qu=new WeakMap,eo=new WeakMap,En=new WeakMap,to=new WeakMap,Xu=new WeakMap,Yu=new WeakMap,ci=new WeakMap,_d=new WeakSet,Lw=function(e){if(W(this,Xu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new He),e instanceof He)return W(this,Yu,!0,"f"),this._emit("abort",e);if(e instanceof D)return this._emit("error",e);if(e instanceof Error){let t=new D(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new D(String(e)))};function Hw(r){return typeof r.parse=="function"}var xt,bd,ec,Bd,vd,Cd,Dw,Mw,UQ=10,li=class extends tA{constructor(){super(...arguments),xt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),yd(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(ui(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new D("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),y(this,xt,"m",bd).call(this)}async finalMessage(){return await this.done(),y(this,xt,"m",ec).call(this)}async finalFunctionToolCall(){return await this.done(),y(this,xt,"m",Bd).call(this)}async finalFunctionToolCallResult(){return await this.done(),y(this,xt,"m",vd).call(this)}async totalUsage(){return await this.done(),y(this,xt,"m",Cd).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=y(this,xt,"m",ec).call(this);t&&this._emit("finalMessage",t);let n=y(this,xt,"m",bd).call(this);n&&this._emit("finalContent",n);let A=y(this,xt,"m",Bd).call(this);A&&this._emit("finalFunctionToolCall",A);let s=y(this,xt,"m",vd).call(this);s!=null&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",y(this,xt,"m",Cd).call(this))}async _createChatCompletion(e,t,n){let A=n?.signal;A&&(A.aborted&&this.controller.abort(),A.addEventListener("abort",()=>this.controller.abort())),y(this,xt,"m",Dw).call(this,t);let s=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(qa(s,t))}async _runChatCompletion(e,t,n){for(let A of t.messages)this._addMessage(A,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){let A="tool",{tool_choice:s="auto",stream:i,...a}=t,o=typeof s!="string"&&s.type==="function"&&s?.function?.name,{maxChatCompletions:u=UQ}=n||{},c=t.tools.map(d=>{if(MA(d)){if(!d.$callback)throw new D("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:d.$callback,name:d.function.name,description:d.function.description||"",parameters:d.function.parameters,parse:d.$parseRaw,strict:!0}}}return d}),l={};for(let d of c)d.type==="function"&&(l[d.function.name||d.function.function.name]=d.function);let f="tools"in t?c.map(d=>d.type==="function"?{type:"function",function:{name:d.function.name||d.function.function.name,parameters:d.function.parameters,description:d.function.description,strict:d.function.strict}}:d):void 0;for(let d of t.messages)this._addMessage(d,!1);for(let d=0;d<u;++d){let h=(await this._createChatCompletion(e,{...a,tool_choice:s,tools:f,messages:[...this.messages]},n)).choices[0]?.message;if(!h)throw new D("missing message in ChatCompletion response");if(!h.tool_calls?.length)return;for(let g of h.tool_calls){if(g.type!=="function")continue;let w=g.id,{name:m,arguments:_}=g.function,B=l[m];if(B){if(o&&o!==m){let Q=`Invalid tool_call: ${JSON.stringify(m)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:A,tool_call_id:w,content:Q});continue}}else{let Q=`Invalid tool_call: ${JSON.stringify(m)}. Available options are: ${Object.keys(l).map(F=>JSON.stringify(F)).join(", ")}. Please try again`;this._addMessage({role:A,tool_call_id:w,content:Q});continue}let C;try{C=Hw(B)?await B.parse(_):_}catch(Q){let F=Q instanceof Error?Q.message:String(Q);this._addMessage({role:A,tool_call_id:w,content:F});continue}let v=await B.function(C,this),x=y(this,xt,"m",Mw).call(this,v);if(this._addMessage({role:A,tool_call_id:w,content:x}),o)return}}}};xt=new WeakSet,bd=function(){return y(this,xt,"m",ec).call(this).content??null},ec=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ui(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new D("stream ended without producing a ChatCompletionMessage with role=assistant")},Bd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ui(t)&&t?.tool_calls?.length)return t.tool_calls.filter(n=>n.type==="function").at(-1)?.function}},vd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(yd(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(A=>A.type==="function"&&A.id===t.tool_call_id)))return t.content}},Cd=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Dw=function(e){if(e.n!=null&&e.n>1)throw new D("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Mw=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var ro=class r extends li{static runTools(e,t,n){let A=new r,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return A._run(()=>A._runTools(e,t,s)),A}_addMessage(e,t=!0){super._addMessage(e,t),ui(e)&&e.content&&this._emit("content",e.content)}};var it={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Ed=class extends Error{},xd=class extends Error{};function FQ(r,e=it.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return QQ(r.trim(),e)}var QQ=(r,e)=>{let t=r.length,n=0,A=f=>{throw new Ed(`${f} at position ${n}`)},s=f=>{throw new xd(`${f} at position ${n}`)},i=()=>(l(),n>=t&&A("Unexpected end of input"),r[n]==='"'?a():r[n]==="{"?o():r[n]==="["?u():r.substring(n,n+4)==="null"||it.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||it.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||it.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||it.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||it.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||it.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):c()),a=()=>{let f=n,d=!1;for(n++;n<t&&(r[n]!=='"'||d&&r[n-1]==="\\");)d=r[n]==="\\"?!d:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(d)))}catch(p){s(String(p))}else if(it.STR&e)try{return JSON.parse(r.substring(f,n-Number(d))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}A("Unterminated string literal")},o=()=>{n++,l();let f={};try{for(;r[n]!=="}";){if(l(),n>=t&&it.OBJ&e)return f;let d=a();l(),n++;try{let p=i();Object.defineProperty(f,d,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(it.OBJ&e)return f;throw p}l(),r[n]===","&&n++}}catch{if(it.OBJ&e)return f;A("Expected '}' at end of object")}return n++,f},u=()=>{n++;let f=[];try{for(;r[n]!=="]";)f.push(i()),l(),r[n]===","&&n++}catch{if(it.ARR&e)return f;A("Expected ']' at end of array")}return n++,f},c=()=>{if(n===0){r==="-"&&it.NUM&e&&A("Not sure what '-' is");try{return JSON.parse(r)}catch(d){if(it.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}s(String(d))}}let f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(it.NUM&e)&&A("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&it.NUM&e&&A("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(p){s(String(p))}}},l=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return i()},Id=r=>FQ(r,it.ALL^it.NUM);var tt,xn,fi,rA,Ud,tc,Fd,Qd,Td,rc,Od,$w,$A=class r extends li{constructor(e){super(),tt.add(this),xn.set(this,void 0),fi.set(this,void 0),rA.set(this,void 0),W(this,xn,e,"f"),W(this,fi,[],"f")}get currentChatCompletionSnapshot(){return y(this,rA,"f")}static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let A=new r(t);return A._run(()=>A._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),A}async _createChatCompletion(e,t,n){super._createChatCompletion;let A=n?.signal;A&&(A.aborted&&this.controller.abort(),A.addEventListener("abort",()=>this.controller.abort())),y(this,tt,"m",Ud).call(this);let s=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let i of s)y(this,tt,"m",Fd).call(this,i);if(s.controller.signal?.aborted)throw new He;return this._addChatCompletion(y(this,tt,"m",rc).call(this))}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),y(this,tt,"m",Ud).call(this),this._connected();let A=Wr.fromReadableStream(e,this.controller),s;for await(let i of A)s&&s!==i.id&&this._addChatCompletion(y(this,tt,"m",rc).call(this)),y(this,tt,"m",Fd).call(this,i),s=i.id;if(A.controller.signal?.aborted)throw new He;return this._addChatCompletion(y(this,tt,"m",rc).call(this))}[(xn=new WeakMap,fi=new WeakMap,rA=new WeakMap,tt=new WeakSet,Ud=function(){this.ended||W(this,rA,void 0,"f")},tc=function(t){let n=y(this,fi,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},y(this,fi,"f")[t.index]=n,n)},Fd=function(t){if(this.ended)return;let n=y(this,tt,"m",$w).call(this,t);this._emit("chunk",t,n);for(let A of t.choices){let s=n.choices[A.index];A.delta.content!=null&&s.message?.role==="assistant"&&s.message?.content&&(this._emit("content",A.delta.content,s.message.content),this._emit("content.delta",{delta:A.delta.content,snapshot:s.message.content,parsed:s.message.parsed})),A.delta.refusal!=null&&s.message?.role==="assistant"&&s.message?.refusal&&this._emit("refusal.delta",{delta:A.delta.refusal,snapshot:s.message.refusal}),A.logprobs?.content!=null&&s.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:A.logprobs?.content,snapshot:s.logprobs?.content??[]}),A.logprobs?.refusal!=null&&s.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:A.logprobs?.refusal,snapshot:s.logprobs?.refusal??[]});let i=y(this,tt,"m",tc).call(this,s);s.finish_reason&&(y(this,tt,"m",Td).call(this,s),i.current_tool_call_index!=null&&y(this,tt,"m",Qd).call(this,s,i.current_tool_call_index));for(let a of A.delta.tool_calls??[])i.current_tool_call_index!==a.index&&(y(this,tt,"m",Td).call(this,s),i.current_tool_call_index!=null&&y(this,tt,"m",Qd).call(this,s,i.current_tool_call_index)),i.current_tool_call_index=a.index;for(let a of A.delta.tool_calls??[]){let o=s.message.tool_calls?.[a.index];o?.type&&(o?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:o.function?.name,index:a.index,arguments:o.function.arguments,parsed_arguments:o.function.parsed_arguments,arguments_delta:a.function?.arguments??""}):(o?.type,void 0))}}},Qd=function(t,n){if(y(this,tt,"m",tc).call(this,t).done_tool_calls.has(n))return;let s=t.message.tool_calls?.[n];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){let i=y(this,xn,"f")?.tools?.find(a=>Ja(a)&&a.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:n,arguments:s.function.arguments,parsed_arguments:MA(i)?i.$parseRaw(s.function.arguments):i?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},Td=function(t){let n=y(this,tt,"m",tc).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;let A=y(this,tt,"m",Od).call(this);this._emit("content.done",{content:t.message.content,parsed:A?A.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},rc=function(){if(this.ended)throw new D("stream has ended, this shouldn't happen");let t=y(this,rA,"f");if(!t)throw new D("request ended without sending any chunks");return W(this,rA,void 0,"f"),W(this,fi,[],"f"),TQ(t,y(this,xn,"f"))},Od=function(){let t=y(this,xn,"f")?.response_format;return Wa(t)?t:null},$w=function(t){var n,A,s,i;let a=y(this,rA,"f"),{choices:o,...u}=t;a?Object.assign(a,u):a=W(this,rA,{...u,choices:[]},"f");for(let{delta:c,finish_reason:l,index:f,logprobs:d=null,...p}of t.choices){let h=a.choices[f];if(h||(h=a.choices[f]={finish_reason:l,index:f,message:{},logprobs:d,...p}),d)if(!h.logprobs)h.logprobs=Object.assign({},d);else{let{content:v,refusal:x,...Q}=d;Object.assign(h.logprobs,Q),v&&((n=h.logprobs).content??(n.content=[]),h.logprobs.content.push(...v)),x&&((A=h.logprobs).refusal??(A.refusal=[]),h.logprobs.refusal.push(...x))}if(l&&(h.finish_reason=l,y(this,xn,"f")&&wd(y(this,xn,"f")))){if(l==="length")throw new si;if(l==="content_filter")throw new ii}if(Object.assign(h,p),!c)continue;let{content:g,refusal:w,function_call:m,role:_,tool_calls:B,...C}=c;if(Object.assign(h.message,C),w&&(h.message.refusal=(h.message.refusal||"")+w),_&&(h.message.role=_),m&&(h.message.function_call?(m.name&&(h.message.function_call.name=m.name),m.arguments&&((s=h.message.function_call).arguments??(s.arguments=""),h.message.function_call.arguments+=m.arguments)):h.message.function_call=m),g&&(h.message.content=(h.message.content||"")+g,!h.message.refusal&&y(this,tt,"m",Od).call(this)&&(h.message.parsed=Id(h.message.content))),B){h.message.tool_calls||(h.message.tool_calls=[]);for(let{index:v,id:x,type:Q,function:F,...z}of B){let ee=(i=h.message.tool_calls)[v]??(i[v]={});Object.assign(ee,z),x&&(ee.id=x),Q&&(ee.type=Q),F&&(ee.function??(ee.function={name:F.name??"",arguments:""})),F?.name&&(ee.function.name=F.name),F?.arguments&&(ee.function.arguments+=F.arguments,Rw(y(this,xn,"f"),ee)&&(ee.function.parsed_arguments=Id(ee.function.arguments)))}}}return a},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",A=>{let s=t.shift();s?s.resolve(A):e.push(A)}),this.on("end",()=>{n=!0;for(let A of t)A.resolve(void 0);t.length=0}),this.on("abort",A=>{n=!0;for(let s of t)s.reject(A);t.length=0}),this.on("error",A=>{n=!0;for(let s of t)s.reject(A);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Wr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function TQ(r,e){let{id:t,choices:n,created:A,model:s,system_fingerprint:i,...a}=r,o={...a,id:t,choices:n.map(({message:u,finish_reason:c,index:l,logprobs:f,...d})=>{if(!c)throw new D(`missing finish_reason for choice ${l}`);let{content:p=null,function_call:h,tool_calls:g,...w}=u,m=u.role;if(!m)throw new D(`missing role for choice ${l}`);if(h){let{arguments:_,name:B}=h;if(_==null)throw new D(`missing function_call.arguments for choice ${l}`);if(!B)throw new D(`missing function_call.name for choice ${l}`);return{...d,message:{content:p,function_call:{arguments:_,name:B},role:m,refusal:u.refusal??null},finish_reason:c,index:l,logprobs:f}}return g?{...d,index:l,finish_reason:c,logprobs:f,message:{...w,role:m,content:p,refusal:u.refusal??null,tool_calls:g.map((_,B)=>{let{function:C,type:v,id:x,...Q}=_,{arguments:F,name:z,...ee}=C||{};if(x==null)throw new D(`missing choices[${l}].tool_calls[${B}].id
${nc(r)}`);if(v==null)throw new D(`missing choices[${l}].tool_calls[${B}].type
${nc(r)}`);if(z==null)throw new D(`missing choices[${l}].tool_calls[${B}].function.name
${nc(r)}`);if(F==null)throw new D(`missing choices[${l}].tool_calls[${B}].function.arguments
${nc(r)}`);return{...Q,id:x,type:v,function:{...ee,name:z,arguments:F}}})}}:{...d,message:{...w,content:p,role:m,refusal:u.refusal??null},finish_reason:c,index:l,logprobs:f}}),created:A,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Pw(o,e)}function nc(r){return JSON.stringify(r)}var no=class r extends $A{static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){let A=new r(t),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return A._run(()=>A._runTools(e,t,s)),A}};var In=class extends U{constructor(){super(...arguments),this.messages=new DA(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(E`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(E`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",de,{query:e,...t})}delete(e,t){return this._client.delete(E`/chat/completions/${e}`,t)}parse(e,t){return Nw(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>qa(n,e))}runTools(e,t){return e.stream?no.runTools(this._client,e,t):ro.runTools(this._client,e,t)}stream(e,t){return $A.createChatCompletion(this._client,e,t)}};In.Messages=DA;var nA=class extends U{constructor(){super(...arguments),this.completions=new In(this._client)}};nA.Completions=In;var jw=Symbol("brand.privateNullableHeaders");function*SQ(r){if(!r)return;if(jw in r){let{values:n,nulls:A}=r;yield*n.entries();for(let s of A)yield[s,null];return}let e=!1,t;r instanceof Headers?t=r.entries():td(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let n of t){let A=n[0];if(typeof A!="string")throw new TypeError("expected header name to be a string");let s=td(n[1])?n[1]:[n[1]],i=!1;for(let a of s)a!==void 0&&(e&&!i&&(i=!0,yield[A,null]),yield[A,a])}}var S=r=>{let e=new Headers,t=new Set;for(let n of r){let A=new Set;for(let[s,i]of SQ(n)){let a=s.toLowerCase();A.has(a)||(e.delete(s),A.add(a)),i===null?(e.delete(s),t.add(a)):(e.append(s,i),t.delete(a))}}return{[jw]:!0,values:e,nulls:t}};var di=class extends U{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:S([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}};var pi=class extends U{create(e,t){return this._client.post("/audio/transcriptions",Wt({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var hi=class extends U{create(e,t){return this._client.post("/audio/translations",Wt({body:e,...t,__metadata:{model:e.model}},this._client))}};var Xr=class extends U{constructor(){super(...arguments),this.transcriptions=new pi(this._client),this.translations=new hi(this._client),this.speech=new di(this._client)}};Xr.Transcriptions=pi;Xr.Translations=hi;Xr.Speech=di;var jA=class extends U{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(E`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",de,{query:e,...t})}cancel(e,t){return this._client.post(E`/batches/${e}/cancel`,t)}};var mi=class extends U{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(E`/assistants/${e}`,{...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(E`/assistants/${e}`,{body:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",de,{query:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(E`/assistants/${e}`,{...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var gi=class extends U{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var wi=class extends U{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var AA=class extends U{constructor(){super(...arguments),this.sessions=new gi(this._client),this.transcriptionSessions=new wi(this._client)}};AA.Sessions=gi;AA.TranscriptionSessions=wi;var yi=class extends U{create(e,t,n){return this._client.post(E`/threads/${e}/messages`,{body:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{thread_id:A}=t;return this._client.get(E`/threads/${A}/messages/${e}`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:A,...s}=t;return this._client.post(E`/threads/${A}/messages/${e}`,{body:s,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(E`/threads/${e}/messages`,de,{query:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{thread_id:A}=t;return this._client.delete(E`/threads/${A}/messages/${e}`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var _i=class extends U{retrieve(e,t,n){let{thread_id:A,run_id:s,...i}=t;return this._client.get(E`/threads/${A}/runs/${s}/steps/${e}`,{query:i,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){let{thread_id:A,...s}=t;return this._client.getAPIList(E`/threads/${A}/runs/${e}/steps`,de,{query:s,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Kw=r=>{if(typeof Buffer<"u"){let e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(r),t=e.length,n=new Uint8Array(t);for(let A=0;A<t;A++)n[A]=e.charCodeAt(A);return Array.from(new Float32Array(n.buffer))}};var sA=r=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[r]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(r)?.trim()};var lt,zA,Sd,Yr,Ac,Ir,GA,bi,KA,ac,qt,sc,ic,io,Ao,so,zw,Gw,Vw,Zw,Jw,Ww,qw,Un=class extends tA{constructor(){super(...arguments),lt.add(this),Sd.set(this,[]),Yr.set(this,{}),Ac.set(this,{}),Ir.set(this,void 0),GA.set(this,void 0),bi.set(this,void 0),KA.set(this,void 0),ac.set(this,void 0),qt.set(this,void 0),sc.set(this,void 0),ic.set(this,void 0),io.set(this,void 0)}[(Sd=new WeakMap,Yr=new WeakMap,Ac=new WeakMap,Ir=new WeakMap,GA=new WeakMap,bi=new WeakMap,KA=new WeakMap,ac=new WeakMap,qt=new WeakMap,sc=new WeakMap,ic=new WeakMap,io=new WeakMap,lt=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",A=>{let s=t.shift();s?s.resolve(A):e.push(A)}),this.on("end",()=>{n=!0;for(let A of t)A.resolve(void 0);t.length=0}),this.on("abort",A=>{n=!0;for(let s of t)s.reject(A);t.length=0}),this.on("error",A=>{n=!0;for(let s of t)s.reject(A);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new zA;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let A=Wr.fromReadableStream(e,this.controller);for await(let s of A)y(this,lt,"m",Ao).call(this,s);if(A.controller.signal?.aborted)throw new He;return this._addRun(y(this,lt,"m",so).call(this))}toReadableStream(){return new Wr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,A){let s=new zA;return s._run(()=>s._runToolAssistantStream(e,t,n,{...A,headers:{...A?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(e,t,n,A){let s=A?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},a=await e.submitToolOutputs(t,i,{...A,signal:this.controller.signal});this._connected();for await(let o of a)y(this,lt,"m",Ao).call(this,o);if(a.controller.signal?.aborted)throw new He;return this._addRun(y(this,lt,"m",so).call(this))}static createThreadAssistantStream(e,t,n){let A=new zA;return A._run(()=>A._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),A}static createAssistantStream(e,t,n,A){let s=new zA;return s._run(()=>s._runAssistantStream(e,t,n,{...A,headers:{...A?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return y(this,sc,"f")}currentRun(){return y(this,ic,"f")}currentMessageSnapshot(){return y(this,Ir,"f")}currentRunStepSnapshot(){return y(this,io,"f")}async finalRunSteps(){return await this.done(),Object.values(y(this,Yr,"f"))}async finalMessages(){return await this.done(),Object.values(y(this,Ac,"f"))}async finalRun(){if(await this.done(),!y(this,GA,"f"))throw Error("Final run was not received.");return y(this,GA,"f")}async _createThreadAssistantStream(e,t,n){let A=n?.signal;A&&(A.aborted&&this.controller.abort(),A.addEventListener("abort",()=>this.controller.abort()));let s={...t,stream:!0},i=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(let a of i)y(this,lt,"m",Ao).call(this,a);if(i.controller.signal?.aborted)throw new He;return this._addRun(y(this,lt,"m",so).call(this))}async _createAssistantStream(e,t,n,A){let s=A?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},a=await e.create(t,i,{...A,signal:this.controller.signal});this._connected();for await(let o of a)y(this,lt,"m",Ao).call(this,o);if(a.controller.signal?.aborted)throw new He;return this._addRun(y(this,lt,"m",so).call(this))}static accumulateDelta(e,t){for(let[n,A]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=A;continue}let s=e[n];if(s==null){e[n]=A;continue}if(n==="index"||n==="type"){e[n]=A;continue}if(typeof s=="string"&&typeof A=="string")s+=A;else if(typeof s=="number"&&typeof A=="number")s+=A;else if($a(s)&&$a(A))s=this.accumulateDelta(s,A);else if(Array.isArray(s)&&Array.isArray(A)){if(s.every(i=>typeof i=="string"||typeof i=="number")){s.push(...A);continue}for(let i of A){if(!$a(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let a=i.index;if(a==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);let o=s[a];o==null?s.push(i):s[a]=this.accumulateDelta(o,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${A}, accValue: ${s}`);e[n]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,A){return await this._createAssistantStream(t,e,n,A)}async _runToolAssistantStream(e,t,n,A){return await this._createToolAssistantStream(t,e,n,A)}};zA=Un,Ao=function(e){if(!this.ended)switch(W(this,sc,e,"f"),y(this,lt,"m",Vw).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":y(this,lt,"m",qw).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":y(this,lt,"m",Gw).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":y(this,lt,"m",zw).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},so=function(){if(this.ended)throw new D("stream has ended, this shouldn't happen");if(!y(this,GA,"f"))throw Error("Final run has not been received");return y(this,GA,"f")},zw=function(e){let[t,n]=y(this,lt,"m",Jw).call(this,e,y(this,Ir,"f"));W(this,Ir,t,"f"),y(this,Ac,"f")[t.id]=t;for(let A of n){let s=t.content[A.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let A of e.data.delta.content){if(A.type=="text"&&A.text){let s=A.text,i=t.content[A.index];if(i&&i.type=="text")this._emit("textDelta",s,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(A.index!=y(this,bi,"f")){if(y(this,KA,"f"))switch(y(this,KA,"f").type){case"text":this._emit("textDone",y(this,KA,"f").text,y(this,Ir,"f"));break;case"image_file":this._emit("imageFileDone",y(this,KA,"f").image_file,y(this,Ir,"f"));break}W(this,bi,A.index,"f")}W(this,KA,t.content[A.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(y(this,bi,"f")!==void 0){let A=e.data.content[y(this,bi,"f")];if(A)switch(A.type){case"image_file":this._emit("imageFileDone",A.image_file,y(this,Ir,"f"));break;case"text":this._emit("textDone",A.text,y(this,Ir,"f"));break}}y(this,Ir,"f")&&this._emit("messageDone",e.data),W(this,Ir,void 0,"f")}},Gw=function(e){let t=y(this,lt,"m",Zw).call(this,e);switch(W(this,io,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let s of n.step_details.tool_calls)s.index==y(this,ac,"f")?this._emit("toolCallDelta",s,t.step_details.tool_calls[s.index]):(y(this,qt,"f")&&this._emit("toolCallDone",y(this,qt,"f")),W(this,ac,s.index,"f"),W(this,qt,t.step_details.tool_calls[s.index],"f"),y(this,qt,"f")&&this._emit("toolCallCreated",y(this,qt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":W(this,io,void 0,"f"),e.data.step_details.type=="tool_calls"&&y(this,qt,"f")&&(this._emit("toolCallDone",y(this,qt,"f")),W(this,qt,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},Vw=function(e){y(this,Sd,"f").push(e),this._emit("event",e)},Zw=function(e){switch(e.event){case"thread.run.step.created":return y(this,Yr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=y(this,Yr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let A=zA.accumulateDelta(t,n.delta);y(this,Yr,"f")[e.data.id]=A}return y(this,Yr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":y(this,Yr,"f")[e.data.id]=e.data;break}if(y(this,Yr,"f")[e.data.id])return y(this,Yr,"f")[e.data.id];throw new Error("No snapshot available")},Jw=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let A=e.data;if(A.delta.content)for(let s of A.delta.content)if(s.index in t.content){let i=t.content[s.index];t.content[s.index]=y(this,lt,"m",Ww).call(this,s,i)}else t.content[s.index]=s,n.push(s);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ww=function(e,t){return zA.accumulateDelta(t,e)},qw=function(e){switch(W(this,ic,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":W(this,GA,e.data,"f"),y(this,qt,"f")&&(this._emit("toolCallDone",y(this,qt,"f")),W(this,qt,void 0,"f"));break;case"thread.run.cancelling":break}};var VA=class extends U{constructor(){super(...arguments),this.steps=new _i(this._client)}create(e,t,n){let{include:A,...s}=t;return this._client.post(E`/threads/${e}/runs`,{query:{include:A},body:s,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){let{thread_id:A}=t;return this._client.get(E`/threads/${A}/runs/${e}`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:A,...s}=t;return this._client.post(E`/threads/${A}/runs/${e}`,{body:s,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(E`/threads/${e}/runs`,de,{query:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{thread_id:A}=t;return this._client.post(E`/threads/${A}/runs/${e}/cancel`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let A=await this.create(e,t,n);return await this.poll(A.id,{thread_id:e},n)}createAndStream(e,t,n){return Un.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let A=S([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:i}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...A}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{let o=i.headers.get("openai-poll-after-ms");if(o){let u=parseInt(o);isNaN(u)||(a=u)}}await Zr(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,n){return Un.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){let{thread_id:A,...s}=t;return this._client.post(E`/threads/${A}/runs/${e}/submit_tool_outputs`,{body:s,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){let A=await this.submitToolOutputs(e,t,n);return await this.poll(A.id,t,n)}submitToolOutputsStream(e,t,n){return Un.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};VA.Steps=_i;var iA=class extends U{constructor(){super(...arguments),this.runs=new VA(this._client),this.messages=new yi(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(E`/threads/${e}`,{...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(E`/threads/${e}`,{body:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(E`/threads/${e}`,{...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Un.createThreadAssistantStream(e,this._client.beta.threads,t)}};iA.Runs=VA;iA.Messages=yi;var en=class extends U{constructor(){super(...arguments),this.realtime=new AA(this._client),this.assistants=new mi(this._client),this.threads=new iA(this._client)}};en.Realtime=AA;en.Assistants=mi;en.Threads=iA;var ZA=class extends U{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Bi=class extends U{retrieve(e,t,n){let{container_id:A}=t;return this._client.get(E`/containers/${A}/files/${e}/content`,{...n,headers:S([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}};var JA=class extends U{constructor(){super(...arguments),this.content=new Bi(this._client)}create(e,t,n){return this._client.post(E`/containers/${e}/files`,Wt({body:t,...n},this._client))}retrieve(e,t,n){let{container_id:A}=t;return this._client.get(E`/containers/${A}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(E`/containers/${e}/files`,de,{query:t,...n})}delete(e,t,n){let{container_id:A}=t;return this._client.delete(E`/containers/${A}/files/${e}`,{...n,headers:S([{Accept:"*/*"},n?.headers])})}};JA.Content=Bi;var aA=class extends U{constructor(){super(...arguments),this.files=new JA(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(E`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",de,{query:e,...t})}delete(e,t){return this._client.delete(E`/containers/${e}`,{...t,headers:S([{Accept:"*/*"},t?.headers])})}};aA.Files=JA;var WA=class extends U{create(e,t){let n=!!e.encoding_format,A=n?e.encoding_format:"base64";n&&Ke(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:A},...t});return n?s:(Ke(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(i=>(i&&i.data&&i.data.forEach(a=>{let o=a.embedding;a.embedding=Kw(o)}),i)))}};var vi=class extends U{retrieve(e,t,n){let{eval_id:A,run_id:s}=t;return this._client.get(E`/evals/${A}/runs/${s}/output_items/${e}`,n)}list(e,t,n){let{eval_id:A,...s}=t;return this._client.getAPIList(E`/evals/${A}/runs/${e}/output_items`,de,{query:s,...n})}};var qA=class extends U{constructor(){super(...arguments),this.outputItems=new vi(this._client)}create(e,t,n){return this._client.post(E`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){let{eval_id:A}=t;return this._client.get(E`/evals/${A}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(E`/evals/${e}/runs`,de,{query:t,...n})}delete(e,t,n){let{eval_id:A}=t;return this._client.delete(E`/evals/${A}/runs/${e}`,n)}cancel(e,t,n){let{eval_id:A}=t;return this._client.post(E`/evals/${A}/runs/${e}`,n)}};qA.OutputItems=vi;var oA=class extends U{constructor(){super(...arguments),this.runs=new qA(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(E`/evals/${e}`,t)}update(e,t,n){return this._client.post(E`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",de,{query:e,...t})}delete(e,t){return this._client.delete(E`/evals/${e}`,t)}};oA.Runs=qA;var XA=class extends U{create(e,t){return this._client.post("/files",Wt({body:e,...t},this._client))}retrieve(e,t){return this._client.get(E`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",de,{query:e,...t})}delete(e,t){return this._client.delete(E`/files/${e}`,t)}content(e,t){return this._client.get(E`/files/${e}/content`,{...t,headers:S([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){let A=new Set(["processed","error","deleted"]),s=Date.now(),i=await this.retrieve(e);for(;!i.status||!A.has(i.status);)if(await Zr(t),i=await this.retrieve(e),Date.now()-s>n)throw new Gr({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};var Ci=class extends U{};var Ei=class extends U{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var YA=class extends U{constructor(){super(...arguments),this.graders=new Ei(this._client)}};YA.Graders=Ei;var xi=class extends U{create(e,t,n){return this._client.getAPIList(E`/fine_tuning/checkpoints/${e}/permissions`,qr,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(E`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){let{fine_tuned_model_checkpoint:A}=t;return this._client.delete(E`/fine_tuning/checkpoints/${A}/permissions/${e}`,n)}};var es=class extends U{constructor(){super(...arguments),this.permissions=new xi(this._client)}};es.Permissions=xi;var Ii=class extends U{list(e,t={},n){return this._client.getAPIList(E`/fine_tuning/jobs/${e}/checkpoints`,de,{query:t,...n})}};var ts=class extends U{constructor(){super(...arguments),this.checkpoints=new Ii(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(E`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",de,{query:e,...t})}cancel(e,t){return this._client.post(E`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(E`/fine_tuning/jobs/${e}/events`,de,{query:t,...n})}pause(e,t){return this._client.post(E`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(E`/fine_tuning/jobs/${e}/resume`,t)}};ts.Checkpoints=Ii;var Ur=class extends U{constructor(){super(...arguments),this.methods=new Ci(this._client),this.jobs=new ts(this._client),this.checkpoints=new es(this._client),this.alpha=new YA(this._client)}};Ur.Methods=Ci;Ur.Jobs=ts;Ur.Checkpoints=es;Ur.Alpha=YA;var Ui=class extends U{};var uA=class extends U{constructor(){super(...arguments),this.graderModels=new Ui(this._client)}};uA.GraderModels=Ui;var rs=class extends U{createVariation(e,t){return this._client.post("/images/variations",Wt({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Wt({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}};var ns=class extends U{retrieve(e,t){return this._client.get(E`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",qr,e)}delete(e,t){return this._client.delete(E`/models/${e}`,t)}};var As=class extends U{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function Xw(r,e){return!e||!AT(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Pd(r,e)}function Pd(r,e){let t=r.output.map(A=>{if(A.type==="function_call")return{...A,parsed_arguments:aT(e,A)};if(A.type==="message"){let s=A.content.map(i=>i.type==="output_text"?{...i,parsed:nT(e,i.text)}:i);return{...A,content:s}}return A}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||oc(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let A of n.output)if(A.type==="message"){for(let s of A.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),n}function nT(r,e){return r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(e):JSON.parse(e)}function AT(r){return!!Wa(r.text?.format)}function sT(r){return r?.$brand==="auto-parseable-tool"}function iT(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function aT(r,e){let t=iT(r.tools??[],e.name);return{...e,...e,parsed_arguments:sT(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function oc(r){let e=[];for(let t of r.output)if(t.type==="message")for(let n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}var Fi,uc,cA,cc,Yw,ey,ty,ry,lc=class r extends tA{constructor(e){super(),Fi.add(this),uc.set(this,void 0),cA.set(this,void 0),cc.set(this,void 0),W(this,uc,e,"f")}static createResponse(e,t,n){let A=new r(t);return A._run(()=>A._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),A}async _createOrRetrieveResponse(e,t,n){let A=n?.signal;A&&(A.aborted&&this.controller.abort(),A.addEventListener("abort",()=>this.controller.abort())),y(this,Fi,"m",Yw).call(this);let s,i=null;"response_id"in t?(s=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):s=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let a of s)y(this,Fi,"m",ey).call(this,a,i);if(s.controller.signal?.aborted)throw new He;return y(this,Fi,"m",ty).call(this)}[(uc=new WeakMap,cA=new WeakMap,cc=new WeakMap,Fi=new WeakSet,Yw=function(){this.ended||W(this,cA,void 0,"f")},ey=function(t,n){if(this.ended)return;let A=(i,a)=>{(n==null||a.sequence_number>n)&&this._emit(i,a)},s=y(this,Fi,"m",ry).call(this,t);switch(A("event",t),t.type){case"response.output_text.delta":{let i=s.output[t.output_index];if(!i)throw new D(`missing output at index ${t.output_index}`);if(i.type==="message"){let a=i.content[t.content_index];if(!a)throw new D(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new D(`expected content to be 'output_text', got ${a.type}`);A("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{let i=s.output[t.output_index];if(!i)throw new D(`missing output at index ${t.output_index}`);i.type==="function_call"&&A("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:A(t.type,t);break}},ty=function(){if(this.ended)throw new D("stream has ended, this shouldn't happen");let t=y(this,cA,"f");if(!t)throw new D("request ended without sending any events");W(this,cA,void 0,"f");let n=oT(t,y(this,uc,"f"));return W(this,cc,n,"f"),n},ry=function(t){let n=y(this,cA,"f");if(!n){if(t.type!=="response.created")throw new D(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=W(this,cA,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{let A=n.output[t.output_index];if(!A)throw new D(`missing output at index ${t.output_index}`);A.type==="message"&&A.content.push(t.part);break}case"response.output_text.delta":{let A=n.output[t.output_index];if(!A)throw new D(`missing output at index ${t.output_index}`);if(A.type==="message"){let s=A.content[t.content_index];if(!s)throw new D(`missing content at index ${t.content_index}`);if(s.type!=="output_text")throw new D(`expected content to be 'output_text', got ${s.type}`);s.text+=t.delta}break}case"response.function_call_arguments.delta":{let A=n.output[t.output_index];if(!A)throw new D(`missing output at index ${t.output_index}`);A.type==="function_call"&&(A.arguments+=t.delta);break}case"response.completed":{W(this,cA,t.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",A=>{let s=t.shift();s?s.resolve(A):e.push(A)}),this.on("end",()=>{n=!0;for(let A of t)A.resolve(void 0);t.length=0}),this.on("abort",A=>{n=!0;for(let s of t)s.reject(A);t.length=0}),this.on("error",A=>{n=!0;for(let s of t)s.reject(A);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=y(this,cc,"f");if(!e)throw new D("stream ended without producing a ChatCompletion");return e}};function oT(r,e){return Xw(r,e)}var Qi=class extends U{list(e,t={},n){return this._client.getAPIList(E`/responses/${e}/input_items`,de,{query:t,...n})}};var lA=class extends U{constructor(){super(...arguments),this.inputItems=new Qi(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&oc(n),n))}retrieve(e,t={},n){return this._client.get(E`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})._thenUnwrap(A=>("object"in A&&A.object==="response"&&oc(A),A))}delete(e,t){return this._client.delete(E`/responses/${e}`,{...t,headers:S([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Pd(n,e))}stream(e,t){return lc.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(E`/responses/${e}/cancel`,t)}};lA.InputItems=Qi;var Ti=class extends U{create(e,t,n){return this._client.post(E`/uploads/${e}/parts`,Wt({body:t,...n},this._client))}};var fA=class extends U{constructor(){super(...arguments),this.parts=new Ti(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(E`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(E`/uploads/${e}/complete`,{body:t,...n})}};fA.Parts=Ti;var ny=async r=>{let e=await Promise.allSettled(r),t=e.filter(A=>A.status==="rejected");if(t.length){for(let A of t)console.error(A.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let n=[];for(let A of e)A.status==="fulfilled"&&n.push(A.value);return n};var Oi=class extends U{create(e,t,n){return this._client.post(E`/vector_stores/${e}/file_batches`,{body:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:A}=t;return this._client.get(E`/vector_stores/${A}/file_batches/${e}`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{vector_store_id:A}=t;return this._client.post(E`/vector_stores/${A}/file_batches/${e}/cancel`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let A=await this.create(e,t);return await this.poll(e,A.id,n)}listFiles(e,t,n){let{vector_store_id:A,...s}=t;return this._client.getAPIList(E`/vector_stores/${A}/file_batches/${e}/files`,de,{query:s,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){let A=S([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:i}=await this.retrieve(t,{vector_store_id:e},{...n,headers:A}).withResponse();switch(s.status){case"in_progress":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{let o=i.headers.get("openai-poll-after-ms");if(o){let u=parseInt(o);isNaN(u)||(a=u)}}await Zr(a);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},A){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=A?.maxConcurrency??5,i=Math.min(s,t.length),a=this._client,o=t.values(),u=[...n];async function c(f){for(let d of f){let p=await a.files.create({file:d,purpose:"assistants"},A);u.push(p.id)}}let l=Array(i).fill(o).map(c);return await ny(l),await this.createAndPoll(e,{file_ids:u})}};var Si=class extends U{create(e,t,n){return this._client.post(E`/vector_stores/${e}/files`,{body:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:A}=t;return this._client.get(E`/vector_stores/${A}/files/${e}`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{vector_store_id:A,...s}=t;return this._client.post(E`/vector_stores/${A}/files/${e}`,{body:s,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(E`/vector_stores/${e}/files`,de,{query:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{vector_store_id:A}=t;return this._client.delete(E`/vector_stores/${A}/files/${e}`,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let A=await this.create(e,t,n);return await this.poll(e,A.id,n)}async poll(e,t,n){let A=S([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let s=await this.retrieve(t,{vector_store_id:e},{...n,headers:A}).withResponse(),i=s.data;switch(i.status){case"in_progress":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{let o=s.response.headers.get("openai-poll-after-ms");if(o){let u=parseInt(o);isNaN(u)||(a=u)}}await Zr(a);break;case"failed":case"completed":return i}}}async upload(e,t,n){let A=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:A.id},n)}async uploadAndPoll(e,t,n){let A=await this.upload(e,t,n);return await this.poll(e,A.id,n)}content(e,t,n){let{vector_store_id:A}=t;return this._client.getAPIList(E`/vector_stores/${A}/files/${e}/content`,qr,{...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Fn=class extends U{constructor(){super(...arguments),this.files=new Si(this._client),this.fileBatches=new Oi(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(E`/vector_stores/${e}`,{...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(E`/vector_stores/${e}`,{body:t,...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",de,{query:e,...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(E`/vector_stores/${e}`,{...t,headers:S([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(E`/vector_stores/${e}/search`,qr,{body:t,method:"post",...n,headers:S([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};Fn.Files=Si;Fn.FileBatches=Oi;var Pi,Ay,fc,ss=class extends U{constructor(){super(...arguments),Pi.add(this)}async unwrap(e,t,n=this._client.webhookSecret,A=300){return await this.verifySignature(e,t,n,A),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,A=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");y(this,Pi,"m",Ay).call(this,n);let s=S([t]).values,i=y(this,Pi,"m",fc).call(this,s,"webhook-signature"),a=y(this,Pi,"m",fc).call(this,s,"webhook-timestamp"),o=y(this,Pi,"m",fc).call(this,s,"webhook-id"),u=parseInt(a,10);if(isNaN(u))throw new Vr("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-u>A)throw new Vr("Webhook timestamp is too old");if(u>c+A)throw new Vr("Webhook timestamp is too new");let l=i.split(" ").map(h=>h.startsWith("v1,")?h.substring(3):h),f=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",f,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let h of l)try{let g=Buffer.from(h,"base64");if(await crypto.subtle.verify("HMAC",p,g,new TextEncoder().encode(d)))return}catch{continue}throw new Vr("The given webhook signature does not match the expected signature")}};Pi=new WeakSet,Ay=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},fc=function(e,t){if(!e)throw new Error("Headers are required");let n=e.get(t);if(n==null)throw new Error(`Missing required header: ${t}`);return n};var Rd,kd,dc,sy,Ae=class{constructor({baseURL:e=sA("OPENAI_BASE_URL"),apiKey:t=sA("OPENAI_API_KEY"),organization:n=sA("OPENAI_ORG_ID")??null,project:A=sA("OPENAI_PROJECT_ID")??null,webhookSecret:s=sA("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(Rd.add(this),dc.set(this,void 0),this.completions=new ZA(this),this.chat=new nA(this),this.embeddings=new WA(this),this.files=new XA(this),this.images=new rs(this),this.audio=new Xr(this),this.moderations=new As(this),this.models=new ns(this),this.fineTuning=new Ur(this),this.graders=new uA(this),this.vectorStores=new Fn(this),this.webhooks=new ss(this),this.beta=new en(this),this.batches=new jA(this),this.uploads=new fA(this),this.responses=new lA(this),this.evals=new oA(this),this.containers=new aA(this),t===void 0)throw new D("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:n,project:A,webhookSecret:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&dw())throw new D(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=a.baseURL,this.timeout=a.timeout??kd.DEFAULT_TIMEOUT,this.logger=a.logger??console;let o="warn";this.logLevel=o,this.logLevel=ld(a.logLevel,"ClientOptions.logLevel",this)??ld(sA("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??hw(),W(this,dc,gw,"f"),this._options=a,this.apiKey=t,this.organization=n,this.project=A,this.webhookSecret=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return S([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return ud(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${eA}`}defaultIdempotencyKey(){return`stainless-node-retry-${ed()}`}makeStatusError(e,t,n,A){return Ye.generate(e,t,n,A)}buildURL(e,t,n){let A=!y(this,Rd,"m",sy).call(this)&&n||this.baseURL,s=Aw(e)?new URL(e):new URL(A+(A.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return iw(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(A=>({method:e,path:t,...A})))}request(e,t=null){return new HA(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let A=await e,s=A.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(A);let{req:i,url:a,timeout:o}=await this.buildRequest(A,{retryCount:s-t});await this.prepareRequest(i,{url:a,options:A});let u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),c=n===void 0?"":`, retryOf: ${n}`,l=Date.now();if(Ke(this).debug(`[${u}] sending request`,Cn({retryOfRequestLogID:n,method:A.method,url:a,options:A,headers:i.headers})),A.signal?.aborted)throw new He;let f=new AbortController,d=await this.fetchWithTimeout(a,i,o,f).catch(Ma),p=Date.now();if(d instanceof Error){let w=`retrying, ${t} attempts remaining`;if(A.signal?.aborted)throw new He;let m=Da(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return Ke(this).info(`[${u}] connection ${m?"timed out":"failed"} - ${w}`),Ke(this).debug(`[${u}] connection ${m?"timed out":"failed"} (${w})`,Cn({retryOfRequestLogID:n,url:a,durationMs:p-l,message:d.message})),this.retryRequest(A,t,n??u);throw Ke(this).info(`[${u}] connection ${m?"timed out":"failed"} - error; no more retries left`),Ke(this).debug(`[${u}] connection ${m?"timed out":"failed"} (error; no more retries left)`,Cn({retryOfRequestLogID:n,url:a,durationMs:p-l,message:d.message})),m?new Gr:new Yn({cause:d})}let h=[...d.headers.entries()].filter(([w])=>w==="x-request-id").map(([w,m])=>", "+w+": "+JSON.stringify(m)).join(""),g=`[${u}${c}${h}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-l}ms`;if(!d.ok){let w=await this.shouldRetry(d);if(t&&w){let x=`retrying, ${t} attempts remaining`;return await mw(d.body),Ke(this).info(`${g} - ${x}`),Ke(this).debug(`[${u}] response error (${x})`,Cn({retryOfRequestLogID:n,url:d.url,status:d.status,headers:d.headers,durationMs:p-l})),this.retryRequest(A,t,n??u,d.headers)}let m=w?"error; no more retries left":"error; not retryable";Ke(this).info(`${g} - ${m}`);let _=await d.text().catch(x=>Ma(x).message),B=uw(_),C=B?void 0:_;throw Ke(this).debug(`[${u}] response error (${m})`,Cn({retryOfRequestLogID:n,url:d.url,status:d.status,headers:d.headers,message:C,durationMs:Date.now()-l})),this.makeStatusError(d.status,B,C,d.headers)}return Ke(this).info(g),Ke(this).debug(`[${u}] response start`,Cn({retryOfRequestLogID:n,url:d.url,status:d.status,headers:d.headers,durationMs:p-l})),{response:d,options:A,controller:f,requestLogID:u,retryOfRequestLogID:n,startTime:l}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){let n=this.makeRequest(t,null,void 0);return new Ga(this,n,e)}async fetchWithTimeout(e,t,n,A){let{signal:s,method:i,...a}=t||{};s&&s.addEventListener("abort",()=>A.abort());let o=setTimeout(()=>A.abort(),n),u=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,c={signal:A.signal,...u?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,A){let s,i=A?.get("retry-after-ms");if(i){let o=parseFloat(i);Number.isNaN(o)||(s=o)}let a=A?.get("retry-after");if(a&&!s){let o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Zr(s),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let s=t-e,i=Math.min(.5*Math.pow(2,s),8),a=1-Math.random()*.25;return i*a*1e3}async buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:A,path:s,query:i,defaultBaseURL:a}=n,o=this.buildURL(s,i,a);"timeout"in n&&ow("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:u,body:c}=this.buildBody({options:n}),l=await this.buildHeaders({options:e,method:A,bodyHeaders:u,retryCount:t});return{req:{method:A,headers:l,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...n.fetchOptions??{}},url:o,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:A}){let s={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let i=S([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(A),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...pw(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=S([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Du(e)}:y(this,dc,"f").call(this,{body:e,headers:n})}};kd=Ae,dc=new WeakMap,Rd=new WeakSet,sy=function(){return this.baseURL!=="https://api.openai.com/v1"};Ae.OpenAI=kd;Ae.DEFAULT_TIMEOUT=6e5;Ae.OpenAIError=D;Ae.APIError=Ye;Ae.APIConnectionError=Yn;Ae.APIConnectionTimeoutError=Gr;Ae.APIUserAbortError=He;Ae.NotFoundError=ei;Ae.ConflictError=ti;Ae.RateLimitError=ni;Ae.BadRequestError=qs;Ae.AuthenticationError=Xs;Ae.InternalServerError=Ai;Ae.PermissionDeniedError=Ys;Ae.UnprocessableEntityError=ri;Ae.InvalidWebhookSignatureError=Vr;Ae.toFile=Za;Ae.Completions=ZA;Ae.Chat=nA;Ae.Embeddings=WA;Ae.Files=XA;Ae.Images=rs;Ae.Audio=Xr;Ae.Moderations=As;Ae.Models=ns;Ae.FineTuning=Ur;Ae.Graders=uA;Ae.VectorStores=Fn;Ae.Webhooks=ss;Ae.Beta=en;Ae.Batches=jA;Ae.Uploads=fA;Ae.Responses=lA;Ae.Evals=oA;Ae.Containers=aA;function Ld(r,e=Ri){r=r.trim();let t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));let A=n.indexOf("```"),s=n;return A!==-1&&(s=n.substring(0,A)),e(s.trim())}function Ri(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="",t=[],n=!1,A=!1;for(let s of r){if(n)s==='"'&&!A?n=!1:s===`
`&&!A?s="\\n":s==="\\"?A=!A:A=!1;else if(s==='"')n=!0,A=!1;else if(s==="{")t.push("}");else if(s==="[")t.push("]");else if(s==="}"||s==="]")if(t&&t[t.length-1]===s)t.pop();else return null;e+=s}n&&(e+='"');for(let s=t.length-1;s>=0;s-=1)e+=t[s];try{return JSON.parse(e)}catch{return null}}var hy=Ct(ay(),1),_T=Ct(py(),1);function my(r,e){return e?.[r]||(0,hy.default)(r)}function gy(r,e,t){let n={};for(let A in r)Object.hasOwn(r,A)&&(n[e(A,t)]=r[A]);return n}function wy(r){return Array.isArray(r)?[...r]:{...r}}function bT(r,e){let t=wy(r);for(let[n,A]of Object.entries(e)){let[s,...i]=n.split(".").reverse(),a=t;for(let o of i.reverse()){if(a[o]===void 0)break;a[o]=wy(a[o]),a=a[o]}a[s]!==void 0&&(a[s]={lc:1,type:"secret",id:[A]})}return t}function Dd(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Fr=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Dd(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>this.lc_serializable_keys?.includes(n))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((A,s)=>(A[s]=s in this?this[s]:this.lc_kwargs[s],A),{});for(let A=Object.getPrototypeOf(this);A;A=Object.getPrototypeOf(A))Object.assign(e,Reflect.get(A,"lc_aliases",this)),Object.assign(t,Reflect.get(A,"lc_secrets",this)),Object.assign(n,Reflect.get(A,"lc_attributes",this));return Object.keys(t).forEach(A=>{let s=this,i=n,[a,...o]=A.split(".").reverse();for(let u of o.reverse()){if(!(u in s)||s[u]===void 0)return;(!(u in i)||i[u]===void 0)&&(typeof s[u]=="object"&&s[u]!=null?i[u]={}:Array.isArray(s[u])&&(i[u]=[])),s=s[u],i=i[u]}a in s&&s[a]!==void 0&&(i[a]=i[a]||s[a])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:gy(Object.keys(t).length?bT(n,t):n,my,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Qn(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function yy(r){return Qn(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function _y(r){return Qn(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function by(r){if(Qn(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function Md(r){let e=r.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${r}" - does not match type/subtype format.`);let t=e[0].trim(),n=e[1].trim();if(t===""||n==="")throw new Error(`Invalid mime type: "${r}" - type or subtype is empty.`);let A={};for(let s of r.split(";").slice(1)){let i=s.split("=");if(i.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${r}".`);let a=i[0].trim(),o=i[1].trim();if(a==="")throw new Error(`Invalid parameter syntax in mime type: "${r}".`);A[a]=o}return{type:t,subtype:n,parameters:A}}function $d({dataUrl:r,asTypedArray:e=!1}){let t=r.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/),n;if(t){n=t[1].toLowerCase();let A=e?Uint8Array.from(atob(t[2]),s=>s.charCodeAt(0)):t[2];return{mime_type:n,data:A}}}function jd(r,e){if(r.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(r)}if(r.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(r)}if(r.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(r)}if(r.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(r)}throw new Error(`Unable to convert content block type '${r.type}' to provider-specific format: not recognized.`)}function cr(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.some(t=>Qn(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?ao(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>Qn(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function By(r,e){return r==="error"||e==="error"?"error":"success"}function BT(r,e){function t(n,A){if(typeof n!="object"||n===null||n===void 0)return n;if(A>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(i=>t(i,A+1));let s={};for(let i of Object.keys(n))s[i]=t(n[i],A+1);return s}return JSON.stringify(t(r,0),null,2)}var It=class extends Fr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=BT(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};function ze(r,e){let t={...r};for(let[n,A]of Object.entries(e))if(t[n]==null)t[n]=A;else{if(A==null)continue;if(typeof t[n]!=typeof A||Array.isArray(t[n])!==Array.isArray(A))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;t[n]+=A}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=ze(t[n],A);else if(Array.isArray(t[n]))t[n]=ao(t[n],A);else{if(t[n]===A)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function ao(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{let t=[...r];for(let n of e)if(typeof n=="object"&&"index"in n&&typeof n.index=="number"){let A=t.findIndex(s=>s.index===n.index);A!==-1?t[A]=ze(t[A],n):t.push(n)}else{if(typeof n=="object"&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function vy(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return ao(r,e);if(typeof r=="object"&&typeof e=="object")return ze(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}var Nt=class extends It{};function Cy(r){return typeof r.role=="string"}function dA(r){return typeof r?._getType=="function"}function Kd(r){return dA(r)&&typeof r.concat=="function"}function Ey(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}var Qr=class extends It{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status,this.metadata=e.metadata}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},ki=class r extends Nt{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new r({content:cr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),artifact:vy(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:By(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function xy(r){let e=[],t=[];for(let n of r)if(n.function){let A=n.function.name;try{let s=JSON.parse(n.function.arguments),i={name:A||"",args:s||{},id:n.id};e.push(i)}catch{t.push({name:A,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}var Ut=class extends It{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;let A=n.additional_kwargs?.tool_calls,s=n.tool_calls;A!=null&&A.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(A!=null&&s===void 0){let[i,a]=xy(A);n.tool_calls=i??[],n.invalid_tool_calls=a??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}};function pA(r){return r._getType()==="ai"}function zd(r){return r._getType()==="ai"}var Xt=class r extends Nt{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{let n=e.tool_call_chunks.reduce((i,a)=>{let o=a.id||`fallback-${a.index||0}`;return i[o]=i[o]??[],i[o].push(a),i},{}),A=[],s=[];for(let[i,a]of Object.entries(n)){let o={},u=a[0]?.name??"",c=a.map(d=>d.args||"").join(""),l=c.length?c:"{}",f=a[0]?.id||i;try{if(o=Ri(l),o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");A.push({name:u,args:o,id:f,type:"tool_call"})}catch{s.push({name:u,args:l,id:f,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:A,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:cr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let n=ao(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(t.tool_call_chunks=n)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let n={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},A={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},s=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:s.input_tokens+i.input_tokens,output_tokens:s.output_tokens+i.output_tokens,total_tokens:s.total_tokens+i.total_tokens,...Object.keys(n).length>0&&{input_token_details:n},...Object.keys(A).length>0&&{output_token_details:A}};t.usage_metadata=a}return new r(t)}};var hA=class r extends It{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return r}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},is=class r extends Nt{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new r({content:cr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}};var as=class r extends Nt{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new r({content:cr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};var Lt=class extends It{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}},os=class r extends Nt{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new r({content:cr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),id:this.id??e.id})}};var mA=class extends It{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}},gA=class r extends Nt{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new r({content:cr(this.content,e.content),additional_kwargs:ze(this.additional_kwargs,e.additional_kwargs),response_metadata:ze(this.response_metadata,e.response_metadata),id:this.id??e.id})}};function pc(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function wA(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}function Iy(r){return!!(r&&typeof r=="object"&&"toolCall"in r&&r.toolCall!=null&&typeof r.toolCall=="object"&&"id"in r.toolCall&&typeof r.toolCall.id=="string")}var us=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};function CT(r){return wA(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function ET(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Gd(r){let e,t;if(ET(r)){let n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{let{type:n,...A}=r;e=n,t=A}if(e==="human"||e==="user")return new Lt(t);if(e==="ai"||e==="assistant"){let{tool_calls:n,...A}=t;if(!Array.isArray(n))return new Ut(t);let s=n.map(CT);return new Ut({...A,tool_calls:s})}else{if(e==="system")return new mA(t);if(e==="developer")return new mA({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Qr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw pc(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function cs(r){if(typeof r=="string")return new Lt(r);if(dA(r))return r;if(Array.isArray(r)){let[e,t]=r;return Gd({type:e,content:t})}else if(Cy(r)){let{role:e,...t}=r;return Gd({...t,type:e})}else return Gd(r)}function oo(r,e="Human",t="AI"){let n=[];for(let A of r){let s;if(A._getType()==="human")s=e;else if(A._getType()==="ai")s=t;else if(A._getType()==="system")s="System";else if(A._getType()==="function")s="Function";else if(A._getType()==="tool")s="Tool";else if(A._getType()==="generic")s=A.role;else throw new Error(`Got unsupported message type: ${A._getType()}`);let i=A.name?`${A.name}, `:"",a=typeof A.content=="string"?A.content:JSON.stringify(A.content,null,2);n.push(`${s}: ${i}${a}`)}return n.join(`
`)}function Vd(r){let e=r._getType();if(e==="human")return new os({...r});if(e==="ai"){let t={...r};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(n=>({...n,type:"tool_call_chunk",index:void 0,args:JSON.stringify(n.args)}))}),new Xt({...t})}else{if(e==="system")return new gA({...r});if(e==="function")return new as({...r});if(hA.isInstance(r))return new is({...r});throw new Error("Unknown message type.")}}var Yt={};ef(Yt,{BRAND:()=>qT,DIRTY:()=>ls,EMPTY_PATH:()=>FT,INVALID:()=>te,NEVER:()=>RO,OK:()=>yt,ParseStatus:()=>ft,Schema:()=>pe,ZodAny:()=>bA,ZodArray:()=>Pn,ZodBigInt:()=>ds,ZodBoolean:()=>ps,ZodBranded:()=>co,ZodCatch:()=>Es,ZodDate:()=>hs,ZodDefault:()=>Cs,ZodDiscriminatedUnion:()=>gc,ZodEffects:()=>dr,ZodEnum:()=>Bs,ZodError:()=>Ht,ZodFirstPartyTypeKind:()=>b,ZodFunction:()=>yc,ZodIntersection:()=>ys,ZodIssueCode:()=>I,ZodLazy:()=>_s,ZodLiteral:()=>bs,ZodMap:()=>$i,ZodNaN:()=>Ki,ZodNativeEnum:()=>vs,ZodNever:()=>Tr,ZodNull:()=>gs,ZodNullable:()=>nn,ZodNumber:()=>fs,ZodObject:()=>Dt,ZodOptional:()=>lr,ZodParsedType:()=>R,ZodPipeline:()=>lo,ZodPromise:()=>BA,ZodReadonly:()=>xs,ZodRecord:()=>wc,ZodSchema:()=>pe,ZodSet:()=>ji,ZodString:()=>_A,ZodSymbol:()=>Di,ZodTransformer:()=>dr,ZodTuple:()=>rn,ZodType:()=>pe,ZodUndefined:()=>ms,ZodUnion:()=>ws,ZodUnknown:()=>Sn,ZodVoid:()=>Mi,addIssueToContext:()=>T,any:()=>iO,array:()=>cO,bigint:()=>tO,boolean:()=>Ly,coerce:()=>PO,custom:()=>Ry,date:()=>rO,datetimeRegex:()=>Sy,defaultErrorMap:()=>Tn,discriminatedUnion:()=>pO,effect:()=>xO,enum:()=>vO,function:()=>_O,getErrorMap:()=>Ni,getParsedType:()=>tn,instanceof:()=>YT,intersection:()=>hO,isAborted:()=>hc,isAsync:()=>Li,isDirty:()=>mc,isValid:()=>yA,late:()=>XT,lazy:()=>bO,literal:()=>BO,makeIssue:()=>uo,map:()=>wO,nan:()=>eO,nativeEnum:()=>CO,never:()=>oO,null:()=>sO,nullable:()=>UO,number:()=>Ny,object:()=>lO,objectUtil:()=>Zd,oboolean:()=>SO,onumber:()=>OO,optional:()=>IO,ostring:()=>TO,pipeline:()=>QO,preprocess:()=>FO,promise:()=>EO,quotelessJson:()=>xT,record:()=>gO,set:()=>yO,setErrorMap:()=>UT,strictObject:()=>fO,string:()=>ky,symbol:()=>nO,transformer:()=>xO,tuple:()=>mO,undefined:()=>AO,union:()=>dO,unknown:()=>aO,util:()=>me,void:()=>uO});var me;(function(r){r.assertEqual=A=>{};function e(A){}r.assertIs=e;function t(A){throw new Error}r.assertNever=t,r.arrayToEnum=A=>{let s={};for(let i of A)s[i]=i;return s},r.getValidEnumValues=A=>{let s=r.objectKeys(A).filter(a=>typeof A[A[a]]!="number"),i={};for(let a of s)i[a]=A[a];return r.objectValues(i)},r.objectValues=A=>r.objectKeys(A).map(function(s){return A[s]}),r.objectKeys=typeof Object.keys=="function"?A=>Object.keys(A):A=>{let s=[];for(let i in A)Object.prototype.hasOwnProperty.call(A,i)&&s.push(i);return s},r.find=(A,s)=>{for(let i of A)if(s(i))return i},r.isInteger=typeof Number.isInteger=="function"?A=>Number.isInteger(A):A=>typeof A=="number"&&Number.isFinite(A)&&Math.floor(A)===A;function n(A,s=" | "){return A.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}r.joinValues=n,r.jsonStringifyReplacer=(A,s)=>typeof s=="bigint"?s.toString():s})(me||(me={}));var Zd;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Zd||(Zd={}));var R=me.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),tn=r=>{switch(typeof r){case"undefined":return R.undefined;case"string":return R.string;case"number":return Number.isNaN(r)?R.nan:R.number;case"boolean":return R.boolean;case"function":return R.function;case"bigint":return R.bigint;case"symbol":return R.symbol;case"object":return Array.isArray(r)?R.array:r===null?R.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?R.promise:typeof Map<"u"&&r instanceof Map?R.map:typeof Set<"u"&&r instanceof Set?R.set:typeof Date<"u"&&r instanceof Date?R.date:R.object;default:return R.unknown}};var I=me.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),xT=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Ht=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(s){return s.message},n={_errors:[]},A=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(A);else if(i.code==="invalid_return_type")A(i.returnTypeError);else if(i.code==="invalid_arguments")A(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let a=n,o=0;for(;o<i.path.length;){let u=i.path[o];o===i.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(t(i))):a[u]=a[u]||{_errors:[]},a=a[u],o++}}};return A(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,me.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let A of this.issues)if(A.path.length>0){let s=A.path[0];t[s]=t[s]||[],t[s].push(e(A))}else n.push(e(A));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};Ht.create=r=>new Ht(r);var IT=(r,e)=>{let t;switch(r.code){case I.invalid_type:r.received===R.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case I.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,me.jsonStringifyReplacer)}`;break;case I.unrecognized_keys:t=`Unrecognized key(s) in object: ${me.joinValues(r.keys,", ")}`;break;case I.invalid_union:t="Invalid input";break;case I.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${me.joinValues(r.options)}`;break;case I.invalid_enum_value:t=`Invalid enum value. Expected ${me.joinValues(r.options)}, received '${r.received}'`;break;case I.invalid_arguments:t="Invalid function arguments";break;case I.invalid_return_type:t="Invalid function return type";break;case I.invalid_date:t="Invalid date";break;case I.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:me.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case I.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case I.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case I.custom:t="Invalid input";break;case I.invalid_intersection_types:t="Intersection results could not be merged";break;case I.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case I.not_finite:t="Number must be finite";break;default:t=e.defaultError,me.assertNever(r)}return{message:t}},Tn=IT;var Uy=Tn;function UT(r){Uy=r}function Ni(){return Uy}var uo=r=>{let{data:e,path:t,errorMaps:n,issueData:A}=r,s=[...t,...A.path||[]],i={...A,path:s};if(A.message!==void 0)return{...A,path:s,message:A.message};let a="",o=n.filter(u=>!!u).slice().reverse();for(let u of o)a=u(i,{data:e,defaultError:a}).message;return{...A,path:s,message:a}},FT=[];function T(r,e){let t=Ni(),n=uo({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Tn?void 0:Tn].filter(A=>!!A)});r.common.issues.push(n)}var ft=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let A of t){if(A.status==="aborted")return te;A.status==="dirty"&&e.dirty(),n.push(A.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let A of t){let s=await A.key,i=await A.value;n.push({key:s,value:i})}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let A of t){let{key:s,value:i}=A;if(s.status==="aborted"||i.status==="aborted")return te;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||A.alwaysSet)&&(n[s.value]=i.value)}return{status:e.value,value:n}}},te=Object.freeze({status:"aborted"}),ls=r=>({status:"dirty",value:r}),yt=r=>({status:"valid",value:r}),hc=r=>r.status==="aborted",mc=r=>r.status==="dirty",yA=r=>r.status==="valid",Li=r=>typeof Promise<"u"&&r instanceof Promise;var V;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(V||(V={}));var fr=class{constructor(e,t,n,A){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=A}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Fy=(r,e)=>{if(yA(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Ht(r.common.issues);return this._error=t,this._error}}};function le(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:A}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:A}:{errorMap:(i,a)=>{let{message:o}=r;return i.code==="invalid_enum_value"?{message:o??a.defaultError}:typeof a.data>"u"?{message:o??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:o??t??a.defaultError}},description:A}}var pe=class{get description(){return this._def.description}_getType(e){return tn(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:tn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ft,ctx:{common:e.parent.common,data:e.data,parsedType:tn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Li(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tn(e)},A=this._parseSync({data:e,path:n.path,parent:n});return Fy(n,A)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tn(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return yA(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>yA(n)?{value:n.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tn(e)},A=this._parse({data:e,path:n.path,parent:n}),s=await(Li(A)?A:Promise.resolve(A));return Fy(n,s)}refine(e,t){let n=A=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(A):t;return this._refinement((A,s)=>{let i=e(A),a=()=>s.addIssue({code:I.custom,...n(A)});return typeof Promise<"u"&&i instanceof Promise?i.then(o=>o?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,A)=>e(n)?!0:(A.addIssue(typeof t=="function"?t(n,A):t),!1))}_refinement(e){return new dr({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return lr.create(this,this._def)}nullable(){return nn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Pn.create(this)}promise(){return BA.create(this,this._def)}or(e){return ws.create([this,e],this._def)}and(e){return ys.create(this,e,this._def)}transform(e){return new dr({...le(this._def),schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Cs({...le(this._def),innerType:this,defaultValue:t,typeName:b.ZodDefault})}brand(){return new co({typeName:b.ZodBranded,type:this,...le(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Es({...le(this._def),innerType:this,catchValue:t,typeName:b.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return lo.create(this,e)}readonly(){return xs.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},QT=/^c[^\s-]{8,}$/i,TT=/^[0-9a-z]+$/,OT=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ST=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,PT=/^[a-z0-9_-]{21}$/i,RT=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,kT=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,NT=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,LT="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Jd,HT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,DT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,MT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,$T=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,jT=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,KT=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Ty="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",zT=new RegExp(`^${Ty}$`);function Oy(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function GT(r){return new RegExp(`^${Oy(r)}$`)}function Sy(r){let e=`${Ty}T${Oy(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function VT(r,e){return!!((e==="v4"||!e)&&HT.test(r)||(e==="v6"||!e)&&MT.test(r))}function ZT(r,e){if(!RT.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),A=JSON.parse(atob(n));return!(typeof A!="object"||A===null||"typ"in A&&A?.typ!=="JWT"||!A.alg||e&&A.alg!==e)}catch{return!1}}function JT(r,e){return!!((e==="v4"||!e)&&DT.test(r)||(e==="v6"||!e)&&$T.test(r))}var _A=class r extends pe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==R.string){let s=this._getOrReturnCtx(e);return T(s,{code:I.invalid_type,expected:R.string,received:s.parsedType}),te}let n=new ft,A;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(A=this._getOrReturnCtx(e,A),T(A,{code:I.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(A=this._getOrReturnCtx(e,A),T(A,{code:I.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,a=e.data.length<s.value;(i||a)&&(A=this._getOrReturnCtx(e,A),i?T(A,{code:I.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&T(A,{code:I.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")NT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"email",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")Jd||(Jd=new RegExp(LT,"u")),Jd.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"emoji",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")ST.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"uuid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")PT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"nanoid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")QT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"cuid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")TT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"cuid2",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")OT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"ulid",code:I.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{A=this._getOrReturnCtx(e,A),T(A,{validation:"url",code:I.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"regex",code:I.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(A=this._getOrReturnCtx(e,A),T(A,{code:I.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(A=this._getOrReturnCtx(e,A),T(A,{code:I.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(A=this._getOrReturnCtx(e,A),T(A,{code:I.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?Sy(s).test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{code:I.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?zT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{code:I.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?GT(s).test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{code:I.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?kT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"duration",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?VT(e.data,s.version)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"ip",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?ZT(e.data,s.alg)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"jwt",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?JT(e.data,s.version)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"cidr",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?jT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"base64",code:I.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?KT.test(e.data)||(A=this._getOrReturnCtx(e,A),T(A,{validation:"base64url",code:I.invalid_string,message:s.message}),n.dirty()):me.assertNever(s);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(A=>e.test(A),{validation:t,code:I.invalid_string,...V.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...V.errToObj(e)})}url(e){return this._addCheck({kind:"url",...V.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...V.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...V.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...V.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...V.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...V.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...V.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...V.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...V.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...V.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...V.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...V.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...V.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...V.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...V.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...V.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...V.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...V.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...V.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...V.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...V.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...V.errToObj(t)})}nonempty(e){return this.min(1,V.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};_A.create=r=>new _A({checks:[],typeName:b.ZodString,coerce:r?.coerce??!1,...le(r)});function WT(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,A=t>n?t:n,s=Number.parseInt(r.toFixed(A).replace(".","")),i=Number.parseInt(e.toFixed(A).replace(".",""));return s%i/10**A}var fs=class r extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==R.number){let s=this._getOrReturnCtx(e);return T(s,{code:I.invalid_type,expected:R.number,received:s.parsedType}),te}let n,A=new ft;for(let s of this._def.checks)s.kind==="int"?me.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),T(n,{code:I.invalid_type,expected:"integer",received:"float",message:s.message}),A.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:I.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),A.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:I.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),A.dirty()):s.kind==="multipleOf"?WT(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),T(n,{code:I.not_multiple_of,multipleOf:s.value,message:s.message}),A.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),T(n,{code:I.not_finite,message:s.message}),A.dirty()):me.assertNever(s);return{status:A.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,V.toString(t))}gt(e,t){return this.setLimit("min",e,!1,V.toString(t))}lte(e,t){return this.setLimit("max",e,!0,V.toString(t))}lt(e,t){return this.setLimit("max",e,!1,V.toString(t))}setLimit(e,t,n,A){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:V.toString(A)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:V.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:V.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:V.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:V.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:V.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:V.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:V.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:V.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:V.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&me.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};fs.create=r=>new fs({checks:[],typeName:b.ZodNumber,coerce:r?.coerce||!1,...le(r)});var ds=class r extends pe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==R.bigint)return this._getInvalidInput(e);let n,A=new ft;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:I.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),A.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),T(n,{code:I.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),A.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),T(n,{code:I.not_multiple_of,multipleOf:s.value,message:s.message}),A.dirty()):me.assertNever(s);return{status:A.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return T(t,{code:I.invalid_type,expected:R.bigint,received:t.parsedType}),te}gte(e,t){return this.setLimit("min",e,!0,V.toString(t))}gt(e,t){return this.setLimit("min",e,!1,V.toString(t))}lte(e,t){return this.setLimit("max",e,!0,V.toString(t))}lt(e,t){return this.setLimit("max",e,!1,V.toString(t))}setLimit(e,t,n,A){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:V.toString(A)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:V.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:V.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:V.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:V.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:V.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};ds.create=r=>new ds({checks:[],typeName:b.ZodBigInt,coerce:r?.coerce??!1,...le(r)});var ps=class extends pe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==R.boolean){let n=this._getOrReturnCtx(e);return T(n,{code:I.invalid_type,expected:R.boolean,received:n.parsedType}),te}return yt(e.data)}};ps.create=r=>new ps({typeName:b.ZodBoolean,coerce:r?.coerce||!1,...le(r)});var hs=class r extends pe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==R.date){let s=this._getOrReturnCtx(e);return T(s,{code:I.invalid_type,expected:R.date,received:s.parsedType}),te}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return T(s,{code:I.invalid_date}),te}let n=new ft,A;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(A=this._getOrReturnCtx(e,A),T(A,{code:I.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(A=this._getOrReturnCtx(e,A),T(A,{code:I.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):me.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:V.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:V.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};hs.create=r=>new hs({checks:[],coerce:r?.coerce||!1,typeName:b.ZodDate,...le(r)});var Di=class extends pe{_parse(e){if(this._getType(e)!==R.symbol){let n=this._getOrReturnCtx(e);return T(n,{code:I.invalid_type,expected:R.symbol,received:n.parsedType}),te}return yt(e.data)}};Di.create=r=>new Di({typeName:b.ZodSymbol,...le(r)});var ms=class extends pe{_parse(e){if(this._getType(e)!==R.undefined){let n=this._getOrReturnCtx(e);return T(n,{code:I.invalid_type,expected:R.undefined,received:n.parsedType}),te}return yt(e.data)}};ms.create=r=>new ms({typeName:b.ZodUndefined,...le(r)});var gs=class extends pe{_parse(e){if(this._getType(e)!==R.null){let n=this._getOrReturnCtx(e);return T(n,{code:I.invalid_type,expected:R.null,received:n.parsedType}),te}return yt(e.data)}};gs.create=r=>new gs({typeName:b.ZodNull,...le(r)});var bA=class extends pe{constructor(){super(...arguments),this._any=!0}_parse(e){return yt(e.data)}};bA.create=r=>new bA({typeName:b.ZodAny,...le(r)});var Sn=class extends pe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return yt(e.data)}};Sn.create=r=>new Sn({typeName:b.ZodUnknown,...le(r)});var Tr=class extends pe{_parse(e){let t=this._getOrReturnCtx(e);return T(t,{code:I.invalid_type,expected:R.never,received:t.parsedType}),te}};Tr.create=r=>new Tr({typeName:b.ZodNever,...le(r)});var Mi=class extends pe{_parse(e){if(this._getType(e)!==R.undefined){let n=this._getOrReturnCtx(e);return T(n,{code:I.invalid_type,expected:R.void,received:n.parsedType}),te}return yt(e.data)}};Mi.create=r=>new Mi({typeName:b.ZodVoid,...le(r)});var Pn=class r extends pe{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),A=this._def;if(t.parsedType!==R.array)return T(t,{code:I.invalid_type,expected:R.array,received:t.parsedType}),te;if(A.exactLength!==null){let i=t.data.length>A.exactLength.value,a=t.data.length<A.exactLength.value;(i||a)&&(T(t,{code:i?I.too_big:I.too_small,minimum:a?A.exactLength.value:void 0,maximum:i?A.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:A.exactLength.message}),n.dirty())}if(A.minLength!==null&&t.data.length<A.minLength.value&&(T(t,{code:I.too_small,minimum:A.minLength.value,type:"array",inclusive:!0,exact:!1,message:A.minLength.message}),n.dirty()),A.maxLength!==null&&t.data.length>A.maxLength.value&&(T(t,{code:I.too_big,maximum:A.maxLength.value,type:"array",inclusive:!0,exact:!1,message:A.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,a)=>A.type._parseAsync(new fr(t,i,t.path,a)))).then(i=>ft.mergeArray(n,i));let s=[...t.data].map((i,a)=>A.type._parseSync(new fr(t,i,t.path,a)));return ft.mergeArray(n,s)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:V.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:V.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:V.toString(t)}})}nonempty(e){return this.min(1,e)}};Pn.create=(r,e)=>new Pn({type:r,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray,...le(e)});function Hi(r){if(r instanceof Dt){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=lr.create(Hi(n))}return new Dt({...r._def,shape:()=>e})}else return r instanceof Pn?new Pn({...r._def,type:Hi(r.element)}):r instanceof lr?lr.create(Hi(r.unwrap())):r instanceof nn?nn.create(Hi(r.unwrap())):r instanceof rn?rn.create(r.items.map(e=>Hi(e))):r}var Dt=class r extends pe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=me.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==R.object){let u=this._getOrReturnCtx(e);return T(u,{code:I.invalid_type,expected:R.object,received:u.parsedType}),te}let{status:n,ctx:A}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof Tr&&this._def.unknownKeys==="strip"))for(let u in A.data)i.includes(u)||a.push(u);let o=[];for(let u of i){let c=s[u],l=A.data[u];o.push({key:{status:"valid",value:u},value:c._parse(new fr(A,l,A.path,u)),alwaysSet:u in A.data})}if(this._def.catchall instanceof Tr){let u=this._def.unknownKeys;if(u==="passthrough")for(let c of a)o.push({key:{status:"valid",value:c},value:{status:"valid",value:A.data[c]}});else if(u==="strict")a.length>0&&(T(A,{code:I.unrecognized_keys,keys:a}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let c of a){let l=A.data[c];o.push({key:{status:"valid",value:c},value:u._parse(new fr(A,l,A.path,c)),alwaysSet:c in A.data})}}return A.common.async?Promise.resolve().then(async()=>{let u=[];for(let c of o){let l=await c.key,f=await c.value;u.push({key:l,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>ft.mergeObjectSync(n,u)):ft.mergeObjectSync(n,o)}get shape(){return this._def.shape()}strict(e){return V.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{let A=this._def.errorMap?.(t,n).message??n.defaultError;return t.code==="unrecognized_keys"?{message:V.errToObj(e).message??A}:{message:A}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:b.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let n of me.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let n of me.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}deepPartial(){return Hi(this)}partial(e){let t={};for(let n of me.objectKeys(this.shape)){let A=this.shape[n];e&&!e[n]?t[n]=A:t[n]=A.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let n of me.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof lr;)s=s._def.innerType;t[n]=s}return new r({...this._def,shape:()=>t})}keyof(){return Py(me.objectKeys(this.shape))}};Dt.create=(r,e)=>new Dt({shape:()=>r,unknownKeys:"strip",catchall:Tr.create(),typeName:b.ZodObject,...le(e)});Dt.strictCreate=(r,e)=>new Dt({shape:()=>r,unknownKeys:"strict",catchall:Tr.create(),typeName:b.ZodObject,...le(e)});Dt.lazycreate=(r,e)=>new Dt({shape:r,unknownKeys:"strip",catchall:Tr.create(),typeName:b.ZodObject,...le(e)});var ws=class extends pe{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function A(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new Ht(a.ctx.common.issues));return T(t,{code:I.invalid_union,unionErrors:i}),te}if(t.common.async)return Promise.all(n.map(async s=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(A);{let s,i=[];for(let o of n){let u={...t,common:{...t.common,issues:[]},parent:null},c=o._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(o=>new Ht(o));return T(t,{code:I.invalid_union,unionErrors:a}),te}}get options(){return this._def.options}};ws.create=(r,e)=>new ws({options:r,typeName:b.ZodUnion,...le(e)});var On=r=>r instanceof _s?On(r.schema):r instanceof dr?On(r.innerType()):r instanceof bs?[r.value]:r instanceof Bs?r.options:r instanceof vs?me.objectValues(r.enum):r instanceof Cs?On(r._def.innerType):r instanceof ms?[void 0]:r instanceof gs?[null]:r instanceof lr?[void 0,...On(r.unwrap())]:r instanceof nn?[null,...On(r.unwrap())]:r instanceof co||r instanceof xs?On(r.unwrap()):r instanceof Es?On(r._def.innerType):[],gc=class r extends pe{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==R.object)return T(t,{code:I.invalid_type,expected:R.object,received:t.parsedType}),te;let n=this.discriminator,A=t.data[n],s=this.optionsMap.get(A);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(T(t,{code:I.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),te)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let A=new Map;for(let s of t){let i=On(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of i){if(A.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);A.set(a,s)}}return new r({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:A,...le(n)})}};function Wd(r,e){let t=tn(r),n=tn(e);if(r===e)return{valid:!0,data:r};if(t===R.object&&n===R.object){let A=me.objectKeys(e),s=me.objectKeys(r).filter(a=>A.indexOf(a)!==-1),i={...r,...e};for(let a of s){let o=Wd(r[a],e[a]);if(!o.valid)return{valid:!1};i[a]=o.data}return{valid:!0,data:i}}else if(t===R.array&&n===R.array){if(r.length!==e.length)return{valid:!1};let A=[];for(let s=0;s<r.length;s++){let i=r[s],a=e[s],o=Wd(i,a);if(!o.valid)return{valid:!1};A.push(o.data)}return{valid:!0,data:A}}else return t===R.date&&n===R.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var ys=class extends pe{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),A=(s,i)=>{if(hc(s)||hc(i))return te;let a=Wd(s.value,i.value);return a.valid?((mc(s)||mc(i))&&t.dirty(),{status:t.value,value:a.data}):(T(n,{code:I.invalid_intersection_types}),te)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>A(s,i)):A(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};ys.create=(r,e,t)=>new ys({left:r,right:e,typeName:b.ZodIntersection,...le(t)});var rn=class r extends pe{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==R.array)return T(n,{code:I.invalid_type,expected:R.array,received:n.parsedType}),te;if(n.data.length<this._def.items.length)return T(n,{code:I.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),te;!this._def.rest&&n.data.length>this._def.items.length&&(T(n,{code:I.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let s=[...n.data].map((i,a)=>{let o=this._def.items[a]||this._def.rest;return o?o._parse(new fr(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>ft.mergeArray(t,i)):ft.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};rn.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new rn({items:r,typeName:b.ZodTuple,rest:null,...le(e)})};var wc=class r extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==R.object)return T(n,{code:I.invalid_type,expected:R.object,received:n.parsedType}),te;let A=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)A.push({key:s._parse(new fr(n,a,n.path,a)),value:i._parse(new fr(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?ft.mergeObjectAsync(t,A):ft.mergeObjectSync(t,A)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof pe?new r({keyType:e,valueType:t,typeName:b.ZodRecord,...le(n)}):new r({keyType:_A.create(),valueType:e,typeName:b.ZodRecord,...le(t)})}},$i=class extends pe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==R.map)return T(n,{code:I.invalid_type,expected:R.map,received:n.parsedType}),te;let A=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,o],u)=>({key:A._parse(new fr(n,a,n.path,[u,"key"])),value:s._parse(new fr(n,o,n.path,[u,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let o of i){let u=await o.key,c=await o.value;if(u.status==="aborted"||c.status==="aborted")return te;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),a.set(u.value,c.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let o of i){let u=o.key,c=o.value;if(u.status==="aborted"||c.status==="aborted")return te;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),a.set(u.value,c.value)}return{status:t.value,value:a}}}};$i.create=(r,e,t)=>new $i({valueType:e,keyType:r,typeName:b.ZodMap,...le(t)});var ji=class r extends pe{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==R.set)return T(n,{code:I.invalid_type,expected:R.set,received:n.parsedType}),te;let A=this._def;A.minSize!==null&&n.data.size<A.minSize.value&&(T(n,{code:I.too_small,minimum:A.minSize.value,type:"set",inclusive:!0,exact:!1,message:A.minSize.message}),t.dirty()),A.maxSize!==null&&n.data.size>A.maxSize.value&&(T(n,{code:I.too_big,maximum:A.maxSize.value,type:"set",inclusive:!0,exact:!1,message:A.maxSize.message}),t.dirty());let s=this._def.valueType;function i(o){let u=new Set;for(let c of o){if(c.status==="aborted")return te;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}let a=[...n.data.values()].map((o,u)=>s._parse(new fr(n,o,n.path,u)));return n.common.async?Promise.all(a).then(o=>i(o)):i(a)}min(e,t){return new r({...this._def,minSize:{value:e,message:V.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:V.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};ji.create=(r,e)=>new ji({valueType:r,minSize:null,maxSize:null,typeName:b.ZodSet,...le(e)});var yc=class r extends pe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==R.function)return T(t,{code:I.invalid_type,expected:R.function,received:t.parsedType}),te;function n(a,o){return uo({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ni(),Tn].filter(u=>!!u),issueData:{code:I.invalid_arguments,argumentsError:o}})}function A(a,o){return uo({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ni(),Tn].filter(u=>!!u),issueData:{code:I.invalid_return_type,returnTypeError:o}})}let s={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof BA){let a=this;return yt(async function(...o){let u=new Ht([]),c=await a._def.args.parseAsync(o,s).catch(d=>{throw u.addIssue(n(o,d)),u}),l=await Reflect.apply(i,this,c);return await a._def.returns._def.type.parseAsync(l,s).catch(d=>{throw u.addIssue(A(l,d)),u})})}else{let a=this;return yt(function(...o){let u=a._def.args.safeParse(o,s);if(!u.success)throw new Ht([n(o,u.error)]);let c=Reflect.apply(i,this,u.data),l=a._def.returns.safeParse(c,s);if(!l.success)throw new Ht([A(c,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:rn.create(e).rest(Sn.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||rn.create([]).rest(Sn.create()),returns:t||Sn.create(),typeName:b.ZodFunction,...le(n)})}},_s=class extends pe{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};_s.create=(r,e)=>new _s({getter:r,typeName:b.ZodLazy,...le(e)});var bs=class extends pe{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return T(t,{received:t.data,code:I.invalid_literal,expected:this._def.value}),te}return{status:"valid",value:e.data}}get value(){return this._def.value}};bs.create=(r,e)=>new bs({value:r,typeName:b.ZodLiteral,...le(e)});function Py(r,e){return new Bs({values:r,typeName:b.ZodEnum,...le(e)})}var Bs=class r extends pe{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return T(t,{expected:me.joinValues(n),received:t.parsedType,code:I.invalid_type}),te}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return T(t,{received:t.data,code:I.invalid_enum_value,options:n}),te}return yt(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};Bs.create=Py;var vs=class extends pe{_parse(e){let t=me.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==R.string&&n.parsedType!==R.number){let A=me.objectValues(t);return T(n,{expected:me.joinValues(A),received:n.parsedType,code:I.invalid_type}),te}if(this._cache||(this._cache=new Set(me.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let A=me.objectValues(t);return T(n,{received:n.data,code:I.invalid_enum_value,options:A}),te}return yt(e.data)}get enum(){return this._def.values}};vs.create=(r,e)=>new vs({values:r,typeName:b.ZodNativeEnum,...le(e)});var BA=class extends pe{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==R.promise&&t.common.async===!1)return T(t,{code:I.invalid_type,expected:R.promise,received:t.parsedType}),te;let n=t.parsedType===R.promise?t.data:Promise.resolve(t.data);return yt(n.then(A=>this._def.type.parseAsync(A,{path:t.path,errorMap:t.common.contextualErrorMap})))}};BA.create=(r,e)=>new BA({type:r,typeName:b.ZodPromise,...le(e)});var dr=class extends pe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),A=this._def.effect||null,s={addIssue:i=>{T(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),A.type==="preprocess"){let i=A.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(t.value==="aborted")return te;let o=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return o.status==="aborted"?te:o.status==="dirty"?ls(o.value):t.value==="dirty"?ls(o.value):o});{if(t.value==="aborted")return te;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?te:a.status==="dirty"?ls(a.value):t.value==="dirty"?ls(a.value):a}}if(A.type==="refinement"){let i=a=>{let o=A.refinement(a,s);if(n.common.async)return Promise.resolve(o);if(o instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?te:(a.status==="dirty"&&t.dirty(),i(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?te:(a.status==="dirty"&&t.dirty(),i(a.value).then(()=>({status:t.value,value:a.value}))))}if(A.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!yA(i))return te;let a=A.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>yA(i)?Promise.resolve(A.transform(i.value,s)).then(a=>({status:t.value,value:a})):te);me.assertNever(A)}};dr.create=(r,e,t)=>new dr({schema:r,typeName:b.ZodEffects,effect:e,...le(t)});dr.createWithPreprocess=(r,e,t)=>new dr({schema:e,effect:{type:"preprocess",transform:r},typeName:b.ZodEffects,...le(t)});var lr=class extends pe{_parse(e){return this._getType(e)===R.undefined?yt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};lr.create=(r,e)=>new lr({innerType:r,typeName:b.ZodOptional,...le(e)});var nn=class extends pe{_parse(e){return this._getType(e)===R.null?yt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};nn.create=(r,e)=>new nn({innerType:r,typeName:b.ZodNullable,...le(e)});var Cs=class extends pe{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===R.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Cs.create=(r,e)=>new Cs({innerType:r,typeName:b.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...le(e)});var Es=class extends pe{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},A=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Li(A)?A.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ht(n.common.issues)},input:n.data})})):{status:"valid",value:A.status==="valid"?A.value:this._def.catchValue({get error(){return new Ht(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Es.create=(r,e)=>new Es({innerType:r,typeName:b.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...le(e)});var Ki=class extends pe{_parse(e){if(this._getType(e)!==R.nan){let n=this._getOrReturnCtx(e);return T(n,{code:I.invalid_type,expected:R.nan,received:n.parsedType}),te}return{status:"valid",value:e.data}}};Ki.create=r=>new Ki({typeName:b.ZodNaN,...le(r)});var qT=Symbol("zod_brand"),co=class extends pe{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},lo=class r extends pe{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?te:s.status==="dirty"?(t.dirty(),ls(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let A=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return A.status==="aborted"?te:A.status==="dirty"?(t.dirty(),{status:"dirty",value:A.value}):this._def.out._parseSync({data:A.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:b.ZodPipeline})}},xs=class extends pe{_parse(e){let t=this._def.innerType._parse(e),n=A=>(yA(A)&&(A.value=Object.freeze(A.value)),A);return Li(t)?t.then(A=>n(A)):n(t)}unwrap(){return this._def.innerType}};xs.create=(r,e)=>new xs({innerType:r,typeName:b.ZodReadonly,...le(e)});function Qy(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Ry(r,e={},t){return r?bA.create().superRefine((n,A)=>{let s=r(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=Qy(e,n),o=a.fatal??t??!0;A.addIssue({code:"custom",...a,fatal:o})}});if(!s){let i=Qy(e,n),a=i.fatal??t??!0;A.addIssue({code:"custom",...i,fatal:a})}}):bA.create()}var XT={object:Dt.lazycreate},b;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(b||(b={}));var YT=(r,e={message:`Input not instance of ${r.name}`})=>Ry(t=>t instanceof r,e),ky=_A.create,Ny=fs.create,eO=Ki.create,tO=ds.create,Ly=ps.create,rO=hs.create,nO=Di.create,AO=ms.create,sO=gs.create,iO=bA.create,aO=Sn.create,oO=Tr.create,uO=Mi.create,cO=Pn.create,lO=Dt.create,fO=Dt.strictCreate,dO=ws.create,pO=gc.create,hO=ys.create,mO=rn.create,gO=wc.create,wO=$i.create,yO=ji.create,_O=yc.create,bO=_s.create,BO=bs.create,vO=Bs.create,CO=vs.create,EO=BA.create,xO=dr.create,IO=lr.create,UO=nn.create,FO=dr.createWithPreprocess,QO=lo.create,TO=()=>ky().optional(),OO=()=>Ny().optional(),SO=()=>Ly().optional(),PO={string:(r=>_A.create({...r,coerce:!0})),number:(r=>fs.create({...r,coerce:!0})),boolean:(r=>ps.create({...r,coerce:!0})),bigint:(r=>ds.create({...r,coerce:!0})),date:(r=>hs.create({...r,coerce:!0}))};var RO=te;var xh=Ct(Bc(),1);var zy=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function MO(r){return typeof r=="string"&&zy.test(r)}var vA=MO;function $O(r){if(!vA(r))throw TypeError("Invalid UUID");let e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Gy=$O;var dt=[];for(let r=0;r<256;++r)dt.push((r+256).toString(16).slice(1));function vc(r,e=0){return(dt[r[e+0]]+dt[r[e+1]]+dt[r[e+2]]+dt[r[e+3]]+"-"+dt[r[e+4]]+dt[r[e+5]]+"-"+dt[r[e+6]]+dt[r[e+7]]+"-"+dt[r[e+8]]+dt[r[e+9]]+"-"+dt[r[e+10]]+dt[r[e+11]]+dt[r[e+12]]+dt[r[e+13]]+dt[r[e+14]]+dt[r[e+15]]).toLowerCase()}var Vy=Ct(require("crypto")),Ec=new Uint8Array(256),Cc=Ec.length;function qd(){return Cc>Ec.length-16&&(Vy.default.randomFillSync(Ec),Cc=0),Ec.slice(Cc,Cc+=16)}function jO(r){r=unescape(encodeURIComponent(r));let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var KO="6ba7b810-9dad-11d1-80b4-00c04fd430c8",zO="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Xd(r,e,t){function n(A,s,i,a){var o;if(typeof A=="string"&&(A=jO(A)),typeof s=="string"&&(s=Gy(s)),((o=s)===null||o===void 0?void 0:o.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+A.length);if(u.set(s),u.set(A,s.length),u=t(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,i){a=a||0;for(let c=0;c<16;++c)i[a+c]=u[c];return i}return vc(u)}try{n.name=r}catch{}return n.DNS=KO,n.URL=zO,n}var Zy=Ct(require("crypto")),Yd={randomUUID:Zy.default.randomUUID};function GO(r,e,t){if(Yd.randomUUID&&!e&&!r)return Yd.randomUUID();r=r||{};let n=r.random||(r.rng||qd)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let A=0;A<16;++A)e[t+A]=n[A];return e}return vc(n)}var De=GO;var Jy=Ct(require("crypto"));function VO(r){return Array.isArray(r)?r=Buffer.from(r):typeof r=="string"&&(r=Buffer.from(r,"utf8")),Jy.default.createHash("sha1").update(r).digest()}var Wy=VO;var ZO=Xd("v5",80,Wy),xc=ZO;var rp=class{getStore(){}run(e,t){return t()}},tp=Symbol.for("ls:tracing_async_local_storage"),JO=new rp,np=class{getInstance(){return globalThis[tp]??JO}initializeGlobalInstance(e){globalThis[tp]===void 0&&(globalThis[tp]=e)}},WO=new np;function qy(r=!1){let e=WO.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}var mK=Symbol.for("langsmith:traceable:root");function Ic(r){return typeof r=="function"&&"langsmith:traceable"in r}var Ap={};ef(Ap,{JsonPatchError:()=>Me,_areEquals:()=>po,applyOperation:()=>Fs,applyPatch:()=>CA,applyReducer:()=>eS,deepClone:()=>XO,getValueByPointer:()=>Oc,validate:()=>Yy,validator:()=>Sc});var qO=Object.prototype.hasOwnProperty;function Fc(r,e){return qO.call(r,e)}function Qc(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Fc(r,t)&&e.push(t);return e}function _t(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Tc(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function An(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function fo(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Uc(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Uc(r[t]))return!0}else if(typeof r=="object"){let t=Qc(r),n=t.length;for(var e=0;e<n;e++)if(Uc(r[t[e]]))return!0}}return!1}function Xy(r,e){let t=[r];for(let n in e){let A=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof A<"u"&&t.push(`${n}: ${A}`)}return t.join(`
`)}var Us=class extends Error{constructor(e,t,n,A,s){super(Xy(e,{name:t,index:n,operation:A,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:A}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=Xy(e,{name:t,index:n,operation:A,tree:s})}};var Me=Us,XO=_t,zi={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Oc(t,this.path);n&&(n=_t(n));let A=Fs(t,{op:"remove",path:this.from}).removed;return Fs(t,{op:"add",path:this.path,value:A}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=Oc(t,this.from);return Fs(t,{op:"add",path:this.path,value:_t(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:po(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},YO={add:function(r,e,t){return Tc(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:zi.move,copy:zi.copy,test:zi.test,_get:zi._get};function Oc(r,e){if(e=="")return r;var t={op:"_get",path:e};return Fs(r,t),t.value}function Fs(r,e,t=!1,n=!0,A=!0,s=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):Sc(e,0)),e.path===""){let i={newDocument:r};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=r,i;if(e.op==="move"||e.op==="copy")return i.newDocument=Oc(r,e.from),e.op==="move"&&(i.removed=r),i;if(e.op==="test"){if(i.test=po(r,e.value),i.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return i.newDocument=r,i}else{if(e.op==="remove")return i.removed=r,i.newDocument=null,i;if(e.op==="_get")return e.value=r,i;if(t)throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,r);return i}}else{n||(r=_t(r));let a=(e.path||"").split("/"),o=r,u=1,c=a.length,l,f,d;for(typeof t=="function"?d=t:d=Sc;;){if(f=a[u],f&&f.indexOf("~")!=-1&&(f=fo(f)),A&&(f=="__proto__"||f=="prototype"&&u>0&&a[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&l===void 0&&(o[f]===void 0?l=a.slice(0,u).join("/"):u==c-1&&(l=e.path),l!==void 0&&d(e,0,r,l)),u++,Array.isArray(o)){if(f==="-")f=o.length;else{if(t&&!Tc(f))throw new Me("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,r);Tc(f)&&(f=~~f)}if(u>=c){if(t&&e.op==="add"&&f>o.length)throw new Me("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,r);let p=YO[e.op].call(e,o,f,r);if(p.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return p}}else if(u>=c){let p=zi[e.op].call(e,o,f,r);if(p.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",s,e,r);return p}if(o=o[f],t&&u<c&&(!o||typeof o!="object"))throw new Me("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,r)}}}function CA(r,e,t,n=!0,A=!0){if(t&&!Array.isArray(e))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=_t(r));let s=new Array(e.length);for(let i=0,a=e.length;i<a;i++)s[i]=Fs(r,e[i],t,!0,A,i),r=s[i].newDocument;return s.newDocument=r,s}function eS(r,e,t){let n=Fs(r,e);if(n.test===!1)throw new Me("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function Sc(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new Me("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(zi[r.op]){if(typeof r.path!="string")throw new Me("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new Me('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new Me("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Uc(r.value))throw new Me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var A=r.path.split("/").length,s=n.split("/").length;if(A!==s+1&&A!==s)throw new Me("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new Me("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var i={op:"_get",path:r.from,value:void 0},a=Yy([i],t);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Me("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new Me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Yy(r,e,t){try{if(!Array.isArray(r))throw new Me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)CA(_t(e),_t(r),t||!0);else{t=t||Sc;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(A){if(A instanceof Me)return A;throw A}}function po(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),A,s,i;if(t&&n){if(s=r.length,s!=e.length)return!1;for(A=s;A--!==0;)if(!po(r[A],e[A]))return!1;return!0}if(t!=n)return!1;var a=Object.keys(r);if(s=a.length,s!==Object.keys(e).length)return!1;for(A=s;A--!==0;)if(!e.hasOwnProperty(a[A]))return!1;for(A=s;A--!==0;)if(i=a[A],!po(r[i],e[i]))return!1;return!0}return r!==r&&e!==e}function e_(r,e,t,n,A){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Qc(e),i=Qc(r),a=!1,o=!1,u=i.length-1;u>=0;u--){var c=i[u],l=r[c];if(Fc(e,c)&&!(e[c]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var f=e[c];typeof l=="object"&&l!=null&&typeof f=="object"&&f!=null&&Array.isArray(l)===Array.isArray(f)?e_(l,f,t,n+"/"+An(c),A):l!==f&&(a=!0,A&&t.push({op:"test",path:n+"/"+An(c),value:_t(l)}),t.push({op:"replace",path:n+"/"+An(c),value:_t(f)}))}else Array.isArray(r)===Array.isArray(e)?(A&&t.push({op:"test",path:n+"/"+An(c),value:_t(l)}),t.push({op:"remove",path:n+"/"+An(c)}),o=!0):(A&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}),a=!0)}if(!(!o&&s.length==i.length))for(var u=0;u<s.length;u++){var c=s[u];!Fc(r,c)&&e[c]!==void 0&&t.push({op:"add",path:n+"/"+An(c),value:_t(e[c])})}}}function Pc(r,e,t=!1){var n=[];return e_(r,e,n,"",t),n}var xK={...Ap,JsonPatchError:Us,deepClone:_t,escapePathComponent:An,unescapePathComponent:fo};var t_="gen_ai.operation.name",r_="gen_ai.system",sp="gen_ai.request.model",n_="gen_ai.response.model",ip="gen_ai.usage.input_tokens",ap="gen_ai.usage.output_tokens",op="gen_ai.usage.total_tokens",A_="gen_ai.request.max_tokens",s_="gen_ai.request.temperature",i_="gen_ai.request.top_p",a_="gen_ai.request.frequency_penalty",o_="gen_ai.request.presence_penalty",u_="gen_ai.response.finish_reasons",c_="gen_ai.prompt",l_="gen_ai.completion",f_="gen_ai.request.extra_query",d_="gen_ai.request.extra_body",p_="gen_ai.serialized.name",h_="gen_ai.serialized.signature",m_="gen_ai.serialized.doc",g_="gen_ai.response.id",w_="gen_ai.response.service_tier",y_="gen_ai.response.system_fingerprint",__="gen_ai.usage.input_token_details",b_="gen_ai.usage.output_token_details",B_="langsmith.trace.session_id",v_="langsmith.trace.session_name",C_="langsmith.span.kind",E_="langsmith.trace.name",x_="langsmith.metadata",up="langsmith.span.tags";var I_="langsmith.request.streaming",U_="langsmith.request.headers";var rS=(...r)=>fetch(...r),F_=Symbol.for("ls:fetch_implementation");var Q_=()=>{let r=globalThis[F_];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},T_=r=>async(...e)=>{if(r||We("DEBUG")==="true"){let[n,A]=e;console.log(`\u2192 ${A?.method||"GET"} ${n}`)}let t=await(globalThis[F_]??rS)(...e);return(r||We("DEBUG")==="true")&&console.log(`\u2190 ${t.status} ${t.statusText} ${t.url}`),t};var ho=()=>We("PROJECT")??er("LANGCHAIN_SESSION")??"default";var Rc="0.3.67";var sn,nS=()=>typeof window<"u"&&typeof window.document<"u",AS=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",sS=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),O_=()=>typeof Deno<"u",iS=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!O_(),fp=()=>sn||(typeof Bun<"u"?sn="bun":nS()?sn="browser":iS()?sn="node":AS()?sn="webworker":sS()?sn="jsdom":O_()?sn="deno":sn="other",sn),cp;function kc(){if(cp===void 0){let r=fp(),e=oS();cp={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Rc,...e}}return cp}function S_(){let r=aS()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[n,A]of Object.entries(r))(n.startsWith("LANGCHAIN_")||n.startsWith("LANGSMITH_"))&&typeof A=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=A:e[n]=A);return e}function aS(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch{return}}function er(r){try{return typeof process<"u"?process.env?.[r]:void 0}catch{return}}function We(r){return er(`LANGSMITH_${r}`)||er(`LANGCHAIN_${r}`)}var lp;function oS(){if(lp!==void 0)return lp;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=er(t);n!==void 0&&(e[t]=n)}return lp=e,e}function Nc(){return er("OTEL_ENABLED")==="true"||We("OTEL_ENABLED")==="true"}var hp=class{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&Nc()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}},mp=class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new hp})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},gp=class{active(){return{}}with(e,t){return t()}},dp=Symbol.for("ls:otel_trace"),pp=Symbol.for("ls:otel_context"),P_=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),uS=new mp,cS=new gp,wp=class{getTraceInstance(){return globalThis[dp]??uS}getContextInstance(){return globalThis[pp]??cS}initializeGlobalInstances(e){globalThis[dp]===void 0&&(globalThis[dp]=e.trace),globalThis[pp]===void 0&&(globalThis[pp]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[P_]=e}getDefaultOTLPTracerComponents(){return globalThis[P_]??void 0}},yp=new wp;function Lc(){return yp.getTraceInstance()}function R_(){return yp.getContextInstance()}function k_(){return yp.getDefaultOTLPTracerComponents()}var lS={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function fS(r){return lS[r]||r}var Hc=class{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let n of e)try{if(!n.run)continue;if(n.operation==="post"){let A=this.createSpanForRun(n,n.run,t.get(n.id));A&&!n.run.end_time&&this.spans.set(n.id,A)}else this.updateSpanForRun(n,n.run)}catch(A){console.error(`Error processing operation ${n.id}:`,A)}}createSpanForRun(e,t,n){let A=n&&Lc().getSpan(n);if(A)try{return this.finishSpanSetup(A,t,e)}catch(s){console.error(`Failed to create span for run ${e.id}:`,s);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});let A=t.end_time;A&&(n.end(new Date(A)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let n=t.invocation_params;if(n.model)return n.model;if(n.model_name)return n.model_name}}}setSpanAttributes(e,t,n){if("run_type"in t&&t.run_type){e.setAttribute(C_,t.run_type);let a=fS(t.run_type||"chain");e.setAttribute(t_,a)}"name"in t&&t.name&&e.setAttribute(E_,t.name),"session_id"in t&&t.session_id&&e.setAttribute(B_,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(v_,t.session_name),this.setGenAiSystem(e,t);let A=this.extractModelName(t);A&&e.setAttribute(sp,A),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(ip,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(ap,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(op,t.total_tokens),this.setInvocationParameters(e,t);let s=t.extra?.metadata||{};for(let[a,o]of Object.entries(s))o!=null&&e.setAttribute(`${x_}.${a}`,String(o));let i=t.tags;if(i&&Array.isArray(i)?e.setAttribute(up,i.join(", ")):i&&e.setAttribute(up,String(i)),"serialized"in t&&typeof t.serialized=="object"){let a=t.serialized;a.name&&e.setAttribute(p_,String(a.name)),a.signature&&e.setAttribute(h_,String(a.signature)),a.doc&&e.setAttribute(m_,String(a.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain",A=this.extractModelName(t);if(A){let s=A.toLowerCase();s.includes("anthropic")||s.startsWith("claude")?n="anthropic":s.includes("bedrock")?n="aws.bedrock":s.includes("azure")&&s.includes("openai")?n="az.ai.openai":s.includes("azure")&&s.includes("inference")?n="az.ai.inference":s.includes("cohere")?n="cohere":s.includes("deepseek")?n="deepseek":s.includes("gemini")?n="gemini":s.includes("groq")?n="groq":s.includes("watson")||s.includes("ibm")?n="ibm.watsonx.ai":s.includes("mistral")?n="mistral_ai":s.includes("gpt")||s.includes("openai")?n="openai":s.includes("perplexity")||s.includes("sonar")?n="perplexity":s.includes("vertex")?n="vertex_ai":(s.includes("xai")||s.includes("grok"))&&(n="xai")}e.setAttribute(r_,n)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(A_,n.max_tokens),n.temperature!==void 0&&e.setAttribute(s_,n.temperature),n.top_p!==void 0&&e.setAttribute(i_,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(a_,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(o_,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(sp,n.model),n.stream!==void 0&&e.setAttribute(I_,n.stream),n.extra_headers&&e.setAttribute(U_,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(f_,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(d_,JSON.stringify(n.extra_body))),e.setAttribute(c_,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{let n=t.run.outputs,A=this.getUnifiedRunTokens(n);if(A&&(e.setAttribute(ip,A[0]),e.setAttribute(ap,A[1]),e.setAttribute(op,A[0]+A[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(n_,String(n.model)),n.id&&e.setAttribute(g_,n.id),n.choices&&Array.isArray(n.choices)){let s=n.choices.map(i=>i.finish_reason).filter(i=>i).map(String);s.length>0&&e.setAttribute(u_,s.join(", "))}if(n.service_tier&&e.setAttribute(w_,n.service_tier),n.system_fingerprint&&e.setAttribute(y_,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){let s=n.usage_metadata;s.input_token_details&&e.setAttribute(__,JSON.stringify(s.input_token_details)),s.output_token_details&&e.setAttribute(b_,JSON.stringify(s.output_token_details))}}e.setAttribute(l_,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;let n=Object.keys(e);for(let i of n){let a=e[i];if(!(!a||typeof a!="object")&&(t=this.extractUnifiedRunTokens(a.usage_metadata),t||a.lc===1&&a.kwargs&&typeof a.kwargs=="object"&&(t=this.extractUnifiedRunTokens(a.kwargs.usage_metadata),t)))return t}let A=e.generations||[];if(!Array.isArray(A))return null;let s=Array.isArray(A[0])?A.flat():A;for(let i of s)if(typeof i=="object"&&i.message&&typeof i.message=="object"&&i.message.kwargs&&typeof i.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(i.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}};var G_=Ct(Bc(),1),zc=Ct(Kc(),1),bS=[429,500,502,503,504],go=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in zc.default?this.queue=new zc.default.default({concurrency:this.maxConcurrency}):this.queue=new zc.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,G_.default)(()=>e(...t).catch(A=>{throw A instanceof Error?A:new Error(A)}),{async onFailedAttempt(A){if(A.message.startsWith("Cancel")||A.message.startsWith("TimeoutError")||A.name==="TimeoutError"||A.message.startsWith("AbortError")||A?.code==="ECONNABORTED")throw A;let s=A?.response;if(n&&await n(s))return;let i=s?.status??A?.status;if(i&&!bS.includes(+i))throw A},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((A,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...n)}};function xp(r){return typeof r?._getType=="function"}function Ip(r){let e={type:r._getType(),data:{content:r.content}};return r?.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}var BS=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function ue(r,e){if(!BS.test(r)){let t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}var V_={};function Gc(r){V_[r]||(console.warn(r),V_[r]=!0)}var wk=Ct(kB(),1);function Rn(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);let[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){let[A,s]=e.split("/",2);if(!A||!s)throw new Error(`Invalid identifier format: ${r}`);return[A,s,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}var Gp=class extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}};async function q(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}if(r.status===403)try{if((await r.json())?.error==="org_scoped_key_requires_workspace")throw new Error("This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{throw new Error(`${r.status} ${r.statusText}`)}n=await r.text();let A=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Server response: ${n}`;if(r.status===409)throw new Gp(A);let s=new Error(A);throw s.status=r.status,s}var NB="ERR_CONFLICTING_ENDPOINTS",sl=class extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:NB}),this.name="ConflictingEndpointsError"}};function LB(r){return typeof r=="object"&&r!==null&&r.code===NB}var HB="[...]",yk={result:"[Circular]"},al=[],Zi=[],_k=new TextEncoder;function bk(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function il(r){return _k.encode(r)}function DB(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function Bk(r){return function(e,t){if(r){let n=r.call(this,e,t);if(n!==void 0)return n}return DB(t)}}function $t(r,e,t,n,A){try{let s=JSON.stringify(r,Bk(t),n);return il(s)}catch(s){if(!s.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),il("[Unserializable]");We("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof A>"u"&&(A=bk()),Zp(r,"",0,[],void 0,0,A);let i;try{Zi.length===0?i=JSON.stringify(r,t,n):i=JSON.stringify(r,vk(t),n)}catch{return il("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;al.length!==0;){let a=al.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return il(i)}}function Vp(r,e,t,n){var A=Object.getOwnPropertyDescriptor(n,t);A.get!==void 0?A.configurable?(Object.defineProperty(n,t,{value:r}),al.push([n,t,e,A])):Zi.push([e,t,r]):(n[t]=r,al.push([n,t,e]))}function Zp(r,e,t,n,A,s,i){s+=1;var a;if(typeof r=="object"&&r!==null){for(a=0;a<n.length;a++)if(n[a]===r){Vp(yk,r,e,A);return}if(typeof i.depthLimit<"u"&&s>i.depthLimit){Vp(HB,r,e,A);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){Vp(HB,r,e,A);return}if(n.push(r),Array.isArray(r))for(a=0;a<r.length;a++)Zp(r[a],a,a,n,r,s,i);else{r=DB(r);var o=Object.keys(r);for(a=0;a<o.length;a++){var u=o[a];Zp(r[u],u,a,n,r,s,i)}}n.pop()}}function vk(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Zi.length>0)for(var n=0;n<Zi.length;n++){var A=Zi[n];if(A[1]===e&&A[0]===t){t=A[2],Zi.splice(n,1);break}}return r.call(this,e,t)}}function MB(r){let e=kc(),t=S_(),n=r.extra??{},A=n.metadata;return r.extra={...n,runtime:{...e,...n?.runtime},metadata:{...t,...t.revision_id||"revision_id"in r&&r.revision_id?{revision_id:("revision_id"in r?r.revision_id:void 0)??t.revision_id}:{},...A}},r}var Ck=r=>{let e=r?.toString()??We("TRACING_SAMPLING_RATE");if(e===void 0)return;let t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},Ek=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function xk(r){let e=[];for await(let t of r)e.push(t);return e}function ol(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var Ik=async r=>{if(r?.status===429){let e=parseInt(r.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function $B(r){return typeof r=="number"?Number(r.toFixed(4)):r}var Jp=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,n=new Promise(s=>{t=s}),A=$t(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:A}),this.sizeBytes+=A,n}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],n=0;for(;n+(this.peek()?.size??0)<e&&this.items.length>0;){let A=this.items.shift();A&&(t.push(A),n+=A.size,this.sizeBytes-=A.size)}if(t.length===0&&this.items.length>0){let A=this.items.shift();t.push(A),n+=A.size,this.sizeBytes-=A.size}return[t.map(A=>({action:A.action,item:A.payload,otelContext:A.otelContext,apiKey:A.apiKey,apiUrl:A.apiUrl})),()=>t.forEach(A=>A.itemPromiseResolve())]}},Uk=24*1024*1024,Fk=1e4,jB="https://api.smith.langchain.com",Qs=class r{get _fetch(){return this.fetchImplementation||T_(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Jp}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:er("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:er("LANGSMITH_DEBUG")==="true"});let t=r.getDefaultClientConfig();if(this.tracingSampleRate=Ck(e.tracingSamplingRate),this.apiUrl=ol(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=ol(e.apiKey??t.apiKey),this.webUrl=ol(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=ol(e.workspaceId??We("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new go({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new go({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:Ik,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,Nc()&&(this.langSmithToOTELTranslator=new Hc)}static getDefaultClientConfig(){let e=We("API_KEY"),t=We("ENDPOINT")??jB,n=We("HIDE_INPUTS")==="true",A=We("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:A}}getHostUrl(){return this.webUrl?this.webUrl:Ek(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${Rc}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let n=t?.toString()??"",A=`${this.apiUrl}${e}?${n}`;return await this.caller.call(async()=>{let i=await this._fetch(A,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,`Failed to fetch ${e}`),i})}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let A=Number(t.get("offset"))||0,s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(A)),t.set("limit",String(s));let i=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(async()=>{let u=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(u,`Failed to fetch ${e}`),u}),o=n?n(await a.json()):await a.json();if(o.length===0||(yield o,o.length<s))break;A+=o.length}}async*_getCursorPaginatedList(e,t=null,n="POST",A="runs"){let s=t?{...t}:{};for(;;){let i=JSON.stringify(s),o=await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(c,`Failed to fetch ${e}`),c})).json();if(!o||!o[A])break;yield o[A];let u=o.cursors;if(!u||!u.next)break;s.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let A of e)this.filteredPostUuids.has(A.trace_id)?A.id===A.trace_id&&this.filteredPostUuids.delete(A.trace_id):n.push(A);return n}else{let n=[];for(let A of e){let s=A.trace_id??A.id;this.filteredPostUuids.has(s)||(A.id===s?this._shouldSample()?n.push(A):this.filteredPostUuids.add(s):n.push(A))}return n}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??Uk}async _getDatasetExamplesMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){let t=[];for(;this.autoBatchQueue.items.length>0;){let[n,A]=this.autoBatchQueue.pop(e);if(!n.length){A();break}let s=n.reduce((o,u)=>{let c=u.apiUrl??this.apiUrl,l=u.apiKey??this.apiKey,d=u.apiKey===this.apiKey&&u.apiUrl===this.apiUrl?"default":`${c}|${l}`;return o[d]||(o[d]=[]),o[d].push(u),o},{}),i=[];for(let[o,u]of Object.entries(s)){let c=this._processBatch(u,{apiUrl:o==="default"?void 0:o.split("|")[0],apiKey:o==="default"?void 0:o.split("|")[1]});i.push(c)}let a=Promise.all(i).finally(A);t.push(a)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{let n={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},A=await this._ensureServerInfo();if(A?.batch_ingest_config?.use_multipart_endpoint){let s=A?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(n,{...t,useGzip:s})}else await this.batchIngestRuns(n,t)}}catch(n){console.error("Error exporting batch:",n)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){let t=new Map,n=[];for(let A of e)A.item.id&&A.otelContext&&(t.set(A.item.id,A.otelContext),A.action==="create"?n.push({operation:"post",id:A.item.id,trace_id:A.item.trace_id??A.item.id,run:A.item}):n.push({operation:"patch",id:A.item.id,trace_id:A.item.trace_id??A.item.id,run:A.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=MB(e.item);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let n=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>n&&this.drainAutoBatchQueue(n),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(n)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let t=await(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(Fk),...this.fetchOptions});return await q(n,"get server info"),n})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){let e=Lc(),t=R_();if(this.langSmithToOTELTranslator!==void 0){let n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let n={...this.headers,"Content-Type":"application/json"},A=e.project_name;delete e.project_name;let s=await this.prepareRunCreateOrUpdateInputs({session_name:A,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){let o=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:s,otelContext:o,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let i=MB(s);t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(n["x-tenant-id"]=t.workspaceId);let a=$t(i,`Creating run with id: ${i.id}`);await this.caller.call(async()=>{let o=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await q(o,"create run",!0),o})}async batchIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let A=await Promise.all(e?.map(o=>this.prepareRunCreateOrUpdateInputs(o))??[]),s=await Promise.all(t?.map(o=>this.prepareRunCreateOrUpdateInputs(o))??[]);if(A.length>0&&s.length>0){let o=A.reduce((c,l)=>(l.id&&(c[l.id]=l),c),{}),u=[];for(let c of s)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:u.push(c);A=Object.values(o),s=u}let i={post:A,patch:s};if(!i.post.length&&!i.patch.length)return;let a={post:[],patch:[]};for(let o of["post","patch"]){let u=o,c=i[u].reverse(),l=c.pop();for(;l!==void 0;)a[u].push(l),l=c.pop()}if(a.post.length>0||a.patch.length>0){let o=a.post.map(u=>u.id).concat(a.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns($t(a,`Ingesting runs with ids: ${o}`),n)}}async _postBatchIngestRuns(e,t){let n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{let A=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await q(A,"batch create run",!0),A})}async multipartIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let A={},s=[];for(let l of e??[]){let f=await this.prepareRunCreateOrUpdateInputs(l);f.id!==void 0&&f.attachments!==void 0&&(A[f.id]=f.attachments),delete f.attachments,s.push(f)}let i=[];for(let l of t??[])i.push(await this.prepareRunCreateOrUpdateInputs(l));if(s.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&i.length>0){let l=s.reduce((d,p)=>(p.id&&(d[p.id]=p),d),{}),f=[];for(let d of i)d.id!==void 0&&l[d.id]?l[d.id]={...l[d.id],...d}:f.push(d);s=Object.values(l),i=f}if(s.length===0&&i.length===0)return;let u=[],c=[];for(let[l,f]of[["post",s],["patch",i]])for(let d of f){let{inputs:p,outputs:h,events:g,extra:w,error:m,serialized:_,attachments:B,...C}=d,v={inputs:p,outputs:h,events:g,extra:w,error:m,serialized:_},x=$t(C,`Serializing for multipart ingestion of run with id: ${C.id}`);c.push({name:`${l}.${C.id}`,payload:new Blob([x],{type:`application/json; length=${x.length}`})});for(let[Q,F]of Object.entries(v)){if(F===void 0)continue;let z=$t(F,`Serializing ${Q} for multipart ingestion of run with id: ${C.id}`);c.push({name:`${l}.${C.id}.${Q}`,payload:new Blob([z],{type:`application/json; length=${z.length}`})})}if(C.id!==void 0){let Q=A[C.id];if(Q){delete A[C.id];for(let[F,z]of Object.entries(Q)){let ee,ve;if(Array.isArray(z)?[ee,ve]=z:(ee=z.mimeType,ve=z.data),F.includes(".")){console.warn(`Skipping attachment '${F}' for run ${C.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${C.id}.${F}`,payload:new Blob([ve],{type:`${ee}; length=${ve.byteLength}`})})}}}u.push(`trace=${C.trace_id},id=${C.id}`)}await this._sendMultipartRequest(c,u.join("; "),n)}async _createNodeFetchBody(e,t){let n=[];for(let i of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),n.push(i.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,t){let n=new TextEncoder;return new ReadableStream({async start(s){let i=async a=>{typeof a=="string"?s.enqueue(n.encode(a)):s.enqueue(a)};for(let a of e){await i(`--${t}\r
`),await i(`Content-Disposition: form-data; name="${a.name}"\r
`),await i(`Content-Type: ${a.payload.type}\r
\r
`);let u=a.payload.stream().getReader();try{let c;for(;!(c=await u.read()).done;)s.enqueue(c.value)}finally{u.releaseLock()}await i(`\r
`)}await i(`--${t}--\r
`),s.close()}})}async _sendMultipartRequest(e,t,n){let A="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=Q_(),i=()=>this._createNodeFetchBody(e,A),a=()=>this._createMultipartStream(e,A),o=async u=>this.batchIngestCaller.call(async()=>{let c=await u(),l={...this.headers,"Content-Type":`multipart/form-data; boundary=${A}`};n?.apiKey!==void 0&&(l["x-api-key"]=n.apiKey);let f=c;n?.useGzip&&typeof c=="object"&&"pipeThrough"in c&&(f=c.pipeThrough(new CompressionStream("gzip")),l["Content-Encoding"]="gzip");let d=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:l,body:f,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(d,"Failed to send multipart request",!0),d});try{let u,c=!1;!s&&!this.multipartStreamingDisabled&&fp()!=="bun"?(c=!0,u=await o(a)):u=await o(i),(!this.multipartStreamingDisabled||c)&&u.status===422&&(n?.apiUrl??this.apiUrl)!==jB&&(console.warn(`Streaming multipart upload to ${n?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,u=await o(i))}catch(u){console.warn(`${u.message.trim()}

Context: ${t}`)}}async updateRun(e,t,n){ue(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let A={...t,id:e};if(!this._filterForSampling([A],!0).length)return;if(this.autoBatchTracing&&A.trace_id!==void 0&&A.dotted_order!==void 0){let a=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&A.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:A,otelContext:a,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:A,otelContext:a,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}let s={...this.headers,"Content-Type":"application/json"};n?.apiKey!==void 0&&(s["x-api-key"]=n.apiKey),n?.workspaceId!==void 0&&(s["x-tenant-id"]=n.workspaceId);let i=$t(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let a=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(a,"update run",!0),a})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){ue(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let A;t.session_id?A=t.session_id:n?.projectName?A=(await this.readProject({projectName:n?.projectName})).id:n?.projectId?A=n?.projectId:A=(await this.readProject({projectName:We("PROJECT")||"default"})).id;let s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${A}/r/${t.id}?poll=true`}else if(e!==void 0){let A=await this.readRun(e);if(!A.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${A.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await xk(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},A={};t.sort((s,i)=>(s?.dotted_order??"").localeCompare(i?.dotted_order??""));for(let s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.dotted_order?.startsWith(e.dotted_order??"")&&s.id!==e.id&&(s.parent_run_id in n||(n[s.parent_run_id]=[]),n[s.parent_run_id].push(s),A[s.id]=s)}e.child_runs=n[e.id]||[];for(let s in n)s!==e.id&&(A[s].child_runs=n[s]);return e}async*listRuns(e){let{projectId:t,projectName:n,parentRunId:A,traceId:s,referenceExampleId:i,startTime:a,executionOrder:o,isRoot:u,runType:c,error:l,id:f,query:d,filter:p,traceFilter:h,treeFilter:g,limit:w,select:m,order:_}=e,B=[];if(t&&(B=Array.isArray(t)?t:[t]),n){let Q=Array.isArray(n)?n:[n],F=await Promise.all(Q.map(z=>this.readProject({projectName:z}).then(ee=>ee.id)));B.push(...F)}let C=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],v={session:B.length?B:null,run_type:c,reference_example:i,query:d,filter:p,trace_filter:h,tree_filter:g,execution_order:o,parent_run:A,start_time:a?a.toISOString():null,error:l,id:f,limit:w,trace:s,select:m||C,is_root:u,order:_},x=0;for await(let Q of this._getCursorPaginatedList("/runs/query",v))if(w){if(x>=w)break;if(Q.length+x>w){yield*Q.slice(0,w-x);break}x+=Q.length,yield*Q}else yield*Q}async*listGroupRuns(e){let{projectId:t,projectName:n,groupBy:A,filter:s,startTime:i,endTime:a,limit:o,offset:u}=e,l={session_id:t||(await this.readProject({projectName:n})).id,group_by:A,filter:s,start_time:i?i.toISOString():null,end_time:a?a.toISOString():null,limit:Number(o)||100},f=Number(u)||0,d="/runs/group",p=`${this.apiUrl}${d}`;for(;;){let h={...l,offset:f},g=Object.fromEntries(Object.entries(h).filter(([v,x])=>x!==void 0)),w=JSON.stringify(g),_=await(await this.caller.call(async()=>{let v=await this._fetch(p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:w});return await q(v,`Failed to fetch ${d}`),v})).json(),{groups:B,total:C}=_;if(B.length===0)break;for(let v of B)yield v;if(f+=B.length,f>=C)break}}async getRunStats({id:e,trace:t,parentRun:n,runType:A,projectNames:s,projectIds:i,referenceExampleIds:a,startTime:o,endTime:u,error:c,query:l,filter:f,traceFilter:d,treeFilter:p,isRoot:h,dataSourceType:g}){let w=i||[];s&&(w=[...i||[],...await Promise.all(s.map(x=>this.readProject({projectName:x}).then(Q=>Q.id)))]);let _=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:A,session:w,reference_example:a,start_time:o,end_time:u,error:c,query:l,filter:f,trace_filter:d,tree_filter:p,is_root:h,data_source_type:g}).filter(([x,Q])=>Q!==void 0)),B=JSON.stringify(_);return await(await this.caller.call(async()=>{let x=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:B});return await q(x,"get run stats"),x})).json()}async shareRun(e,{shareId:t}={}){let n={run_id:e,share_token:t||De()};ue(e);let A=JSON.stringify(n),i=await(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:A});return await q(a,"share run"),a})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){ue(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(t,"unshare run",!0),t})}async readRunSharedLink(e){ue(e);let n=await(await this.caller.call(async()=>{let A=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(A,"read run shared link"),A})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let n=new URLSearchParams({share_token:e});if(t!==void 0)for(let i of t)n.append("id",i);return ue(e),await(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"list shared runs"),i})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),ue(e);let A=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(s,"read dataset shared schema"),s})).json();return A.url=`${this.getHostUrl()}/public/${A.share_token}/d`,A}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let n={dataset_id:e};ue(e);let A=JSON.stringify(n),i=await(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:A});return await q(a,"share dataset"),a})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){ue(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(t,"unshare dataset",!0),t})}async readSharedDataset(e){return ue(e),await(await this.caller.call(async()=>{let A=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(A,"read shared dataset"),A})).json()}async listSharedExamples(e,t){let n={};t?.exampleIds&&(n.id=t.exampleIds);let A=new URLSearchParams;Object.entries(n).forEach(([a,o])=>{Array.isArray(o)?o.forEach(u=>A.append(a,u)):A.append(a,o)});let s=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/public/${e}/examples?${A.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(a,"list shared examples"),a}),i=await s.json();if(!s.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return i.map(a=>({...a,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:A=!1,projectExtra:s=null,referenceDatasetId:i=null}){let a=A?"?upsert=true":"",o=`${this.apiUrl}/sessions${a}`,u=s||{};n&&(u.metadata=n);let c={name:e,extra:u,description:t};i!==null&&(c.reference_dataset_id=i);let l=JSON.stringify(c);return await(await this.caller.call(async()=>{let p=await this._fetch(o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await q(p,"create project"),p})).json()}async updateProject(e,{name:t=null,description:n=null,metadata:A=null,projectExtra:s=null,endTime:i=null}){let a=`${this.apiUrl}/sessions/${e}`,o=s;A&&(o={...o||{},metadata:A});let u=JSON.stringify({name:t,extra:o,description:n,end_time:i?new Date(i).toISOString():null});return await(await this.caller.call(async()=>{let f=await this._fetch(a,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await q(f,"update project"),f})).json()}async hasProject({projectId:e,projectName:t}){let n="/sessions",A=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ue(e),n+=`/${e}`;else if(t!==void 0)A.append("name",t);else throw new Error("Must provide projectName or projectId");let s=await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${n}?${A}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"has project"),i});try{let i=await s.json();return s.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let A="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ue(e),A+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&s.append("include_stats",n.toString());let i=await this._get(A,s),a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let n=await this.readProject({projectId:e,projectName:t}),A=await this._getTenantId();return`${this.getHostUrl()}/o/${A}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let n=await this.readDataset({datasetId:e,datasetName:t}),A=await this._getTenantId();return`${this.getHostUrl()}/o/${A}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:A,referenceDatasetName:s,includeStats:i,datasetVersion:a,referenceFree:o,metadata:u}={}){let c=new URLSearchParams;if(e!==void 0)for(let l of e)c.append("id",l);if(t!==void 0&&c.append("name",t),n!==void 0&&c.append("name_contains",n),A!==void 0)c.append("reference_dataset",A);else if(s!==void 0){let l=await this.readDataset({datasetName:s});c.append("reference_dataset",l.id)}i!==void 0&&c.append("include_stats",i.toString()),a!==void 0&&c.append("dataset_version",a),o!==void 0&&c.append("reference_free",o.toString()),u!==void 0&&c.append("metadata",JSON.stringify(u));for await(let l of this._getPaginated("/sessions",c))yield*l}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,ue(n),await this.caller.call(async()=>{let A=await this._fetch(`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(A,`delete session ${n} (${t})`,!0),A})}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:A,description:s,dataType:i,name:a}){let o=`${this.apiUrl}/datasets/upload`,u=new FormData;return u.append("file",e,t),n.forEach(f=>{u.append("input_keys",f)}),A.forEach(f=>{u.append("output_keys",f)}),s&&u.append("description",s),i&&u.append("data_type",i),a&&u.append("name",a),await(await this.caller.call(async()=>{let f=await this._fetch(o,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await q(f,"upload CSV"),f})).json()}async createDataset(e,{description:t,dataType:n,inputsSchema:A,outputsSchema:s,metadata:i}={}){let a={name:e,description:t,extra:i?{metadata:i}:void 0};n&&(a.data_type=n),A&&(a.inputs_schema_definition=A),s&&(a.outputs_schema_definition=s);let o=JSON.stringify(a);return await(await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await q(l,"create dataset"),l})).json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets",A=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)ue(e),n+=`/${e}`;else if(t)A.append("name",t);else throw new Error("Must provide datasetName or datasetId");let s=await this._get(n,A),i;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:A}){let s=e;if(s===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:t})).id);let i=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof A=="string"?A:A.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(a=>JSON.parse(a))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:A,datasetNameContains:s,metadata:i}={}){let a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let u of n)o.append("id",u);A!==void 0&&o.append("name",A),s!==void 0&&o.append("name_contains",s),i!==void 0&&o.append("metadata",JSON.stringify(i));for await(let u of this._getPaginated(a,o))yield*u}async updateDataset(e){let{datasetId:t,datasetName:n,...A}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let s=t??(await this.readDataset({datasetName:n})).id;ue(s);let i=JSON.stringify(A);return await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/datasets/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(o,"update dataset"),o})).json()}async updateDatasetTag(e){let{datasetId:t,datasetName:n,asOf:A,tag:s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let i=t??(await this.readDataset({datasetName:n})).id;ue(i);let a=JSON.stringify({as_of:typeof A=="string"?A:A.toISOString(),tag:s});await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await q(o,"update dataset tags",!0),o})}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",A=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(A=(await this.readDataset({datasetName:t})).id),A!==void 0)ue(A),n+=`/${A}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let s=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(s,`delete ${n}`,!0),s})}async indexDataset({datasetId:e,datasetName:t,tag:n}){let A=e;if(!A&&!t)throw new Error("Must provide either datasetName or datasetId");if(A&&t)throw new Error("Must provide either datasetName or datasetId, not both");A||(A=(await this.readDataset({datasetName:t})).id),ue(A);let i=JSON.stringify({tag:n});await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/datasets/${A}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(o,"index dataset"),o})).json()}async similarExamples(e,t,n,{filter:A}={}){let s={limit:n,inputs:e};A!==void 0&&(s.filter=A),ue(t);let i=JSON.stringify(s);return(await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:i});return await q(u,"fetch similar examples"),u})).json()).examples}async createExample(e,t,n){if(KB(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let A=t?n?.datasetId:e.dataset_id,s=t?n?.datasetName:e.dataset_name;if(A===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(A!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");A===void 0&&(A=(await this.readDataset({datasetName:s})).id);let i=(t?n?.createdAt:e.created_at)||new Date,a;KB(e)?a=e:a={inputs:e,outputs:t,created_at:i?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};let o=await this._uploadExamplesMultipart(A,[a]);return await this.readExample(o.example_ids?.[0]??De())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];let m=e,_=m[0].dataset_id,B=m[0].dataset_name;if(_===void 0&&B===void 0)throw new Error("Must provide either datasetName or datasetId");if(_!==void 0&&B!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");_===void 0&&(_=(await this.readDataset({datasetName:B})).id);let C=await this._uploadExamplesMultipart(_,m);return await Promise.all(C.example_ids.map(x=>this.readExample(x)))}let{inputs:t,outputs:n,metadata:A,splits:s,sourceRunIds:i,useSourceRunIOs:a,useSourceRunAttachments:o,attachments:u,exampleIds:c,datasetId:l,datasetName:f}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let d=l,p=f;if(d===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(d!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");d===void 0&&(d=(await this.readDataset({datasetName:p})).id);let h=t.map((m,_)=>({dataset_id:d,inputs:m,outputs:n?.[_],metadata:A?.[_],split:s?.[_],id:c?.[_],attachments:u?.[_],source_run_id:i?.[_],use_source_run_io:a?.[_],use_source_run_attachments:o?.[_]})),g=await this._uploadExamplesMultipart(d,h);return await Promise.all(g.example_ids.map(m=>this.readExample(m)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){let A=e.map(i=>xp(i)?Ip(i):i),s=xp(t)?Ip(t):t;return this.createExample({input:A},{output:s},n)}async readExample(e){ue(e);let t=`/examples/${e}`,n=await this._get(t),{attachment_urls:A,...s}=n,i=s;return A&&(i.attachments=Object.entries(A).reduce((a,[o,u])=>(a[o.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},a),{})),i}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:A,splits:s,inlineS3Urls:i,metadata:a,limit:o,offset:u,filter:c,includeAttachments:l}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let d=new URLSearchParams({dataset:f}),p=A?typeof A=="string"?A:A?.toISOString():void 0;p&&d.append("as_of",p);let h=i??!0;if(d.append("inline_s3_urls",h.toString()),n!==void 0)for(let w of n)d.append("id",w);if(s!==void 0)for(let w of s)d.append("splits",w);if(a!==void 0){let w=JSON.stringify(a);d.append("metadata",w)}o!==void 0&&d.append("limit",o.toString()),u!==void 0&&d.append("offset",u.toString()),c!==void 0&&d.append("filter",c),l===!0&&["attachment_urls","outputs","metadata"].forEach(w=>d.append("select",w));let g=0;for await(let w of this._getPaginated("/examples",d)){for(let m of w){let{attachment_urls:_,...B}=m,C=B;_&&(C.attachments=Object.entries(_).reduce((v,[x,Q])=>(v[x.slice(11)]={presigned_url:Q.presigned_url,mime_type:Q.mime_type||void 0},v),{})),yield C,g++}if(o!==void 0&&g>=o)break}}async deleteExample(e){ue(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(n,`delete ${t}`,!0),n})}async updateExample(e,t){let n;t?n=e:n=e.id,ue(n);let A;t?A={id:n,...t}:A=e;let s;return A.dataset_id!==void 0?s=A.dataset_id:s=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(s,[A])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:A}){let s;if(e?s=e:s=(await this.readDataset({datasetName:t})).id,ue(s),n&&A||!n&&!A)throw new Error("Exactly one of asOf and tag must be specified.");let i=new URLSearchParams;return n!==void 0&&i.append("as_of",typeof n=="string"?n:n.toISOString()),A!==void 0&&i.append("tag",A),await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/datasets/${s}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(o,"read dataset version"),o})).json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let A;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?A=(await this.readDataset({datasetName:t})).id:A=e,ue(A);let s=new URLSearchParams,i=n?typeof n=="string"?n:n?.toISOString():void 0;return i&&s.append("as_of",i),await this._get(`/datasets/${A}/splits`,s)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:A,remove:s=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,ue(i);let a={split_name:n,examples:A.map(u=>(ue(u),u)),remove:s},o=JSON.stringify(a);await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await q(u,"update dataset splits",!0),u})}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:A,referenceExample:s}={loadChildRuns:!1}){Gc("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:A});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(s=await this.readExample(i.reference_example_id));let a=await t.evaluateRun(i,s),[o,u]=await this._logEvaluationFeedback(a,i,n);return u[0]}async createFeedback(e,t,{score:n,value:A,correction:s,comment:i,sourceInfo:a,feedbackSourceType:o="api",sourceRunId:u,feedbackId:c,feedbackConfig:l,projectId:f,comparativeExperimentId:d}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");let p={type:o??"api",metadata:a??{}};u!==void 0&&p?.metadata!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&ue(p.metadata.__run.run_id);let h={id:c??De(),run_id:e,key:t,score:$B(n),value:A,correction:s,comment:i,feedback_source:p,comparative_experiment_id:d,feedbackConfig:l,session_id:f},g=JSON.stringify(h),w=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let m=await this._fetch(w,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await q(m,"create feedback",!0),m}),h}async updateFeedback(e,{score:t,value:n,correction:A,comment:s}){let i={};t!=null&&(i.score=$B(t)),n!=null&&(i.value=n),A!=null&&(i.correction=A),s!=null&&(i.comment=s),ue(e);let a=JSON.stringify(i);await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await q(o,"update feedback",!0),o})}async readFeedback(e){ue(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){ue(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(n,`delete ${t}`,!0),n})}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let A=new URLSearchParams;if(e)for(let s of e)ue(s),A.append("run",s);if(t)for(let s of t)A.append("key",s);if(n)for(let s of n)A.append("source",s);for await(let s of this._getPaginated("/feedback",A))yield*s}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:A}={}){let s={run_id:e,feedback_key:t,feedback_config:A};n?typeof n=="string"?s.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(s.expires_in=n):s.expires_in={hours:3};let i=JSON.stringify(s);return await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(o,"create presigned feedback token"),o})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:A,description:s,metadata:i,id:a}){if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let o={id:a,name:e,experiment_ids:t,reference_dataset_id:n,description:s,created_at:(A??new Date)?.toISOString(),extra:{}};i&&(o.extra.metadata=i);let u=JSON.stringify(o);return(await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await q(l,"create comparative experiment"),l})).json()}async*listPresignedFeedbackTokens(e){ue(e);let t=new URLSearchParams({run_id:e});for await(let n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){let A=this._selectEvalResults(e),s=[];for(let i of A){let a=n||{};i.evaluatorInfo&&(a={...i.evaluatorInfo,...a});let o=null;i.targetRunId?o=i.targetRunId:t&&(o=t.id),s.push(await this.createFeedback(o,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:a,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[A,s]}async logEvaluationFeedback(e,t,n){let[A]=await this._logEvaluationFeedback(e,t,n);return A}async*listAnnotationQueues(e={}){let{queueIds:t,name:n,nameContains:A,limit:s}=e,i=new URLSearchParams;t&&t.forEach((o,u)=>{ue(o,`queueIds[${u}]`),i.append("ids",o)}),n&&i.append("name",n),A&&i.append("name_contains",A),i.append("limit",(s!==void 0?Math.min(s,100):100).toString());let a=0;for await(let o of this._getPaginated("/annotation-queues",i))if(yield*o,a++,s!==void 0&&a>=s)break}async createAnnotationQueue(e){let{name:t,description:n,queueId:A,rubricInstructions:s}=e,i={name:t,description:n,id:A||De(),rubric_instructions:s},a=JSON.stringify(Object.fromEntries(Object.entries(i).filter(([u,c])=>c!==void 0)));return(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await q(u,"create annotation queue"),u})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${ue(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(n,"read annotation queue"),n})).json()}async updateAnnotationQueue(e,t){let{name:n,description:A,rubricInstructions:s}=t,i=JSON.stringify({name:n,description:A,rubric_instructions:s});await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/annotation-queues/${ue(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(a,"update annotation queue",!0),a})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${ue(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let n=JSON.stringify(t.map((A,s)=>ue(A,`runIds[${s}]`).toString()));await this.caller.call(async()=>{let A=await this._fetch(`${this.apiUrl}/annotation-queues/${ue(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await q(A,"add runs to annotation queue",!0),A})}async getRunFromAnnotationQueue(e,t){let n=`/annotation-queues/${ue(e,"queueId")}/run`;return(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(s,"get run from annotation queue"),s})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${ue(e,"queueId")}/runs/${ue(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(n,"delete run from annotation queue",!0),n})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${ue(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(n,"get size from annotation queue"),n})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){let n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let n=await(await this.caller.call(async()=>{let A=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(A,"get latest commit hash"),A})).json();if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[n,A,s]=Rn(e),i=JSON.stringify({like:t});return(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/likes/${n}/${A}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(o,`${t?"like":"unlike"} prompt`),o})).json()}async _getPromptUrl(e){let[t,n,A]=Rn(e);if(await this._currentTenantIsOwner(t)){let s=await this._getSettings();return A!=="latest"?`${this.getHostUrl()}/prompts/${n}/${A.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${s.id}`}else return A!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${A.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(let n of this._getPaginated("/repos",t,A=>A.repos))yield*n}async getPrompt(e){let[t,n,A]=Rn(e),i=await(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return a?.status===404?null:(await q(a,"get prompt"),a)}))?.json();return i?.repo?i.repo:null}async createPrompt(e,t){let n=await this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[A,s,i]=Rn(e);if(!await this._currentTenantIsOwner(A))throw await this._ownerConflictError("create a prompt",A);let a={repo_handle:s,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},o=JSON.stringify(a),u=await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await q(l,"create prompt"),l}),{repo:c}=await u.json();return c}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[A,s,i]=Rn(e),a=n?.parentCommitHash==="latest"||!n?.parentCommitHash?await this._getLatestCommitHash(`${A}/${s}`):n?.parentCommitHash,o={manifest:JSON.parse(JSON.stringify(t)),parent_commit:a},u=JSON.stringify(o),l=await(await this.caller.call(async()=>{let f=await this._fetch(`${this.apiUrl}/commits/${A}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await q(f,"create commit"),f})).json();return this._getPromptUrl(`${A}/${s}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let i of t){let a=i.id,o={...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},u=$t(o,`Serializing body for example with id: ${a}`),c=new Blob([u],{type:"application/json"});if(n.append(a,c),i.inputs){let l=$t(i.inputs,`Serializing inputs for example with id: ${a}`),f=new Blob([l],{type:"application/json"});n.append(`${a}.inputs`,f)}if(i.outputs){let l=$t(i.outputs,`Serializing outputs whle updating example with id: ${a}`),f=new Blob([l],{type:"application/json"});n.append(`${a}.outputs`,f)}if(i.attachments)for(let[l,f]of Object.entries(i.attachments)){let d,p;Array.isArray(f)?[d,p]=f:(d=f.mimeType,p=f.data);let h=new Blob([p],{type:`${d}; length=${p.byteLength}`});n.append(`${a}.attachment.${l}`,h)}if(i.attachments_operations){let l=$t(i.attachments_operations,`Serializing attachments while updating example with id: ${a}`),f=new Blob([l],{type:"application/json"});n.append(`${a}.attachments_operations`,f)}}let A=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${A}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await q(i,"update examples"),i})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let s of t){let i=(s.id??De()).toString(),a={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split},...s.source_run_id&&{source_run_id:s.source_run_id},...s.use_source_run_io&&{use_source_run_io:s.use_source_run_io},...s.use_source_run_attachments&&{use_source_run_attachments:s.use_source_run_attachments}},o=$t(a,`Serializing body for uploaded example with id: ${i}`),u=new Blob([o],{type:"application/json"});if(n.append(i,u),s.inputs){let c=$t(s.inputs,`Serializing inputs for uploaded example with id: ${i}`),l=new Blob([c],{type:"application/json"});n.append(`${i}.inputs`,l)}if(s.outputs){let c=$t(s.outputs,`Serializing outputs for uploaded example with id: ${i}`),l=new Blob([c],{type:"application/json"});n.append(`${i}.outputs`,l)}if(s.attachments)for(let[c,l]of Object.entries(s.attachments)){let f,d;Array.isArray(l)?[f,d]=l:(f=l.mimeType,d=l.data);let p=new Blob([d],{type:`${f}; length=${d.byteLength}`});n.append(`${i}.attachment.${c}`,p)}}return(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await q(s,"upload examples"),s})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[n,A]=Rn(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);let s={};if(t?.description!==void 0&&(s.description=t.description),t?.readme!==void 0&&(s.readme=t.readme),t?.tags!==void 0&&(s.tags=t.tags),t?.isPublic!==void 0&&(s.is_public=t.isPublic),t?.isArchived!==void 0&&(s.is_archived=t.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");let i=JSON.stringify(s);return(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/repos/${n}/${A}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await q(o,"update prompt"),o})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[t,n,A]=Rn(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"delete prompt"),i})).json()}async pullPromptCommit(e,t){let[n,A,s]=Rn(e),a=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/commits/${n}/${A}/${s}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(o,"pull prompt commit"),o})).json();return{owner:n,repo:A,commit_hash:a.commit_hash,manifest:a.manifest,examples:a.examples}}async _pullPrompt(e,t){let n=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(A=>A!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:n=this.apiUrl,datasetName:A}=t,[s,i]=this.parseTokenOrUrl(e,n),a=new r({apiUrl:s,apiKey:"placeholder"}),o=await a.readSharedDataset(i),u=A||o.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}let c=await a.listSharedExamples(i),l=await this.createDataset(u,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:l.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,n=2,A="dataset"){try{return ue(e),[t,e]}catch{}try{let i=new URL(e).pathname.split("/").filter(a=>a!=="");if(i.length>=n){let a=i[i.length-n];return[t,a]}else throw new Error(`Invalid public ${A} URL: ${e}`)}catch{throw new Error(`Invalid public ${A} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await k_()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}};function KB(r){return"dataset_id"in r||"dataset_name"in r}var zB=r=>r!==void 0?r:!!["TRACING_V2","TRACING"].find(t=>We(t)==="true");var ul=Symbol.for("lc:context_variables");function Qk(r){return r.replace(/[-:.]/g,"")}function Wp(r,e,t=1){let n=t.toFixed(0).slice(0,3).padStart(3,"0"),A=`${new Date(r).toISOString().slice(0,-1)}${n}Z`;return{dottedOrder:Qk(A)+e,microsecondPrecisionDatestring:A}}var cl=class r{constructor(e,t,n,A){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=A}static fromHeader(e){let t=e.split(","),n={},A=[],s,i;for(let a of t){let[o,u]=a.split("="),c=decodeURIComponent(u);o==="langsmith-metadata"?n=JSON.parse(c):o==="langsmith-tags"?A=c.split(","):o==="langsmith-project"?s=c:o==="langsmith-replicas"&&(i=JSON.parse(c))}return new r(n,A,s,i)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}},Or=class r{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),VB(e)){Object.assign(this,{...e});return}let t=r.getDefaultConfig(),{metadata:n,...A}=e,s=A.client??r.getSharedClient(),i={...n,...A?.extra?.metadata};if(A.extra={...A.extra,metadata:i},Object.assign(this,{...t,...A,client:s}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=Rk(this.replicas),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){let{dottedOrder:a,microsecondPrecisionDatestring:o}=Wp(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+a:this.dotted_order=a,this._serialized_start_time=o}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:De(),run_type:"chain",project_name:ho(),child_runs:[],api_url:er("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:er("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return r.sharedClient||(r.sharedClient=new Qs),r.sharedClient}createChild(e){let t=this.child_execution_order+1,n=new r({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});ul in this&&(n[ul]=this[ul]);let A=Symbol.for("lc:child_config"),s=e.extra?.[A]??this.extra[A];if(Ok(s)){let o={...s},u=Tk(o.callbacks)?o.callbacks.copy?.():void 0;u&&(Object.assign(u,{_parentRunId:n.id}),u.handlers?.find(ZB)?.updateFromRunTree?.(n),o.callbacks=u),n.extra[A]=o}let i=new Set,a=this;for(;a!=null&&!i.has(a.id);)i.add(a.id),a.child_execution_order=Math.max(a.child_execution_order,t),a=a.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),A){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,A&&Object.keys(A).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...A}}:{metadata:A})}_convertToCreate(e,t,n=!0){let A=e.extra??{};if(A?.runtime?.library===void 0&&(A.runtime||(A.runtime={}),t))for(let[a,o]of Object.entries(t))A.runtime[a]||(A.runtime[a]=o);let s,i;return n?(i=e.parent_run?.id??e.parent_run_id,s=[]):(s=e.child_runs.map(a=>this._convertToCreate(a,t,n)),i=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:A,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){let A=this._convertToCreate(this,t,n);if(e===this.project_name)return A;let s=l=>xc(`${l}:${e}`,xc.DNS),i=s(A.id),a=A.trace_id?s(A.trace_id):void 0,o=A.parent_run_id?s(A.parent_run_id):void 0,u;if(A.dotted_order){let l=Sk(A.dotted_order),f=[];for(let p=0;p<l.length-1;p++){let[h,g]=l[p],w=s(g);f.push(h.toISOString().replace(/[-:]/g,"").replace(".","")+w)}let[d]=l[l.length-1];f.push(d.toISOString().replace(/[-:]/g,"").replace(".","")+i),u=f.join(".")}else u=void 0;return{...A,id:i,trace_id:a,parent_run_id:o,dotted_order:u,session_name:e}}async postRun(e=!0){try{let t=kc();if(this.replicas&&this.replicas.length>0)for(let{projectName:n,apiKey:A,apiUrl:s,workspaceId:i}of this.replicas){let a=this._remapForProject(n??this.project_name,t,!0);await this.client.createRun(a,{apiKey:A,apiUrl:s,workspaceId:i})}else{let n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){Gc("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let n of this.child_runs)await n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:n,apiUrl:A,workspaceId:s,updates:i}of this.replicas){let a=this._remapForProject(t??this.project_name),o={id:a.id,outputs:a.outputs,error:a.error,parent_run_id:a.parent_run_id,session_name:a.session_name,reference_example_id:a.reference_example_id,end_time:a.end_time,dotted_order:a.dotted_order,trace_id:a.trace_id,events:a.events,tags:a.tags,extra:a.extra,attachments:this.attachments,...i};e?.excludeInputs||(o.inputs=a.inputs),await this.client.updateRun(a.id,o,{apiKey:n,apiUrl:A,workspaceId:s})}else try{let t={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){let n=e?.callbacks,A,s,i,a=zB();if(n){let u=n?.getParentRunId?.()??"",c=n?.handlers?.find(l=>l?.name=="langchain_tracer");A=c?.getRun?.(u),s=c?.projectName,i=c?.client,a=a||!!c}return A?new r({name:A.name,id:A.id,trace_id:A.trace_id,dotted_order:A.dotted_order,client:i,tracingEnabled:a,project_name:s,tags:[...new Set((A?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...A?.extra?.metadata,...e?.metadata}}}).createChild(t):new r({...t,client:i,tracingEnabled:a,project_name:s})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,A=n["langsmith-trace"];if(!A||typeof A!="string")return;let s=A.trim(),i=s.split(".").map(u=>{let[c,l]=u.split("Z");return{strTime:c,time:Date.parse(c+"Z"),uuid:l}}),a=i[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:a,dotted_order:s};if(n.baggage&&typeof n.baggage=="string"){let u=cl.fromHeader(n.baggage);o.metadata=u.metadata,o.tags=u.tags,o.project_name=u.project_name,o.replicas=u.replicas}return new r(o)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new cl(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[n,A]of Object.entries(t))e.set(n,A);return t}};Object.defineProperty(Or,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function VB(r){return r!=null&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function ZB(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function GB(r){return Array.isArray(r)&&r.some(e=>ZB(e))}function Tk(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function Ok(r){return r!=null&&typeof r.callbacks=="object"&&(GB(r.callbacks?.handlers)||GB(r.callbacks))}function Sk(r){return r.split(".").map(t=>{let n=t.slice(0,-36),A=t.slice(-36),s=parseInt(n.slice(0,4)),i=parseInt(n.slice(4,6))-1,a=parseInt(n.slice(6,8)),o=parseInt(n.slice(9,11)),u=parseInt(n.slice(11,13)),c=parseInt(n.slice(13,15)),l=parseInt(n.slice(15,21));return[new Date(s,i,a,o,u,c,l/1e3),A]})}function Pk(){let r=er("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{let e=JSON.parse(r);if(Array.isArray(e)){let t=[];for(let n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}t.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return t}else if(typeof e=="object"&&e!==null){kk(e);let t=[];for(let[n,A]of Object.entries(e)){let s=n.replace(/\/$/,"");if(typeof A=="string")t.push({apiUrl:s,apiKey:A});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof A}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(LB(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function Rk(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):Pk()}function kk(r){if(Object.keys(r).length>0&&We("ENDPOINT"))throw new sl}var Nk=()=>typeof window<"u"&&typeof window.document<"u",Lk=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Hk=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Xp=()=>typeof Deno<"u",Dk=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Xp(),JB=()=>{let r;return Nk()?r="browser":Dk()?r="node":Lk()?r="webworker":Hk()?r="jsdom":Xp()?r="deno":r="other",r},qp;function WB(){return qp===void 0&&(qp={library:"langchain-js",runtime:JB()}),qp}function Ge(r){try{return typeof process<"u"?process.env?.[r]:Xp()?Deno?.env.get(r):void 0}catch{return}}var Yp=class{};function eh(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}var Os=class r extends Yp{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Dd(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Ge("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Fr.prototype.toJSON.call(this)}toJSONNotImplemented(){return Fr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:De()}),Object.assign(this,e)}}return new t}},qB=r=>{let e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};var Mk=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function rh(r,e){if(r)return new Or({...r,start_time:r._serialized_start_time??r.start_time,parent_run:rh(e),child_runs:r.child_runs.map(t=>rh(t)).filter(t=>t!==void 0),extra:{...r.extra,runtime:WB()},tracingEnabled:!1})}function th(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Ji(r){return typeof r._addRunToRunMap=="function"}var gr=class extends Os{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?Mk(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:n}=Wp(new Date(e.start_time).getTime(),e.id,e.execution_order),A={...e},s=this.getRunById(A.parent_run_id);if(A.parent_run_id!==void 0?s&&(this._addChildRun(s,A),s.child_execution_order=Math.max(s.child_execution_order,A.child_execution_order),A.trace_id=s.trace_id,s.dotted_order!==void 0&&(A.dotted_order=[s.dotted_order,t].join("."),A._serialized_start_time=n)):(A.trace_id=A.id,A.dotted_order=t,A._serialized_start_time=n),this.usesRunTreeMap){let i=rh(A,s);i!==void 0&&this.runTreeMap.set(A.id,i)}else this.runMap.set(A.id,A);return A}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,A,s,i,a,o){let u=this._getExecutionOrder(A),c=Date.now(),l=a?{...s,metadata:a}:s,f={id:n,name:o??e.id[e.id.length-1],parent_run_id:A,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:l??{},tags:i||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,n,A,s,i,a,o){let u=this.getRunById(n)??this._createRunForLLMStart(e,t,n,A,s,i,a,o);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}_createRunForChatModelStart(e,t,n,A,s,i,a,o){let u=this._getExecutionOrder(A),c=Date.now(),l=a?{...s,metadata:a}:s,f={id:n,name:o??e.id[e.id.length-1],parent_run_id:A,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:l??{},tags:i||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,n,A,s,i,a,o){let u=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,A,s,i,a,o);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}async handleLLMEnd(e,t,n,A,s){let i=this.getRunById(t);if(!i||i?.run_type!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.outputs=e,i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...s},await this.onLLMEnd?.(i),await this._endTrace(i),i}async handleLLMError(e,t,n,A,s){let i=this.getRunById(t);if(!i||i?.run_type!=="llm")throw new Error("No LLM run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),i.extra={...i.extra,...s},await this.onLLMError?.(i),await this._endTrace(i),i}_createRunForChainStart(e,t,n,A,s,i,a,o){let u=this._getExecutionOrder(A),c=Date.now(),l={id:n,name:o??e.id[e.id.length-1],parent_run_id:A,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:a??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(l)}async handleChainStart(e,t,n,A,s,i,a,o){let u=this.getRunById(n)??this._createRunForChainStart(e,t,n,A,s,i,a,o);return await this.onRunCreate?.(u),await this.onChainStart?.(u),u}async handleChainEnd(e,t,n,A,s){let i=this.getRunById(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=th(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),s?.inputs!==void 0&&(i.inputs=th(s.inputs,"input")),await this.onChainEnd?.(i),await this._endTrace(i),i}async handleChainError(e,t,n,A,s){let i=this.getRunById(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),s?.inputs!==void 0&&(i.inputs=th(s.inputs,"input")),await this.onChainError?.(i),await this._endTrace(i),i}_createRunForToolStart(e,t,n,A,s,i,a){let o=this._getExecutionOrder(A),u=Date.now(),c={id:n,name:a??e.id[e.id.length-1],parent_run_id:A,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,n,A,s,i,a){let o=this.getRunById(n)??this._createRunForToolStart(e,t,n,A,s,i,a);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onToolEnd?.(n),await this._endTrace(n),n}async handleToolError(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onToolError?.(n),await this._endTrace(n),n}async handleAgentAction(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="chain")return;let A=n;A.actions=A.actions||[],A.actions.push(e),A.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(n)}async handleAgentEnd(e,t){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(n))}_createRunForRetrieverStart(e,t,n,A,s,i,a){let o=this._getExecutionOrder(A),u=Date.now(),c={id:n,name:a??e.id[e.id.length-1],parent_run_id:A,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,n,A,s,i,a){let o=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,A,s,i,a);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onRetrieverEnd?.(n),await this._endTrace(n),n}async handleRetrieverError(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onRetrieverError?.(n),await this._endTrace(n),n}async handleText(e,t){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(n))}async handleLLMNewToken(e,t,n,A,s,i){let a=this.getRunById(n);if(!a||a?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return a.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(a,e,{chunk:i?.chunk}),a}};var nh=Ct(t0(),1);function Ot(r,e){return`${r.open}${e}${r.close}`}function wr(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function r0(r){return typeof r=="string"?r.trim():r==null?r:wr(r,r.toString())}function EA(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:jt}=nh.default,Eo=class extends gr{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let A=this.runMap.get(n.parent_run_id);if(A)t.push(A),n=A;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((A,s,i)=>{let a=`${A.execution_order}:${A.run_type}:${A.name}`;return s===i.length-1?Ot(nh.default.bold,a):a}).join(" > ");return Ot(jt.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${wr(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.cyan,"[chain/end]")} [${t}] [${EA(e)}] Exiting Chain run with output: ${wr(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.red,"[chain/error]")} [${t}] [${EA(e)}] Chain run errored with error: ${wr(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(A=>A.trim())}:e.inputs;console.log(`${Ot(jt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${wr(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.cyan,"[llm/end]")} [${t}] [${EA(e)}] Exiting LLM run with output: ${wr(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.red,"[llm/error]")} [${t}] [${EA(e)}] LLM run errored with error: ${wr(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${r0(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.cyan,"[tool/end]")} [${t}] [${EA(e)}] Exiting Tool run with output: "${r0(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.red,"[tool/error]")} [${t}] [${EA(e)}] Tool run errored with error: ${wr(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${wr(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.cyan,"[retriever/end]")} [${t}] [${EA(e)}] Exiting Retriever run with output: ${wr(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Ot(jt.red,"[retriever/error]")} [${t}] [${EA(e)}] Retriever run errored with error: ${wr(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${Ot(jt.blue,"[agent/action]")} [${n}] Agent selected action: ${wr(t.actions[t.actions.length-1],"[action]")}`)}};var Ah,sh=()=>{if(Ah===void 0){let r=Ge("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Ah=new Qs(r)}return Ah};var Wi=class r extends gr{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:n,client:A,replicas:s}=e;this.projectName=n??ho(),this.replicas=s,this.exampleId=t,this.client=A??sh();let i=r.getTraceableRunTree();i&&this.updateFromRunTree(i)}async persistRun(e){}async onRunCreate(e){await this.getRunTreeWithTracingConfig(e.id)?.postRun()}async onRunUpdate(e){await this.getRunTreeWithTracingConfig(e.id)?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();let A=[t];for(;A.length>0;){let s=A.shift();!s||n.has(s.id)||(n.add(s.id),this.runTreeMap.set(s.id,s),s.child_runs&&A.push(...s.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new Or({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return qy(!0)}catch{return}}};var ll=Ct(Kc(),1);var n0=Symbol.for("ls:tracing_async_local_storage"),Ss=Symbol.for("lc:context_variables"),A0=r=>{globalThis[n0]=r},xA=()=>globalThis[n0];var xo;function jk(){let r="default"in ll.default?ll.default.default:ll.default;return new r({autoStart:!0,concurrency:1})}function Kk(){return typeof xo>"u"&&(xo=jk()),xo}async function Ve(r,e){if(e===!0){let t=xA();t!==void 0?await t.run(void 0,async()=>r()):await r()}else xo=Kk(),xo.add(async()=>{let t=xA();t!==void 0?await t.run(void 0,async()=>r()):await r()})}var s0=r=>r!==void 0?r:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Ge(t)==="true");function ih(r){let e=xA();return e===void 0?void 0:e.getStore()?.[Ss]?.[r]}var zk=Symbol("lc:configure_hooks"),i0=()=>ih(zk)||[];function a0(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var ah=class{setHandler(e){return this.setHandlers([e])}},qi=class{constructor(e,t,n,A,s,i,a,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:A}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,A,s){await Promise.all(this.handlers.map(i=>Ve(async()=>{try{await i.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(a){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${a}`),i.raiseError)throw a}},i.awaitHandlers)))}},oh=class extends qi{getChild(e){let t=new pt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw n}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}},t.awaitHandlers)))}},fl=class extends qi{async handleLLMNewToken(e,t,n,A,s,i){await Promise.all(this.handlers.map(a=>Ve(async()=>{if(!a.ignoreLLM)try{await a.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMNewToken: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleLLMError(e,t,n,A,s){await Promise.all(this.handlers.map(i=>Ve(async()=>{if(!i.ignoreLLM)try{await i.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(a){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${a}`),i.raiseError)throw a}},i.awaitHandlers)))}async handleLLMEnd(e,t,n,A,s){await Promise.all(this.handlers.map(i=>Ve(async()=>{if(!i.ignoreLLM)try{await i.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(a){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${a}`),i.raiseError)throw a}},i.awaitHandlers)))}},uh=class extends qi{getChild(e){let t=new pt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,A,s){await Promise.all(this.handlers.map(i=>Ve(async()=>{if(!i.ignoreChain)try{await i.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(a){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${a}`),i.raiseError)throw a}},i.awaitHandlers)))}async handleChainEnd(e,t,n,A,s){await Promise.all(this.handlers.map(i=>Ve(async()=>{if(!i.ignoreChain)try{await i.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(a){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${a}`),i.raiseError)throw a}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},ch=class extends qi{getChild(e){let t=new pt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Ve(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},pt=class r extends ah{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,A=void 0,s=void 0,i=void 0,a=void 0,o=void 0){return Promise.all(t.map(async(u,c)=>{let l=c===0&&n?n:De();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ji(f)&&f._createRunForLLMStart(e,[u],l,this._parentRunId,s,this.tags,this.metadata,o),Ve(async()=>{try{await f.handleLLMStart?.(e,[u],l,this._parentRunId,s,this.tags,this.metadata,o)}catch(d){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${d}`),f.raiseError)throw d}},f.awaitHandlers)})),new fl(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,A=void 0,s=void 0,i=void 0,a=void 0,o=void 0){return Promise.all(t.map(async(u,c)=>{let l=c===0&&n?n:De();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ji(f)&&f._createRunForChatModelStart(e,[u],l,this._parentRunId,s,this.tags,this.metadata,o),Ve(async()=>{try{if(f.handleChatModelStart)await f.handleChatModelStart?.(e,[u],l,this._parentRunId,s,this.tags,this.metadata,o);else if(f.handleLLMStart){let d=oo(u);await f.handleLLMStart?.(e,[d],l,this._parentRunId,s,this.tags,this.metadata,o)}}catch(d){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${d}`),f.raiseError)throw d}},f.awaitHandlers)})),new fl(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=De(),A=void 0,s=void 0,i=void 0,a=void 0){return await Promise.all(this.handlers.map(o=>{if(!o.ignoreChain)return Ji(o)&&o._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,A,a),Ve(async()=>{try{await o.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,A,a)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleChainStart: ${u}`),o.raiseError)throw u}},o.awaitHandlers)})),new uh(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=De(),A=void 0,s=void 0,i=void 0,a=void 0){return await Promise.all(this.handlers.map(o=>{if(!o.ignoreAgent)return Ji(o)&&o._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,a),Ve(async()=>{try{await o.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,a)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleToolStart: ${u}`),o.raiseError)throw u}},o.awaitHandlers)})),new ch(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=De(),A=void 0,s=void 0,i=void 0,a=void 0){return await Promise.all(this.handlers.map(o=>{if(!o.ignoreRetriever)return Ji(o)&&o._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,a),Ve(async()=>{try{await o.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,a)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleRetrieverStart: ${u}`),o.raiseError)throw u}},o.awaitHandlers)})),new oh(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,A,s){await Promise.all(this.handlers.map(i=>Ve(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,n,this.tags,this.metadata)}catch(a){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${a}`),i.raiseError)throw a}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let A of this.handlers){let s=this.inheritableHandlers.includes(A);n.addHandler(A,s)}for(let A of this.tags){let s=this.inheritableTags.includes(A);n.addTags([A],s)}for(let A of Object.keys(this.metadata)){let s=Object.keys(this.inheritableMetadata).includes(A);n.addMetadata({[A]:this.metadata[A]},s)}for(let A of e)n.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===A.name)||n.addHandler(A,t);return n}static fromHandlers(e){class t extends Os{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:De()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static configure(e,t,n,A,s,i,a){return this._configureSync(e,t,n,A,s,i,a)}static _configureSync(e,t,n,A,s,i,a){let o;(e||t)&&(Array.isArray(e)||!e?(o=new r,o.setHandlers(e?.map(Io)??[],!0)):o=e,o=o.copy(Array.isArray(t)?t.map(Io):t?.handlers,!1));let u=Ge("LANGCHAIN_VERBOSE")==="true"||a?.verbose,c=Wi.getTraceableRunTree()?.tracingEnabled||s0(),l=c||(Ge("LANGCHAIN_TRACING")??!1);if(u||l){if(o||(o=new r),u&&!o.handlers.some(f=>f.name===Eo.prototype.name)){let f=new Eo;o.addHandler(f,!0)}if(l&&!o.handlers.some(f=>f.name==="langchain_tracer")&&c){let f=new Wi;o.addHandler(f,!0)}if(c){let f=Wi.getTraceableRunTree();f&&o._parentRunId===void 0&&(o._parentRunId=f.id,o.handlers.find(p=>p.name==="langchain_tracer")?.updateFromRunTree(f))}}for(let{contextVar:f,inheritable:d=!0,handlerClass:p,envVar:h}of i0()){let g=h&&Ge(h)==="true"&&p,w,m=f!==void 0?ih(f):void 0;m&&qB(m)?w=m:g&&(w=new p({})),w!==void 0&&(o||(o=new r),o.handlers.some(_=>_.name===w.name)||o.addHandler(w,d))}return(n||A)&&o&&(o.addTags(n??[]),o.addTags(A??[],!1)),(s||i)&&o&&(o.addMetadata(s??{}),o.addMetadata(i??{},!1)),o}};function Io(r){return"name"in r?r:Os.fromMethods(r)}var dl=class{getStore(){}run(e,t){return t()}enterWith(e){}},Gk=new dl,o0=Symbol.for("lc:child_config"),lh=class{getInstance(){return xA()??Gk}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[o0]}runWithConfig(e,t,n){let A=pt._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),s=this.getInstance(),i=s.getStore(),a=A?.getParentRunId(),o=A?.handlers?.find(c=>c?.name==="langchain_tracer"),u;return o&&a?u=o.getRunTreeWithTracingConfig(a):n||(u=new Or({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[o0]:e}),i!==void 0&&i[Ss]!==void 0&&(u===void 0&&(u={}),u[Ss]=i[Ss]),s.run(u,t)}initializeGlobalInstance(e){xA()===void 0&&A0(e)}},St=new lh;var pl=25;async function Kt(r){return pt._configureSync(r?.callbacks,void 0,r?.tags,void 0,r?.metadata)}function Xi(...r){let e={};for(let t of r.filter(n=>!!n))for(let n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){let A=e[n]??[];e[n]=[...new Set(A.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){let A=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!A)e.callbacks=s;else if(Array.isArray(A))e.callbacks=A.concat(s);else{let i=A.copy();for(let a of s)i.addHandler(Io(a),!0);e.callbacks=i}else if(s)if(!A)e.callbacks=s;else if(Array.isArray(A)){let i=s.copy();for(let a of A)i.addHandler(Io(a),!0);e.callbacks=i}else e.callbacks=new pt(s._parentRunId,{handlers:A.handlers.concat(s.handlers),inheritableHandlers:A.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(A.tags.concat(s.tags))),inheritableTags:Array.from(new Set(A.inheritableTags.concat(s.inheritableTags))),metadata:{...A.metadata,...s.metadata}})}else{let A=n;e[A]=t[A]??e[A]}return e}var Vk=new Set(["string","number","boolean"]);function ye(r){let e=St.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:n,runName:A,...s}=e;t=Object.entries(s).reduce((i,[a,o])=>(o!==void 0&&(i[a]=o),i),t)}if(r&&(t=Object.entries(r).reduce((n,[A,s])=>(s!==void 0&&(n[A]=s),n),t)),t?.configurable)for(let n of Object.keys(t.configurable))Vk.has(typeof t.configurable[n])&&!t.metadata?.[n]&&(t.metadata||(t.metadata={}),t.metadata[n]=t.configurable[n]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let n=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,n])):t.signal=n,delete t.timeout}return t}function Ze(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:A,configurable:s,runId:i}={}){let a=ye(r);return e!==void 0&&(delete a.runName,a.callbacks=e),n!==void 0&&(a.recursionLimit=n),t!==void 0&&(a.maxConcurrency=t),A!==void 0&&(a.runName=A),s!==void 0&&(a.configurable={...a.configurable,...s}),i!==void 0&&delete a.runId,a}function yr(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function on(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!e?.aborted)throw n}),new Promise((n,A)=>{t=()=>{A(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&A(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}var vt=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return A();function A(){return t.read().then(({done:s,value:i})=>{if(s){n.close();return}return n.enqueue(i),A()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){let{value:n,done:A}=await e.next();A&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}};function fh(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(A){for(;;)if(A.length===0){let s=await r.next();for(let i of t)i.push(s)}else{if(A[0].done)return;yield A.shift().value}})}function Nn(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t={...r};for(let[n,A]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=Nn(t[n],A):t[n]=A;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var kn=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{St.runWithConfig(yr(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(A=>t(void 0),n)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?St.runWithConfig(yr(this.config),this.signal?async()=>on(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function u0(r,e,t,n,...A){let s=new kn({generator:e,startSetup:t,signal:n}),i=await s.setup;return{output:r(s,i,...A),setup:i}}var Sr=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),n=CA({},t);return new Uo({ops:t,state:n[n.length-1].newDocument})}},Uo=class r extends Sr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=CA(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=CA({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}},f0=r=>r.name==="log_stream_tracer";async function c0(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input}async function l0(r,e){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t}function Zk(r){return r!==void 0&&r.message!==void 0}var Fo=class extends gr{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=vt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(A=>this.includeTags?.includes(A))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(A=>!this.excludeTags?.includes(A))),n}async*tapOutputIterable(e,t){for await(let n of t){if(e!==this.rootId){let A=this.keyMapByRunId[e];A&&await this.writer.write(new Sr({ops:[{op:"add",path:`/logs/${A}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Sr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await c0(e,this._schemaFormat)),await this.writer.write(new Sr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await c0(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await l0(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let A=new Sr({ops:n});await this.writer.write(A)}finally{if(e.id===this.rootId){let t=new Sr({ops:[{op:"replace",path:"/final_output",value:await l0(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){let A=this.keyMapByRunId[e.id];if(A===void 0)return;let s=e.inputs.messages!==void 0,i;s?Zk(n?.chunk)?i=n?.chunk:i=new Xt({id:`run-${e.id}`,content:t}):i=t;let a=new Sr({ops:[{op:"add",path:`/logs/${A}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${A}/streamed_output/-`,value:i}]});await this.writer.write(a)}};var hl="__run",un=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Ln=class r extends un{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}};function ml({name:r,serialized:e}){return r!==void 0?r:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var d0=r=>r.name==="event_stream_tracer",gl=class extends gr{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=vt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(A=>this.includeTags?.includes(A))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(A=>!this.excludeTags?.includes(A))),n}async*tapOutputIterable(e,t){let n=await t.next();if(n.done)return;let A=this.runInfoMap.get(e);if(A===void 0){yield n.value;return}function s(a,o){return a==="llm"&&typeof o=="string"?new un({text:o}):o}let i=this.tappedPromises.get(e);if(i===void 0){let a;i=new Promise(o=>{a=o}),this.tappedPromises.set(e,i);try{let o={event:`on_${A.runType}_stream`,run_id:e,name:A.name,tags:A.tags,metadata:A.metadata,data:{}};await this.send({...o,data:{chunk:s(A.runType,n.value)}},A),yield n.value;for await(let u of t)A.runType!=="tool"&&A.runType!=="retriever"&&await this.send({...o,data:{chunk:s(A.runType,u)}},A),yield u}finally{a()}}else{yield n.value;for await(let a of t)yield a}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=ml(e),n=e.inputs.messages!==void 0?"chat_model":"llm",A={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,A);let s=`on_${n}_start`;await this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},A)}async onLLMNewToken(e,t,n){let A=this.runInfoMap.get(e.id),s,i;if(A===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(A.runType==="chat_model")i="on_chat_model_stream",n?.chunk===void 0?s=new Xt({content:t,id:`run-${e.id}`}):s=n.chunk.message;else if(A.runType==="llm")i="on_llm_stream",n?.chunk===void 0?s=new un({text:t}):s=n.chunk;else throw new Error(`Unexpected run type ${A.runType}`);await this.send({event:i,data:{chunk:s},run_id:e.id,name:A.name,tags:A.tags,metadata:A.metadata},A)}}async onLLMEnd(e){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let A=e.outputs?.generations,s;if(t.runType==="chat_model"){for(let i of A??[]){if(s!==void 0)break;s=i[0]?.message}n="on_chat_model_end"}else if(t.runType==="llm")s={generations:A?.map(i=>i.map(a=>({text:a.text,generationInfo:a.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){let t=ml(e),n=e.run_type??"chain",A={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},A.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,A.inputs=e.inputs.input):(s.input=e.inputs,A.inputs=e.inputs),this.runInfoMap.set(e.id,A),await this.send({event:`on_${n}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},A)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let n=`on_${e.run_type}_end`,A=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:A};A.input&&Object.keys(A).length===1&&(i.input=A.input,t.inputs=A.input),await this.sendEndEvent({event:n,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=ml(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let n=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=ml(e),A={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,A),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},A)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){let A=this.runInfoMap.get(n);if(A===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:A.tags,metadata:A.metadata,data:t},A)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};var p0=Ct(Bc(),1),wl=Ct(Kc(),1),Jk=[400,401,402,403,404,405,406,407,409],Wk=r=>{if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||r?.code==="ECONNABORTED")throw r;let e=r?.response?.status??r?.status;if(e&&Jk.includes(+e))throw r;if(r?.error?.code==="insufficient_quota"){let t=new Error(r?.message);throw t.name="InsufficientQuotaError",t}},Hn=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Wk;let t="default"in wl.default?wl.default.default:wl.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,p0.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((A,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var Qo=class extends gr{constructor({config:e,onStart:t,onEnd:n,onError:A}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=A}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function To(r){return r?r.lc_runnable:!1}var yl=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,A=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||A.some(s=>this.includeTags?.includes(s))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&A.every(s=>!this.excludeTags?.includes(s))),n}};function dh(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}var qk=["*","_","`"];function Xk(r){let e="";for(let[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function h0(r,e,t){let{firstNode:n,lastNode:A,nodeColors:s,withStyles:i=!0,curveStyle:a="linear",wrapLabelNWords:o=9}=t??{},u=i?`%%{init: {'flowchart': {'curve': '${a}'}}}%%
graph TD;
`:`graph TD;
`;if(i){let d="default",p={[d]:"{0}({1})"};n!==void 0&&(p[n]="{0}([{1}]):::first"),A!==void 0&&(p[A]="{0}([{1}]):::last");for(let[h,g]of Object.entries(r)){let w=g.name.split(":").pop()??"",_=qk.some(C=>w.startsWith(C)&&w.endsWith(C))?`<p>${w}</p>`:w;Object.keys(g.metadata??{}).length&&(_+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([C,v])=>`${C} = ${v}`).join(`
`)}</em></small>`);let B=(p[h]??p[d]).replace("{0}",dh(h)).replace("{1}",_);u+=`	${B}
`}}let c={};for(let d of e){let p=d.source.split(":"),h=d.target.split(":"),g=p.filter((w,m)=>w===h[m]).join(":");c[g]||(c[g]=[]),c[g].push(d)}let l=new Set;function f(d,p){let h=d.length===1&&d[0].source===d[0].target;if(p&&!h){let g=p.split(":").pop();if(l.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);l.add(g),u+=`	subgraph ${g}
`}for(let g of d){let{source:w,target:m,data:_,conditional:B}=g,C="";if(_!==void 0){let v=_,x=v.split(" ");x.length>o&&(v=Array.from({length:Math.ceil(x.length/o)},(Q,F)=>x.slice(F*o,(F+1)*o).join(" ")).join("&nbsp;<br>&nbsp;")),C=B?` -. &nbsp;${v}&nbsp; .-> `:` -- &nbsp;${v}&nbsp; --> `}else C=B?" -.-> ":" --> ";u+=`	${dh(w)}${C}${dh(m)};
`}for(let g in c)g.startsWith(`${p}:`)&&g!==p&&f(c[g],g);p&&!h&&(u+=`	end
`)}f(c[""]??[],"");for(let d in c)!d.includes(":")&&d!==""&&f(c[d],d);return i&&(u+=Xk(s??{})),u}async function m0(r,e){let{backgroundColor:t="white"}=e??{},n=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let A=`https://mermaid.ink/img/${n}?bgColor=${t}`,s=await fetch(A);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join(`
`));return await s.blob()}var G3=Object.freeze({status:"aborted"});function Yi(r,e,t){function n(a,o){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(r),e(a,o);for(let c in i.prototype)c in a||Object.defineProperty(a,c,{value:i.prototype[c].bind(a)});a._zod.constr=i,a._zod.def=o}let A=t?.Parent??Object;class s extends A{}Object.defineProperty(s,"name",{value:r});function i(a){var o;let u=t?.Parent?new s:this;n(u,a),(o=u._zod).deferred??(o.deferred=[]);for(let c of u._zod.deferred)c();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>t?.Parent&&a instanceof t.Parent?!0:a?._zod?.traits?.has(r)}),Object.defineProperty(i,"name",{value:r}),i}var V3=Symbol("zod_brand"),IA=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},ph={};function ea(r){return r&&Object.assign(ph,r),ph}function hh(r){let e=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,A])=>e.indexOf(+n)===-1).map(([n,A])=>A)}function w0(r,e){return typeof e=="bigint"?e.toString():e}function y0(r){return{get value(){{let t=r();return Object.defineProperty(this,"value",{value:t}),t}throw new Error("cached value already set")}}}var mh=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};var Yk=y0(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let r=Function;return new r(""),!0}catch{return!1}});function ta(r,e,t){let n=new r._zod.constr(e??r._zod.def);return(!e||t?.parent)&&(n._zod.parent=r),n}function _0(r){let e=r;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}var Z3={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function bl(r,e=0){for(let t=e;t<r.issues.length;t++)if(r.issues[t]?.continue!==!0)return!0;return!1}function _l(r){return typeof r=="string"?r:r?.message}function ra(r,e,t){let n={...r,path:r.path??[]};if(!r.message){let A=_l(r.inst?._zod.def?.error?.(r))??_l(e?.error?.(r))??_l(t.customError?.(r))??_l(t.localeError?.(r))??"Invalid input";n.message=A}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}var b0=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(e,w0,2)},enumerable:!0}),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},B0=Yi("$ZodError",b0),So=Yi("$ZodError",b0,{Parent:Error});var t1=r=>(e,t,n,A)=>{let s=n?Object.assign(n,{async:!1}):{async:!1},i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise)throw new IA;if(i.issues.length){let a=new(A?.Err??r)(i.issues.map(o=>ra(o,s,ea())));throw mh(a,A?.callee),a}return i.value},Bl=t1(So),r1=r=>async(e,t,n,A)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){let a=new(A?.Err??r)(i.issues.map(o=>ra(o,s,ea())));throw mh(a,A?.callee),a}return i.value},v0=r1(So),n1=r=>(e,t,n)=>{let A=n?{...n,async:!1}:{async:!1},s=e._zod.run({value:t,issues:[]},A);if(s instanceof Promise)throw new IA;return s.issues.length?{success:!1,error:new(r??B0)(s.issues.map(i=>ra(i,A,ea())))}:{success:!0,data:s.value}},C0=n1(So),A1=r=>async(e,t,n)=>{let A=n?Object.assign(n,{async:!0}):{async:!0},s=e._zod.run({value:t,issues:[]},A);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new r(s.issues.map(i=>ra(i,A,ea())))}:{success:!0,data:s.value}},E0=A1(So);var x0={major:4,minor:0,patch:0};var s1=Yi("$ZodType",(r,e)=>{var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=x0;let n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(let A of n)for(let s of A._zod.onattach)s(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),r._zod.deferred?.push(()=>{r._zod.run=r._zod.parse});else{let A=(s,i,a)=>{let o=bl(s),u;for(let c of i){if(c._zod.def.when){if(!c._zod.def.when(s))continue}else if(o)continue;let l=s.issues.length,f=c._zod.check(s);if(f instanceof Promise&&a?.async===!1)throw new IA;if(u||f instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await f,s.issues.length!==l&&(o||(o=bl(s,l)))});else{if(s.issues.length===l)continue;o||(o=bl(s,l))}}return u?u.then(()=>s):s};r._zod.run=(s,i)=>{let a=r._zod.parse(s,i);if(a instanceof Promise){if(i.async===!1)throw new IA;return a.then(o=>A(o,n,i))}return A(a,n,i)}}r["~standard"]={validate:A=>{try{let s=C0(r,A);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return E0(r,A).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}});var I0=Yi("$ZodNever",(r,e)=>{s1.init(r,e),r._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});var dV=Symbol("ZodOutput"),pV=Symbol("ZodInput"),Po=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n={...this.get(t)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function i1(){return new Po}var cn=i1();function U0(r,e){return new r({type:"never",..._0(e)})}var vl=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??cn,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var n;let A=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},i=this.seen.get(e);if(i)return i.count++,t.schemaPath.includes(e)&&(i.cycle=t.path),i.schema;let a={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,a);let o=e._zod.toJSONSchema?.();if(o)a.schema=o;else{let l={...t,schemaPath:[...t.schemaPath,e],path:t.path},f=e._zod.parent;if(f)a.ref=f,this.process(f,l),this.seen.get(f).isParent=!0;else{let d=a.schema;switch(A.type){case"string":{let p=d;p.type="string";let{minimum:h,maximum:g,format:w,patterns:m,contentEncoding:_}=e._zod.bag;if(typeof h=="number"&&(p.minLength=h),typeof g=="number"&&(p.maxLength=g),w&&(p.format=s[w]??w,p.format===""&&delete p.format),_&&(p.contentEncoding=_),m&&m.size>0){let B=[...m];B.length===1?p.pattern=B[0].source:B.length>1&&(a.schema.allOf=[...B.map(C=>({...this.target==="draft-7"?{type:"string"}:{},pattern:C.source}))])}break}case"number":{let p=d,{minimum:h,maximum:g,format:w,multipleOf:m,exclusiveMaximum:_,exclusiveMinimum:B}=e._zod.bag;typeof w=="string"&&w.includes("int")?p.type="integer":p.type="number",typeof B=="number"&&(p.exclusiveMinimum=B),typeof h=="number"&&(p.minimum=h,typeof B=="number"&&(B>=h?delete p.minimum:delete p.exclusiveMinimum)),typeof _=="number"&&(p.exclusiveMaximum=_),typeof g=="number"&&(p.maximum=g,typeof _=="number"&&(_<=g?delete p.maximum:delete p.exclusiveMaximum)),typeof m=="number"&&(p.multipleOf=m);break}case"boolean":{let p=d;p.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{d.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{d.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let p=d,{minimum:h,maximum:g}=e._zod.bag;typeof h=="number"&&(p.minItems=h),typeof g=="number"&&(p.maxItems=g),p.type="array",p.items=this.process(A.element,{...l,path:[...l.path,"items"]});break}case"object":{let p=d;p.type="object",p.properties={};let h=A.shape;for(let m in h)p.properties[m]=this.process(h[m],{...l,path:[...l.path,"properties",m]});let g=new Set(Object.keys(h)),w=new Set([...g].filter(m=>{let _=A.shape[m]._zod;return this.io==="input"?_.optin===void 0:_.optout===void 0}));w.size>0&&(p.required=Array.from(w)),A.catchall?._zod.def.type==="never"?p.additionalProperties=!1:A.catchall?A.catchall&&(p.additionalProperties=this.process(A.catchall,{...l,path:[...l.path,"additionalProperties"]})):this.io==="output"&&(p.additionalProperties=!1);break}case"union":{let p=d;p.anyOf=A.options.map((h,g)=>this.process(h,{...l,path:[...l.path,"anyOf",g]}));break}case"intersection":{let p=d,h=this.process(A.left,{...l,path:[...l.path,"allOf",0]}),g=this.process(A.right,{...l,path:[...l.path,"allOf",1]}),w=_=>"allOf"in _&&Object.keys(_).length===1,m=[...w(h)?h.allOf:[h],...w(g)?g.allOf:[g]];p.allOf=m;break}case"tuple":{let p=d;p.type="array";let h=A.items.map((m,_)=>this.process(m,{...l,path:[...l.path,"prefixItems",_]}));if(this.target==="draft-2020-12"?p.prefixItems=h:p.items=h,A.rest){let m=this.process(A.rest,{...l,path:[...l.path,"items"]});this.target==="draft-2020-12"?p.items=m:p.additionalItems=m}A.rest&&(p.items=this.process(A.rest,{...l,path:[...l.path,"items"]}));let{minimum:g,maximum:w}=e._zod.bag;typeof g=="number"&&(p.minItems=g),typeof w=="number"&&(p.maxItems=w);break}case"record":{let p=d;p.type="object",p.propertyNames=this.process(A.keyType,{...l,path:[...l.path,"propertyNames"]}),p.additionalProperties=this.process(A.valueType,{...l,path:[...l.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let p=d,h=hh(A.entries);h.every(g=>typeof g=="number")&&(p.type="number"),h.every(g=>typeof g=="string")&&(p.type="string"),p.enum=h;break}case"literal":{let p=d,h=[];for(let g of A.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");h.push(Number(g))}else h.push(g);if(h.length!==0)if(h.length===1){let g=h[0];p.type=g===null?"null":typeof g,p.const=g}else h.every(g=>typeof g=="number")&&(p.type="number"),h.every(g=>typeof g=="string")&&(p.type="string"),h.every(g=>typeof g=="boolean")&&(p.type="string"),h.every(g=>g===null)&&(p.type="null"),p.enum=h;break}case"file":{let p=d,h={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:w,mime:m}=e._zod.bag;g!==void 0&&(h.minLength=g),w!==void 0&&(h.maxLength=w),m?m.length===1?(h.contentMediaType=m[0],Object.assign(p,h)):p.anyOf=m.map(_=>({...h,contentMediaType:_})):Object.assign(p,h);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let p=this.process(A.innerType,l);d.anyOf=[p,{type:"null"}];break}case"nonoptional":{this.process(A.innerType,l),a.ref=A.innerType;break}case"success":{let p=d;p.type="boolean";break}case"default":{this.process(A.innerType,l),a.ref=A.innerType,d.default=JSON.parse(JSON.stringify(A.defaultValue));break}case"prefault":{this.process(A.innerType,l),a.ref=A.innerType,this.io==="input"&&(d._prefault=JSON.parse(JSON.stringify(A.defaultValue)));break}case"catch":{this.process(A.innerType,l),a.ref=A.innerType;let p;try{p=A.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}d.default=p;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let p=d,h=e._zod.pattern;if(!h)throw new Error("Pattern not found in template literal");p.type="string",p.pattern=h.source;break}case"pipe":{let p=this.io==="input"?A.in._zod.def.type==="transform"?A.out:A.in:A.out;this.process(p,l),a.ref=p;break}case"readonly":{this.process(A.innerType,l),a.ref=A.innerType,d.readOnly=!0;break}case"promise":{this.process(A.innerType,l),a.ref=A.innerType;break}case"optional":{this.process(A.innerType,l),a.ref=A.innerType;break}case"lazy":{let p=e._zod.innerType;this.process(p,l),a.ref=p;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let u=this.metadataRegistry.get(e);return u&&Object.assign(a.schema,u),this.io==="input"&&rt(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((n=a.schema).default??(n.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,t){let n={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},A=this.seen.get(e);if(!A)throw new Error("Unprocessed schema. This is a bug in Zod.");let s=c=>{let l=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let h=n.external.registry.get(c[0])?.id,g=n.external.uri??(m=>m);if(h)return{ref:g(h)};let w=c[1].defId??c[1].schema.id??`schema${this.counter++}`;return c[1].defId=w,{defId:w,ref:`${g("__shared")}#/${l}/${w}`}}if(c[1]===A)return{ref:"#"};let d=`#/${l}/`,p=c[1].schema.id??`__schema${this.counter++}`;return{defId:p,ref:d+p}},i=c=>{if(c[1].schema.$ref)return;let l=c[1],{ref:f,defId:d}=s(c);l.def={...l.schema},d&&(l.defId=d);let p=l.schema;for(let h in p)delete p[h];p.$ref=f};if(n.cycles==="throw")for(let c of this.seen.entries()){let l=c[1];if(l.cycle)throw new Error(`Cycle detected: #/${l.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let c of this.seen.entries()){let l=c[1];if(e===c[0]){i(c);continue}if(n.external){let d=n.external.registry.get(c[0])?.id;if(e!==c[0]&&d){i(c);continue}}if(this.metadataRegistry.get(c[0])?.id){i(c);continue}if(l.cycle){i(c);continue}if(l.count>1&&n.reused==="ref"){i(c);continue}}let a=(c,l)=>{let f=this.seen.get(c),d=f.def??f.schema,p={...d};if(f.ref===null)return;let h=f.ref;if(f.ref=null,h){a(h,l);let g=this.seen.get(h).schema;g.$ref&&l.target==="draft-7"?(d.allOf=d.allOf??[],d.allOf.push(g)):(Object.assign(d,g),Object.assign(d,p))}f.isParent||this.override({zodSchema:c,jsonSchema:d,path:f.path??[]})};for(let c of[...this.seen.entries()].reverse())a(c[0],{target:this.target});let o={};if(this.target==="draft-2020-12"?o.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?o.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let c=n.external.registry.get(e)?.id;if(!c)throw new Error("Schema is missing an `id` property");o.$id=n.external.uri(c)}Object.assign(o,A.def);let u=n.external?.defs??{};for(let c of this.seen.entries()){let l=c[1];l.def&&l.defId&&(u[l.defId]=l.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?o.$defs=u:o.definitions=u);try{return JSON.parse(JSON.stringify(o))}catch{throw new Error("Error converting schema to JSON.")}}};function Ro(r,e){if(r instanceof Po){let n=new vl(e),A={};for(let a of r._idmap.entries()){let[o,u]=a;n.process(u)}let s={},i={registry:r,uri:e?.uri,defs:A};for(let a of r._idmap.entries()){let[o,u]=a;s[o]=n.emit(u,{...e,external:i})}if(Object.keys(A).length>0){let a=n.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[a]:A}}return{schemas:s}}let t=new vl(e);return t.process(r),t.emit(r,e)}function rt(r,e){let t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);let A=r._zod.def;switch(A.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return rt(A.element,t);case"object":{for(let s in A.shape)if(rt(A.shape[s],t))return!0;return!1}case"union":{for(let s of A.options)if(rt(s,t))return!0;return!1}case"intersection":return rt(A.left,t)||rt(A.right,t);case"tuple":{for(let s of A.items)if(rt(s,t))return!0;return!!(A.rest&&rt(A.rest,t))}case"record":return rt(A.keyType,t)||rt(A.valueType,t);case"map":return rt(A.keyType,t)||rt(A.valueType,t);case"set":return rt(A.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return rt(A.innerType,t);case"lazy":return rt(A.getter(),t);case"default":return rt(A.innerType,t);case"prefault":return rt(A.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return rt(A.in,t)||rt(A.out,t);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${A.type}`)}var Q0=Symbol("Let zodToJsonSchema decide on which parser to use");var F0={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},T0=r=>typeof r=="string"?{...F0,name:r}:{...F0,...r};var O0=r=>{let e=T0(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,A])=>[A._def,{def:A._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function gh(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function _e(r,e,t,n,A){r[e]=t,gh(r,e,n,A)}var Cl=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function ke(r){if(r.target!=="openAi")return{};let e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?Cl(e,r.currentPath):e.join("/")}}function S0(r,e){let t={type:"array"};return r.type?._def&&r.type?._def?.typeName!==b.ZodAny&&(t.items=ne(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&_e(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&_e(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(_e(t,"minItems",r.exactLength.value,r.exactLength.message,e),_e(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function P0(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?_e(t,"minimum",n.value,n.message,e):_e(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),_e(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?_e(t,"maximum",n.value,n.message,e):_e(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),_e(t,"maximum",n.value,n.message,e));break;case"multipleOf":_e(t,"multipleOf",n.value,n.message,e);break}return t}function R0(){return{type:"boolean"}}function El(r,e){return ne(r.type._def,e)}var k0=(r,e)=>ne(r.innerType._def,e);function wh(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((A,s)=>wh(r,e,A))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return a1(r,e)}}var a1=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":_e(t,"minimum",n.value,n.message,e);break;case"max":_e(t,"maximum",n.value,n.message,e);break}return t};function N0(r,e){return{...ne(r.innerType._def,e),default:r.defaultValue()}}function L0(r,e){return e.effectStrategy==="input"?ne(r.schema._def,e):ke(e)}function H0(r){return{type:"string",enum:Array.from(r.values)}}var o1=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function D0(r,e){let t=[ne(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ne(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,A=[];return t.forEach(s=>{if(o1(s))A.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...o}=s;i=o}else n=void 0;A.push(i)}}),A.length?{allOf:A,...n}:void 0}function M0(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var yh,Pr={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(yh===void 0&&(yh=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),yh),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function xl(r,e){let t={type:"string"};if(r.checks)for(let n of r.checks)switch(n.kind){case"min":_e(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":_e(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Rr(t,"email",n.message,e);break;case"format:idn-email":Rr(t,"idn-email",n.message,e);break;case"pattern:zod":Pt(t,Pr.email,n.message,e);break}break;case"url":Rr(t,"uri",n.message,e);break;case"uuid":Rr(t,"uuid",n.message,e);break;case"regex":Pt(t,n.regex,n.message,e);break;case"cuid":Pt(t,Pr.cuid,n.message,e);break;case"cuid2":Pt(t,Pr.cuid2,n.message,e);break;case"startsWith":Pt(t,RegExp(`^${_h(n.value,e)}`),n.message,e);break;case"endsWith":Pt(t,RegExp(`${_h(n.value,e)}$`),n.message,e);break;case"datetime":Rr(t,"date-time",n.message,e);break;case"date":Rr(t,"date",n.message,e);break;case"time":Rr(t,"time",n.message,e);break;case"duration":Rr(t,"duration",n.message,e);break;case"length":_e(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),_e(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Pt(t,RegExp(_h(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&Rr(t,"ipv4",n.message,e),n.version!=="v4"&&Rr(t,"ipv6",n.message,e);break}case"base64url":Pt(t,Pr.base64url,n.message,e);break;case"jwt":Pt(t,Pr.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Pt(t,Pr.ipv4Cidr,n.message,e),n.version!=="v4"&&Pt(t,Pr.ipv6Cidr,n.message,e);break}case"emoji":Pt(t,Pr.emoji(),n.message,e);break;case"ulid":{Pt(t,Pr.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Rr(t,"binary",n.message,e);break}case"contentEncoding:base64":{_e(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Pt(t,Pr.base64,n.message,e);break}}break}case"nanoid":Pt(t,Pr.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function _h(r,e){return e.patternStrategy==="escape"?c1(r):r}var u1=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function c1(r){let e="";for(let t=0;t<r.length;t++)u1.has(r[t])||(e+="\\"),e+=r[t];return e}function Rr(r,e,t,n){r.format||r.anyOf?.some(A=>A.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):_e(r,"format",e,t,n)}function Pt(r,e,t,n){r.pattern||r.allOf?.some(A=>A.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:$0(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):_e(r,"pattern",$0(e,n),t,n)}function $0(r,e){if(!e.applyRegexFlags||!r.flags)return r.source;let t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source,A="",s=!1,i=!1,a=!1;for(let o=0;o<n.length;o++){if(s){A+=n[o],s=!1;continue}if(t.i){if(i){if(n[o].match(/[a-z]/)){a?(A+=n[o],A+=`${n[o-2]}-${n[o]}`.toUpperCase(),a=!1):n[o+1]==="-"&&n[o+2]?.match(/[a-z]/)?(A+=n[o],a=!0):A+=`${n[o]}${n[o].toUpperCase()}`;continue}}else if(n[o].match(/[a-z]/)){A+=`[${n[o]}${n[o].toUpperCase()}]`;continue}}if(t.m){if(n[o]==="^"){A+=`(^|(?<=[\r
]))`;continue}else if(n[o]==="$"){A+=`($|(?=[\r
]))`;continue}}if(t.s&&n[o]==="."){A+=i?`${n[o]}\r
`:`[${n[o]}\r
]`;continue}A+=n[o],n[o]==="\\"?s=!0:i&&n[o]==="]"?i=!1:!i&&n[o]==="["&&(i=!0)}try{new RegExp(A)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return A}function Il(r,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&r.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((n,A)=>({...n,[A]:ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",A]})??ke(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===b.ZodString&&r.keyType._def.checks?.length){let{type:n,...A}=xl(r.keyType._def,e);return{...t,propertyNames:A}}else{if(r.keyType?._def.typeName===b.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(r.keyType?._def.typeName===b.ZodBranded&&r.keyType._def.type._def.typeName===b.ZodString&&r.keyType._def.type._def.checks?.length){let{type:n,...A}=El(r.keyType._def,e);return{...t,propertyNames:A}}}return t}function j0(r,e){if(e.mapStrategy==="record")return Il(r,e);let t=ne(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ke(e),n=ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ke(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function K0(r){let e=r.values,n=Object.keys(r.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),A=Array.from(new Set(n.map(s=>typeof s)));return{type:A.length===1?A[0]==="string"?"string":"number":["string","number"],enum:n}}function z0(r){return r.target==="openAi"?void 0:{not:ke({...r,currentPath:[...r.currentPath,"not"]})}}function G0(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var ko={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Z0(r,e){if(e.target==="openApi3")return V0(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in ko&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((A,s)=>{let i=ko[s._def.typeName];return i&&!A.includes(i)?[...A,i]:A},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((A,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...A,i];case"bigint":return[...A,"integer"];case"object":if(s._def.value===null)return[...A,"null"];case"symbol":case"undefined":case"function":default:return A}},[]);if(n.length===t.length){let A=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:A.length>1?A:A[0],enum:t.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,A)=>[...n,...A._def.values.filter(s=>!n.includes(s))],[])};return V0(r,e)}var V0=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,A)=>ne(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${A}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function J0(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:ko[r.innerType._def.typeName],nullable:!0}:{type:[ko[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=ne(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=ne(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function W0(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",gh(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?_e(t,"minimum",n.value,n.message,e):_e(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),_e(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?_e(t,"maximum",n.value,n.message,e):_e(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),_e(t,"maximum",n.value,n.message,e));break;case"multipleOf":_e(t,"multipleOf",n.value,n.message,e);break}return t}function q0(r,e){let t=e.target==="openAi",n={type:"object",properties:{}},A=[],s=r.shape();for(let a in s){let o=s[a];if(o===void 0||o._def===void 0)continue;let u=f1(o);u&&t&&(o._def.typeName==="ZodOptional"&&(o=o._def.innerType),o.isNullable()||(o=o.nullable()),u=!1);let c=ne(o._def,{...e,currentPath:[...e.currentPath,"properties",a],propertyPath:[...e.currentPath,"properties",a]});c!==void 0&&(n.properties[a]=c,u||A.push(a))}A.length&&(n.required=A);let i=l1(r,e);return i!==void 0&&(n.additionalProperties=i),n}function l1(r,e){if(r.catchall._def.typeName!=="ZodNever")return ne(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function f1(r){try{return r.isOptional()}catch{return!0}}var X0=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return ne(r.innerType._def,e);let t=ne(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:ke(e)},t]}:ke(e)};var Y0=(r,e)=>{if(e.pipeStrategy==="input")return ne(r.in._def,e);if(e.pipeStrategy==="output")return ne(r.out._def,e);let t=ne(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=ne(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(A=>A!==void 0)}};function ev(r,e){return ne(r.type._def,e)}function tv(r,e){let n={type:"array",uniqueItems:!0,items:ne(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&_e(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&_e(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function rv(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>ne(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:ne(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>ne(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function nv(r){return{not:ke(r)}}function Av(r){return ke(r)}var sv=(r,e)=>ne(r.innerType._def,e);var iv=(r,e,t)=>{switch(e){case b.ZodString:return xl(r,t);case b.ZodNumber:return W0(r,t);case b.ZodObject:return q0(r,t);case b.ZodBigInt:return P0(r,t);case b.ZodBoolean:return R0();case b.ZodDate:return wh(r,t);case b.ZodUndefined:return nv(t);case b.ZodNull:return G0(t);case b.ZodArray:return S0(r,t);case b.ZodUnion:case b.ZodDiscriminatedUnion:return Z0(r,t);case b.ZodIntersection:return D0(r,t);case b.ZodTuple:return rv(r,t);case b.ZodRecord:return Il(r,t);case b.ZodLiteral:return M0(r,t);case b.ZodEnum:return H0(r);case b.ZodNativeEnum:return K0(r);case b.ZodNullable:return J0(r,t);case b.ZodOptional:return X0(r,t);case b.ZodMap:return j0(r,t);case b.ZodSet:return tv(r,t);case b.ZodLazy:return()=>r.getter()._def;case b.ZodPromise:return ev(r,t);case b.ZodNaN:case b.ZodNever:return z0(t);case b.ZodEffects:return L0(r,t);case b.ZodAny:return ke(t);case b.ZodUnknown:return Av(t);case b.ZodDefault:return N0(r,t);case b.ZodBranded:return El(r,t);case b.ZodReadonly:return sv(r,t);case b.ZodCatch:return k0(r,t);case b.ZodPipeline:return Y0(r,t);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(n=>{})(e)}};function ne(r,e,t=!1){let n=e.seen.get(r);if(e.override){let a=e.override?.(r,e,n,t);if(a!==Q0)return a}if(n&&!t){let a=d1(n,e);if(a!==void 0)return a}let A={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,A);let s=iv(r,r.typeName,e),i=typeof s=="function"?ne(s(),e):s;if(i&&p1(r,e,i),e.postProcess){let a=e.postProcess(i,r,e);return A.jsonSchema=i,a}return A.jsonSchema=i,i}var d1=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:Cl(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ke(e)):e.$refStrategy==="seen"?ke(e):void 0}},p1=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var bh=(r,e)=>{let t=O0(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((o,[u,c])=>({...o,[u]:ne(c._def,{...t,currentPath:[...t.basePath,t.definitionPath,u]},!0)??ke(t)}),{}):void 0,A=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=ne(r._def,A===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,A]},!1)??ke(t),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let a=A===void 0?n?{...s,[t.definitionPath]:n}:s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,A].join("/"),[t.definitionPath]:{...n,[A]:s}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function Dn(r,e){let t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;let n=r.length;if(n!==e.length)return!1;for(let A=0;A<n;A++)if(!Dn(r[A],e[A]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;let n=Object.keys(r),A=Object.keys(e);if(n.length!==A.length)return!1;for(let i of n)if(!Dn(r[i],e[i]))return!1;return!0}return r===e}function tr(r){return encodeURI(h1(r))}function h1(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}var m1={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},g1={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},w1={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},y1=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function UA(r,e=Object.create(null),t=y1,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){let s=r.$id||r.id;if(s){let i=new URL(s,t.href);i.hash.length>1?e[i.href]=r:(i.hash="",n===""?t=i:UA(r,e,t))}}else if(r!==!0&&r!==!1)return e;let A=t.href+(n?"#"+n:"");if(e[A]!==void 0)throw new Error(`Duplicate schema URI "${A}".`);if(e[A]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:A}),r.$ref&&r.__absolute_ref__===void 0){let s=new URL(r.$ref,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:s.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){let s=new URL(r.$recursiveRef,t.href);s.hash=s.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:s.href})}if(r.$anchor){let s=new URL("#"+r.$anchor,t.href);e[s.href]=r}for(let s in r){if(w1[s])continue;let i=`${n}/${tr(s)}`,a=r[s];if(Array.isArray(a)){if(m1[s]){let o=a.length;for(let u=0;u<o;u++)UA(a[u],e,t,`${i}/${u}`)}}else if(g1[s])for(let o in a)UA(a[o],e,t,`${i}/${tr(o)}`);else UA(a,e,t,i)}return e}var _1=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,b1=[0,31,28,31,30,31,30,31,31,30,31,30,31],B1=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,v1=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,C1=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,E1=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,x1=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,I1=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,U1=/^(?:\/(?:[^~/]|~0|~1)*)*$/,F1=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Q1=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,T1=r=>{if(r[0]==='"')return!1;let[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(A=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(A))},O1=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,S1=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,P1=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function ln(r){return r.test.bind(r)}var Bh={date:av,time:ov.bind(void 0,!1),"date-time":N1,duration:P1,uri:D1,"uri-reference":ln(C1),"uri-template":ln(E1),url:ln(x1),email:T1,hostname:ln(v1),ipv4:ln(O1),ipv6:ln(S1),regex:$1,uuid:ln(I1),"json-pointer":ln(U1),"json-pointer-uri-fragment":ln(F1),"relative-json-pointer":ln(Q1)};function R1(r){return r%4===0&&(r%100!==0||r%400===0)}function av(r){let e=r.match(_1);if(!e)return!1;let t=+e[1],n=+e[2],A=+e[3];return n>=1&&n<=12&&A>=1&&A<=(n==2&&R1(t)?29:b1[n])}function ov(r,e){let t=e.match(B1);if(!t)return!1;let n=+t[1],A=+t[2],s=+t[3],i=!!t[5];return(n<=23&&A<=59&&s<=59||n==23&&A==59&&s==60)&&(!r||i)}var k1=/t|\s/i;function N1(r){let e=r.split(k1);return e.length==2&&av(e[0])&&ov(!0,e[1])}var L1=/\/|:/,H1=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function D1(r){return L1.test(r)&&H1.test(r)}var M1=/[^\\]\\Z/;function $1(r){if(M1.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}var uv;(function(r){r[r.Flag=1]="Flag",r[r.Basic=2]="Basic",r[r.Detailed=4]="Detailed"})(uv||(uv={}));function cv(r){let e=0,t=r.length,n=0,A;for(;n<t;)e++,A=r.charCodeAt(n++),A>=55296&&A<=56319&&n<t&&(A=r.charCodeAt(n),(A&64512)==56320&&n++);return e}function Se(r,e,t="2019-09",n=UA(e),A=!0,s=null,i="#",a="#",o=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:i,keyword:"false",keywordLocation:i,error:"False boolean schema."}]};let u=typeof r,c;switch(u){case"boolean":case"number":case"string":c=u;break;case"object":r===null?c="null":Array.isArray(r)?c="array":c="object";break;default:throw new Error(`Instances of "${u}" type are not supported.`)}let{$ref:l,$recursiveRef:f,$recursiveAnchor:d,type:p,const:h,enum:g,required:w,not:m,anyOf:_,allOf:B,oneOf:C,if:v,then:x,else:Q,format:F,properties:z,patternProperties:ee,additionalProperties:ve,unevaluatedProperties:G,minProperties:fe,maxProperties:Ie,propertyNames:Ce,dependentRequired:Ee,dependentSchemas:Pe,dependencies:xe,prefixItems:j,items:X,additionalItems:K,unevaluatedItems:J,contains:Be,minContains:ge,maxContains:Ne,minItems:Ar,maxItems:TA,uniqueItems:Yl,minimum:qe,maximum:Gt,exclusiveMinimum:Br,exclusiveMaximum:sr,multipleOf:hn,minLength:vr,maxLength:OA,pattern:Cr,__absolute_ref__:mn,__absolute_recursive_ref__:bC}=e,H=[];if(d===!0&&s===null&&(s=e),f==="#"){let se=s===null?n[bC]:s,Y=`${a}/$recursiveRef`,oe=Se(r,s===null?e:s,t,n,A,se,i,Y,o);oe.valid||H.push({instanceLocation:i,keyword:"$recursiveRef",keywordLocation:Y,error:"A subschema had errors."},...oe.errors)}if(l!==void 0){let Y=n[mn||l];if(Y===void 0){let O=`Unresolved $ref "${l}".`;throw mn&&mn!==l&&(O+=`  Absolute URI "${mn}".`),O+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(O)}let oe=`${a}/$ref`,M=Se(r,Y,t,n,A,s,i,oe,o);if(M.valid||H.push({instanceLocation:i,keyword:"$ref",keywordLocation:oe,error:"A subschema had errors."},...M.errors),t==="4"||t==="7")return{valid:H.length===0,errors:H}}if(Array.isArray(p)){let se=p.length,Y=!1;for(let oe=0;oe<se;oe++)if(c===p[oe]||p[oe]==="integer"&&c==="number"&&r%1===0&&r===r){Y=!0;break}Y||H.push({instanceLocation:i,keyword:"type",keywordLocation:`${a}/type`,error:`Instance type "${c}" is invalid. Expected "${p.join('", "')}".`})}else p==="integer"?(c!=="number"||r%1||r!==r)&&H.push({instanceLocation:i,keyword:"type",keywordLocation:`${a}/type`,error:`Instance type "${c}" is invalid. Expected "${p}".`}):p!==void 0&&c!==p&&H.push({instanceLocation:i,keyword:"type",keywordLocation:`${a}/type`,error:`Instance type "${c}" is invalid. Expected "${p}".`});if(h!==void 0&&(c==="object"||c==="array"?Dn(r,h)||H.push({instanceLocation:i,keyword:"const",keywordLocation:`${a}/const`,error:`Instance does not match ${JSON.stringify(h)}.`}):r!==h&&H.push({instanceLocation:i,keyword:"const",keywordLocation:`${a}/const`,error:`Instance does not match ${JSON.stringify(h)}.`})),g!==void 0&&(c==="object"||c==="array"?g.some(se=>Dn(r,se))||H.push({instanceLocation:i,keyword:"enum",keywordLocation:`${a}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(se=>r===se)||H.push({instanceLocation:i,keyword:"enum",keywordLocation:`${a}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),m!==void 0){let se=`${a}/not`;Se(r,m,t,n,A,s,i,se).valid&&H.push({instanceLocation:i,keyword:"not",keywordLocation:se,error:'Instance matched "not" schema.'})}let Wo=[];if(_!==void 0){let se=`${a}/anyOf`,Y=H.length,oe=!1;for(let M=0;M<_.length;M++){let O=_[M],ae=Object.create(o),ie=Se(r,O,t,n,A,d===!0?s:null,i,`${se}/${M}`,ae);H.push(...ie.errors),oe=oe||ie.valid,ie.valid&&Wo.push(ae)}oe?H.length=Y:H.splice(Y,0,{instanceLocation:i,keyword:"anyOf",keywordLocation:se,error:"Instance does not match any subschemas."})}if(B!==void 0){let se=`${a}/allOf`,Y=H.length,oe=!0;for(let M=0;M<B.length;M++){let O=B[M],ae=Object.create(o),ie=Se(r,O,t,n,A,d===!0?s:null,i,`${se}/${M}`,ae);H.push(...ie.errors),oe=oe&&ie.valid,ie.valid&&Wo.push(ae)}oe?H.length=Y:H.splice(Y,0,{instanceLocation:i,keyword:"allOf",keywordLocation:se,error:"Instance does not match every subschema."})}if(C!==void 0){let se=`${a}/oneOf`,Y=H.length,oe=C.filter((M,O)=>{let ae=Object.create(o),ie=Se(r,M,t,n,A,d===!0?s:null,i,`${se}/${O}`,ae);return H.push(...ie.errors),ie.valid&&Wo.push(ae),ie.valid}).length;oe===1?H.length=Y:H.splice(Y,0,{instanceLocation:i,keyword:"oneOf",keywordLocation:se,error:`Instance does not match exactly one subschema (${oe} matches).`})}if((c==="object"||c==="array")&&Object.assign(o,...Wo),v!==void 0){let se=`${a}/if`;if(Se(r,v,t,n,A,s,i,se,o).valid){if(x!==void 0){let oe=Se(r,x,t,n,A,s,i,`${a}/then`,o);oe.valid||H.push({instanceLocation:i,keyword:"if",keywordLocation:se,error:'Instance does not match "then" schema.'},...oe.errors)}}else if(Q!==void 0){let oe=Se(r,Q,t,n,A,s,i,`${a}/else`,o);oe.valid||H.push({instanceLocation:i,keyword:"if",keywordLocation:se,error:'Instance does not match "else" schema.'},...oe.errors)}}if(c==="object"){if(w!==void 0)for(let M of w)M in r||H.push({instanceLocation:i,keyword:"required",keywordLocation:`${a}/required`,error:`Instance does not have required property "${M}".`});let se=Object.keys(r);if(fe!==void 0&&se.length<fe&&H.push({instanceLocation:i,keyword:"minProperties",keywordLocation:`${a}/minProperties`,error:`Instance does not have at least ${fe} properties.`}),Ie!==void 0&&se.length>Ie&&H.push({instanceLocation:i,keyword:"maxProperties",keywordLocation:`${a}/maxProperties`,error:`Instance does not have at least ${Ie} properties.`}),Ce!==void 0){let M=`${a}/propertyNames`;for(let O in r){let ae=`${i}/${tr(O)}`,ie=Se(O,Ce,t,n,A,s,ae,M);ie.valid||H.push({instanceLocation:i,keyword:"propertyNames",keywordLocation:M,error:`Property name "${O}" does not match schema.`},...ie.errors)}}if(Ee!==void 0){let M=`${a}/dependantRequired`;for(let O in Ee)if(O in r){let ae=Ee[O];for(let ie of ae)ie in r||H.push({instanceLocation:i,keyword:"dependentRequired",keywordLocation:M,error:`Instance has "${O}" but does not have "${ie}".`})}}if(Pe!==void 0)for(let M in Pe){let O=`${a}/dependentSchemas`;if(M in r){let ae=Se(r,Pe[M],t,n,A,s,i,`${O}/${tr(M)}`,o);ae.valid||H.push({instanceLocation:i,keyword:"dependentSchemas",keywordLocation:O,error:`Instance has "${M}" but does not match dependant schema.`},...ae.errors)}}if(xe!==void 0){let M=`${a}/dependencies`;for(let O in xe)if(O in r){let ae=xe[O];if(Array.isArray(ae))for(let ie of ae)ie in r||H.push({instanceLocation:i,keyword:"dependencies",keywordLocation:M,error:`Instance has "${O}" but does not have "${ie}".`});else{let ie=Se(r,ae,t,n,A,s,i,`${M}/${tr(O)}`);ie.valid||H.push({instanceLocation:i,keyword:"dependencies",keywordLocation:M,error:`Instance has "${O}" but does not match dependant schema.`},...ie.errors)}}}let Y=Object.create(null),oe=!1;if(z!==void 0){let M=`${a}/properties`;for(let O in z){if(!(O in r))continue;let ae=`${i}/${tr(O)}`,ie=Se(r[O],z[O],t,n,A,s,ae,`${M}/${tr(O)}`);if(ie.valid)o[O]=Y[O]=!0;else if(oe=A,H.push({instanceLocation:i,keyword:"properties",keywordLocation:M,error:`Property "${O}" does not match schema.`},...ie.errors),oe)break}}if(!oe&&ee!==void 0){let M=`${a}/patternProperties`;for(let O in ee){let ae=new RegExp(O,"u"),ie=ee[O];for(let Rt in r){if(!ae.test(Rt))continue;let Xh=`${i}/${tr(Rt)}`,Yh=Se(r[Rt],ie,t,n,A,s,Xh,`${M}/${tr(O)}`);Yh.valid?o[Rt]=Y[Rt]=!0:(oe=A,H.push({instanceLocation:i,keyword:"patternProperties",keywordLocation:M,error:`Property "${Rt}" matches pattern "${O}" but does not match associated schema.`},...Yh.errors))}}}if(!oe&&ve!==void 0){let M=`${a}/additionalProperties`;for(let O in r){if(Y[O])continue;let ae=`${i}/${tr(O)}`,ie=Se(r[O],ve,t,n,A,s,ae,M);ie.valid?o[O]=!0:(oe=A,H.push({instanceLocation:i,keyword:"additionalProperties",keywordLocation:M,error:`Property "${O}" does not match additional properties schema.`},...ie.errors))}}else if(!oe&&G!==void 0){let M=`${a}/unevaluatedProperties`;for(let O in r)if(!o[O]){let ae=`${i}/${tr(O)}`,ie=Se(r[O],G,t,n,A,s,ae,M);ie.valid?o[O]=!0:H.push({instanceLocation:i,keyword:"unevaluatedProperties",keywordLocation:M,error:`Property "${O}" does not match unevaluated properties schema.`},...ie.errors)}}}else if(c==="array"){TA!==void 0&&r.length>TA&&H.push({instanceLocation:i,keyword:"maxItems",keywordLocation:`${a}/maxItems`,error:`Array has too many items (${r.length} > ${TA}).`}),Ar!==void 0&&r.length<Ar&&H.push({instanceLocation:i,keyword:"minItems",keywordLocation:`${a}/minItems`,error:`Array has too few items (${r.length} < ${Ar}).`});let se=r.length,Y=0,oe=!1;if(j!==void 0){let M=`${a}/prefixItems`,O=Math.min(j.length,se);for(;Y<O;Y++){let ae=Se(r[Y],j[Y],t,n,A,s,`${i}/${Y}`,`${M}/${Y}`);if(o[Y]=!0,!ae.valid&&(oe=A,H.push({instanceLocation:i,keyword:"prefixItems",keywordLocation:M,error:"Items did not match schema."},...ae.errors),oe))break}}if(X!==void 0){let M=`${a}/items`;if(Array.isArray(X)){let O=Math.min(X.length,se);for(;Y<O;Y++){let ae=Se(r[Y],X[Y],t,n,A,s,`${i}/${Y}`,`${M}/${Y}`);if(o[Y]=!0,!ae.valid&&(oe=A,H.push({instanceLocation:i,keyword:"items",keywordLocation:M,error:"Items did not match schema."},...ae.errors),oe))break}}else for(;Y<se;Y++){let O=Se(r[Y],X,t,n,A,s,`${i}/${Y}`,M);if(o[Y]=!0,!O.valid&&(oe=A,H.push({instanceLocation:i,keyword:"items",keywordLocation:M,error:"Items did not match schema."},...O.errors),oe))break}if(!oe&&K!==void 0){let O=`${a}/additionalItems`;for(;Y<se;Y++){let ae=Se(r[Y],K,t,n,A,s,`${i}/${Y}`,O);o[Y]=!0,ae.valid||(oe=A,H.push({instanceLocation:i,keyword:"additionalItems",keywordLocation:O,error:"Items did not match additional items schema."},...ae.errors))}}}if(Be!==void 0)if(se===0&&ge===void 0)H.push({instanceLocation:i,keyword:"contains",keywordLocation:`${a}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(ge!==void 0&&se<ge)H.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${a}/minContains`,error:`Array has less items (${se}) than minContains (${ge}).`});else{let M=`${a}/contains`,O=H.length,ae=0;for(let ie=0;ie<se;ie++){let Rt=Se(r[ie],Be,t,n,A,s,`${i}/${ie}`,M);Rt.valid?(o[ie]=!0,ae++):H.push(...Rt.errors)}ae>=(ge||0)&&(H.length=O),ge===void 0&&Ne===void 0&&ae===0?H.splice(O,0,{instanceLocation:i,keyword:"contains",keywordLocation:M,error:"Array does not contain item matching schema."}):ge!==void 0&&ae<ge?H.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${a}/minContains`,error:`Array must contain at least ${ge} items matching schema. Only ${ae} items were found.`}):Ne!==void 0&&ae>Ne&&H.push({instanceLocation:i,keyword:"maxContains",keywordLocation:`${a}/maxContains`,error:`Array may contain at most ${Ne} items matching schema. ${ae} items were found.`})}if(!oe&&J!==void 0){let M=`${a}/unevaluatedItems`;for(Y;Y<se;Y++){if(o[Y])continue;let O=Se(r[Y],J,t,n,A,s,`${i}/${Y}`,M);o[Y]=!0,O.valid||H.push({instanceLocation:i,keyword:"unevaluatedItems",keywordLocation:M,error:"Items did not match unevaluated items schema."},...O.errors)}}if(Yl)for(let M=0;M<se;M++){let O=r[M],ae=typeof O=="object"&&O!==null;for(let ie=0;ie<se;ie++){if(M===ie)continue;let Rt=r[ie];(O===Rt||ae&&(typeof Rt=="object"&&Rt!==null)&&Dn(O,Rt))&&(H.push({instanceLocation:i,keyword:"uniqueItems",keywordLocation:`${a}/uniqueItems`,error:`Duplicate items at indexes ${M} and ${ie}.`}),M=Number.MAX_SAFE_INTEGER,ie=Number.MAX_SAFE_INTEGER)}}}else if(c==="number"){if(t==="4"?(qe!==void 0&&(Br===!0&&r<=qe||r<qe)&&H.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${a}/minimum`,error:`${r} is less than ${Br?"or equal to ":""} ${qe}.`}),Gt!==void 0&&(sr===!0&&r>=Gt||r>Gt)&&H.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${a}/maximum`,error:`${r} is greater than ${sr?"or equal to ":""} ${Gt}.`})):(qe!==void 0&&r<qe&&H.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${a}/minimum`,error:`${r} is less than ${qe}.`}),Gt!==void 0&&r>Gt&&H.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${a}/maximum`,error:`${r} is greater than ${Gt}.`}),Br!==void 0&&r<=Br&&H.push({instanceLocation:i,keyword:"exclusiveMinimum",keywordLocation:`${a}/exclusiveMinimum`,error:`${r} is less than ${Br}.`}),sr!==void 0&&r>=sr&&H.push({instanceLocation:i,keyword:"exclusiveMaximum",keywordLocation:`${a}/exclusiveMaximum`,error:`${r} is greater than or equal to ${sr}.`})),hn!==void 0){let se=r%hn;Math.abs(0-se)>=11920929e-14&&Math.abs(hn-se)>=11920929e-14&&H.push({instanceLocation:i,keyword:"multipleOf",keywordLocation:`${a}/multipleOf`,error:`${r} is not a multiple of ${hn}.`})}}else if(c==="string"){let se=vr===void 0&&OA===void 0?0:cv(r);vr!==void 0&&se<vr&&H.push({instanceLocation:i,keyword:"minLength",keywordLocation:`${a}/minLength`,error:`String is too short (${se} < ${vr}).`}),OA!==void 0&&se>OA&&H.push({instanceLocation:i,keyword:"maxLength",keywordLocation:`${a}/maxLength`,error:`String is too long (${se} > ${OA}).`}),Cr!==void 0&&!new RegExp(Cr,"u").test(r)&&H.push({instanceLocation:i,keyword:"pattern",keywordLocation:`${a}/pattern`,error:"String does not match pattern."}),F!==void 0&&Bh[F]&&!Bh[F](r)&&H.push({instanceLocation:i,keyword:"format",keywordLocation:`${a}/format`,error:`String does not match format "${F}".`})}return{valid:H.length===0,errors:H}}function rr(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_zod"in e))return!1;let t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function _r(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_def"in e)||"_zod"in e)return!1;let t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function nr(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(rr(r)||_r(r))}async function lv(r,e){if(rr(r))try{return{success:!0,data:await v0(r,e)}}catch(t){return{success:!1,error:t}}if(_r(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function sa(r,e){if(rr(r))return Bl(r,e);if(_r(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Ps(r){if(rr(r))return cn.get(r)?.description;if(_r(r)||"description"in r&&typeof r.description=="string")return r.description}function vh(r){return nr(r)?_r(r)?r._def.typeName==="ZodString":rr(r)?r._zod.def.type==="string":!1:!1}function Aa(r){return rr(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function fv(r){return rr(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function Ul(r,e=!1){if(_r(r))return r.strict();if(Aa(r)){let t=r._zod.def.shape;if(e)for(let[s,i]of Object.entries(r._zod.def.shape)){if(Aa(i)){let o=Ul(i,e);t[s]=o}else if(fv(i)){let o=i._zod.def.element;Aa(o)&&(o=Ul(o,e)),t[s]=ta(i,{...i._zod.def,element:o})}else t[s]=i;let a=cn.get(i);a&&cn.add(t[s],a)}let n=ta(r,{...r._zod.def,shape:t,catchall:U0(I0)}),A=cn.get(r);return A&&cn.add(n,A),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function j1(r){return _r(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function K1(r){return rr(r)&&r._zod.def.type==="pipe"}function na(r,e=!1){if(_r(r))return j1(r)?na(r._def.schema,e):r;if(rr(r)){let t=r;if(K1(r)&&(t=na(r._zod.def.in,e)),e){if(Aa(t)){let A=t._zod.def.shape;for(let[s,i]of Object.entries(t._zod.def.shape))A[s]=na(i,e);t=ta(t,{...t._zod.def,shape:A})}else if(fv(t)){let A=na(t._zod.def.element,e);t=ta(t,{...t._zod.def,element:A})}}let n=cn.get(r);return n&&cn.add(t,n),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function zt(r){if(rr(r)){let e=na(r,!0);if(Aa(e)){let t=Ul(e,!0);return Ro(t)}else return Ro(r)}return _r(r)?bh(r):r}function z1(r,e){if(r!==void 0&&!vA(r))return r;if(To(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function G1(r){return To(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...zt(r.data.schema),title:r.data.name}}}var No=class r{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=vA(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...G1(t)})),edges:this.edges.map(t=>{let n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let A=t??De(),s={id:A,data:e,name:z1(t,e),metadata:n};return this.nodes[A]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,A){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:n,conditional:A};return this.edges.push(s),s}firstNode(){return dv(this)}lastNode(){return pv(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(u=>u.id).every(vA)&&(n="");let s=u=>n?`${n}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[s(u)]={...c,id:s(u)}});let i=e.edges.map(u=>({...u,source:s(u.source),target:s(u.target)}));this.edges=[...this.edges,...i];let a=e.firstNode(),o=e.lastNode();return[a?{id:s(a.id),data:a.data}:void 0,o?{id:s(o.id),data:o.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&dv(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&pv(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(A=>[A.id,A.name])),t=new Map;Object.values(e).forEach(A=>{t.set(A,(t.get(A)||0)+1)});let n=A=>{let s=e[A];return vA(A)&&t.get(s)===1?s:A};return new r({nodes:Object.fromEntries(Object.entries(this.nodes).map(([A,s])=>[n(A),{...s,id:n(A)}])),edges:this.edges.map(A=>({...A,source:n(A.source),target:n(A.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:n,nodeColors:A={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:s}=e??{},i=this.reid(),a=i.firstNode(),o=i.lastNode();return h0(i.nodes,i.edges,{firstNode:a?.id,lastNode:o?.id,withStyles:t,curveStyle:n,nodeColors:A,wrapLabelNWords:s})}async drawMermaidPng(e){let t=this.drawMermaid(e);return m0(t,{backgroundColor:e?.backgroundColor})}};function dv(r,e=[]){let t=new Set(r.edges.filter(A=>!e.includes(A.source)).map(A=>A.target)),n=[];for(let A of Object.values(r.nodes))!e.includes(A.id)&&!t.has(A.id)&&n.push(A);return n.length===1?n[0]:void 0}function pv(r,e=[]){let t=new Set(r.edges.filter(A=>!e.includes(A.target)).map(A=>A.source)),n=[];for(let A of Object.values(r.nodes))!e.includes(A.id)&&!t.has(A.id)&&n.push(A);return n.length===1?n[0]:void 0}function hv(r){let e=new TextEncoder,t=new ReadableStream({async start(n){for await(let A of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(A)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return vt.fromReadableStream(t)}function Ch(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}var mv=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function Fl(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*Eh(r,e){for(;;){let{value:t,done:n}=St.runWithConfig(yr(r),e.next.bind(e),!0);if(n)break;yield t}}async function*Ql(r,e){let t=e[Symbol.asyncIterator]();for(;;){let{value:n,done:A}=await St.runWithConfig(yr(r),t.next.bind(e),!0);if(A)break;yield n}}function nt(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var Qe=class extends Fr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new $n({bound:this,kwargs:e,config:{}})}map(){return new Tl({bound:this})}withRetry(e){return new Lo({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new $n({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new Ol({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ye);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([A])=>A!=="runId"));return Array.from({length:t},(A,s)=>ye(s===0?e:n))}return Array.from({length:t},()=>ye(e))}async batch(e,t,n){let A=this._getOptionsList(t??{},e.length),s=A[0]?.maxConcurrency??n?.maxConcurrency,i=new Hn({maxConcurrency:s,onFailedAttempt:o=>{throw o}}),a=e.map((o,u)=>i.call(async()=>{try{return await this.invoke(o,A[u])}catch(c){if(n?.returnExceptions)return c;throw c}}));return Promise.all(a)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let n=ye(t),A=new kn({generator:this._streamIterator(e,n),config:n});return await A.setup,vt.fromAsyncGenerator(A)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ye(e):t=ye({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){let A=ye(n),i=await(await Kt(A))?.handleChainStart(this.toJSON(),nt(t,"input"),A.runId,A?.runType,void 0,void 0,A?.runName??this.getName());delete A.runId;let a;try{let o=e.call(this,t,A,i);a=await on(o,n?.signal)}catch(o){throw await i?.handleChainError(o),o}return await i?.handleChainEnd(nt(a,"output")),a}async _batchWithConfig(e,t,n,A){let s=this._getOptionsList(n??{},t.length),i=await Promise.all(s.map(Kt)),a=await Promise.all(i.map(async(u,c)=>{let l=await u?.handleChainStart(this.toJSON(),nt(t[c],"input"),s[c].runId,s[c].runType,void 0,void 0,s[c].runName??this.getName());return delete s[c].runId,l})),o;try{let u=e.call(this,t,s,a,A);o=await on(u,s?.[0]?.signal)}catch(u){throw await Promise.all(a.map(c=>c?.handleChainError(u))),u}return await Promise.all(a.map(u=>u?.handleChainEnd(nt(o,"output")))),o}_concatOutputChunks(e,t){return Nn(e,t)}async*_transformStreamWithConfig(e,t,n){let A,s=!0,i,a=!0,o=ye(n),u=await Kt(o),c=this;async function*l(){for await(let d of e){if(s)if(A===void 0)A=d;else try{A=c._concatOutputChunks(A,d)}catch{A=void 0,s=!1}yield d}}let f;try{let d=await u0(t.bind(this),l(),async()=>u?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName()),n?.signal,o);delete o.runId,f=d.setup;let p=f?.handlers.find(d0),h=d.output;p!==void 0&&f!==void 0&&(h=p.tapOutputIterable(f.runId,h));let g=f?.handlers.find(f0);g!==void 0&&f!==void 0&&(h=g.tapOutputIterable(f.runId,h));for await(let w of h)if(yield w,a)if(i===void 0)i=w;else try{i=this._concatOutputChunks(i,w)}catch{i=void 0,a=!1}}catch(d){throw await f?.handleChainError(d,void 0,void 0,void 0,{inputs:nt(A,"input")}),d}await f?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:nt(A,"input")})}getGraph(e){let t=new No,n=t.addNode({name:`${this.getName()}Input`,schema:Yt.any()}),A=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:Yt.any()});return t.addEdge(n,A),t.addEdge(A,s),t}pipe(e){return new jn({first:this,last:Mn(e)})}pick(e){return this.pipe(new Sl(e))}assign(e){return this.pipe(new ia(new FA({steps:e})))}async*transform(e,t){let n;for await(let A of e)n===void 0?n=A:n=this._concatOutputChunks(n,A);yield*this._streamIterator(n,ye(t))}async*streamLog(e,t,n){let A=new Fo({...n,autoClose:!1,_schemaFormat:"original"}),s=ye(t);yield*this._streamLog(e,A,s)}async*_streamLog(e,t,n){let{callbacks:A}=n;if(A===void 0)n.callbacks=[t];else if(Array.isArray(A))n.callbacks=A.concat([t]);else{let o=A.copy();o.addHandler(t,!0),n.callbacks=o}let s=this.stream(e,n);async function i(){try{let o=await s;for await(let u of o){let c=new Sr({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}let a=i();try{for await(let o of t)yield o}finally{await a}}streamEvents(e,t,n){let A;if(t.version==="v1")A=this._streamEventsV1(e,t,n);else if(t.version==="v2")A=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?hv(A):vt.fromAsyncGenerator(A)}async*_streamEventsV2(e,t,n){let A=new gl({...n,autoClose:!1}),s=ye(t),i=s.runId??De();s.runId=i;let a=s.callbacks;if(a===void 0)s.callbacks=[A];else if(Array.isArray(a))s.callbacks=a.concat(A);else{let p=a.copy();p.addHandler(A,!0),s.callbacks=p}let o=new AbortController,u=this;async function c(){let p,h=null;try{t?.signal?"any"in AbortSignal?p=AbortSignal.any([o.signal,t.signal]):(p=t.signal,h=()=>{o.abort()},t.signal.addEventListener("abort",h,{once:!0})):p=o.signal;let g=await u.stream(e,{...s,signal:p}),w=A.tapOutputIterable(i,g);for await(let m of w)if(o.signal.aborted)break}finally{await A.finish(),p&&h&&p.removeEventListener("abort",h)}}let l=c(),f=!1,d;try{for await(let p of A){if(!f){p.data.input=e,f=!0,d=p.run_id,yield p;continue}p.run_id===d&&p.event.endsWith("_end")&&p.data?.input&&delete p.data.input,yield p}}finally{o.abort(),await l}}async*_streamEventsV1(e,t,n){let A,s=!1,i=ye(t),a=i.tags??[],o=i.metadata??{},u=i.runName??this.getName(),c=new Fo({...n,autoClose:!1,_schemaFormat:"streaming_events"}),l=new yl({...n}),f=this._streamLog(e,c,i);for await(let p of f){if(A?A=A.concat(p):A=Uo.fromRunLogPatch(p),A.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;let m={...A.state},_={run_id:m.id,event:`on_${m.type}_start`,name:u,tags:a,metadata:o,data:{input:e}};l.includeEvent(_,m.type)&&(yield _)}let h=p.ops.filter(m=>m.path.startsWith("/logs/")).map(m=>m.path.split("/")[2]),g=[...new Set(h)];for(let m of g){let _,B={},C=A.state.logs[m];if(C.end_time===void 0?C.streamed_output.length>0?_="stream":_="start":_="end",_==="start")C.inputs!==void 0&&(B.input=C.inputs);else if(_==="end")C.inputs!==void 0&&(B.input=C.inputs),B.output=C.final_output;else if(_==="stream"){let v=C.streamed_output.length;if(v!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${v} instead. Encountered in: "${C.name}"`);B={chunk:C.streamed_output[0]},C.streamed_output=[]}yield{event:`on_${C.type}_${_}`,name:C.name,run_id:C.id,tags:C.tags,metadata:C.metadata,data:B}}let{state:w}=A;if(w.streamed_output.length>0){let m=w.streamed_output.length;if(m!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${m} instead. Encountered in: "${w.name}"`);let _={chunk:w.streamed_output[0]};w.streamed_output=[];let B={event:`on_${w.type}_stream`,run_id:w.id,tags:a,metadata:o,name:u,data:_};l.includeEvent(B,w.type)&&(yield B)}}let d=A?.state;if(d!==void 0){let p={event:`on_${d.type}_end`,name:u,run_id:d.id,tags:a,metadata:o,data:{output:d.final_output}};l.includeEvent(p,d.type)&&(yield p)}}static isRunnable(e){return To(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new $n({bound:this,config:{},configFactories:[A=>({callbacks:[new Qo({config:A,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return Z1(this,e)}},$n=class r extends Qe{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=Xi(this.config,...e);return Xi(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new Lo({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(ye(t),this.kwargs))}async batch(e,t,n){let A=Array.isArray(t)?await Promise.all(t.map(async s=>this._mergeConfig(ye(s),this.kwargs))):await this._mergeConfig(ye(t),this.kwargs);return this.bound.batch(e,A,n)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(ye(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(ye(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(ye(t),this.kwargs))}streamEvents(e,t,n){let A=this,s=async function*(){yield*A.bound.streamEvents(e,{...await A._mergeConfig(ye(t),A.kwargs),version:t.version},n)};return vt.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&Qe.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[A=>({callbacks:[new Qo({config:A,onStart:e,onEnd:t,onError:n})]})]})}},Tl=class r extends Qe{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Ze(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},Lo=class extends $n{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){let A=e>1?`retry:attempt:${e}`:void 0;return Ze(t,{callbacks:n?.getChild(A)})}async _invoke(e,t,n){return(0,xh.default)(A=>super.invoke(e,this._patchConfigForRetry(A,t,n)),{onFailedAttempt:A=>this.onFailedAttempt(A,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,A){let s={};try{await(0,xh.default)(async i=>{let a=e.map((f,d)=>d).filter(f=>s[f.toString()]===void 0||s[f.toString()]instanceof Error),o=a.map(f=>e[f]),u=a.map(f=>this._patchConfigForRetry(i,t?.[f],n?.[f])),c=await super.batch(o,u,{...A,returnExceptions:!0}),l;for(let f=0;f<c.length;f+=1){let d=c[f],p=a[f];d instanceof Error&&l===void 0&&(l=d,l.input=o[f]),s[p.toString()]=d}if(l)throw l;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if(A?.returnExceptions!==!0)throw i}return Object.keys(s).sort((i,a)=>parseInt(i,10)-parseInt(a,10)).map(i=>s[parseInt(i,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},jn=class r extends Qe{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let n=ye(t),s=await(await Kt(n))?.handleChainStart(this.toJSON(),nt(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let i=e,a;try{let o=[this.first,...this.middle];for(let u=0;u<o.length;u+=1){let l=o[u].invoke(i,Ze(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`)}));i=await on(l,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");a=await this.last.invoke(i,Ze(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(o){throw await s?.handleChainError(o),o}return await s?.handleChainEnd(nt(a,"output")),a}async batch(e,t,n){let A=this._getOptionsList(t??{},e.length),s=await Promise.all(A.map(Kt)),i=await Promise.all(s.map(async(o,u)=>{let c=await o?.handleChainStart(this.toJSON(),nt(e[u],"input"),A[u].runId,void 0,void 0,void 0,A[u].runName);return delete A[u].runId,c})),a=e;try{for(let o=0;o<this.steps.length;o+=1){let c=this.steps[o].batch(a,i.map((l,f)=>{let d=l?.getChild(this.omitSequenceTags?void 0:`seq:step:${o+1}`);return Ze(A[f],{callbacks:d})}),n);a=await on(c,A[0]?.signal)}}catch(o){throw await Promise.all(i.map(u=>u?.handleChainError(o))),o}return await Promise.all(i.map(o=>o?.handleChainEnd(nt(a,"output")))),a}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async*_streamIterator(e,t){let n=await Kt(t),{runId:A,...s}=t??{},i=await n?.handleChainStart(this.toJSON(),nt(e,"input"),A,void 0,void 0,void 0,s?.runName),a=[this.first,...this.middle,this.last],o=!0,u;async function*c(){yield e}try{let l=a[0].transform(c(),Ze(s,{callbacks:i?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let f=1;f<a.length;f+=1)l=await a[f].transform(l,Ze(s,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${f+1}`)}));for await(let f of l)if(t?.signal?.throwIfAborted(),yield f,o)if(u===void 0)u=f;else try{u=this._concatOutputChunks(u,f)}catch{u=void 0,o=!1}}catch(l){throw await i?.handleChainError(l),l}await i?.handleChainEnd(nt(u,"output"))}getGraph(e){let t=new No,n=null;return this.steps.forEach((A,s)=>{let i=A.getGraph(e);s!==0&&i.trimFirstNode(),s!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let a=i.firstNode();if(!a)throw new Error(`Runnable ${A} has no first node`);n&&t.addEdge(n,a),n=i.lastNode()}),t}pipe(e){return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:Mn(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Qe.isRunnable(e)}static from([e,...t],n){let A={};return typeof n=="string"?A.name=n:n!==void 0&&(A=n),new r({...A,first:Mn(e),middle:t.slice(0,-1).map(Mn),last:Mn(t[t.length-1])})}},FA=class r extends Qe{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=Mn(n)}static from(e){return new r({steps:e})}async invoke(e,t){let n=ye(t),s=await(await Kt(n))?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let i={};try{let a=Object.entries(this.steps).map(async([o,u])=>{i[o]=await u.invoke(e,Ze(n,{callbacks:s?.getChild(`map:key:${o}`)}))});await on(Promise.all(a),t?.signal)}catch(a){throw await s?.handleChainError(a),a}return await s?.handleChainEnd(i),i}async*_transform(e,t,n){let A={...this.steps},s=fh(e,Object.keys(A).length),i=new Map(Object.entries(A).map(([a,o],u)=>{let c=o.transform(s[u],Ze(n,{callbacks:t?.getChild(`map:key:${a}`)}));return[a,c.next().then(l=>({key:a,gen:c,result:l}))]}));for(;i.size;){let a=Promise.race(i.values()),{key:o,result:u,gen:c}=await on(a,n?.signal);i.delete(o),u.done||(yield{[o]:u.value},i.set(o,c.next().then(l=>({key:o,gen:c,result:l}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let A=ye(t),s=new kn({generator:this.transform(n(),A),config:A});return await s.setup,vt.fromAsyncGenerator(s)}},Ih=class r extends Qe{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Ic(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[n]=this._getOptionsList(t??{},1),A=await Kt(n),s=this.func(Ze(n,{callbacks:A}),e);return on(s,n?.signal)}async*_streamIterator(e,t){let[n]=this._getOptionsList(t??{},1),A=await this.invoke(e,t);if(Fl(A)){for await(let s of A)n?.signal?.throwIfAborted(),yield s;return}if(mv(A)){for(;;){n?.signal?.throwIfAborted();let s=A.next();if(s.done)break;yield s.value}return}yield A}static from(e){return new r({func:e})}};function V1(r){if(Ic(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var kr=class r extends Qe{static lc_name(){return"RunnableLambda"}constructor(e){if(Ic(e.func))return Ih.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),V1(e.func),this.func=e.func}static from(e){return new r({func:e})}async _invoke(e,t,n){return new Promise((A,s)=>{let i=Ze(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??pl)-1});St.runWithConfig(yr(i),async()=>{try{let a=await this.func(e,{...i});if(a&&Qe.isRunnable(a)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");a=await a.invoke(e,{...i,recursionLimit:(i.recursionLimit??pl)-1})}else if(Fl(a)){let o;for await(let u of Ql(i,a))if(t?.signal?.throwIfAborted(),o===void 0)o=u;else try{o=this._concatOutputChunks(o,u)}catch{o=u}a=o}else if(Ch(a)){let o;for(let u of Eh(i,a))if(t?.signal?.throwIfAborted(),o===void 0)o=u;else try{o=this._concatOutputChunks(o,u)}catch{o=u}a=o}A(a)}catch(a){s(a)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){let A;for await(let a of e)if(A===void 0)A=a;else try{A=this._concatOutputChunks(A,a)}catch{A=a}let s=Ze(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??pl)-1}),i=await new Promise((a,o)=>{St.runWithConfig(yr(s),async()=>{try{let u=await this.func(A,{...s,config:s});a(u)}catch(u){o(u)}})});if(i&&Qe.isRunnable(i)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");let a=await i.stream(A,s);for await(let o of a)yield o}else if(Fl(i))for await(let a of Ql(s,i))n?.signal?.throwIfAborted(),yield a;else if(Ch(i))for(let a of Eh(s,i))n?.signal?.throwIfAborted(),yield a;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let A=ye(t),s=new kn({generator:this.transform(n(),A),config:A});return await s.setup,vt.fromAsyncGenerator(s)}};var Ol=class extends Qe{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let n=ye(t),A=await Kt(n),{runId:s,...i}=n,a=await A?.handleChainStart(this.toJSON(),nt(e,"input"),s,void 0,void 0,void 0,i?.runName),o=Ze(i,{callbacks:a?.getChild()});return await St.runWithConfig(o,async()=>{let c;for(let l of this.runnables()){n?.signal?.throwIfAborted();try{let f=await l.invoke(e,o);return await a?.handleChainEnd(nt(f,"output")),f}catch(f){c===void 0&&(c=f)}}throw c===void 0?new Error("No error stored at end of fallback."):(await a?.handleChainError(c),c)})}async*_streamIterator(e,t){let n=ye(t),A=await Kt(n),{runId:s,...i}=n,a=await A?.handleChainStart(this.toJSON(),nt(e,"input"),s,void 0,void 0,void 0,i?.runName),o,u;for(let l of this.runnables()){n?.signal?.throwIfAborted();let f=Ze(i,{callbacks:a?.getChild()});try{let d=await l.stream(e,f);u=Ql(f,d);break}catch(d){o===void 0&&(o=d)}}if(u===void 0){let l=o??new Error("No error stored at end of fallback.");throw await a?.handleChainError(l),l}let c;try{for await(let l of u){yield l;try{c=c===void 0?c:this._concatOutputChunks(c,l)}catch{c=void 0}}}catch(l){throw await a?.handleChainError(l),l}await a?.handleChainEnd(nt(c,"output"))}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");let A=this._getOptionsList(t??{},e.length),s=await Promise.all(A.map(o=>Kt(o))),i=await Promise.all(s.map(async(o,u)=>{let c=await o?.handleChainStart(this.toJSON(),nt(e[u],"input"),A[u].runId,void 0,void 0,void 0,A[u].runName);return delete A[u].runId,c})),a;for(let o of this.runnables()){A[0].signal?.throwIfAborted();try{let u=await o.batch(e,i.map((c,l)=>Ze(A[l],{callbacks:c?.getChild()})),n);return await Promise.all(i.map((c,l)=>c?.handleChainEnd(nt(u[l],"output")))),u}catch(u){a===void 0&&(a=u)}}throw a?(await Promise.all(i.map(o=>o?.handleChainError(a))),a):new Error("No error stored at end of fallbacks.")}};function Mn(r){if(typeof r=="function")return new kr({func:r});if(Qe.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=Mn(n);return new FA({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var ia=class extends Qe{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof FA&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){let A=this.mapper.getStepsKeys(),[s,i]=fh(e),a=this.mapper.transform(i,Ze(n,{callbacks:t?.getChild()})),o=a.next();for await(let u of s){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);let c=Object.fromEntries(Object.entries(u).filter(([l])=>!A.includes(l)));Object.keys(c).length>0&&(yield c)}yield(await o).value;for await(let u of a)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let A=ye(t),s=new kn({generator:this.transform(n(),A),config:A});return await s.setup,vt.fromAsyncGenerator(s)}},Sl=class extends Qe{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let A=ye(t),s=new kn({generator:this.transform(n(),A),config:A});return await s.setup,vt.fromAsyncGenerator(s)}},Ho=class extends $n{constructor(e){let t=jn.from([kr.from(async n=>{let A;if(wA(n))try{A=await sa(this.schema,n.args)}catch{throw new us("Received tool input did not match expected schema",JSON.stringify(n.args))}else A=n;return A}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function Z1(r,e){let t=e.name??r.getName(),n=e.description??Ps(e.schema);return vh(e.schema)?new Ho({name:t,description:n,schema:Yt.object({input:Yt.string()}).transform(A=>A.input),bound:r}):new Ho({name:t,description:n,schema:e.schema,bound:r})}var J1=typeof window=="object"?window:{},he="0123456789abcdef".split(""),W1=[-2147483648,8388608,32768,128],Nr=[24,16,8,0];var at=[];function Lr(r){r?(at[0]=at[16]=at[1]=at[2]=at[3]=at[4]=at[5]=at[6]=at[7]=at[8]=at[9]=at[10]=at[11]=at[12]=at[13]=at[14]=at[15]=0,this.blocks=at):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Lr.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===J1.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,A,s=r.length||0,i=this.blocks;n<s;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(A=this.start;n<s&&A<64;++n)i[A>>2]|=r[n]<<Nr[A++&3];else for(A=this.start;n<s&&A<64;++n)t=r.charCodeAt(n),t<128?i[A>>2]|=t<<Nr[A++&3]:t<2048?(i[A>>2]|=(192|t>>6)<<Nr[A++&3],i[A>>2]|=(128|t&63)<<Nr[A++&3]):t<55296||t>=57344?(i[A>>2]|=(224|t>>12)<<Nr[A++&3],i[A>>2]|=(128|t>>6&63)<<Nr[A++&3],i[A>>2]|=(128|t&63)<<Nr[A++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),i[A>>2]|=(240|t>>18)<<Nr[A++&3],i[A>>2]|=(128|t>>12&63)<<Nr[A++&3],i[A>>2]|=(128|t>>6&63)<<Nr[A++&3],i[A>>2]|=(128|t&63)<<Nr[A++&3]);this.lastByteIndex=A,this.bytes+=A-this.start,A>=64?(this.block=i[16],this.start=A-64,this.hash(),this.hashed=!0):this.start=A}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Lr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=W1[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};Lr.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,A=this.h4,s,i,a,o=this.blocks;for(i=16;i<80;++i)a=o[i-3]^o[i-8]^o[i-14]^o[i-16],o[i]=a<<1|a>>>31;for(i=0;i<20;i+=5)s=e&t|~e&n,a=r<<5|r>>>27,A=a+s+A+1518500249+o[i]<<0,e=e<<30|e>>>2,s=r&e|~r&t,a=A<<5|A>>>27,n=a+s+n+1518500249+o[i+1]<<0,r=r<<30|r>>>2,s=A&r|~A&e,a=n<<5|n>>>27,t=a+s+t+1518500249+o[i+2]<<0,A=A<<30|A>>>2,s=n&A|~n&r,a=t<<5|t>>>27,e=a+s+e+1518500249+o[i+3]<<0,n=n<<30|n>>>2,s=t&n|~t&A,a=e<<5|e>>>27,r=a+s+r+1518500249+o[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)s=e^t^n,a=r<<5|r>>>27,A=a+s+A+1859775393+o[i]<<0,e=e<<30|e>>>2,s=r^e^t,a=A<<5|A>>>27,n=a+s+n+1859775393+o[i+1]<<0,r=r<<30|r>>>2,s=A^r^e,a=n<<5|n>>>27,t=a+s+t+1859775393+o[i+2]<<0,A=A<<30|A>>>2,s=n^A^r,a=t<<5|t>>>27,e=a+s+e+1859775393+o[i+3]<<0,n=n<<30|n>>>2,s=t^n^A,a=e<<5|e>>>27,r=a+s+r+1859775393+o[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)s=e&t|e&n|t&n,a=r<<5|r>>>27,A=a+s+A-1894007588+o[i]<<0,e=e<<30|e>>>2,s=r&e|r&t|e&t,a=A<<5|A>>>27,n=a+s+n-1894007588+o[i+1]<<0,r=r<<30|r>>>2,s=A&r|A&e|r&e,a=n<<5|n>>>27,t=a+s+t-1894007588+o[i+2]<<0,A=A<<30|A>>>2,s=n&A|n&r|A&r,a=t<<5|t>>>27,e=a+s+e-1894007588+o[i+3]<<0,n=n<<30|n>>>2,s=t&n|t&A|n&A,a=e<<5|e>>>27,r=a+s+r-1894007588+o[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)s=e^t^n,a=r<<5|r>>>27,A=a+s+A-899497514+o[i]<<0,e=e<<30|e>>>2,s=r^e^t,a=A<<5|A>>>27,n=a+s+n-899497514+o[i+1]<<0,r=r<<30|r>>>2,s=A^r^e,a=n<<5|n>>>27,t=a+s+t-899497514+o[i+2]<<0,A=A<<30|A>>>2,s=n^A^r,a=t<<5|t>>>27,e=a+s+e-899497514+o[i+3]<<0,n=n<<30|n>>>2,s=t^n^A,a=e<<5|e>>>27,r=a+s+r-899497514+o[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+A<<0};Lr.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,A=this.h4;return he[r>>28&15]+he[r>>24&15]+he[r>>20&15]+he[r>>16&15]+he[r>>12&15]+he[r>>8&15]+he[r>>4&15]+he[r&15]+he[e>>28&15]+he[e>>24&15]+he[e>>20&15]+he[e>>16&15]+he[e>>12&15]+he[e>>8&15]+he[e>>4&15]+he[e&15]+he[t>>28&15]+he[t>>24&15]+he[t>>20&15]+he[t>>16&15]+he[t>>12&15]+he[t>>8&15]+he[t>>4&15]+he[t&15]+he[n>>28&15]+he[n>>24&15]+he[n>>20&15]+he[n>>16&15]+he[n>>12&15]+he[n>>8&15]+he[n>>4&15]+he[n&15]+he[A>>28&15]+he[A>>24&15]+he[A>>20&15]+he[A>>16&15]+he[A>>12&15]+he[A>>8&15]+he[A>>4&15]+he[A&15]};Lr.prototype.toString=Lr.prototype.hex;Lr.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,A=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,A>>24&255,A>>16&255,A>>8&255,A&255]};Lr.prototype.array=Lr.prototype.digest;Lr.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};var gv=!1,Uh=r=>(gv||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","\u2514> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),gv=!0),new Lr(!0).update(r).hex());var $="0123456789abcdef".split(""),q1=[-2147483648,8388608,32768,128],Hr=[24,16,8,0],Pl=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var ot=[];function fn(r,e){e?(ot[0]=ot[16]=ot[1]=ot[2]=ot[3]=ot[4]=ot[5]=ot[6]=ot[7]=ot[8]=ot[9]=ot[10]=ot[11]=ot[12]=ot[13]=ot[14]=ot[15]=0,this.blocks=ot):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=r}fn.prototype.update=function(r){if(!this.finalized){var e,t=typeof r;if(t!=="string"){if(t==="object"){if(r===null)throw new Error(ERROR);if(ARRAY_BUFFER&&r.constructor===ArrayBuffer)r=new Uint8Array(r);else if(!Array.isArray(r)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(r)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var n,A=0,s,i=r.length,a=this.blocks;A<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,this.block=a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;A<i&&s<64;++A)a[s>>>2]|=r[A]<<Hr[s++&3];else for(s=this.start;A<i&&s<64;++A)n=r.charCodeAt(A),n<128?a[s>>>2]|=n<<Hr[s++&3]:n<2048?(a[s>>>2]|=(192|n>>>6)<<Hr[s++&3],a[s>>>2]|=(128|n&63)<<Hr[s++&3]):n<55296||n>=57344?(a[s>>>2]|=(224|n>>>12)<<Hr[s++&3],a[s>>>2]|=(128|n>>>6&63)<<Hr[s++&3],a[s>>>2]|=(128|n&63)<<Hr[s++&3]):(n=65536+((n&1023)<<10|r.charCodeAt(++A)&1023),a[s>>>2]|=(240|n>>>18)<<Hr[s++&3],a[s>>>2]|=(128|n>>>12&63)<<Hr[s++&3],a[s>>>2]|=(128|n>>>6&63)<<Hr[s++&3],a[s>>>2]|=(128|n&63)<<Hr[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};fn.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>>2]|=q1[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};fn.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,A=this.h4,s=this.h5,i=this.h6,a=this.h7,o=this.blocks,u,c,l,f,d,p,h,g,w,m,_;for(u=16;u<64;++u)d=o[u-15],c=(d>>>7|d<<25)^(d>>>18|d<<14)^d>>>3,d=o[u-2],l=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,o[u]=o[u-16]+c+o[u-7]+l<<0;for(_=e&t,u=0;u<64;u+=4)this.first?(this.is224?(g=300032,d=o[0]-1413257819,a=d-150054599<<0,n=d+24177077<<0):(g=704751109,d=o[0]-210244248,a=d-1521486534<<0,n=d+143694565<<0),this.first=!1):(c=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),l=(A>>>6|A<<26)^(A>>>11|A<<21)^(A>>>25|A<<7),g=r&e,f=g^r&t^_,h=A&s^~A&i,d=a+l+h+Pl[u]+o[u],p=c+f,a=n+d<<0,n=d+p<<0),c=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),l=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),w=n&r,f=w^n&e^g,h=i&a^~i&A,d=s+l+h+Pl[u+1]+o[u+1],p=c+f,i=t+d<<0,t=d+p<<0,c=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),l=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),m=t&n,f=m^t&r^w,h=s&i^~s&a,d=A+l+h+Pl[u+2]+o[u+2],p=c+f,s=e+d<<0,e=d+p<<0,c=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),l=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),_=e&t,f=_^e&n^m,h=s&i^~s&a,d=A+l+h+Pl[u+3]+o[u+3],p=c+f,A=r+d<<0,r=d+p<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+A<<0,this.h5=this.h5+s<<0,this.h6=this.h6+i<<0,this.h7=this.h7+a<<0};fn.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,A=this.h4,s=this.h5,i=this.h6,a=this.h7,o=$[r>>>28&15]+$[r>>>24&15]+$[r>>>20&15]+$[r>>>16&15]+$[r>>>12&15]+$[r>>>8&15]+$[r>>>4&15]+$[r&15]+$[e>>>28&15]+$[e>>>24&15]+$[e>>>20&15]+$[e>>>16&15]+$[e>>>12&15]+$[e>>>8&15]+$[e>>>4&15]+$[e&15]+$[t>>>28&15]+$[t>>>24&15]+$[t>>>20&15]+$[t>>>16&15]+$[t>>>12&15]+$[t>>>8&15]+$[t>>>4&15]+$[t&15]+$[n>>>28&15]+$[n>>>24&15]+$[n>>>20&15]+$[n>>>16&15]+$[n>>>12&15]+$[n>>>8&15]+$[n>>>4&15]+$[n&15]+$[A>>>28&15]+$[A>>>24&15]+$[A>>>20&15]+$[A>>>16&15]+$[A>>>12&15]+$[A>>>8&15]+$[A>>>4&15]+$[A&15]+$[s>>>28&15]+$[s>>>24&15]+$[s>>>20&15]+$[s>>>16&15]+$[s>>>12&15]+$[s>>>8&15]+$[s>>>4&15]+$[s&15]+$[i>>>28&15]+$[i>>>24&15]+$[i>>>20&15]+$[i>>>16&15]+$[i>>>12&15]+$[i>>>8&15]+$[i>>>4&15]+$[i&15];return this.is224||(o+=$[a>>>28&15]+$[a>>>24&15]+$[a>>>20&15]+$[a>>>16&15]+$[a>>>12&15]+$[a>>>8&15]+$[a>>>4&15]+$[a&15]),o};fn.prototype.toString=fn.prototype.hex;fn.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,A=this.h4,s=this.h5,i=this.h6,a=this.h7,o=[r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255];return this.is224||o.push(a>>>24&255,a>>>16&255,a>>>8&255,a&255),o};fn.prototype.array=fn.prototype.digest;fn.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(this.is224?28:32),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),r};var X1=(...r)=>Uh(r.join("_"));var Fh=class{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:X1})}makeDefaultKeyEncoder(e){this.keyEncoder=e}},Y1=new Map,Rl=class r extends Fh{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,n){this.cache.set(this.keyEncoder(e,t),n)}static global(){return new r(Y1)}};var kl=class extends Fr{},Nl=class extends kl{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Lt(this.value)]}},Ll=class extends kl{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return oo(this.messages)}toChatMessages(){return this.messages}};var bv=Ct(_v(),1);var aN=Object.defineProperty,oN=(r,e,t)=>e in r?aN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,uN=(r,e,t)=>(oN(r,typeof e!="symbol"?e+"":e,t),t);function cN(r,e){let t=Array.from({length:r.length},(n,A)=>({start:A,end:A+1}));for(;t.length>1;){let n=null;for(let A=0;A<t.length-1;A++){let s=r.slice(t[A].start,t[A+1].end),i=e.get(s.join(","));i!=null&&(n==null||i<n[0])&&(n=[i,A])}if(n!=null){let A=n[1];t[A]={start:t[A].start,end:t[A+1].end},t.splice(A+1,1)}else break}return t}function lN(r,e){return r.length===1?[e.get(r.join(","))]:cN(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function fN(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Th=class{constructor(r,e){gn(this,"specialTokens");gn(this,"inverseSpecialTokens");gn(this,"patStr");gn(this,"textEncoder",new TextEncoder);gn(this,"textDecoder",new TextDecoder("utf-8"));gn(this,"rankMap",new Map);gn(this,"textMap",new Map);this.patStr=r.pat_str;let t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,A)=>{let[s,i,...a]=A.split(" "),o=Number.parseInt(i,10);return a.forEach((u,c)=>n[u]=o+c),n},{});for(let[n,A]of Object.entries(t)){let s=bv.default.toByteArray(n);this.rankMap.set(s.join(","),A),this.textMap.set(A,s)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[A,s])=>(n[s]=this.textEncoder.encode(A),n),{})}encode(r,e=[],t="all"){let n=new RegExp(this.patStr,"ug"),A=Th.specialTokenRegex(Object.keys(this.specialTokens)),s=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),a=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):t);if(a.size>0){let u=Th.specialTokenRegex([...a]),c=r.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let o=0;for(;;){let u=null,c=o;for(;A.lastIndex=c,u=A.exec(r),!(u==null||i.has(u[0]));)c=u.index+1;let l=u?.index??r.length;for(let d of r.substring(o,l).matchAll(n)){let p=this.textEncoder.encode(d[0]),h=this.rankMap.get(p.join(","));if(h!=null){s.push(h);continue}s.push(...lN(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];s.push(f),o=u.index+u[0].length}return s}decode(r){let e=[],t=0;for(let s=0;s<r.length;++s){let i=r[s],a=this.textMap.get(i)??this.inverseSpecialTokens[i];a!=null&&(e.push(a),t+=a.length)}let n=new Uint8Array(t),A=0;for(let s of e)n.set(s,A),A+=s.length;return this.textDecoder.decode(n)}},Dl=Th;uN(Dl,"specialTokenRegex",r=>new RegExp(r.map(e=>fN(e)).join("|"),"g"));function Oh(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var Ml={},dN=new Hn({});async function pN(r){return r in Ml||(Ml[r]=dN.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new Dl(e)).catch(e=>{throw delete Ml[r],e})),await Ml[r]}async function Bv(r){return pN(Oh(r))}var hN=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function Sh(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}var mN=()=>!1,Do=class extends Qe{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??mN(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},Mo=class extends Do{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){let{cache:A,...s}=n;super({callbacks:e??t,...s}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof A=="object"?this.cache=A:A?this.cache=Rl.global():this.cache=void 0,this.caller=new Hn(n??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(A=>typeof A=="string"?A:A.type==="text"&&"text"in A?A.text:"").join("");let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await Bv("modelName"in this?hN(this.modelName):"gpt2")}catch(A){console.warn("Failed to calculate number of tokens, falling back to approximate count",A)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(A){console.warn("Failed to calculate number of tokens, falling back to approximate count",A)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new Nl(e):Array.isArray(e)?new Ll(e.map(cs)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){let n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([i,a])=>a!==void 0).map(([i,a])=>`${i}:${JSON.stringify(a)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};var pn=class extends Qe{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let n=ye(t);return this.func&&await this.func(e,n),this._callWithConfig(A=>Promise.resolve(A),e,n)}async*transform(e,t){let n=ye(t),A,s=!0;for await(let i of this._transformStreamWithConfig(e,a=>a,n))if(yield i,s)if(A===void 0)A=i;else try{A=Nn(A,i)}catch{A=void 0,s=!1}this.func&&A!==void 0&&await this.func(A,n)}static assign(e){return new ia(new FA({steps:e}))}};function Ph(r){let e=[];for(let t of r){let n=t;if(Array.isArray(t.content))for(let A=0;A<t.content.length;A++){let s=t.content[A];(yy(s)||_y(s))&&n===t&&(n=new t.constructor({...n,content:[...t.content.slice(0,A),by(s),...t.content.slice(A+1)]}))}e.push(n)}return e}var $l=class r extends Mo{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){let n=r._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===r.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{let A=r._convertInputToPromptValue(e).toChatMessages(),[s,i]=this._separateRunnableConfigFromCallOptionsCompat(t),a={...s.metadata,...this.getLsParams(i)},o=await pt.configure(s.callbacks,this.callbacks,s.tags,this.tags,a,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this?.invocationParams(i),batch_size:1},c=await o?.handleChatModelStart(this.toJSON(),[Ph(A)],s.runId,void 0,u,void 0,void 0,s.runName),l,f;try{for await(let d of this._streamResponseChunks(A,i,c?.[0])){if(d.message.id==null){let p=c?.at(0)?.runId;p!=null&&d.message._updateId(`run-${p}`)}d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},yield d.message,l?l=l.concat(d):l=d,zd(d.message)&&d.message.usage_metadata!==void 0&&(f={tokenUsage:{promptTokens:d.message.usage_metadata.input_tokens,completionTokens:d.message.usage_metadata.output_tokens,totalTokens:d.message.usage_metadata.total_tokens}})}}catch(d){throw await Promise.all((c??[]).map(p=>p?.handleLLMError(d))),d}await Promise.all((c??[]).map(d=>d?.handleLLMEnd({generations:[[l]],llmOutput:f})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,A){let s=e.map(l=>l.map(cs)),i;if(A!==void 0&&A.length===s.length)i=A;else{let l={...n.metadata,...this.getLsParams(t)},f=await pt.configure(n.callbacks,this.callbacks,n.tags,this.tags,l,this.metadata,{verbose:this.verbose}),d={options:t,invocation_params:this?.invocationParams(t),batch_size:1};i=await f?.handleChatModelStart(this.toJSON(),s.map(Ph),n.runId,void 0,d,void 0,void 0,n.runName)}let a=[],o=[];if(!!i?.[0].handlers.find(eh)&&!this.disableStreaming&&s.length===1&&this._streamResponseChunks!==r.prototype._streamResponseChunks)try{let l=await this._streamResponseChunks(s[0],t,i?.[0]),f,d;for await(let p of l){if(p.message.id==null){let h=i?.at(0)?.runId;h!=null&&p.message._updateId(`run-${h}`)}f===void 0?f=p:f=Nn(f,p),zd(p.message)&&p.message.usage_metadata!==void 0&&(d={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}if(f===void 0)throw new Error("Received empty response from chat model call.");a.push([f]),await i?.[0].handleLLMEnd({generations:a,llmOutput:d})}catch(l){throw await i?.[0].handleLLMError(l),l}else{let l=await Promise.allSettled(s.map((f,d)=>this._generate(f,{...t,promptIndex:d},i?.[d])));await Promise.all(l.map(async(f,d)=>{if(f.status==="fulfilled"){let p=f.value;for(let h of p.generations){if(h.message.id==null){let g=i?.at(0)?.runId;g!=null&&h.message._updateId(`run-${g}`)}h.message.response_metadata={...h.generationInfo,...h.message.response_metadata}}return p.generations.length===1&&(p.generations[0].message.response_metadata={...p.llmOutput,...p.generations[0].message.response_metadata}),a[d]=p.generations,o[d]=p.llmOutput,i?.[d]?.handleLLMEnd({generations:[p.generations],llmOutput:p.llmOutput})}else return await i?.[d]?.handleLLMError(f.reason),Promise.reject(f.reason)}))}let c={generations:a,llmOutput:o.length?this._combineLLMOutput?.(...o):void 0};return Object.defineProperty(c,hl,{value:i?{runIds:i?.map(l=>l.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:A,handledOptions:s}){let i=e.map(g=>g.map(cs)),a={...s.metadata,...this.getLsParams(A)},o=await pt.configure(s.callbacks,this.callbacks,s.tags,this.tags,a,this.metadata,{verbose:this.verbose}),u={options:A,invocation_params:this?.invocationParams(A),batch_size:1},c=await o?.handleChatModelStart(this.toJSON(),i.map(Ph),s.runId,void 0,u,void 0,void 0,s.runName),l=[],d=(await Promise.allSettled(i.map(async(g,w)=>{let m=r._convertInputToPromptValue(g).toString(),_=await t.lookup(m,n);return _==null&&l.push(w),_}))).map((g,w)=>({result:g,runManager:c?.[w]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),p=[];await Promise.all(d.map(async({result:g,runManager:w},m)=>{if(g.status==="fulfilled"){let _=g.value;return p[m]=_.map(B=>("message"in B&&dA(B.message)&&pA(B.message)&&(B.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),B.generationInfo={...B.generationInfo,tokenUsage:{}},B)),_.length&&await w?.handleLLMNewToken(_[0].text),w?.handleLLMEnd({generations:[_]},void 0,void 0,void 0,{cached:!0})}else return await w?.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(g.reason)}));let h={generations:p,missingPromptIndices:l,startedRunManagers:c};return Object.defineProperty(h,hl,{value:c?{runIds:c?.map(g=>g.runId)}:void 0,configurable:!0}),h}async generate(e,t,n){let A;Array.isArray(t)?A={stop:t}:A=t;let s=e.map(p=>p.map(cs)),[i,a]=this._separateRunnableConfigFromCallOptionsCompat(A);if(i.callbacks=i.callbacks??n,!this.cache)return this._generateUncached(s,a,i);let{cache:o}=this,u=this._getSerializedCacheKeyParametersForCall(a),{generations:c,missingPromptIndices:l,startedRunManagers:f}=await this._generateCached({messages:s,cache:o,llmStringKey:u,parsedOptions:a,handledOptions:i}),d={};if(l.length>0){let p=await this._generateUncached(l.map(h=>s[h]),a,i,f!==void 0?l.map(h=>f?.[h]):void 0);await Promise.all(p.generations.map(async(h,g)=>{let w=l[g];c[w]=h;let m=r._convertInputToPromptValue(s[w]).toString();return o.update(m,u,h)})),d=p.llmOutput??{}}return{generations:c,llmOutput:d}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){let A=e.map(s=>s.toChatMessages());return this.generate(A,t,n)}async call(e,t,n){return(await this.generate([e.map(cs)],t,n)).generations[0][0].message}async callPrompt(e,t,n){let A=e.toChatMessages();return this.call(A,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){let A=new Lt(e),s=await this.call([A],t,n);if(typeof s.content!="string")throw new Error("Cannot use predict when output is not a string.");return s.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw new Error('"strict" mode is not supported for this model by default.');let n=e,A=t?.name,s=Ps(n)??"A function available to call.",i=t?.method,a=t?.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let o=A??"extract",u;nr(n)?u=[{type:"function",function:{name:o,description:s,parameters:zt(n)}}]:("name"in n&&(o=n.name),u=[{type:"function",function:{name:o,description:s,parameters:n}}]);let c=this.bindTools(u),l=kr.from(h=>{if(!h.tool_calls||h.tool_calls.length===0)throw new Error("No tool calls found in the response.");let g=h.tool_calls.find(w=>w.name===o);if(!g)throw new Error(`No tool call found with name ${o}.`);return g.args});if(!a)return c.pipe(l).withConfig({runName:"StructuredOutput"});let f=pn.assign({parsed:(h,g)=>l.invoke(h.raw,g)}),d=pn.assign({parsed:()=>null}),p=f.withFallbacks({fallbacks:[d]});return jn.from([{raw:c},p]).withConfig({runName:"StructuredOutputRunnable"})}};var Rh=class extends Qe{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,A)=>this.parseResult([{text:n}],A?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,A)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],A?.callbacks),e,{...t,runType:"parser"})}},aa=class extends Rh{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}},QA=class extends Error{constructor(e,t,n,A=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=A,A&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");pc(this,"OUTPUT_PARSING_FAILURE")}};var oa=class extends aa{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},ks=class extends oa{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(let A of e){if(typeof A!="string"&&typeof A.content!="string")throw new Error("Cannot handle non-string output.");let s;if(Kd(A)){if(typeof A.content!="string")throw new Error("Cannot handle non-string message output.");s=new Ln({message:A,text:A.content})}else if(dA(A)){if(typeof A.content!="string")throw new Error("Cannot handle non-string message output.");s=new Ln({message:Vd(A),text:A.content})}else s=new un({text:A});n===void 0?n=s:n=n.concat(s);let i=await this.parsePartialResult([n]);i!=null&&!Dn(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}};var $o=class extends aa{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=Yt.object(Object.fromEntries(Object.entries(e).map(([n,A])=>[n,Yt.string().describe(A)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(zt(this.schema))}
\`\`\`
`}async parse(e){try{let n=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(A,s)=>`"${s.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await sa(this.schema,JSON.parse(n))}catch(t){throw new QA(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};var jo=class extends ks{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?Pc(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Ld(e[0].text)}async parse(e){return Ld(e,JSON.parse)}getFormatInstructions(){return""}};function jl(r,e){if(r.function===void 0)return;let t;if(e?.partial)try{t=Ri(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(A){throw new QA([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${A.message}`].join(`
`))}let n={name:r.function.name,args:t,type:"tool_call"};return e?.returnId&&(n.id=r.id),n}function vv(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function Kl(r,e){return{name:r.function?.name,args:r.function?.arguments,id:r.id,error:e,type:"invalid_tool_call"}}var kh=class extends ks{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let n=e[0].message,A;if(pA(n)&&n.tool_calls?.length?A=n.tool_calls.map(i=>{let{id:a,...o}=i;return this.returnId?{id:a,...o}:o}):n.additional_kwargs.tool_calls!==void 0&&(A=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(a=>jl(a,{returnId:this.returnId,partial:t}))),!A)return[];let s=[];for(let i of A)if(i!==void 0){let a={type:i.name,args:i.args,id:i.id};s.push(a)}return s}},Ko=class extends kh{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await lv(this.zodSchema,e);if(t.success)return t.data;throw new QA(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let n=(await super.parsePartialResult(e)).filter(s=>s.type===this.keyName),A=n;if(n.length)return this.returnId||(A=n.map(s=>s.args)),this.returnSingle?A[0]:A}async parseResult(e){let n=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName),A=n;return n.length?(this.returnId||(A=n.map(i=>i.args)),this.returnSingle?this._validateResult(A[0]):await Promise.all(A.map(i=>this._validateResult(i)))):void 0}};function Ns(r){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:A,baseURL:s,azureADTokenProvider:i,azureOpenAIEndpoint:a}=r;if((n||i)&&A&&e)return`${A}/${e}`;if((n||i)&&a&&e)return`${a}/openai/deployments/${e}`;if(n||i){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return s}function Nh(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function Lh(r){return r!==void 0&&Qe.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function Hh(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&(nr(r.schema)||r.schema!=null&&typeof r.schema=="object"&&"type"in r.schema&&typeof r.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(r.schema.type))}function ua(r){return Hh(r)||Lh(r)||Nh(r)}function Cv(r,e){let t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:zt(r.schema),...t?.strict!==void 0?{strict:t.strict}:{}}}function Dh(r,e){let t=typeof e=="number"?void 0:e,n;return ua(r)?n={type:"function",function:Cv(r)}:n=r,t?.strict!==void 0&&(n.function.strict=t.strict),n}var xv=Symbol("Let zodToJsonSchema decide on which parser to use"),Ev={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Iv=r=>typeof r=="string"?{...Ev,basePath:["#"],definitions:{},name:r}:{...Ev,basePath:["#"],definitions:{},...r};var zo=r=>"_def"in r?r._def:r;function Uv(r){if(!r)return!0;for(let e in r)return!1;return!0}var Fv=r=>{let e=Iv(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,A])=>[zo(A),{def:zo(A),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function Mh(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function be(r,e,t,n,A){r[e]=t,Mh(r,e,n,A)}function Qv(){return{}}function Tv(r,e){let t={type:"array"};return r.type?._def?.typeName!==b.ZodAny&&(t.items=re(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&be(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&be(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(be(t,"minItems",r.exactLength.value,r.exactLength.message,e),be(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Ov(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?be(t,"minimum",n.value,n.message,e):be(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),be(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?be(t,"maximum",n.value,n.message,e):be(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),be(t,"maximum",n.value,n.message,e));break;case"multipleOf":be(t,"multipleOf",n.value,n.message,e);break}return t}function Sv(){return{type:"boolean"}}function Pv(r,e){return re(r.type._def,e)}var Rv=(r,e)=>re(r.innerType._def,e);function $h(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((A,s)=>$h(r,e,A))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return gN(r,e)}}var gN=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":be(t,"minimum",n.value,n.message,e);break;case"max":be(t,"maximum",n.value,n.message,e);break}return t};function kv(r,e){return{...re(r.innerType._def,e),default:r.defaultValue()}}function Nv(r,e,t){return e.effectStrategy==="input"?re(r.schema._def,e,t):{}}function Lv(r){return{type:"string",enum:[...r.values]}}var wN=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function Hv(r,e){let t=[re(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),re(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,A=[];return t.forEach(s=>{if(wN(s))A.push(...s.allOf),s.unevaluatedProperties===void 0&&(n=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:a,...o}=s;i=o}else n=void 0;A.push(i)}}),A.length?{allOf:A,...n}:void 0}function Dv(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var jh,Ls={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(jh===void 0&&(jh=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),jh),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function zl(r,e){let t={type:"string"};function n(A){return e.patternStrategy==="escape"?yN(A):A}if(r.checks)for(let A of r.checks)switch(A.kind){case"min":be(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,A.value):A.value,A.message,e);break;case"max":be(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,A.value):A.value,A.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Dr(t,"email",A.message,e);break;case"format:idn-email":Dr(t,"idn-email",A.message,e);break;case"pattern:zod":Mr(t,Ls.email,A.message,e);break}break;case"url":Dr(t,"uri",A.message,e);break;case"uuid":Dr(t,"uuid",A.message,e);break;case"regex":Mr(t,A.regex,A.message,e);break;case"cuid":Mr(t,Ls.cuid,A.message,e);break;case"cuid2":Mr(t,Ls.cuid2,A.message,e);break;case"startsWith":Mr(t,RegExp(`^${n(A.value)}`),A.message,e);break;case"endsWith":Mr(t,RegExp(`${n(A.value)}$`),A.message,e);break;case"datetime":Dr(t,"date-time",A.message,e);break;case"date":Dr(t,"date",A.message,e);break;case"time":Dr(t,"time",A.message,e);break;case"duration":Dr(t,"duration",A.message,e);break;case"length":be(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,A.value):A.value,A.message,e),be(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,A.value):A.value,A.message,e);break;case"includes":{Mr(t,RegExp(n(A.value)),A.message,e);break}case"ip":{A.version!=="v6"&&Dr(t,"ipv4",A.message,e),A.version!=="v4"&&Dr(t,"ipv6",A.message,e);break}case"emoji":Mr(t,Ls.emoji,A.message,e);break;case"ulid":{Mr(t,Ls.ulid,A.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Dr(t,"binary",A.message,e);break}case"contentEncoding:base64":{be(t,"contentEncoding","base64",A.message,e);break}case"pattern:zod":{Mr(t,Ls.base64,A.message,e);break}}break}case"nanoid":Mr(t,Ls.nanoid,A.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var yN=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Dr=(r,e,t,n)=>{r.format||r.anyOf?.some(A=>A.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):be(r,"format",e,t,n)},Mr=(r,e,t,n)=>{r.pattern||r.allOf?.some(A=>A.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Mv(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):be(r,"pattern",Mv(e,n),t,n)},Mv=(r,e)=>{let t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;let n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},A=n.i?t.source.toLowerCase():t.source,s="",i=!1,a=!1,o=!1;for(let u=0;u<A.length;u++){if(i){s+=A[u],i=!1;continue}if(n.i){if(a){if(A[u].match(/[a-z]/)){o?(s+=A[u],s+=`${A[u-2]}-${A[u]}`.toUpperCase(),o=!1):A[u+1]==="-"&&A[u+2]?.match(/[a-z]/)?(s+=A[u],o=!0):s+=`${A[u]}${A[u].toUpperCase()}`;continue}}else if(A[u].match(/[a-z]/)){s+=`[${A[u]}${A[u].toUpperCase()}]`;continue}}if(n.m){if(A[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(A[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&A[u]==="."){s+=a?`${A[u]}\r
`:`[${A[u]}\r
]`;continue}s+=A[u],A[u]==="\\"?i=!0:a&&A[u]==="]"?a=!1:!a&&A[u]==="["&&(a=!0)}try{let u=new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s};function Gl(r,e){if(e.target==="openApi3"&&r.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((n,A)=>({...n,[A]:re(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",A]})??{}}),{}),additionalProperties:!1};let t={type:"object",additionalProperties:re(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===b.ZodString&&r.keyType._def.checks?.length){let n=Object.entries(zl(r.keyType._def,e)).reduce((A,[s,i])=>s==="type"?A:{...A,[s]:i},{});return{...t,propertyNames:n}}else if(r.keyType?._def.typeName===b.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function $v(r,e){if(e.mapStrategy==="record")return Gl(r,e);let t=re(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=re(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function jv(r){let e=r.values,n=Object.keys(r.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),A=Array.from(new Set(n.map(s=>typeof s)));return{type:A.length===1?A[0]==="string"?"string":"number":["string","number"],enum:n}}function Kv(){return{not:{}}}function zv(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Go={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Vv(r,e){if(e.target==="openApi3")return Gv(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Go&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((A,s)=>{let i=Go[s._def.typeName];return i&&!A.includes(i)?[...A,i]:A},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((A,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...A,i];case"bigint":return[...A,"integer"];case"object":if(s._def.value===null)return[...A,"null"];case"symbol":case"undefined":case"function":default:return A}},[]);if(n.length===t.length){let A=n.filter((s,i,a)=>a.indexOf(s)===i);return{type:A.length>1?A:A[0],enum:t.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,A)=>[...n,...A._def.values.filter(s=>!n.includes(s))],[])};return Gv(r,e)}var Gv=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,A)=>re(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${A}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function Zv(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Go[r.innerType._def.typeName],nullable:!0}:{type:[Go[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=re(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=re(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Jv(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",Mh(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?be(t,"minimum",n.value,n.message,e):be(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),be(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?be(t,"maximum",n.value,n.message,e):be(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),be(t,"maximum",n.value,n.message,e));break;case"multipleOf":be(t,"multipleOf",n.value,n.message,e);break}return t}function _N(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":re(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":re(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function Wv(r,e){let t={type:"object",...Object.entries(r.shape()).reduce((n,[A,s])=>{if(s===void 0||s._def===void 0)return n;let i=[...e.currentPath,"properties",A],a=re(s._def,{...e,currentPath:i,propertyPath:i});if(a===void 0)return n;if(e.openaiStrictMode&&s.isOptional()&&!s.isNullable()&&typeof s._def?.defaultValue>"u")throw new Error(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...n.properties,[A]:a},required:s.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,A]}},{properties:{},required:[]}),additionalProperties:_N(r,e)};return t.required.length||delete t.required,t}var qv=(r,e)=>{if(e.propertyPath&&e.currentPath.slice(0,e.propertyPath.length).toString()===e.propertyPath.toString())return re(r.innerType._def,{...e,currentPath:e.currentPath});let t=re(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var Xv=(r,e)=>{if(e.pipeStrategy==="input")return re(r.in._def,e);if(e.pipeStrategy==="output")return re(r.out._def,e);let t=re(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=re(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(A=>A!==void 0)}};function Yv(r,e){return re(r.type._def,e)}function eC(r,e){let n={type:"array",uniqueItems:!0,items:re(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&be(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&be(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function tC(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>re(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:re(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>re(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function rC(){return{not:{}}}function nC(){return{}}var AC=(r,e)=>re(r.innerType._def,e);function re(r,e,t=!1){let n=e.seen.get(r);if(e.override){let i=e.override?.(r,e,n,t);if(i!==xv)return i}if(n&&!t){let i=bN(n,e);if(i!==void 0)return"$ref"in i&&e.seenRefs.add(i.$ref),i}let A={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,A);let s=vN(r,r.typeName,e,t);return s&&CN(r,e,s),A.jsonSchema=s,s}var bN=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":let t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:BN(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,A)=>e.currentPath[A]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},BN=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},vN=(r,e,t,n)=>{switch(e){case b.ZodString:return zl(r,t);case b.ZodNumber:return Jv(r,t);case b.ZodObject:return Wv(r,t);case b.ZodBigInt:return Ov(r,t);case b.ZodBoolean:return Sv();case b.ZodDate:return $h(r,t);case b.ZodUndefined:return rC();case b.ZodNull:return zv(t);case b.ZodArray:return Tv(r,t);case b.ZodUnion:case b.ZodDiscriminatedUnion:return Vv(r,t);case b.ZodIntersection:return Hv(r,t);case b.ZodTuple:return tC(r,t);case b.ZodRecord:return Gl(r,t);case b.ZodLiteral:return Dv(r,t);case b.ZodEnum:return Lv(r);case b.ZodNativeEnum:return jv(r);case b.ZodNullable:return Zv(r,t);case b.ZodOptional:return qv(r,t);case b.ZodMap:return $v(r,t);case b.ZodSet:return eC(r,t);case b.ZodLazy:return re(r.getter()._def,t);case b.ZodPromise:return Yv(r,t);case b.ZodNaN:case b.ZodNever:return Kv();case b.ZodEffects:return Nv(r,t,n);case b.ZodAny:return Qv();case b.ZodUnknown:return nC();case b.ZodDefault:return kv(r,t);case b.ZodBranded:return Pv(r,t);case b.ZodReadonly:return AC(r,t);case b.ZodCatch:return Rv(r,t);case b.ZodPipeline:return Xv(r,t);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(A=>{})(e)}},CN=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var Kh=(r,e)=>{let t=Fv(e),n=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,A=re(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},s=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;s!==void 0&&(A.title=s);let i=(()=>{if(Uv(t.definitions))return;let o={},u=new Set;for(let c=0;c<500;c++){let l=Object.entries(t.definitions).filter(([f])=>!u.has(f));if(l.length===0)break;for(let[f,d]of l)o[f]=re(zo(d),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},u.add(f)}return o})(),a=n===void 0?i?{...A,[t.definitionPath]:i}:A:t.nameStrategy==="duplicate-ref"?{...A,...i||t.seenRefs.size?{[t.definitionPath]:{...i,...t.seenRefs.size?{[n]:A}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...i,[n]:A}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function EN(r,e){return Kh(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function sC(r,e,t){return Sw({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:EN(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function Vo(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function ca(r){let e;return r.constructor.name===Gr.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===He.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=Vo(r,"INVALID_TOOL_RESULTS"):r.status===401?e=Vo(r,"MODEL_AUTHENTICATION"):r.status===429?e=Vo(r,"MODEL_RATE_LIMIT"):r.status===404?e=Vo(r,"MODEL_NOT_FOUND"):e=r,e}function zh(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function xN(r,e){let t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function iC(r,e,t){if(_r(r))return sC(r,e,t);if(rr(r))return xN({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Ro(r,{cycles:"ref",reused:"ref",override(n){n.jsonSchema.title=e}})}},n=>Bl(r,JSON.parse(n)));throw new Error("Unsupported schema response format")}function IN(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function aC(r){let e=["namespace functions {",""];for(let t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(oC(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function oC(r,e){let t=[];for(let[n,A]of Object.entries(r.properties??{}))A.description&&e<2&&t.push(`// ${A.description}`),r.required?.includes(n)?t.push(`${n}: ${Vl(A,e)},`):t.push(`${n}?: ${Vl(A,e)},`);return t.map(n=>" ".repeat(e)+n).join(`
`)}function Vl(r,e){if(IN(r))return r.anyOf.map(t=>Vl(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",oC(r,e+2),"}"].join(`
`);case"array":return r.items?`${Vl(r.items,e)}[]`:"any[]";default:return""}}function uC(r,e){let t;return ua(r)?t=Dh(r):t=r,t.type==="function"&&e?.strict!==void 0&&(t.function.strict=e.strict),t}function Zl(r){return"type"in r&&r.type!=="function"&&r.type!=="custom"}function cC(r){return r!=null&&typeof r=="object"&&"type"in r&&r.type!=="function"}function lC(r){return typeof r=="object"&&r!==null&&"metadata"in r&&typeof r.metadata=="object"&&r.metadata!==null&&"customTool"in r.metadata&&typeof r.metadata.customTool=="object"&&r.metadata.customTool!==null}function Gh(r){return"type"in r&&r.type==="custom"&&"custom"in r&&typeof r.custom=="object"&&r.custom!==null}function fC(r){if(r.type==="custom_tool_call")return{...r,type:"tool_call",call_id:r.id,id:r.call_id,name:r.name,isCustomTool:!0,args:{input:r.input}}}function dC(r){return r.type==="tool_call"&&"isCustomTool"in r&&r.isCustomTool===!0}function pC(r){let e=()=>{if(r.custom.format){if(r.custom.format.type==="grammar")return{type:"grammar",definition:r.custom.format.grammar.definition,syntax:r.custom.format.grammar.syntax};if(r.custom.format.type==="text")return{type:"text"}}};return{type:"custom",name:r.custom.name,description:r.custom.description,format:e()}}function hC(r){let e=()=>{if(r.format){if(r.format.type==="grammar")return{type:"grammar",grammar:{definition:r.format.definition,syntax:r.format.syntax}};if(r.format.type==="text")return{type:"text"}}};return{type:"custom",custom:{name:r.name,description:r.description,format:e()}}}var la="__openai_function_call_ids__";function ql(r){return r?!!(/^o\d/.test(r??"")||r.startsWith("gpt-5")&&!r.startsWith("gpt-5-chat")):!1}function UN(r){return r!==void 0&&typeof r.schema=="object"}function FN(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Zh(r){let e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!hA.isInstance(r))throw new Error("Invalid generic chat message");return FN(r)}default:throw new Error(`Unknown message type: ${e}`)}}var mC={providerName:"ChatOpenAI",fromStandardTextBlock(r){return{type:"text",text:r.text}},fromStandardImageBlock(r){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url,...r.metadata?.detail?{detail:r.metadata.detail}:{}}};if(r.source_type==="base64")return{type:"image_url",image_url:{url:`data:${r.mime_type??""};base64,${r.data}`,...r.metadata?.detail?{detail:r.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${r.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(r){if(r.source_type==="url"){let e=$d({dataUrl:r.url});if(!e)throw new Error(`URL audio blocks with source_type ${r.source_type} must be formatted as a data URL for ChatOpenAI`);let t=e.mime_type||r.mime_type||"",n;try{n=Md(t)}catch{throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`)}if(n.type!=="audio"||n.subtype!=="wav"&&n.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:n.subtype,data:e.data}}}if(r.source_type==="base64"){let e;try{e=Md(r.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${r.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:r.data}}}throw new Error(`Audio content blocks with source_type ${r.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(r){if(r.source_type==="url"){if(!$d({dataUrl:r.url}))throw new Error(`URL file blocks with source_type ${r.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:r.url,...r.metadata?.filename||r.metadata?.name?{filename:r.metadata?.filename||r.metadata?.name}:{}}}}if(r.source_type==="base64")return{type:"file",file:{file_data:`data:${r.mime_type??""};base64,${r.data}`,...r.metadata?.filename||r.metadata?.name||r.metadata?.title?{filename:r.metadata?.filename||r.metadata?.name||r.metadata?.title}:{}}};if(r.source_type==="id")return{type:"file",file:{file_id:r.id}};throw new Error(`File content blocks with source_type ${r.source_type} are not supported for ChatOpenAI`)}};function Vh(r,e){return r.flatMap(t=>{let n=Zh(t);n==="system"&&ql(e)&&(n="developer");let A=typeof t.content=="string"?t.content:t.content.map(i=>Qn(i)?jd(i,mC):i),s={role:n,content:A};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=""),pA(t)&&t.tool_calls?.length?(s.tool_calls=t.tool_calls.map(vv),s.content=""):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){let i={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,i]}return s})}var Zo=class extends $l{_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","reasoningEffort","service_tier"]}get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model",reasoningEffort:"reasoning_effort"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","reasoningEffort","promptCacheKey","verbosity"]}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}constructor(e){super(e??{}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"promptCacheKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbosity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.apiKey=e?.apiKey??e?.configuration?.apiKey??Ge("OPENAI_API_KEY"),this.organization=e?.configuration?.organization??Ge("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoning=e?.reasoning??e?.reasoningEffort?{effort:e.reasoningEffort}:void 0,this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.disableStreaming=e?.disableStreaming??this.disableStreaming,this.promptCacheKey=e?.promptCacheKey??this.promptCacheKey,this.verbosity=e?.verbosity??this.verbosity,this.streaming=e?.streaming??!1,this.streaming===!1&&(this.disableStreaming=!0),this.disableStreaming&&(this.streaming=!1),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),e?.service_tier!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=e?.zdrEnabled??!1}_getReasoningParams(e){if(!ql(this.model))return;let t;return this.reasoning!==void 0&&(t={...t,...this.reasoning}),e?.reasoning!==void 0&&(t={...t,...e.reasoning}),t}_getResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&nr(e.json_schema.schema)?iC(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){let n={baseURL:this.clientConfig.baseURL},A=Ns(n),s={...this.clientConfig,baseURL:A,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new Ae(s)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,t){return lC(e)?hC(e.metadata.customTool):Sh(e)?t?.strict!==void 0?{...e,function:{...e.function,strict:t.strict}}:e:uC(e,t)}bindTools(e,t){let n;return t?.strict!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.withConfig({tools:e.map(A=>Zl(A)?A:this._convertChatOpenAIToolToCompletionsTool(A,{strict:n})),...t})}async stream(e,t){return super.stream(e,this._combineCallOptions(t))}async invoke(e,t){return super.invoke(e,this._combineCallOptions(t))}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let t=0,n=0,A=0;this.model==="gpt-3.5-turbo-0301"?(n=4,A=-1):(n=3,A=1);let s=await Promise.all(e.map(async i=>{let a=await this.getNumTokens(i.content),o=await this.getNumTokens(Zh(i)),u=i.name!==void 0?A+await this.getNumTokens(i.name):0,c=a+n+o+u,l=i;if(l._getType()==="function"&&(c-=2),l.additional_kwargs?.function_call&&(c+=3),l?.additional_kwargs.function_call?.name&&(c+=await this.getNumTokens(l.additional_kwargs.function_call?.name)),l.additional_kwargs.function_call?.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse(l.additional_kwargs.function_call?.arguments)))}catch(f){console.error("Error parsing function arguments",f,JSON.stringify(l.additional_kwargs.function_call)),c+=await this.getNumTokens(l.additional_kwargs.function_call?.arguments)}return t+=c,c}));return t+=3,{totalCount:t,countPerMessage:s}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>n.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)))).reduce((n,A)=>n+A,0)}async _getEstimatedTokenCountFromPrompt(e,t,n){let A=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){let s=aC(t);A+=await this.getNumTokens(s),A+=9}return t&&e.find(s=>s._getType()==="system")&&(A-=4),n==="none"?A+=1:typeof n=="object"&&(A+=await this.getNumTokens(n.name)+4),A}_getStructuredOutputMethod(e){let t={...e};if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"){if(t?.method===void 0)return"jsonSchema"}else t.method==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);return t.method}withStructuredOutput(e,t){let n,A,s,i;UN(e)?(n=e.schema,A=e.name,s=e.method,i=e.includeRaw):(n=e,A=t?.name,s=t?.method,i=t?.includeRaw);let a,o;if(t?.strict!==void 0&&s==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(s=this._getStructuredOutputMethod({...t,method:s}),s==="jsonMode"){nr(n)?o=$o.fromZodSchema(n):o=new jo;let f=zt(n);a=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:A??"extract",...f}}})}else if(s==="jsonSchema"){let f={name:A??"extract",description:Ps(n),schema:n,strict:t?.strict},d=zt(f.schema);if(a=this.withConfig({response_format:{type:"json_schema",json_schema:f},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:f.name,description:f.description,...d}}}),nr(n)){let p=$o.fromZodSchema(n);o=kr.from(h=>"parsed"in h.additional_kwargs?h.additional_kwargs.parsed:p)}else o=new jo}else{let f=A??"extract";if(nr(n)){let d=zt(n);a=this.withConfig({tools:[{type:"function",function:{name:f,description:d.description,parameters:d}}],tool_choice:{type:"function",function:{name:f}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:f,...d}},...t?.strict!==void 0?{strict:t.strict}:{}}),o=new Ko({returnSingle:!0,keyName:f,zodSchema:n})}else{let d;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(d=n,f=n.name):(f=n.title??f,d={name:f,description:n.description??"",parameters:n});let p=zt(n);a=this.withConfig({tools:[{type:"function",function:d}],tool_choice:{type:"function",function:{name:f}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:f,...p}},...t?.strict!==void 0?{strict:t.strict}:{}}),o=new Ko({returnSingle:!0,keyName:f})}}if(!i)return a.pipe(o);let u=pn.assign({parsed:(f,d)=>o.invoke(f.raw,d)}),c=pn.assign({parsed:()=>null}),l=u.withFallbacks({fallbacks:[c]});return jn.from([{raw:a},l])}},Jl=class extends Zo{invocationParams(e){let t;e?.strict!==void 0?t=e.strict:this.supportsStrictToolCalling!==void 0&&(t=this.supportsStrictToolCalling);let n={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e?.previous_response_id,truncation:e?.truncation,include:e?.include,tools:e?.tools?.length?this._reduceChatOpenAITools(e.tools,{stream:this.streaming,strict:t}):void 0,tool_choice:cC(e?.tool_choice)?e?.tool_choice:(()=>{let s=zh(e?.tool_choice);if(typeof s=="object"&&"type"in s){if(s.type==="function")return{type:"function",name:s.function.name};if(s.type==="allowed_tools")return{type:"allowed_tools",mode:s.allowed_tools.mode,tools:s.allowed_tools.tools};if(s.type==="custom")return{type:"custom",name:s.custom.name}}})(),text:(()=>{if(e?.text)return e.text;let s=this._getResponseFormat(e?.response_format);return s?.type==="json_schema"?s.json_schema.schema!=null?{format:{type:"json_schema",schema:s.json_schema.schema,description:s.json_schema.description,name:s.json_schema.name,strict:s.json_schema.strict},verbosity:e?.verbosity}:void 0:{format:s,verbosity:e?.verbosity}})(),parallel_tool_calls:e?.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},A=this._getReasoningParams(e);return A!==void 0&&(n.reasoning=A),n}async _generate(e,t){let n=this.invocationParams(t);if(n.stream){let A=this._streamResponseChunks(e,t),s;for await(let i of A)i.message.response_metadata={...i.generationInfo,...i.message.response_metadata},s=s?.concat(i)??i;return{generations:s?[s]:[],llmOutput:{estimatedTokenUsage:s?.message?.usage_metadata}}}else{let A=this._convertMessagesToResponsesParams(e),s=await this.completionWithRetry({input:A,...n,stream:!1},{signal:t?.signal,...t?.options});return{generations:[{text:s.output_text,message:this._convertResponsesMessageToBaseMessage(s)}],llmOutput:{id:s.id,estimatedTokenUsage:s.usage?{promptTokens:s.usage.input_tokens,completionTokens:s.usage.output_tokens,totalTokens:s.usage.total_tokens}:void 0}}}}async*_streamResponseChunks(e,t,n){let A=await this.completionWithRetry({...this.invocationParams(t),input:this._convertMessagesToResponsesParams(e),stream:!0},t);for await(let s of A){let i=this._convertResponsesDeltaToBaseMessageChunk(s);i!=null&&(yield i,await n?.handleLLMNewToken(i.text||"",{prompt:t.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:i}))}}async completionWithRetry(e,t){return this.caller.call(async()=>{let n=this._getClientOptions(t);try{return e.text?.format?.type==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(A){throw ca(A)}})}_convertResponsesMessageToBaseMessage(e){if(e.error){let o=new Error(e.error.message);throw o.name=e.error.code,o}let t,n=[],A=[],s=[],i={model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,service_tier:e.service_tier,model_name:e.model},a={};for(let o of e.output)if(o.type==="message")t=o.id,n.push(...o.content.flatMap(u=>u.type==="output_text"?("parsed"in u&&u.parsed!=null&&(a.parsed=u.parsed),{type:"text",text:u.text,annotations:u.annotations}):u.type==="refusal"?(a.refusal=u.refusal,[]):u));else if(o.type==="function_call"){let u={function:{name:o.name,arguments:o.arguments},id:o.call_id};try{A.push(jl(u,{returnId:!0}))}catch(c){let l;typeof c=="object"&&c!=null&&"message"in c&&typeof c.message=="string"&&(l=c.message),s.push(Kl(u,l))}a[la]??(a[la]={}),o.id&&(a[la][o.call_id]=o.id)}else if(o.type==="reasoning")a.reasoning=o;else if(o.type==="custom_tool_call"){let u=fC(o);u?A.push(u):s.push(Kl(o,"Malformed custom tool call"))}else a.tool_outputs??(a.tool_outputs=[]),a.tool_outputs.push(o);return new Ut({id:t,content:n,tool_calls:A,invalid_tool_calls:s,usage_metadata:e.usage,additional_kwargs:a,response_metadata:i})}_convertResponsesDeltaToBaseMessageChunk(e){let t=[],n={},A,s=[],i={},a={},o;if(e.type==="response.output_text.delta")t.push({type:"text",text:e.delta,index:e.content_index});else if(e.type==="response.output_text.annotation.added")t.push({type:"text",text:"",annotations:[e.annotation],index:e.content_index});else if(e.type==="response.output_item.added"&&e.item.type==="message")o=e.item.id;else if(e.type==="response.output_item.added"&&e.item.type==="function_call")s.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),a[la]={[e.item.call_id]:e.item.id};else if(e.type==="response.output_item.done"&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(e.item.type))a.tool_outputs=[e.item];else if(e.type==="response.created")i.id=e.response.id,i.model_name=e.response.model,i.model=e.response.model;else if(e.type==="response.completed"){let u=this._convertResponsesMessageToBaseMessage(e.response);A=e.response.usage,e.response.text?.format?.type==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(u.text)));for(let[c,l]of Object.entries(e.response))c!=="id"&&(i[c]=l)}else if(e.type==="response.function_call_arguments.delta")s.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if(e.type==="response.web_search_call.completed"||e.type==="response.file_search_call.completed")n={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(e.type==="response.refusal.done")a.refusal=e.refusal;else if(e.type==="response.output_item.added"&&"item"in e&&e.item.type==="reasoning"){let u=e.item.summary?e.item.summary.map((c,l)=>({...c,index:l})):void 0;a.reasoning={id:e.item.id,type:e.item.type,...u?{summary:u}:{}}}else if(e.type==="response.reasoning_summary_part.added")a.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]};else if(e.type==="response.reasoning_summary_text.delta")a.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]};else return e.type==="response.image_generation_call.partial_image",null;return new Ln({text:t.map(u=>u.text).join(""),message:new Xt({id:o,content:t,tool_call_chunks:s,usage_metadata:A,additional_kwargs:a,response_metadata:i}),generationInfo:n})}_convertMessagesToResponsesParams(e){return e.flatMap(t=>{let n=t.additional_kwargs,A=Zh(t);if(A==="system"&&ql(this.model)&&(A="developer"),A==="function")throw new Error("Function messages are not supported in Responses API");if(A==="tool"){let s=t;return n?.type==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof s.content=="string")return{type:"computer_screenshot",image_url:s.content};if(Array.isArray(s.content)){let a=s.content.find(u=>u.type==="computer_screenshot");if(a)return a;let o=s.content.find(u=>u.type==="image_url");if(o)return{type:"computer_screenshot",image_url:typeof o.image_url=="string"?o.image_url:o.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:s.tool_call_id}:s.metadata?.customTool?{type:"custom_tool_call_output",call_id:s.tool_call_id,output:s.content}:{type:"function_call_output",call_id:s.tool_call_id,id:s.id?.startsWith("fc_")?s.id:void 0,output:typeof s.content!="string"?JSON.stringify(s.content):s.content}}if(A==="assistant"){if(!this.zdrEnabled&&t.response_metadata.output!=null&&Array.isArray(t.response_metadata.output)&&t.response_metadata.output.length>0&&t.response_metadata.output.every(c=>"type"in c))return t.response_metadata.output;let s=[];if(n?.reasoning&&!this.zdrEnabled){let c=this._convertReasoningSummary(n.reasoning);s.push(c)}let{content:i}=t;n?.refusal&&(typeof i=="string"&&(i=[{type:"output_text",text:i,annotations:[]}]),i=[...i,{type:"refusal",refusal:n.refusal}]),(typeof i=="string"||i.length>0)&&s.push({type:"message",role:"assistant",...t.id&&!this.zdrEnabled&&t.id.startsWith("msg_")?{id:t.id}:{},content:typeof i=="string"?i:i.flatMap(c=>c.type==="text"?{type:"output_text",text:c.text,annotations:c.annotations??[]}:c.type==="output_text"||c.type==="refusal"?c:[])});let a=n?.[la];pA(t)&&t.tool_calls?.length?s.push(...t.tool_calls.map(c=>dC(c)?{type:"custom_tool_call",id:c.call_id,call_id:c.id??"",input:c.args.input,name:c.name}:{type:"function_call",name:c.name,arguments:JSON.stringify(c.args),call_id:c.id,...this.zdrEnabled?{id:a?.[c.id]}:{}})):n?.tool_calls&&s.push(...n.tool_calls.map(c=>({type:"function_call",name:c.function.name,call_id:c.id,arguments:c.function.arguments,...this.zdrEnabled?{id:a?.[c.id]}:{}})));let o=t.response_metadata.output?.length?t.response_metadata.output:n.tool_outputs,u=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(o!=null){let l=o?.filter(f=>u.includes(f.type));l.length>0&&s.push(...l)}return s}if(A==="user"||A==="system"||A==="developer"){if(typeof t.content=="string")return{type:"message",role:A,content:t.content};let s=[],i=t.content.flatMap(a=>(a.type==="mcp_approval_response"&&s.push({type:"mcp_approval_response",approval_request_id:a.approval_request_id,approve:a.approve}),Qn(a)?jd(a,mC):a.type==="text"?{type:"input_text",text:a.text}:a.type==="image_url"?{type:"input_image",image_url:typeof a.image_url=="string"?a.image_url:a.image_url.url,detail:typeof a.image_url=="string"?"auto":a.image_url.detail}:a.type==="input_text"||a.type==="input_image"||a.type==="input_file"?a:[]));return i.length>0&&s.push({type:"message",role:A,content:i}),s}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${A}`),[]})}_convertReasoningSummary(e){let t=(e.summary.length>1?e.summary.reduce((n,A)=>{let s=n.at(-1);return s.index===A.index?s.text+=A.text:n.push(A),n},[{...e.summary[0]}]):e.summary).map(n=>Object.fromEntries(Object.entries(n).filter(([A])=>A!=="index")));return{...e,summary:t}}_reduceChatOpenAITools(e,t){let n=[];for(let A of e)Zl(A)?(A.type==="image_generation"&&t?.stream&&(A.partial_images=1),n.push(A)):Sh(A)?n.push({type:"function",name:A.function.name,parameters:A.function.parameters,description:A.function.description,strict:t?.strict??null}):Gh(A)&&n.push(pC(A));return n}},Wl=class extends Zo{invocationParams(e,t){let n;e?.strict!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling);let A={};e?.stream_options!==void 0?A={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(A={stream_options:{include_usage:!0}});let s={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(a=>this._convertChatOpenAIToolToCompletionsTool(a,{strict:n})):void 0,tool_choice:zh(e?.tool_choice),response_format:this._getResponseFormat(e?.response_format),seed:e?.seed,...A,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,verbosity:e?.verbosity??this.verbosity};e?.prediction!==void 0&&(s.prediction=e.prediction),this.service_tier!==void 0&&(s.service_tier=this.service_tier),e?.service_tier!==void 0&&(s.service_tier=e.service_tier);let i=this._getReasoningParams(e);return i!==void 0&&i.effort!==void 0&&(s.reasoning_effort=i.effort),ql(s.model)?s.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:s.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,s}async _generate(e,t,n){let A={},s=this.invocationParams(t),i=Vh(e,this.model);if(s.stream){let a=this._streamResponseChunks(e,t,n),o={};for await(let p of a){p.message.response_metadata={...p.generationInfo,...p.message.response_metadata};let h=p.generationInfo?.completion??0;o[h]===void 0?o[h]=p:o[h]=o[h].concat(p)}let u=Object.entries(o).sort(([p],[h])=>parseInt(p,10)-parseInt(h,10)).map(([p,h])=>h),{functions:c,function_call:l}=this.invocationParams(t),f=await this._getEstimatedTokenCountFromPrompt(e,c,l),d=await this._getNumTokensFromGenerations(u);return A.input_tokens=f,A.output_tokens=d,A.total_tokens=f+d,{generations:u,llmOutput:{estimatedTokenUsage:{promptTokens:A.input_tokens,completionTokens:A.output_tokens,totalTokens:A.total_tokens}}}}else{let a=await this.completionWithRetry({...s,stream:!1,messages:i},{signal:t?.signal,...t?.options}),{completion_tokens:o,prompt_tokens:u,total_tokens:c,prompt_tokens_details:l,completion_tokens_details:f}=a?.usage??{};o&&(A.output_tokens=(A.output_tokens??0)+o),u&&(A.input_tokens=(A.input_tokens??0)+u),c&&(A.total_tokens=(A.total_tokens??0)+c),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(A.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(f?.audio_tokens!==null||f?.reasoning_tokens!==null)&&(A.output_token_details={...f?.audio_tokens!==null&&{audio:f?.audio_tokens},...f?.reasoning_tokens!==null&&{reasoning:f?.reasoning_tokens}});let d=[];for(let p of a?.choices??[]){let g={text:p.message?.content??"",message:this._convertCompletionsMessageToBaseMessage(p.message??{role:"assistant"},a)};g.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},pA(g.message)&&(g.message.usage_metadata=A),g.message=new Ut(Object.fromEntries(Object.entries(g.message).filter(([w])=>!w.startsWith("lc_")))),d.push(g)}return{generations:d,llmOutput:{tokenUsage:{promptTokens:A.input_tokens,completionTokens:A.output_tokens,totalTokens:A.total_tokens}}}}}async*_streamResponseChunks(e,t,n){let A=Vh(e,this.model),s={...this.invocationParams(t,{streaming:!0}),messages:A,stream:!0},i,a=await this.completionWithRetry(s,t),o;for await(let u of a){let c=u?.choices?.[0];if(u.usage&&(o=u.usage),!c)continue;let{delta:l}=c;if(!l)continue;let f=this._convertCompletionsDeltaToBaseMessageChunk(l,u,i);i=l.role??i;let d={prompt:t.promptIndex??0,completion:c.index??0};if(typeof f.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let p={...d};c.finish_reason!=null&&(p.finish_reason=c.finish_reason,p.system_fingerprint=u.system_fingerprint,p.model_name=u.model,p.service_tier=u.service_tier),this.logprobs&&(p.logprobs=c.logprobs);let h=new Ln({message:f,text:f.content,generationInfo:p});yield h,await n?.handleLLMNewToken(h.text??"",d,void 0,void 0,void 0,{chunk:h})}if(o){let u={...o.prompt_tokens_details?.audio_tokens!==null&&{audio:o.prompt_tokens_details?.audio_tokens},...o.prompt_tokens_details?.cached_tokens!==null&&{cache_read:o.prompt_tokens_details?.cached_tokens}},c={...o.completion_tokens_details?.audio_tokens!==null&&{audio:o.completion_tokens_details?.audio_tokens},...o.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:o.completion_tokens_details?.reasoning_tokens}};yield new Ln({message:new Xt({content:"",response_metadata:{usage:{...o}},usage_metadata:{input_tokens:o.prompt_tokens,output_tokens:o.completion_tokens,total_tokens:o.total_tokens,...Object.keys(u).length>0&&{input_token_details:u},...Object.keys(c).length>0&&{output_token_details:c}}}),text:""})}if(t.signal?.aborted)throw new Error("AbortError")}async completionWithRetry(e,t){let n=this._getClientOptions(t),A=e.response_format&&e.response_format.type==="json_schema";return this.caller.call(async()=>{try{return A&&!e.stream?await this.client.chat.completions.parse(e,n):await this.client.chat.completions.create(e,n)}catch(s){throw ca(s)}})}_convertCompletionsMessageToBaseMessage(e,t){let n=e.tool_calls;switch(e.role){case"assistant":{let A=[],s=[];for(let o of n??[])try{A.push(jl(o,{returnId:!0}))}catch(u){s.push(Kl(o,u.message))}let i={function_call:e.function_call,tool_calls:n};this.__includeRawResponse!==void 0&&(i.__raw_response=t);let a={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(i.audio=e.audio),new Ut({content:e.content||"",tool_calls:A,invalid_tool_calls:s,additional_kwargs:i,response_metadata:a,id:t.id})}default:return new hA(e.content||"",e.role??"unknown")}}_convertCompletionsDeltaToBaseMessageChunk(e,t,n){let A=e.role??n,s=e.content??"",i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},this.__includeRawResponse&&(i.__raw_response=t),e.audio&&(i.audio={...e.audio,index:t.choices[0].index});let a={usage:{...t.usage}};if(A==="user")return new os({content:s,response_metadata:a});if(A==="assistant"){let o=[];if(Array.isArray(e.tool_calls))for(let u of e.tool_calls)o.push({name:u.function?.name,args:u.function?.arguments,id:u.id,index:u.index,type:"tool_call_chunk"});return new Xt({content:s,tool_call_chunks:o,additional_kwargs:i,id:t.id,response_metadata:a})}else return A==="system"?new gA({content:s,response_metadata:a}):A==="developer"?new gA({content:s,response_metadata:a,additional_kwargs:{__openai_role__:"developer"}}):A==="function"?new as({content:s,additional_kwargs:i,name:e.name,response_metadata:a}):A==="tool"?new ki({content:s,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:a}):new is({content:s,role:A,response_metadata:a})}},Jo=class r extends Zo{get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}constructor(e){super(e),Object.defineProperty(this,"fields",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"completions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.useResponsesApi=e?.useResponsesApi??!1,this.responses=e?.responses??new Jl(e),this.completions=e?.completions??new Wl(e)}_useResponsesApi(e){let t=e?.tools?.some(Zl),n=e?.previous_response_id!=null||e?.text!=null||e?.truncation!=null||e?.include!=null||e?.reasoning?.summary!=null||this.reasoning?.summary!=null,A=e?.tools?.some(Gh);return this.useResponsesApi||t||n||A}getLsParams(e){let t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.getLsParams(t):this.completions.getLsParams(t)}invocationParams(e){let t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.invocationParams(t):this.completions.invocationParams(t)}async _generate(e,t,n){return this._useResponsesApi(t)?this.responses._generate(e,t):this.completions._generate(e,t,n)}async*_streamResponseChunks(e,t,n){if(this._useResponsesApi(t)){yield*this.responses._streamResponseChunks(e,this._combineCallOptions(t),n);return}yield*this.completions._streamResponseChunks(e,this._combineCallOptions(t),n)}withConfig(e){let t=new r(this.fields);return t.defaultOptions={...this.defaultOptions,...e},t}};var Jh=class extends Do{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),Object.defineProperty(this,"defaultConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata}async invoke(e,t){let n,A=ye(Xi(this.defaultConfig,t));return wA(e)?(n=e.args,A={...A,toolCall:e}):n=e,this.call(n,A)}async call(e,t,n){let A=wA(e)?e.args:e,s;if(nr(this.schema))try{s=await sa(this.schema,A)}catch(p){let h="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(h=`${h}
Details: ${p.message}`),new us(h,JSON.stringify(e))}else{let p=Se(A,this.schema);if(!p.valid){let h="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(h=`${h}
Details: ${p.errors.map(g=>`${g.keywordLocation}: ${g.error}`).join(`
`)}`),new us(h,JSON.stringify(e))}s=A}let i=a0(t),o=await pt.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose})?.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),i.runId,void 0,void 0,void 0,i.runName);delete i.runId;let u;try{u=await this._call(s,o,i)}catch(p){throw await o?.handleToolError(p),p}let c,l;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[c,l]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else c=u;let f;wA(e)&&(f=e.id),!f&&Iy(i)&&(f=i.toolCall.id);let d=TN({content:c,artifact:l,toolCallId:f,name:this.name,metadata:this.metadata});return await o?.handleToolEnd(d),d}},Xl=class extends Jh{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Yt.object({input:Yt.string().optional()}).transform(t=>t.input)})}call(e,t){let n=typeof e=="string"||e==null?{input:e}:e;return super.call(n,t)}};function TN(r){let{content:e,artifact:t,toolCallId:n,metadata:A}=r;return n&&!Ey(e)?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new Qr({status:"success",content:e,artifact:t,tool_call_id:n,name:r.name,metadata:A}):new Qr({status:"success",content:ON(e),artifact:t,tool_call_id:n,name:r.name,metadata:A}):e}function ON(r){try{return JSON.stringify(r,null,2)??""}catch{return`${r}`}}var Wh=class extends Xl{static lc_name(){return"DallEAPIWrapper"}constructor(e){e?.responseFormat!==void 0&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=e?.apiKey??e?.openAIApiKey??Ge("OPENAI_API_KEY"),n=e?.organization??Ge("OPENAI_ORGANIZATION"),A={apiKey:t,organization:n,dangerouslyAllowBrowser:!0,baseURL:e?.baseUrl};this.client=new Ae(A),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.dallEResponseFormat=e?.dallEResponseFormat??this.dallEResponseFormat,this.user=e?.user}processMultipleGeneratedUrls(e){return this.dallEResponseFormat==="url"?e.flatMap(t=>t.data?.flatMap(A=>A.url?{type:"image_url",image_url:A.url}:[]).filter(A=>A!==void 0&&A.type==="image_url"&&typeof A.image_url=="string"&&A.image_url!==void 0)??[]):e.flatMap(t=>t.data?.flatMap(A=>A.b64_json?{type:"image_url",image_url:{url:A.b64_json}}:[]).filter(A=>A!==void 0&&A.type==="image_url"&&typeof A.image_url=="object"&&"url"in A.image_url&&typeof A.image_url.url=="string"&&A.image_url.url!==void 0)??[])}async _call(e){let t={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let s=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(t)));return this.processMultipleGeneratedUrls(s)}let n=await this.client.images.generate(t),A="";return this.dallEResponseFormat==="url"?[A]=n.data?.map(s=>s.url).filter(s=>s!=="undefined")??[]:[A]=n.data?.map(s=>s.b64_json).filter(s=>s!=="undefined")??[],A}};Object.defineProperty(Wh,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var fa="ai-hud:default-chatbot:history:";function qh(r){return`${fa}${r}`}function wC(r){try{typeof window<"u"&&window.localStorage.removeItem(qh(r))}catch{}}function yC(){try{if(typeof window>"u")return;let r=[];for(let e=0;e<window.localStorage.length;e++){let t=window.localStorage.key(e);t&&t.startsWith(fa)&&r.push(t)}r.forEach(e=>window.localStorage.removeItem(e))}catch{}}var Le=require("react/jsx-runtime");async function SN(r){return new Promise((e,t)=>{let n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsDataURL(r)})}var _C=({model:r="gpt-4o-mini",placeholderApiKey:e,systemPrompt:t="You are a helpful assistant.",welcome:n="Hi! How can I help you today?",className:A,style:s,conversationId:i,context:a,contextImages:o,inputPlaceholder:u,inputValue:c,tools:l,toolMaxIterations:f=3})=>{let p=(j=>{if(j&&j!=="REPLACE_WITH_YOUR_OPENAI_API_KEY")return j;try{let X=globalThis||{};if(typeof X.AI_HUD_OPENAI_API_KEY=="string"&&X.AI_HUD_OPENAI_API_KEY)return X.AI_HUD_OPENAI_API_KEY;if(typeof X.__AI_HUD_OPENAI_API_KEY__=="string"&&X.__AI_HUD_OPENAI_API_KEY__)return X.__AI_HUD_OPENAI_API_KEY__}catch{}try{let X=globalThis.process;if(X&&X.env&&typeof X.env.AI_HUD_OPENAI_API_KEY=="string")return X.env.AI_HUD_OPENAI_API_KEY}catch{}return null})(e),h=(0,At.useRef)(null);if(!i&&!h.current){let j=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();h.current=j}let g=i??h.current,w=`${fa}${g}`,[m,_]=(0,At.useState)(()=>{try{let j=typeof window<"u"?window.localStorage.getItem(w):null;if(j){let X=JSON.parse(j);if(Array.isArray(X))return X}}catch{}return[{id:"welcome",role:"assistant",text:n}]}),[B,C]=(0,At.useState)(()=>typeof c=="string"?c:""),[v,x]=(0,At.useState)([]),[Q,F]=(0,At.useState)(!1),z=(0,At.useRef)(null),ee=(0,At.useCallback)(()=>{z.current?.scrollIntoView({behavior:"smooth"})},[]),ve=(0,At.useCallback)(j=>j?j.replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\times/g,"\xD7").replace(/\\n/g,`
`):"",[]),{toolSchemas:G,toolExecutors:fe}=(0,At.useMemo)(()=>{if(!Array.isArray(l))return{toolSchemas:[],toolExecutors:{}};let j=l.map(K=>({type:"function",function:{name:K.function.name,description:K.function.description??"",parameters:K.function.parameters??{type:"object",properties:{}}}})),X={};for(let K of l)X[K.function.name]=async J=>await K.execute(J);return{toolSchemas:j,toolExecutors:X}},[l]),Ie=async j=>{let X=Array.from(j.target.files||[]);if(X.length===0)return;let K=await Promise.all(X.map(SN));x(J=>[...J,...K]),j.target.value=""},Ce=j=>{x(X=>X.filter((K,J)=>J!==j))},Ee=(0,At.useCallback)((j,X)=>{let K=[];if(t&&K.push({role:"system",content:t}),typeof a<"u"){let J="";try{J=JSON.stringify(a)}catch{J=String(a)}K.push({role:"system",content:`Context: ${J}`})}if(Array.isArray(o)&&o.length>0){let J=o.filter(Be=>typeof Be=="string"&&(Be.startsWith("data:image/")||Be.startsWith("http")));if(J.length>0){let Be=[{type:"text",text:"Context images"},...J.map(ge=>({type:"image_url",image_url:{url:ge}}))];K.push({role:"user",content:Be})}}for(let J of j)if(J.role==="assistant")K.push({role:"assistant",content:J.text||""});else if((J.images?.length||0)>0){let Be=[{type:"text",text:J.text||""},...J.images.map(ge=>({type:"image_url",image_url:{url:ge}}))];K.push({role:"user",content:Be})}else K.push({role:"user",content:J.text||""});if(X)if(X.images.length>0){let J=[{type:"text",text:X.text},...X.images.map(Be=>({type:"image_url",image_url:{url:Be}}))];K.push({role:"user",content:J})}else K.push({role:"user",content:X.text});return console.log("result",K),K},[t,a]),Pe=(0,At.useCallback)(async()=>{let j=B.trim();if(!j&&v.length===0)return;let X={id:String(Date.now()),role:"user",text:j||void 0,images:v.length?v:void 0};_(K=>[...K,X]),C(""),x([]),F(!0);try{let K=[],J=Ee(m,{text:X.text||"",images:X.images||[]});for(let qe of J)if(qe.role==="system")K.push(new mA(qe.content));else if(qe.role==="assistant")K.push(new Ut(qe.content));else if(qe.role==="user"){let Gt=qe.content;Array.isArray(Gt)?K.push(new Lt({content:Gt})):K.push(new Lt(qe.content))}let Be=new Jo({modelName:r,temperature:.7,apiKey:p??void 0}),ge=G.length>0?Be.bind({tools:G}):Be,Ne=await ge.invoke(K),Ar=0;for(;Ar<f&&Array.isArray(Ne.tool_calls)&&Ne.tool_calls.length>0&&G.length>0;){let qe=Ne.tool_calls,Gt=[];for(let Br of qe){let sr=Br.name??Br.function?.name,hn=Br.args??Br.function?.arguments,vr=hn;if(typeof hn=="string")try{vr=JSON.parse(hn)}catch{vr=hn}let OA=sr?fe[sr]:void 0,Cr=`Tool '${sr}' not found`;try{OA&&(Cr=await OA(vr))}catch(mn){Cr=`Error from tool '${sr}': ${mn?.message||String(mn)}`}_(mn=>[...mn,{id:`${Date.now()}_${sr}`,role:"tool",text:`Called ${sr} with ${typeof vr=="string"?vr:JSON.stringify(vr)}
\u2192 ${typeof Cr=="string"?Cr:JSON.stringify(Cr)}`}]),Gt.push(new Qr({tool_call_id:Br.id,content:typeof Cr=="string"?Cr:JSON.stringify(Cr)}))}K=[...K,Ne,...Gt],Ne=await ge.invoke(K),Ar+=1}let TA=typeof Ne.content=="string"?Ne.content:JSON.stringify(Ne.content),Yl={id:String(Date.now()+1),role:"assistant",text:typeof TA=="string"?TA:String(TA)};_(qe=>[...qe,Yl]),setTimeout(ee,0)}catch(K){let J={id:String(Date.now()+1),role:"assistant",text:`Error: ${K?.message||"Failed to contact OpenAI"}`};_(Be=>[...Be,J])}finally{F(!1)}},[Ee,B,m,v,e,r,ee]),xe=(0,At.useMemo)(()=>(B.trim().length>0||v.length>0)&&!Q,[B,v.length,Q]);return(0,At.useEffect)(()=>{try{typeof window<"u"&&window.localStorage.setItem(w,JSON.stringify(m))}catch{}},[m,w]),(0,At.useEffect)(()=>()=>{if(!i)try{typeof window<"u"&&window.localStorage.removeItem(w)}catch{}},[i,w]),(0,Le.jsxs)("div",{className:A,style:{display:"flex",flexDirection:"column",height:"100%",...s},children:[(0,Le.jsxs)("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[m.map(j=>(0,Le.jsx)("div",{style:{marginBottom:10,display:"flex",justifyContent:j.role==="user"?"flex-end":"flex-start"},children:(0,Le.jsxs)("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:j.role==="tool"?"1px dashed rgba(0,0,0,0.2)":"1px solid rgba(0,0,0,0.06)",background:j.role==="user"?"#111827":j.role==="tool"?"#fff7ed":"#f3f4f6",color:j.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[j.role==="assistant"?ve(j.text):j.text,j.images&&j.images.length>0&&(0,Le.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:j.images.map((X,K)=>(0,Le.jsx)("img",{src:X,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},K))})]})},j.id)),(0,Le.jsx)("div",{ref:z})]}),(0,Le.jsxs)("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[(0,Le.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,Le.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:Ie,style:{display:"none"},id:"ai-hud-chatbot-file"}),(0,Le.jsx)("label",{htmlFor:"ai-hud-chatbot-file",children:(0,Le.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:(0,Le.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,Le.jsx)("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),(0,Le.jsx)("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),(0,Le.jsx)("input",{value:B,onChange:j=>C(j.target.value),placeholder:u??"Type a message...",onKeyDown:j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),xe&&Pe())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),(0,Le.jsx)("button",{type:"button",disabled:!xe,onClick:()=>void Pe(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:xe?"#111827":"#e5e7eb",color:xe?"#ffffff":"#9ca3af",cursor:xe?"pointer":"not-allowed"},children:"Send"})]}),v.length>0&&(0,Le.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:v.map((j,X)=>(0,Le.jsxs)("div",{style:{position:"relative"},children:[(0,Le.jsx)("img",{src:j,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),(0,Le.jsx)("button",{type:"button",onClick:()=>Ce(X),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},X))})]})]})};0&&(module.exports={CHAT_STORAGE_PREFIX,ChatEnabled,DefaultChatbot,FloatingWindow,clearAllConversations,clearConversation,getConversationStorageKey});
/*! Bundled license information:

html2canvas/dist/html2canvas.esm.js:
  (*!
   * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
   * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
   * Released under MIT License
   *)
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@langchain/core/dist/utils/js-sha256/hash.js:
  (**
   * [js-sha256]{@link https://github.com/emn178/js-sha256}
   *
   * @version 0.11.1
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2025
   * @license MIT
   *)
*/
//# sourceMappingURL=index.cjs.map