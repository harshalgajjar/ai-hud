"use strict";var ae=Object.create;var V=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var ue=(r,s)=>{for(var a in s)V(r,a,{get:s[a],enumerable:!0})},ee=(r,s,a,y)=>{if(s&&typeof s=="object"||typeof s=="function")for(let g of le(s))!ce.call(r,g)&&g!==a&&V(r,g,{get:()=>s[g],enumerable:!(y=ie(s,g))||y.enumerable});return r};var te=(r,s,a)=>(a=r!=null?ae(de(r)):{},ee(s||!r||!r.__esModule?V(a,"default",{value:r,enumerable:!0}):a,r)),fe=r=>ee(V({},"__esModule",{value:!0}),r);var me={};ue(me,{CHAT_STORAGE_PREFIX:()=>Y,ChatEnabled:()=>q,DefaultChatbot:()=>se,FloatingWindow:()=>G,clearAllConversations:()=>re,clearConversation:()=>oe,getConversationStorageKey:()=>Z});module.exports=fe(me);var b=te(require("react"),1),ne=te(require("html2canvas"),1);var L=require("react"),R=require("react/jsx-runtime"),G=({children:r,title:s,onClose:a,position:y="bottom-right",width:g=360,height:A=480,minWidth:D=280,minHeight:O=240,offset:F=16,zIndex:j=1e3,className:M,style:J,headerClassName:_,bodyClassName:U,closeButtonAriaLabel:z="Close",closeOnEscape:E=!0,draggable:I=!0,anchorRect:u})=>{let[x,C]=(0,L.useState)(!1),m=(0,L.useRef)(null),[B,P]=(0,L.useState)(!1),v=(0,L.useRef)(null),[S,k]=(0,L.useState)(null);(0,L.useEffect)(()=>{if(!E)return;let i=c=>{c.key==="Escape"&&a?.()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[E,a]);let X=(()=>{let i=`${F}px`;switch(y){case"top-left":return{top:i,left:i};case"top-right":return{top:i,right:i};case"bottom-left":return{bottom:i,left:i};case"bottom-right":default:return{bottom:i,right:i}}})(),W=(()=>{if(y!=="auto"||!u)return null;let i=window.innerWidth,c=window.innerHeight,e=F,t=u.top<c/2,o=u.left>i/2,n=t?["bottom","top"]:["top","bottom"],l=o?["right","left"]:["left","right"],w=[`${n[0]}-${l[0]}`,`${n[0]}-${l[1]}`,`${n[1]}-${l[0]}`,`${n[1]}-${l[1]}`];for(let p of w){let N=0,T=0;if(p==="bottom-right"?(N=u.bottom+e,T=u.right-g):p==="bottom-left"?(N=u.bottom+e,T=u.left):p==="top-right"?(N=u.top-A-e,T=u.right-g):(N=u.top-A-e,T=u.left),N>=0&&T>=0&&N+A<=c&&T+g<=i)return{top:N,left:T}}let K=Math.min(Math.max(u.bottom+e,0),c-A),f=Math.min(Math.max(u.right-g,0),i-g);return{top:K,left:f}})(),$=i=>{if(!I)return;let c=m.current;if(!c)return;let e=c.getBoundingClientRect();v.current={x:i.clientX,y:i.clientY,top:e.top,left:e.left},k({top:e.top,left:e.left}),P(!0);let t=n=>{if(!v.current)return;let l=n.clientX-v.current.x,w=n.clientY-v.current.y;k({top:v.current.top+w,left:v.current.left+l})},o=()=>{P(!1),v.current=null,window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",o)};window.addEventListener("pointermove",t),window.addEventListener("pointerup",o,{once:!0})};return(0,R.jsxs)("div",{ref:m,role:"dialog","aria-modal":"false",className:M,style:{position:"fixed",...S?{top:S.top,left:S.left}:W?{top:W.top,left:W.left}:X,width:g,height:A,minWidth:D,minHeight:O,zIndex:j,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:B?"none":void 0,...J},children:[(0,R.jsxs)("div",{className:_,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:I?"move":void 0},onPointerDown:$,children:[(0,R.jsx)("div",{style:{fontWeight:600,color:"#111827"},children:s}),(0,R.jsx)("button",{type:"button",onClick:a,"aria-label":z,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:x?"#ef4444":void 0,transition:"color 120ms ease"},children:(0,R.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,R.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,R.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,R.jsx)("div",{className:U,style:{flex:1,overflow:"auto",background:"#ffffff"},children:r})]})};var H=require("react/jsx-runtime"),q=b.default.forwardRef(({children:r,onClick:s,label:a="Open chat",position:y="top-right",offset:g=8,icon:A,className:D,containerStyle:O,buttonClassName:F,buttonStyle:j,buttonSize:M=36,zIndex:J=10,disabled:_=!1,trigger:U,open:z,onOpenChange:E,renderButton:I,openWindowOnClick:u=!1,windowProps:x,windowContent:C},m)=>{let[B,P]=(0,b.useState)(!1),[v,S]=(0,b.useState)(!1),k=(0,b.useRef)(null),X=(0,b.useRef)(null),W=(0,b.useRef)(null),[$,i]=(0,b.useState)(null),c=U??"hover",e=(0,b.useMemo)(()=>{let f={position:"absolute"},p=`${g}px`;switch(y){case"top-left":return{...f,top:p,left:p};case"top-right":return{...f,top:p,right:p};case"bottom-left":return{...f,bottom:p,left:p};case"bottom-right":default:return{...f,bottom:p,right:p}}},[y,g]),t=c==="always"?!0:c==="manual"?!!z:B,o=f=>{E&&E(f)},n={onMouseEnter:c==="hover"?()=>{P(!0),o(!0)}:void 0,onMouseLeave:c==="hover"?()=>{P(!1),o(!1)}:void 0,onFocus:c==="focus"?()=>{P(!0),o(!0)}:void 0,onBlur:c==="focus"?()=>{P(!1),o(!1)}:void 0},l=!!x?.sendComponentImageAsContext;(0,b.useEffect)(()=>{v&&(async()=>{if(!l)return;let p=W.current;if(p)try{await new Promise(Q=>requestAnimationFrame(()=>setTimeout(Q,50)));let T=(await(0,ne.default)(p,{useCORS:!0,backgroundColor:null,scale:Math.min(2,Math.max(1,Math.ceil(p.offsetWidth/280)))})).toDataURL("image/png",.92);i(T)}catch{}})()},[v,l]);let w=f=>{k.current=f,typeof m=="function"?m(f):m&&typeof m=="object"&&(m.current=f)},K={type:"button","aria-label":a,onClick:f=>{s?.(f),!_&&u&&S(!0)},className:F,disabled:_,style:{...e,zIndex:J,width:M,height:M,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:_?"#f3f4f6":"white",color:_?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:_?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:t?1:0,transform:t?"scale(1)":"scale(0.95)",pointerEvents:t?"auto":"none",...j},tabIndex:t?0:-1,"aria-hidden":t?void 0:!0,ref:w,visible:t};return(0,H.jsxs)("div",{className:D,style:{position:"relative",display:"inline-block",...O},...n,ref:X,children:[(0,H.jsx)("div",{ref:W,style:{display:"inline-block"},children:r}),I?I(K):(0,H.jsx)("button",{...K,children:A??(0,H.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(M*.5)),height:Math.max(12,Math.floor(M*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,H.jsx)("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),u&&v&&C&&(0,H.jsx)(G,{...x,onClose:()=>{x?.onClose?.(),S(!1),i(null)},anchorRect:x?.anchorRect??(k.current?k.current.getBoundingClientRect():null),children:(()=>{if(l){if(!$)return(0,H.jsx)("div",{style:{padding:12,color:"#6b7280",fontSize:14},children:"Loading..."});if(b.default.isValidElement(C)){let p=[...C.props?.contextImages??[],$];try{return b.default.cloneElement(C,{contextImages:p})}catch{return C}}}return C})()})]})});q.displayName="ChatEnabled";var h=require("react");var Y="ai-hud:default-chatbot:history:";function Z(r){return`${Y}${r}`}function oe(r){try{typeof window<"u"&&window.localStorage.removeItem(Z(r))}catch{}}function re(){try{if(typeof window>"u")return;let r=[];for(let s=0;s<window.localStorage.length;s++){let a=window.localStorage.key(s);a&&a.startsWith(Y)&&r.push(a)}r.forEach(s=>window.localStorage.removeItem(s))}catch{}}var d=require("react/jsx-runtime"),pe="https://api.openai.com/v1/chat/completions";async function ge(r){return new Promise((s,a)=>{let y=new FileReader;y.onload=()=>s(y.result),y.onerror=a,y.readAsDataURL(r)})}var se=({model:r="gpt-4o-mini",placeholderApiKey:s,systemPrompt:a="You are a helpful assistant.",welcome:y="Hi! How can I help you today?",className:g,style:A,conversationId:D,context:O,contextImages:F,inputPlaceholder:j,inputValue:M})=>{let _=(e=>{if(e&&e!=="REPLACE_WITH_YOUR_OPENAI_API_KEY")return e;try{let t=globalThis||{};if(typeof t.AI_HUD_OPENAI_API_KEY=="string"&&t.AI_HUD_OPENAI_API_KEY)return t.AI_HUD_OPENAI_API_KEY;if(typeof t.__AI_HUD_OPENAI_API_KEY__=="string"&&t.__AI_HUD_OPENAI_API_KEY__)return t.__AI_HUD_OPENAI_API_KEY__}catch{}try{let t=globalThis.process;if(t&&t.env&&typeof t.env.AI_HUD_OPENAI_API_KEY=="string")return t.env.AI_HUD_OPENAI_API_KEY}catch{}return null})(s),U=(0,h.useRef)(null);if(!D&&!U.current){let e=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();U.current=e}let z=D??U.current,E=`${Y}${z}`,[I,u]=(0,h.useState)(()=>{try{let e=typeof window<"u"?window.localStorage.getItem(E):null;if(e){let t=JSON.parse(e);if(Array.isArray(t))return t}}catch{}return[{id:"welcome",role:"assistant",text:y}]}),[x,C]=(0,h.useState)(()=>typeof M=="string"?M:""),[m,B]=(0,h.useState)([]),[P,v]=(0,h.useState)(!1),S=(0,h.useRef)(null),k=(0,h.useCallback)(()=>{S.current?.scrollIntoView({behavior:"smooth"})},[]),X=async e=>{let t=Array.from(e.target.files||[]);if(t.length===0)return;let o=await Promise.all(t.map(ge));B(n=>[...n,...o]),e.target.value=""},W=e=>{B(t=>t.filter((o,n)=>n!==e))},$=(0,h.useCallback)((e,t)=>{let o=[];if(a&&o.push({role:"system",content:a}),typeof O<"u"){let n="";try{n=JSON.stringify(O)}catch{n=String(O)}o.push({role:"system",content:`Context: ${n}`})}if(Array.isArray(F)&&F.length>0){let n=F.filter(l=>typeof l=="string"&&(l.startsWith("data:image/")||l.startsWith("http")));if(n.length>0){let l=[{type:"text",text:"Context images"},...n.map(w=>({type:"image_url",image_url:{url:w}}))];o.push({role:"user",content:l})}}for(let n of e)if(n.role==="assistant")o.push({role:"assistant",content:n.text||""});else if((n.images?.length||0)>0){let l=[{type:"text",text:n.text||""},...n.images.map(w=>({type:"image_url",image_url:{url:w}}))];o.push({role:"user",content:l})}else o.push({role:"user",content:n.text||""});if(t)if(t.images.length>0){let n=[{type:"text",text:t.text},...t.images.map(l=>({type:"image_url",image_url:{url:l}}))];o.push({role:"user",content:n})}else o.push({role:"user",content:t.text});return console.log("result",o),o},[a,O]),i=(0,h.useCallback)(async()=>{let e=x.trim();if(!e&&m.length===0)return;let t={id:String(Date.now()),role:"user",text:e||void 0,images:m.length?m:void 0};u(o=>[...o,t]),C(""),B([]),v(!0);try{let o=$(I,{text:t.text||"",images:t.images||[]}),n=await fetch(pe,{method:"POST",headers:{"Content-Type":"application/json",..._?{Authorization:`Bearer ${_}`}:{}},body:JSON.stringify({model:r,messages:o,temperature:.7})});if(!n.ok)throw new Error(`OpenAI error: ${n.status}`);let w=(await n.json())?.choices?.[0]?.message?.content??"",K={id:String(Date.now()+1),role:"assistant",text:typeof w=="string"?w:String(w)};u(f=>[...f,K]),setTimeout(k,0)}catch(o){let n={id:String(Date.now()+1),role:"assistant",text:`Error: ${o?.message||"Failed to contact OpenAI"}`};u(l=>[...l,n])}finally{v(!1)}},[$,x,I,m,s,r,k]),c=(0,h.useMemo)(()=>(x.trim().length>0||m.length>0)&&!P,[x,m.length,P]);return(0,h.useEffect)(()=>{try{typeof window<"u"&&window.localStorage.setItem(E,JSON.stringify(I))}catch{}},[I,E]),(0,h.useEffect)(()=>()=>{if(!D)try{typeof window<"u"&&window.localStorage.removeItem(E)}catch{}},[D,E]),(0,d.jsxs)("div",{className:g,style:{display:"flex",flexDirection:"column",height:"100%",...A},children:[(0,d.jsxs)("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[I.map(e=>(0,d.jsx)("div",{style:{marginBottom:10,display:"flex",justifyContent:e.role==="user"?"flex-end":"flex-start"},children:(0,d.jsxs)("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:e.role==="user"?"#111827":"#f3f4f6",color:e.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.text,e.images&&e.images.length>0&&(0,d.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:e.images.map((t,o)=>(0,d.jsx)("img",{src:t,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},o))})]})},e.id)),(0,d.jsx)("div",{ref:S})]}),(0,d.jsxs)("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[(0,d.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,d.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:X,style:{display:"none"},id:"ai-hud-chatbot-file"}),(0,d.jsx)("label",{htmlFor:"ai-hud-chatbot-file",children:(0,d.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,d.jsx)("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),(0,d.jsx)("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),(0,d.jsx)("input",{value:x,onChange:e=>C(e.target.value),placeholder:j??"Type a message...",onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),c&&i())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),(0,d.jsx)("button",{type:"button",disabled:!c,onClick:()=>void i(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:c?"#111827":"#e5e7eb",color:c?"#ffffff":"#9ca3af",cursor:c?"pointer":"not-allowed"},children:"Send"})]}),m.length>0&&(0,d.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:m.map((e,t)=>(0,d.jsxs)("div",{style:{position:"relative"},children:[(0,d.jsx)("img",{src:e,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),(0,d.jsx)("button",{type:"button",onClick:()=>W(t),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},t))})]})]})};0&&(module.exports={CHAT_STORAGE_PREFIX,ChatEnabled,DefaultChatbot,FloatingWindow,clearAllConversations,clearConversation,getConversationStorageKey});
//# sourceMappingURL=index.cjs.map