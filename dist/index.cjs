"use strict";var ie=Object.create;var Y=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var ue=(n,a)=>{for(var s in a)Y(n,s,{get:a[s],enumerable:!0})},ee=(n,a,s,h)=>{if(a&&typeof a=="object"||typeof a=="function")for(let f of le(a))!ce.call(n,f)&&f!==s&&Y(n,f,{get:()=>a[f],enumerable:!(h=se(a,f))||h.enumerable});return n};var te=(n,a,s)=>(s=n!=null?ie(de(n)):{},ee(a||!n||!n.__esModule?Y(s,"default",{value:n,enumerable:!0}):s,n)),fe=n=>ee(Y({},"__esModule",{value:!0}),n);var me={};ue(me,{CHAT_STORAGE_PREFIX:()=>J,ChatEnabled:()=>Z,DefaultChatbot:()=>ae,FloatingWindow:()=>V,clearAllConversations:()=>re,clearConversation:()=>ne,getConversationStorageKey:()=>q});module.exports=fe(me);var m=te(require("react"),1),oe=te(require("html2canvas"),1);var H=require("react"),M=require("react/jsx-runtime"),V=({children:n,title:a,onClose:s,position:h="bottom-right",width:f=360,height:S=480,minWidth:B=280,minHeight:O=240,offset:N=16,zIndex:j=1e3,className:U,style:k,headerClassName:y,bodyClassName:K,closeButtonAriaLabel:P="Close",closeOnEscape:$=!0,draggable:b=!0,anchorRect:d})=>{let[I,w]=(0,H.useState)(!1),x=(0,H.useRef)(null),[G,T]=(0,H.useState)(!1),v=(0,H.useRef)(null),[F,L]=(0,H.useState)(null);(0,H.useEffect)(()=>{if(!$)return;let e=t=>{t.key==="Escape"&&s?.()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[$,s]);let W=(()=>{let e=`${N}px`;switch(h){case"top-left":return{top:e,left:e};case"top-right":return{top:e,right:e};case"bottom-left":return{bottom:e,left:e};case"bottom-right":default:return{bottom:e,right:e}}})(),o=(()=>{if(h!=="auto"||!d)return null;let e=window.innerWidth,t=window.innerHeight,i=N,c=d.top<t/2,C=d.left>e/2,R=c?["bottom","top"]:["top","bottom"],E=C?["right","left"]:["left","right"],X=[`${R[0]}-${E[0]}`,`${R[0]}-${E[1]}`,`${R[1]}-${E[0]}`,`${R[1]}-${E[1]}`];for(let u of X){let _=0,A=0;if(u==="bottom-right"?(_=d.bottom+i,A=d.right-f):u==="bottom-left"?(_=d.bottom+i,A=d.left):u==="top-right"?(_=d.top-S-i,A=d.right-f):(_=d.top-S-i,A=d.left),_>=0&&A>=0&&_+S<=t&&A+f<=e)return{top:_,left:A}}let z=Math.min(Math.max(d.bottom+i,0),t-S),g=Math.min(Math.max(d.right-f,0),e-f);return{top:z,left:g}})(),r=e=>{if(!b)return;let t=x.current;if(!t)return;let i=t.getBoundingClientRect();v.current={x:e.clientX,y:e.clientY,top:i.top,left:i.left},L({top:i.top,left:i.left}),T(!0);let c=R=>{if(!v.current)return;let E=R.clientX-v.current.x,X=R.clientY-v.current.y;L({top:v.current.top+X,left:v.current.left+E})},C=()=>{T(!1),v.current=null,window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",C)};window.addEventListener("pointermove",c),window.addEventListener("pointerup",C,{once:!0})};return(0,M.jsxs)("div",{ref:x,role:"dialog","aria-modal":"false",className:U,style:{position:"fixed",...F?{top:F.top,left:F.left}:o?{top:o.top,left:o.left}:W,width:f,height:S,minWidth:B,minHeight:O,zIndex:j,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:G?"none":void 0,...k},children:[(0,M.jsxs)("div",{className:y,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:b?"move":void 0},onPointerDown:r,children:[(0,M.jsx)("div",{style:{fontWeight:600,color:"#111827"},children:a}),(0,M.jsx)("button",{type:"button",onClick:s,"aria-label":P,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:I?"#ef4444":void 0,transition:"color 120ms ease"},children:(0,M.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,M.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,M.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,M.jsx)("div",{className:K,style:{flex:1,overflow:"auto",background:"#ffffff"},children:n})]})};var D=require("react/jsx-runtime"),Z=m.default.forwardRef(({children:n,onClick:a,label:s="Open chat",position:h="top-right",offset:f=8,icon:S,className:B,containerStyle:O,buttonClassName:N,buttonStyle:j,buttonSize:U=36,zIndex:k=10,disabled:y=!1,trigger:K,open:P,onOpenChange:$,renderButton:b,openWindowOnClick:d=!1,windowProps:I,windowContent:w},x)=>{let[G,T]=(0,m.useState)(!1),[v,F]=(0,m.useState)(!1),L=(0,m.useRef)(null),W=(0,m.useRef)(null),o=(0,m.useRef)(null),[r,e]=(0,m.useState)(null),t=K??"hover",i=(0,m.useMemo)(()=>{let g={position:"absolute"},u=`${f}px`;switch(h){case"top-left":return{...g,top:u,left:u};case"top-right":return{...g,top:u,right:u};case"bottom-left":return{...g,bottom:u,left:u};case"bottom-right":default:return{...g,bottom:u,right:u}}},[h,f]),c=t==="always"?!0:t==="manual"?!!P:G,C=g=>{$&&$(g)},R={onMouseEnter:t==="hover"?()=>{T(!0),C(!0)}:void 0,onMouseLeave:t==="hover"?()=>{T(!1),C(!1)}:void 0,onFocus:t==="focus"?()=>{T(!0),C(!0)}:void 0,onBlur:t==="focus"?()=>{T(!1),C(!1)}:void 0},E=!!I?.sendComponentImageAsContext;(0,m.useEffect)(()=>{v&&(async()=>{if(!E)return;let u=o.current;if(u)try{await new Promise(Q=>requestAnimationFrame(()=>setTimeout(Q,50)));let A=(await(0,oe.default)(u,{useCORS:!0,backgroundColor:null,scale:Math.min(2,Math.max(1,Math.ceil(u.offsetWidth/280)))})).toDataURL("image/png",.92);e(A)}catch{}})()},[v,E]);let X=g=>{L.current=g,typeof x=="function"?x(g):x&&typeof x=="object"&&(x.current=g)},z={type:"button","aria-label":s,onClick:g=>{a?.(g),!y&&d&&F(!0)},className:N,disabled:y,style:{...i,zIndex:k,width:U,height:U,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:y?"#f3f4f6":"white",color:y?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:y?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:c?1:0,transform:c?"scale(1)":"scale(0.95)",pointerEvents:c?"auto":"none",...j},tabIndex:c?0:-1,"aria-hidden":c?void 0:!0,ref:X,visible:c};return(0,D.jsxs)("div",{className:B,style:{position:"relative",display:"inline-block",...O},...R,ref:W,children:[(0,D.jsx)("div",{ref:o,style:{display:"inline-block"},children:n}),b?b(z):(0,D.jsx)("button",{...z,children:S??(0,D.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(U*.5)),height:Math.max(12,Math.floor(U*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,D.jsx)("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),d&&v&&w&&(0,D.jsx)(V,{...I,onClose:()=>{I?.onClose?.(),F(!1),e(null)},anchorRect:I?.anchorRect??(L.current?L.current.getBoundingClientRect():null),children:(()=>{if(E){if(!r)return(0,D.jsx)("div",{style:{padding:12,color:"#6b7280",fontSize:14},children:"Preparing context\u2026"});if(m.default.isValidElement(w)){let u=[...w.props?.contextImages??[],r];try{return m.default.cloneElement(w,{contextImages:u})}catch{return w}}}return w})()})]})});Z.displayName="ChatEnabled";var p=require("react");var J="ai-hud:default-chatbot:history:";function q(n){return`${J}${n}`}function ne(n){try{typeof window<"u"&&window.localStorage.removeItem(q(n))}catch{}}function re(){try{if(typeof window>"u")return;let n=[];for(let a=0;a<window.localStorage.length;a++){let s=window.localStorage.key(a);s&&s.startsWith(J)&&n.push(s)}n.forEach(a=>window.localStorage.removeItem(a))}catch{}}var l=require("react/jsx-runtime"),pe="https://api.openai.com/v1/chat/completions";async function ge(n){return new Promise((a,s)=>{let h=new FileReader;h.onload=()=>a(h.result),h.onerror=s,h.readAsDataURL(n)})}var ae=({model:n="gpt-4o-mini",placeholderApiKey:a="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",systemPrompt:s="You are a helpful assistant.",welcome:h="Hi! How can I help you today?",className:f,style:S,conversationId:B,context:O,contextImages:N})=>{let j=(0,p.useRef)(null);if(!B&&!j.current){let o=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();j.current=o}let U=B??j.current,k=`${J}${U}`,[y,K]=(0,p.useState)(()=>{try{let o=typeof window<"u"?window.localStorage.getItem(k):null;if(o){let r=JSON.parse(o);if(Array.isArray(r))return r}}catch{}return[{id:"welcome",role:"assistant",text:h}]}),[P,$]=(0,p.useState)(""),[b,d]=(0,p.useState)([]),[I,w]=(0,p.useState)(!1),x=(0,p.useRef)(null),G=(0,p.useCallback)(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[]),T=async o=>{let r=Array.from(o.target.files||[]);if(r.length===0)return;let e=await Promise.all(r.map(ge));d(t=>[...t,...e]),o.target.value=""},v=o=>{d(r=>r.filter((e,t)=>t!==o))},F=(0,p.useCallback)((o,r)=>{let e=[];if(s&&e.push({role:"system",content:s}),typeof O<"u"){let t="";try{t=JSON.stringify(O)}catch{t=String(O)}e.push({role:"system",content:`Context: ${t}`})}if(Array.isArray(N)&&N.length>0){let t=N.filter(i=>typeof i=="string"&&(i.startsWith("data:image/")||i.startsWith("http")));if(t.length>0){let i=[{type:"text",text:"Context images"},...t.map(c=>({type:"image_url",image_url:{url:c}}))];e.push({role:"user",content:i})}}for(let t of o)if(t.role==="assistant")e.push({role:"assistant",content:t.text||""});else if((t.images?.length||0)>0){let i=[{type:"text",text:t.text||""},...t.images.map(c=>({type:"image_url",image_url:{url:c}}))];e.push({role:"user",content:i})}else e.push({role:"user",content:t.text||""});if(r)if(r.images.length>0){let t=[{type:"text",text:r.text},...r.images.map(i=>({type:"image_url",image_url:{url:i}}))];e.push({role:"user",content:t})}else e.push({role:"user",content:r.text});return console.log("result",e),e},[s,O]),L=(0,p.useCallback)(async()=>{let o=P.trim();if(!o&&b.length===0)return;let r={id:String(Date.now()),role:"user",text:o||void 0,images:b.length?b:void 0};K(e=>[...e,r]),$(""),d([]),w(!0);try{let e=F(y,{text:r.text||"",images:r.images||[]}),t=await fetch(pe,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({model:n,messages:e,modalities:["text","image"],temperature:.7})});if(!t.ok)throw new Error(`OpenAI error: ${t.status}`);let c=(await t.json())?.choices?.[0]?.message?.content??"",C={id:String(Date.now()+1),role:"assistant",text:typeof c=="string"?c:String(c)};K(R=>[...R,C]),setTimeout(G,0)}catch(e){let t={id:String(Date.now()+1),role:"assistant",text:`Error: ${e?.message||"Failed to contact OpenAI"}`};K(i=>[...i,t])}finally{w(!1)}},[F,P,y,b,a,n,G]),W=(0,p.useMemo)(()=>(P.trim().length>0||b.length>0)&&!I,[P,b.length,I]);return(0,p.useEffect)(()=>{try{typeof window<"u"&&window.localStorage.setItem(k,JSON.stringify(y))}catch{}},[y,k]),(0,p.useEffect)(()=>()=>{if(!B)try{typeof window<"u"&&window.localStorage.removeItem(k)}catch{}},[B,k]),(0,l.jsxs)("div",{className:f,style:{display:"flex",flexDirection:"column",height:"100%",...S},children:[(0,l.jsxs)("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[y.map(o=>(0,l.jsx)("div",{style:{marginBottom:10,display:"flex",justifyContent:o.role==="user"?"flex-end":"flex-start"},children:(0,l.jsxs)("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:o.role==="user"?"#111827":"#f3f4f6",color:o.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[o.text,o.images&&o.images.length>0&&(0,l.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:o.images.map((r,e)=>(0,l.jsx)("img",{src:r,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},e))})]})},o.id)),(0,l.jsx)("div",{ref:x})]}),(0,l.jsxs)("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,l.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:T,style:{display:"none"},id:"ai-hud-chatbot-file"}),(0,l.jsx)("label",{htmlFor:"ai-hud-chatbot-file",children:(0,l.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,l.jsx)("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),(0,l.jsx)("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),(0,l.jsx)("input",{value:P,onChange:o=>$(o.target.value),placeholder:"Type a message...",onKeyDown:o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),W&&L())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),(0,l.jsx)("button",{type:"button",disabled:!W,onClick:()=>void L(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:W?"#111827":"#e5e7eb",color:W?"#ffffff":"#9ca3af",cursor:W?"pointer":"not-allowed"},children:"Send"})]}),b.length>0&&(0,l.jsx)("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:b.map((o,r)=>(0,l.jsxs)("div",{style:{position:"relative"},children:[(0,l.jsx)("img",{src:o,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),(0,l.jsx)("button",{type:"button",onClick:()=>v(r),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},r))})]})]})};0&&(module.exports={CHAT_STORAGE_PREFIX,ChatEnabled,DefaultChatbot,FloatingWindow,clearAllConversations,clearConversation,getConversationStorageKey});
//# sourceMappingURL=index.cjs.map