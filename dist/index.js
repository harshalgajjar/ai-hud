import ie,{useMemo as se,useRef as ae,useState as Z}from"react";import{useEffect as re,useRef as V,useState as Y}from"react";import{jsx as _,jsxs as z}from"react/jsx-runtime";var G=({children:d,title:u,onClose:c,position:m="bottom-right",width:v=360,height:R=480,minWidth:P=280,minHeight:L=240,offset:D=16,zIndex:E=1e3,className:b,style:F,headerClassName:g,bodyClassName:O,closeButtonAriaLabel:h="Close",closeOnEscape:M=!0,draggable:k=!0,anchorRect:i})=>{let[I,T]=Y(!1),x=V(null),[N,C]=Y(!1),y=V(null),[w,e]=Y(null);re(()=>{if(!M)return;let o=a=>{a.key==="Escape"&&c?.()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[M,c]);let t=(()=>{let o=`${D}px`;switch(m){case"top-left":return{top:o,left:o};case"top-right":return{top:o,right:o};case"bottom-left":return{bottom:o,left:o};case"bottom-right":default:return{bottom:o,right:o}}})(),r=(()=>{if(m!=="auto"||!i)return null;let o=window.innerWidth,a=window.innerHeight,f=D,S=i.top<a/2,s=i.left>o/2,l=S?["bottom","top"]:["top","bottom"],B=s?["right","left"]:["left","right"],K=[`${l[0]}-${B[0]}`,`${l[0]}-${B[1]}`,`${l[1]}-${B[0]}`,`${l[1]}-${B[1]}`];for(let X of K){let W=0,A=0;if(X==="bottom-right"?(W=i.bottom+f,A=i.right-v):X==="bottom-left"?(W=i.bottom+f,A=i.left):X==="top-right"?(W=i.top-R-f,A=i.right-v):(W=i.top-R-f,A=i.left),W>=0&&A>=0&&W+R<=a&&A+v<=o)return{top:W,left:A}}let oe=Math.min(Math.max(i.bottom+f,0),a-R),ne=Math.min(Math.max(i.right-v,0),o-v);return{top:oe,left:ne}})(),n=o=>{if(!k)return;let a=x.current;if(!a)return;let f=a.getBoundingClientRect();y.current={x:o.clientX,y:o.clientY,top:f.top,left:f.left},e({top:f.top,left:f.left}),C(!0);let S=l=>{if(!y.current)return;let B=l.clientX-y.current.x,K=l.clientY-y.current.y;e({top:y.current.top+K,left:y.current.left+B})},s=()=>{C(!1),y.current=null,window.removeEventListener("pointermove",S),window.removeEventListener("pointerup",s)};window.addEventListener("pointermove",S),window.addEventListener("pointerup",s,{once:!0})};return z("div",{ref:x,role:"dialog","aria-modal":"false",className:b,style:{position:"fixed",...w?{top:w.top,left:w.left}:r?{top:r.top,left:r.left}:t,width:v,height:R,minWidth:P,minHeight:L,zIndex:E,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:N?"none":void 0,...F},children:[z("div",{className:g,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:k?"move":void 0},onPointerDown:n,children:[_("div",{style:{fontWeight:600,color:"#111827"},children:u}),_("button",{type:"button",onClick:c,"aria-label":h,onMouseEnter:()=>T(!0),onMouseLeave:()=>T(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:I?"#ef4444":void 0,transition:"color 120ms ease"},children:z("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[_("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),_("div",{className:O,style:{flex:1,overflow:"auto",background:"#ffffff"},children:d})]})};import{jsx as U,jsxs as le}from"react/jsx-runtime";var q=ie.forwardRef(({children:d,onClick:u,label:c="Open chat",position:m="top-right",offset:v=8,icon:R,className:P,containerStyle:L,buttonClassName:D,buttonStyle:E,buttonSize:b=36,zIndex:F=10,disabled:g=!1,trigger:O,open:h,onOpenChange:M,renderButton:k,openWindowOnClick:i=!1,windowProps:I,windowContent:T},x)=>{let[N,C]=Z(!1),[y,w]=Z(!1),e=ae(null),t=O??"hover",r=se(()=>{let s={position:"absolute"},l=`${v}px`;switch(m){case"top-left":return{...s,top:l,left:l};case"top-right":return{...s,top:l,right:l};case"bottom-left":return{...s,bottom:l,left:l};case"bottom-right":default:return{...s,bottom:l,right:l}}},[m,v]),n=t==="always"?!0:t==="manual"?!!h:N,o=s=>{M&&M(s)},a={onMouseEnter:t==="hover"?()=>{C(!0),o(!0)}:void 0,onMouseLeave:t==="hover"?()=>{C(!1),o(!1)}:void 0,onFocus:t==="focus"?()=>{C(!0),o(!0)}:void 0,onBlur:t==="focus"?()=>{C(!1),o(!1)}:void 0},f=s=>{e.current=s,typeof x=="function"?x(s):x&&typeof x=="object"&&(x.current=s)},S={type:"button","aria-label":c,onClick:s=>{u?.(s),!g&&i&&w(!0)},className:D,disabled:g,style:{...r,zIndex:F,width:b,height:b,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:g?"#f3f4f6":"white",color:g?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:g?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:n?1:0,transform:n?"scale(1)":"scale(0.95)",pointerEvents:n?"auto":"none",...E},tabIndex:n?0:-1,"aria-hidden":n?void 0:!0,ref:f,visible:n};return le("div",{className:P,style:{position:"relative",display:"inline-block",...L},...a,children:[d,k?k(S):U("button",{...S,children:R??U("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(b*.5)),height:Math.max(12,Math.floor(b*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:U("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),i&&y&&T&&U(G,{...I,onClose:()=>{I?.onClose?.(),w(!1)},anchorRect:I?.anchorRect??(e.current?e.current.getBoundingClientRect():null),children:T})]})});q.displayName="ChatEnabled";import{useCallback as J,useEffect as ee,useMemo as ue,useRef as te,useState as j}from"react";var $="ai-hud:default-chatbot:history:";function Q(d){return`${$}${d}`}function de(d){try{typeof window<"u"&&window.localStorage.removeItem(Q(d))}catch{}}function ce(){try{if(typeof window>"u")return;let d=[];for(let u=0;u<window.localStorage.length;u++){let c=window.localStorage.key(u);c&&c.startsWith($)&&d.push(c)}d.forEach(u=>window.localStorage.removeItem(u))}catch{}}import{jsx as p,jsxs as H}from"react/jsx-runtime";var fe="https://api.openai.com/v1/chat/completions";async function pe(d){return new Promise((u,c)=>{let m=new FileReader;m.onload=()=>u(m.result),m.onerror=c,m.readAsDataURL(d)})}var ge=({model:d="gpt-4o-mini",placeholderApiKey:u="REPLACE_WITH_YOUR_OPENAI_API_KEY",systemPrompt:c="You are a helpful assistant.",welcome:m="Hi! How can I help you today?",className:v,style:R,conversationId:P})=>{let L=te(null);if(!P&&!L.current){let e=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();L.current=e}let D=P??L.current,E=`${$}${D}`,[b,F]=j(()=>{try{let e=typeof window<"u"?window.localStorage.getItem(E):null;if(e){let t=JSON.parse(e);if(Array.isArray(t))return t}}catch{}return[{id:"welcome",role:"assistant",text:m}]}),[g,O]=j(""),[h,M]=j([]),[k,i]=j(!1),I=te(null),T=J(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[]),x=async e=>{let t=Array.from(e.target.files||[]);if(t.length===0)return;let r=await Promise.all(t.map(pe));M(n=>[...n,...r]),e.target.value=""},N=e=>{M(t=>t.filter((r,n)=>n!==e))},C=J((e,t)=>{let r=[];c&&r.push({role:"system",content:c});for(let n of e)if(n.role==="assistant")r.push({role:"assistant",content:n.text||""});else if((n.images?.length||0)>0){let o=[{type:"text",text:n.text||""},...n.images.map(a=>({type:"image_url",image_url:{url:a}}))];r.push({role:"user",content:o})}else r.push({role:"user",content:n.text||""});if(t)if(t.images.length>0){let n=[{type:"text",text:t.text},...t.images.map(o=>({type:"image_url",image_url:{url:o}}))];r.push({role:"user",content:n})}else r.push({role:"user",content:t.text});return r},[c]),y=J(async()=>{let e=g.trim();if(!e&&h.length===0)return;let t={id:String(Date.now()),role:"user",text:e||void 0,images:h.length?h:void 0};F(r=>[...r,t]),O(""),M([]),i(!0);try{let r=C(b,{text:t.text||"",images:t.images||[]}),n=await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({model:d,messages:r,temperature:.7})});if(!n.ok)throw new Error(`OpenAI error: ${n.status}`);let a=(await n.json())?.choices?.[0]?.message?.content??"",f={id:String(Date.now()+1),role:"assistant",text:typeof a=="string"?a:String(a)};F(S=>[...S,f]),setTimeout(T,0)}catch(r){let n={id:String(Date.now()+1),role:"assistant",text:`Error: ${r?.message||"Failed to contact OpenAI"}`};F(o=>[...o,n])}finally{i(!1)}},[C,g,b,h,u,d,T]),w=ue(()=>(g.trim().length>0||h.length>0)&&!k,[g,h.length,k]);return ee(()=>{try{typeof window<"u"&&window.localStorage.setItem(E,JSON.stringify(b))}catch{}},[b,E]),ee(()=>()=>{if(!P)try{typeof window<"u"&&window.localStorage.removeItem(E)}catch{}},[P,E]),H("div",{className:v,style:{display:"flex",flexDirection:"column",height:"100%",...R},children:[H("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[b.map(e=>p("div",{style:{marginBottom:10,display:"flex",justifyContent:e.role==="user"?"flex-end":"flex-start"},children:H("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:e.role==="user"?"#111827":"#f3f4f6",color:e.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.text,e.images&&e.images.length>0&&p("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:e.images.map((t,r)=>p("img",{src:t,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},r))})]})},e.id)),p("div",{ref:I})]}),H("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[H("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[p("input",{type:"file",accept:"image/*",multiple:!0,onChange:x,style:{display:"none"},id:"ai-hud-chatbot-file"}),p("label",{htmlFor:"ai-hud-chatbot-file",children:p("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:H("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[p("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),p("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),p("input",{value:g,onChange:e=>O(e.target.value),placeholder:"Type a message...",onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),w&&y())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),p("button",{type:"button",disabled:!w,onClick:()=>void y(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:w?"#111827":"#e5e7eb",color:w?"#ffffff":"#9ca3af",cursor:w?"pointer":"not-allowed"},children:"Send"})]}),h.length>0&&p("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:h.map((e,t)=>H("div",{style:{position:"relative"},children:[p("img",{src:e,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),p("button",{type:"button",onClick:()=>N(t),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},t))})]})]})};export{$ as CHAT_STORAGE_PREFIX,q as ChatEnabled,ge as DefaultChatbot,G as FloatingWindow,ce as clearAllConversations,de as clearConversation,Q as getConversationStorageKey};
//# sourceMappingURL=index.js.map