import q,{useMemo as G,useState as U}from"react";import{useEffect as $,useState as V}from"react";import{jsx as T,jsxs as D}from"react/jsx-runtime";var O=({children:u,title:f,onClose:l,position:d="bottom-right",width:P=360,height:L=480,minWidth:x=280,minHeight:w=240,offset:c=16,zIndex:M=1e3,className:s,style:v,headerClassName:p,bodyClassName:S,closeButtonAriaLabel:I="Close",closeOnEscape:h=!0})=>{let[F,C]=V(!1);$(()=>{if(!h)return;let r=g=>{g.key==="Escape"&&l?.()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[h,l]);let R=(()=>{let r=`${c}px`;switch(d){case"top-left":return{top:r,left:r};case"top-right":return{top:r,right:r};case"bottom-left":return{bottom:r,left:r};case"bottom-right":default:return{bottom:r,right:r}}})();return D("div",{role:"dialog","aria-modal":"false",className:s,style:{position:"fixed",...R,width:P,height:L,minWidth:x,minHeight:w,zIndex:M,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",...v},children:[D("div",{className:p,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb"},children:[T("div",{style:{fontWeight:600,color:"#111827"},children:f}),T("button",{type:"button",onClick:l,"aria-label":I,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:F?"#ef4444":void 0,transition:"color 120ms ease"},children:D("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[T("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),T("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),T("div",{className:S,style:{flex:1,overflow:"auto",background:"#ffffff"},children:u})]})};import{useCallback as A,useMemo as Y,useRef as z,useState as H}from"react";import{jsx as a,jsxs as E}from"react/jsx-runtime";var J="https://api.openai.com/v1/chat/completions";async function Z(u){return new Promise((f,l)=>{let d=new FileReader;d.onload=()=>f(d.result),d.onerror=l,d.readAsDataURL(u)})}var B=({model:u="gpt-4o-mini",placeholderApiKey:f="REPLACE_WITH_YOUR_OPENAI_API_KEY",systemPrompt:l="You are a helpful assistant.",welcome:d="Hi! How can I help you today?",className:P,style:L})=>{let[x,w]=H([{id:"welcome",role:"assistant",text:d}]),[c,M]=H(""),[s,v]=H([]),[p,S]=H(!1),I=z(null),h=A(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[]),F=async e=>{let t=Array.from(e.target.files||[]);if(t.length===0)return;let n=await Promise.all(t.map(Z));v(o=>[...o,...n]),e.target.value=""},C=e=>{v(t=>t.filter((n,o)=>o!==e))},R=A((e,t)=>{let n=[];l&&n.push({role:"system",content:l});for(let o of e)if(o.role==="assistant")n.push({role:"assistant",content:o.text||""});else if((o.images?.length||0)>0){let i=[{type:"text",text:o.text||""},...o.images.map(k=>({type:"image_url",image_url:{url:k}}))];n.push({role:"user",content:i})}else n.push({role:"user",content:o.text||""});if(t)if(t.images.length>0){let o=[{type:"text",text:t.text},...t.images.map(i=>({type:"image_url",image_url:{url:i}}))];n.push({role:"user",content:o})}else n.push({role:"user",content:t.text});return n},[l]),r=A(async()=>{let e=c.trim();if(!e&&s.length===0)return;let t={id:String(Date.now()),role:"user",text:e||void 0,images:s.length?s:void 0};w(n=>[...n,t]),M(""),v([]),S(!0);try{let n=R(x,{text:t.text||"",images:t.images||[]}),o=await fetch(J,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify({model:u,messages:n,temperature:.7})});if(!o.ok)throw new Error(`OpenAI error: ${o.status}`);let k=(await o.json())?.choices?.[0]?.message?.content??"",b={id:String(Date.now()+1),role:"assistant",text:typeof k=="string"?k:String(k)};w(W=>[...W,b]),setTimeout(h,0)}catch(n){let o={id:String(Date.now()+1),role:"assistant",text:`Error: ${n?.message||"Failed to contact OpenAI"}`};w(i=>[...i,o])}finally{S(!1)}},[R,c,x,s,f,u,h]),g=Y(()=>(c.trim().length>0||s.length>0)&&!p,[c,s.length,p]);return E("div",{className:P,style:{display:"flex",flexDirection:"column",height:"100%",...L},children:[E("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[x.map(e=>a("div",{style:{marginBottom:10,display:"flex",justifyContent:e.role==="user"?"flex-end":"flex-start"},children:E("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:e.role==="user"?"#111827":"#f3f4f6",color:e.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.text,e.images&&e.images.length>0&&a("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:e.images.map((t,n)=>a("img",{src:t,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},n))})]})},e.id)),a("div",{ref:I})]}),E("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[E("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a("input",{type:"file",accept:"image/*",multiple:!0,onChange:F,style:{display:"none"},id:"ai-hud-chatbot-file"}),a("label",{htmlFor:"ai-hud-chatbot-file",children:a("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:E("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),a("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),a("input",{value:c,onChange:e=>M(e.target.value),placeholder:"Type a message...",onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),g&&r())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),a("button",{type:"button",disabled:!g,onClick:()=>void r(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:g?"#111827":"#e5e7eb",color:g?"#ffffff":"#9ca3af",cursor:g?"pointer":"not-allowed"},children:"Send"})]}),s.length>0&&a("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:s.map((e,t)=>E("div",{style:{position:"relative"},children:[a("img",{src:e,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),a("button",{type:"button",onClick:()=>C(t),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},t))})]})]})};import{jsx as N,jsxs as Q}from"react/jsx-runtime";var j=q.forwardRef(({children:u,onClick:f,label:l="Open chat",position:d="top-right",offset:P=8,icon:L,className:x,containerStyle:w,buttonClassName:c,buttonStyle:M,buttonSize:s=36,zIndex:v=10,disabled:p=!1,trigger:S,open:I,onOpenChange:h,renderButton:F,openWindowOnClick:C=!1,windowProps:R,windowContent:r},g)=>{let[e,t]=U(!1),[n,o]=U(!1),i=S??"hover",k=G(()=>{let m={position:"absolute"},y=`${P}px`;switch(d){case"top-left":return{...m,top:y,left:y};case"top-right":return{...m,top:y,right:y};case"bottom-left":return{...m,bottom:y,left:y};case"bottom-right":default:return{...m,bottom:y,right:y}}},[d,P]),b=i==="always"?!0:i==="manual"?!!I:e,W=m=>{h&&h(m)},K={onMouseEnter:i==="hover"?()=>{t(!0),W(!0)}:void 0,onMouseLeave:i==="hover"?()=>{t(!1),W(!1)}:void 0,onFocus:i==="focus"?()=>{t(!0),W(!0)}:void 0,onBlur:i==="focus"?()=>{t(!1),W(!1)}:void 0},_={type:"button","aria-label":l,onClick:m=>{f?.(m),!p&&C&&o(!0)},className:c,disabled:p,style:{...k,zIndex:v,width:s,height:s,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:p?"#f3f4f6":"white",color:p?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:p?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:b?1:0,transform:b?"scale(1)":"scale(0.95)",pointerEvents:b?"auto":"none",...M},tabIndex:b?0:-1,"aria-hidden":b?void 0:!0,ref:g,visible:b};return Q("div",{className:x,style:{position:"relative",display:"inline-block",...w},...K,children:[u,F?F(_):N("button",{..._,children:L??N("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(s*.5)),height:Math.max(12,Math.floor(s*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:N("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),C&&n&&N(O,{...R,onClose:()=>{R?.onClose?.(),o(!1)},children:r??N(B,{})})]})});j.displayName="ChatEnabled";export{j as ChatEnabled,B as DefaultChatbot,O as FloatingWindow};
//# sourceMappingURL=index.js.map