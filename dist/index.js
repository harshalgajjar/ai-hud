import Q,{useMemo as ee,useState as Y}from"react";import{useEffect as X,useRef as K,useState as O}from"react";import{jsx as N,jsxs as A}from"react/jsx-runtime";var _=({children:b,title:y,onClose:l,position:d="bottom-right",width:M=360,height:W=480,minWidth:w=280,minHeight:C=240,offset:f=16,zIndex:S=1e3,className:s,style:R,headerClassName:g,bodyClassName:I,closeButtonAriaLabel:L="Close",closeOnEscape:x=!0,draggable:E=!0})=>{let[T,v]=O(!1),P=K(null),[h,t]=O(!1),e=K(null),[o,n]=O(null);X(()=>{if(!x)return;let r=c=>{c.key==="Escape"&&l?.()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[x,l]);let a=(()=>{let r=`${f}px`;switch(d){case"top-left":return{top:r,left:r};case"top-right":return{top:r,right:r};case"bottom-left":return{bottom:r,left:r};case"bottom-right":default:return{bottom:r,right:r}}})(),m=r=>{if(!E)return;let c=P.current;if(!c)return;let F=c.getBoundingClientRect();e.current={x:r.clientX,y:r.clientY,top:F.top,left:F.left},n({top:F.top,left:F.left}),t(!0);let D=u=>{if(!e.current)return;let V=u.clientX-e.current.x,z=u.clientY-e.current.y;n({top:e.current.top+z,left:e.current.left+V})},p=()=>{t(!1),e.current=null,window.removeEventListener("pointermove",D),window.removeEventListener("pointerup",p)};window.addEventListener("pointermove",D),window.addEventListener("pointerup",p,{once:!0})};return A("div",{ref:P,role:"dialog","aria-modal":"false",className:s,style:{position:"fixed",...o?{top:o.top,left:o.left}:a,width:M,height:W,minWidth:w,minHeight:C,zIndex:S,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:h?"none":void 0,...R},children:[A("div",{className:g,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:E?"move":void 0},onPointerDown:m,children:[N("div",{style:{fontWeight:600,color:"#111827"},children:y}),N("button",{type:"button",onClick:l,"aria-label":L,onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:T?"#ef4444":void 0,transition:"color 120ms ease"},children:A("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[N("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),N("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),N("div",{className:I,style:{flex:1,overflow:"auto",background:"#ffffff"},children:b})]})};import{useCallback as U,useMemo as J,useRef as Z,useState as B}from"react";import{jsx as i,jsxs as k}from"react/jsx-runtime";var q="https://api.openai.com/v1/chat/completions";async function G(b){return new Promise((y,l)=>{let d=new FileReader;d.onload=()=>y(d.result),d.onerror=l,d.readAsDataURL(b)})}var j=({model:b="gpt-4o-mini",placeholderApiKey:y="REPLACE_WITH_YOUR_OPENAI_API_KEY",systemPrompt:l="You are a helpful assistant.",welcome:d="Hi! How can I help you today?",className:M,style:W})=>{let[w,C]=B([{id:"welcome",role:"assistant",text:d}]),[f,S]=B(""),[s,R]=B([]),[g,I]=B(!1),L=Z(null),x=U(()=>{L.current?.scrollIntoView({behavior:"smooth"})},[]),E=async t=>{let e=Array.from(t.target.files||[]);if(e.length===0)return;let o=await Promise.all(e.map(G));R(n=>[...n,...o]),t.target.value=""},T=t=>{R(e=>e.filter((o,n)=>n!==t))},v=U((t,e)=>{let o=[];l&&o.push({role:"system",content:l});for(let n of t)if(n.role==="assistant")o.push({role:"assistant",content:n.text||""});else if((n.images?.length||0)>0){let a=[{type:"text",text:n.text||""},...n.images.map(m=>({type:"image_url",image_url:{url:m}}))];o.push({role:"user",content:a})}else o.push({role:"user",content:n.text||""});if(e)if(e.images.length>0){let n=[{type:"text",text:e.text},...e.images.map(a=>({type:"image_url",image_url:{url:a}}))];o.push({role:"user",content:n})}else o.push({role:"user",content:e.text});return o},[l]),P=U(async()=>{let t=f.trim();if(!t&&s.length===0)return;let e={id:String(Date.now()),role:"user",text:t||void 0,images:s.length?s:void 0};C(o=>[...o,e]),S(""),R([]),I(!0);try{let o=v(w,{text:e.text||"",images:e.images||[]}),n=await fetch(q,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify({model:b,messages:o,temperature:.7})});if(!n.ok)throw new Error(`OpenAI error: ${n.status}`);let m=(await n.json())?.choices?.[0]?.message?.content??"",r={id:String(Date.now()+1),role:"assistant",text:typeof m=="string"?m:String(m)};C(c=>[...c,r]),setTimeout(x,0)}catch(o){let n={id:String(Date.now()+1),role:"assistant",text:`Error: ${o?.message||"Failed to contact OpenAI"}`};C(a=>[...a,n])}finally{I(!1)}},[v,f,w,s,y,b,x]),h=J(()=>(f.trim().length>0||s.length>0)&&!g,[f,s.length,g]);return k("div",{className:M,style:{display:"flex",flexDirection:"column",height:"100%",...W},children:[k("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[w.map(t=>i("div",{style:{marginBottom:10,display:"flex",justifyContent:t.role==="user"?"flex-end":"flex-start"},children:k("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:t.role==="user"?"#111827":"#f3f4f6",color:t.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[t.text,t.images&&t.images.length>0&&i("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:t.images.map((e,o)=>i("img",{src:e,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},o))})]})},t.id)),i("div",{ref:L})]}),k("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[k("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[i("input",{type:"file",accept:"image/*",multiple:!0,onChange:E,style:{display:"none"},id:"ai-hud-chatbot-file"}),i("label",{htmlFor:"ai-hud-chatbot-file",children:i("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:k("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),i("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),i("input",{value:f,onChange:t=>S(t.target.value),placeholder:"Type a message...",onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),h&&P())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),i("button",{type:"button",disabled:!h,onClick:()=>void P(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:h?"#111827":"#e5e7eb",color:h?"#ffffff":"#9ca3af",cursor:h?"pointer":"not-allowed"},children:"Send"})]}),s.length>0&&i("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:s.map((t,e)=>k("div",{style:{position:"relative"},children:[i("img",{src:t,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),i("button",{type:"button",onClick:()=>T(e),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},e))})]})]})};import{jsx as H,jsxs as te}from"react/jsx-runtime";var $=Q.forwardRef(({children:b,onClick:y,label:l="Open chat",position:d="top-right",offset:M=8,icon:W,className:w,containerStyle:C,buttonClassName:f,buttonStyle:S,buttonSize:s=36,zIndex:R=10,disabled:g=!1,trigger:I,open:L,onOpenChange:x,renderButton:E,openWindowOnClick:T=!1,windowProps:v,windowContent:P},h)=>{let[t,e]=Y(!1),[o,n]=Y(!1),a=I??"hover",m=ee(()=>{let p={position:"absolute"},u=`${M}px`;switch(d){case"top-left":return{...p,top:u,left:u};case"top-right":return{...p,top:u,right:u};case"bottom-left":return{...p,bottom:u,left:u};case"bottom-right":default:return{...p,bottom:u,right:u}}},[d,M]),r=a==="always"?!0:a==="manual"?!!L:t,c=p=>{x&&x(p)},F={onMouseEnter:a==="hover"?()=>{e(!0),c(!0)}:void 0,onMouseLeave:a==="hover"?()=>{e(!1),c(!1)}:void 0,onFocus:a==="focus"?()=>{e(!0),c(!0)}:void 0,onBlur:a==="focus"?()=>{e(!1),c(!1)}:void 0},D={type:"button","aria-label":l,onClick:p=>{y?.(p),!g&&T&&n(!0)},className:f,disabled:g,style:{...m,zIndex:R,width:s,height:s,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:g?"#f3f4f6":"white",color:g?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:g?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:r?1:0,transform:r?"scale(1)":"scale(0.95)",pointerEvents:r?"auto":"none",...S},tabIndex:r?0:-1,"aria-hidden":r?void 0:!0,ref:h,visible:r};return te("div",{className:w,style:{position:"relative",display:"inline-block",...C},...F,children:[b,E?E(D):H("button",{...D,children:W??H("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(s*.5)),height:Math.max(12,Math.floor(s*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:H("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),T&&o&&H(_,{...v,onClose:()=>{v?.onClose?.(),n(!1)},children:P??H(j,{})})]})});$.displayName="ChatEnabled";export{$ as ChatEnabled,j as DefaultChatbot,_ as FloatingWindow};
//# sourceMappingURL=index.js.map