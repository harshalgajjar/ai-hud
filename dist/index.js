import ie,{useMemo as ae,useRef as le,useState as q}from"react";import{useEffect as te,useRef as Z,useState as Y}from"react";import{jsx as _,jsxs as z}from"react/jsx-runtime";var V=({children:C,title:R,onClose:m,position:f="bottom-right",width:b=360,height:w=480,minWidth:P=280,minHeight:k=240,offset:h=16,zIndex:D=1e3,className:l,style:L,headerClassName:y,bodyClassName:N,closeButtonAriaLabel:O="Close",closeOnEscape:E=!0,draggable:S=!0,anchorRect:s})=>{let[M,I]=Y(!1),d=Z(null),[e,o]=Y(!1),t=Z(null),[n,c]=Y(null);te(()=>{if(!E)return;let r=v=>{v.key==="Escape"&&m?.()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[E,m]);let u=(()=>{let r=`${h}px`;switch(f){case"top-left":return{top:r,left:r};case"top-right":return{top:r,right:r};case"bottom-left":return{bottom:r,left:r};case"bottom-right":default:return{bottom:r,right:r}}})(),T=(()=>{if(f!=="auto"||!s)return null;let r=window.innerWidth,v=window.innerHeight,g=h,W=s.top<v/2,i=s.left>r/2,a=W?["bottom","top"]:["top","bottom"],A=i?["right","left"]:["left","right"],j=[`${a[0]}-${A[0]}`,`${a[0]}-${A[1]}`,`${a[1]}-${A[0]}`,`${a[1]}-${A[1]}`];for(let K of j){let F=0,H=0;if(K==="bottom-right"?(F=s.bottom+g,H=s.right-b):K==="bottom-left"?(F=s.bottom+g,H=s.left):K==="top-right"?(F=s.top-w-g,H=s.right-b):(F=s.top-w-g,H=s.left),F>=0&&H>=0&&F+w<=v&&H+b<=r)return{top:F,left:H}}let Q=Math.min(Math.max(s.bottom+g,0),v-w),ee=Math.min(Math.max(s.right-b,0),r-b);return{top:Q,left:ee}})(),x=r=>{if(!S)return;let v=d.current;if(!v)return;let g=v.getBoundingClientRect();t.current={x:r.clientX,y:r.clientY,top:g.top,left:g.left},c({top:g.top,left:g.left}),o(!0);let W=a=>{if(!t.current)return;let A=a.clientX-t.current.x,j=a.clientY-t.current.y;c({top:t.current.top+j,left:t.current.left+A})},i=()=>{o(!1),t.current=null,window.removeEventListener("pointermove",W),window.removeEventListener("pointerup",i)};window.addEventListener("pointermove",W),window.addEventListener("pointerup",i,{once:!0})};return z("div",{ref:d,role:"dialog","aria-modal":"false",className:l,style:{position:"fixed",...n?{top:n.top,left:n.left}:T?{top:T.top,left:T.left}:u,width:b,height:w,minWidth:P,minHeight:k,zIndex:D,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:e?"none":void 0,...L},children:[z("div",{className:y,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:S?"move":void 0},onPointerDown:x,children:[_("div",{style:{fontWeight:600,color:"#111827"},children:R}),_("button",{type:"button",onClick:m,"aria-label":O,onMouseEnter:()=>I(!0),onMouseLeave:()=>I(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:M?"#ef4444":void 0,transition:"color 120ms ease"},children:z("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[_("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),_("div",{className:N,style:{flex:1,overflow:"auto",background:"#ffffff"},children:C})]})};import{useCallback as X,useMemo as oe,useRef as ne,useState as $}from"react";import{jsx as p,jsxs as B}from"react/jsx-runtime";var re="https://api.openai.com/v1/chat/completions";async function se(C){return new Promise((R,m)=>{let f=new FileReader;f.onload=()=>R(f.result),f.onerror=m,f.readAsDataURL(C)})}var J=({model:C="gpt-4o-mini",placeholderApiKey:R="REPLACE_WITH_YOUR_OPENAI_API_KEY",systemPrompt:m="You are a helpful assistant.",welcome:f="Hi! How can I help you today?",className:b,style:w})=>{let[P,k]=$([{id:"welcome",role:"assistant",text:f}]),[h,D]=$(""),[l,L]=$([]),[y,N]=$(!1),O=ne(null),E=X(()=>{O.current?.scrollIntoView({behavior:"smooth"})},[]),S=async e=>{let o=Array.from(e.target.files||[]);if(o.length===0)return;let t=await Promise.all(o.map(se));L(n=>[...n,...t]),e.target.value=""},s=e=>{L(o=>o.filter((t,n)=>n!==e))},M=X((e,o)=>{let t=[];m&&t.push({role:"system",content:m});for(let n of e)if(n.role==="assistant")t.push({role:"assistant",content:n.text||""});else if((n.images?.length||0)>0){let c=[{type:"text",text:n.text||""},...n.images.map(u=>({type:"image_url",image_url:{url:u}}))];t.push({role:"user",content:c})}else t.push({role:"user",content:n.text||""});if(o)if(o.images.length>0){let n=[{type:"text",text:o.text},...o.images.map(c=>({type:"image_url",image_url:{url:c}}))];t.push({role:"user",content:n})}else t.push({role:"user",content:o.text});return t},[m]),I=X(async()=>{let e=h.trim();if(!e&&l.length===0)return;let o={id:String(Date.now()),role:"user",text:e||void 0,images:l.length?l:void 0};k(t=>[...t,o]),D(""),L([]),N(!0);try{let t=M(P,{text:o.text||"",images:o.images||[]}),n=await fetch(re,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify({model:C,messages:t,temperature:.7})});if(!n.ok)throw new Error(`OpenAI error: ${n.status}`);let u=(await n.json())?.choices?.[0]?.message?.content??"",T={id:String(Date.now()+1),role:"assistant",text:typeof u=="string"?u:String(u)};k(x=>[...x,T]),setTimeout(E,0)}catch(t){let n={id:String(Date.now()+1),role:"assistant",text:`Error: ${t?.message||"Failed to contact OpenAI"}`};k(c=>[...c,n])}finally{N(!1)}},[M,h,P,l,R,C,E]),d=oe(()=>(h.trim().length>0||l.length>0)&&!y,[h,l.length,y]);return B("div",{className:b,style:{display:"flex",flexDirection:"column",height:"100%",...w},children:[B("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[P.map(e=>p("div",{style:{marginBottom:10,display:"flex",justifyContent:e.role==="user"?"flex-end":"flex-start"},children:B("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:e.role==="user"?"#111827":"#f3f4f6",color:e.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.text,e.images&&e.images.length>0&&p("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:e.images.map((o,t)=>p("img",{src:o,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},t))})]})},e.id)),p("div",{ref:O})]}),B("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[B("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[p("input",{type:"file",accept:"image/*",multiple:!0,onChange:S,style:{display:"none"},id:"ai-hud-chatbot-file"}),p("label",{htmlFor:"ai-hud-chatbot-file",children:p("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:B("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[p("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),p("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),p("input",{value:h,onChange:e=>D(e.target.value),placeholder:"Type a message...",onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),d&&I())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),p("button",{type:"button",disabled:!d,onClick:()=>void I(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:d?"#111827":"#e5e7eb",color:d?"#ffffff":"#9ca3af",cursor:d?"pointer":"not-allowed"},children:"Send"})]}),l.length>0&&p("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:l.map((e,o)=>B("div",{style:{position:"relative"},children:[p("img",{src:e,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),p("button",{type:"button",onClick:()=>s(o),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},o))})]})]})};import{jsx as U,jsxs as de}from"react/jsx-runtime";var G=ie.forwardRef(({children:C,onClick:R,label:m="Open chat",position:f="top-right",offset:b=8,icon:w,className:P,containerStyle:k,buttonClassName:h,buttonStyle:D,buttonSize:l=36,zIndex:L=10,disabled:y=!1,trigger:N,open:O,onOpenChange:E,renderButton:S,openWindowOnClick:s=!1,windowProps:M,windowContent:I},d)=>{let[e,o]=q(!1),[t,n]=q(!1),c=le(null),u=N??"hover",T=ae(()=>{let i={position:"absolute"},a=`${b}px`;switch(f){case"top-left":return{...i,top:a,left:a};case"top-right":return{...i,top:a,right:a};case"bottom-left":return{...i,bottom:a,left:a};case"bottom-right":default:return{...i,bottom:a,right:a}}},[f,b]),x=u==="always"?!0:u==="manual"?!!O:e,r=i=>{E&&E(i)},v={onMouseEnter:u==="hover"?()=>{o(!0),r(!0)}:void 0,onMouseLeave:u==="hover"?()=>{o(!1),r(!1)}:void 0,onFocus:u==="focus"?()=>{o(!0),r(!0)}:void 0,onBlur:u==="focus"?()=>{o(!1),r(!1)}:void 0},g=i=>{c.current=i,typeof d=="function"?d(i):d&&typeof d=="object"&&(d.current=i)},W={type:"button","aria-label":m,onClick:i=>{R?.(i),!y&&s&&n(!0)},className:h,disabled:y,style:{...T,zIndex:L,width:l,height:l,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:y?"#f3f4f6":"white",color:y?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:y?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:x?1:0,transform:x?"scale(1)":"scale(0.95)",pointerEvents:x?"auto":"none",...D},tabIndex:x?0:-1,"aria-hidden":x?void 0:!0,ref:g,visible:x};return de("div",{className:P,style:{position:"relative",display:"inline-block",...k},...v,children:[C,S?S(W):U("button",{...W,children:w??U("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(l*.5)),height:Math.max(12,Math.floor(l*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:U("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),s&&t&&U(V,{...M,onClose:()=>{M?.onClose?.(),n(!1)},anchorRect:M?.anchorRect??(c.current?c.current.getBoundingClientRect():null),children:I??U(J,{})})]})});G.displayName="ChatEnabled";export{G as ChatEnabled,J as DefaultChatbot,V as FloatingWindow};
//# sourceMappingURL=index.js.map