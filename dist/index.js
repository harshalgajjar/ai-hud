import ie,{useMemo as se,useRef as ae,useState as Z}from"react";import{useEffect as re,useRef as V,useState as Y}from"react";import{jsx as _,jsxs as z}from"react/jsx-runtime";var J=({children:d,title:c,onClose:u,position:g="bottom-right",width:y=360,height:x=480,minWidth:k=280,minHeight:I=240,offset:T=16,zIndex:N=1e3,className:m,style:C,headerClassName:w,bodyClassName:R,closeButtonAriaLabel:O="Close",closeOnEscape:f=!0,draggable:E=!0,anchorRect:r})=>{let[L,F]=Y(!1),v=V(null),[B,S]=Y(!1),b=V(null),[M,h]=Y(null);re(()=>{if(!f)return;let e=a=>{a.key==="Escape"&&u?.()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f,u]);let t=(()=>{let e=`${T}px`;switch(g){case"top-left":return{top:e,left:e};case"top-right":return{top:e,right:e};case"bottom-left":return{bottom:e,left:e};case"bottom-right":default:return{bottom:e,right:e}}})(),o=(()=>{if(g!=="auto"||!r)return null;let e=window.innerWidth,a=window.innerHeight,s=T,P=r.top<a/2,i=r.left>e/2,l=P?["bottom","top"]:["top","bottom"],D=i?["right","left"]:["left","right"],K=[`${l[0]}-${D[0]}`,`${l[0]}-${D[1]}`,`${l[1]}-${D[0]}`,`${l[1]}-${D[1]}`];for(let X of K){let W=0,A=0;if(X==="bottom-right"?(W=r.bottom+s,A=r.right-y):X==="bottom-left"?(W=r.bottom+s,A=r.left):X==="top-right"?(W=r.top-x-s,A=r.right-y):(W=r.top-x-s,A=r.left),W>=0&&A>=0&&W+x<=a&&A+y<=e)return{top:W,left:A}}let oe=Math.min(Math.max(r.bottom+s,0),a-x),ne=Math.min(Math.max(r.right-y,0),e-y);return{top:oe,left:ne}})(),n=e=>{if(!E)return;let a=v.current;if(!a)return;let s=a.getBoundingClientRect();b.current={x:e.clientX,y:e.clientY,top:s.top,left:s.left},h({top:s.top,left:s.left}),S(!0);let P=l=>{if(!b.current)return;let D=l.clientX-b.current.x,K=l.clientY-b.current.y;h({top:b.current.top+K,left:b.current.left+D})},i=()=>{S(!1),b.current=null,window.removeEventListener("pointermove",P),window.removeEventListener("pointerup",i)};window.addEventListener("pointermove",P),window.addEventListener("pointerup",i,{once:!0})};return z("div",{ref:v,role:"dialog","aria-modal":"false",className:m,style:{position:"fixed",...M?{top:M.top,left:M.left}:o?{top:o.top,left:o.left}:t,width:y,height:x,minWidth:k,minHeight:I,zIndex:N,background:"#ffffff",border:"1px solid rgba(0,0,0,0.06)",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",overflow:"hidden",userSelect:B?"none":void 0,...C},children:[z("div",{className:w,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#f9fafb",cursor:E?"move":void 0},onPointerDown:n,children:[_("div",{style:{fontWeight:600,color:"#111827"},children:c}),_("button",{type:"button",onClick:u,"aria-label":O,onMouseEnter:()=>F(!0),onMouseLeave:()=>F(!1),style:{width:28,height:28,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer",color:L?"#ef4444":void 0,transition:"color 120ms ease"},children:z("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[_("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),_("div",{className:R,style:{flex:1,overflow:"auto",background:"#ffffff"},children:d})]})};import{jsx as U,jsxs as le}from"react/jsx-runtime";var q=ie.forwardRef(({children:d,onClick:c,label:u="Open chat",position:g="top-right",offset:y=8,icon:x,className:k,containerStyle:I,buttonClassName:T,buttonStyle:N,buttonSize:m=36,zIndex:C=10,disabled:w=!1,trigger:R,open:O,onOpenChange:f,renderButton:E,openWindowOnClick:r=!1,windowProps:L,windowContent:F},v)=>{let[B,S]=Z(!1),[b,M]=Z(!1),h=ae(null),t=R??"hover",o=se(()=>{let i={position:"absolute"},l=`${y}px`;switch(g){case"top-left":return{...i,top:l,left:l};case"top-right":return{...i,top:l,right:l};case"bottom-left":return{...i,bottom:l,left:l};case"bottom-right":default:return{...i,bottom:l,right:l}}},[g,y]),n=t==="always"?!0:t==="manual"?!!O:B,e=i=>{f&&f(i)},a={onMouseEnter:t==="hover"?()=>{S(!0),e(!0)}:void 0,onMouseLeave:t==="hover"?()=>{S(!1),e(!1)}:void 0,onFocus:t==="focus"?()=>{S(!0),e(!0)}:void 0,onBlur:t==="focus"?()=>{S(!1),e(!1)}:void 0},s=i=>{h.current=i,typeof v=="function"?v(i):v&&typeof v=="object"&&(v.current=i)},P={type:"button","aria-label":u,onClick:i=>{c?.(i),!w&&r&&M(!0)},className:T,disabled:w,style:{...o,zIndex:C,width:m,height:m,borderRadius:9999,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,0.08)",background:w?"#f3f4f6":"white",color:w?"#9ca3af":void 0,boxShadow:"0 2px 6px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06)",cursor:w?"not-allowed":"pointer",transition:"opacity 120ms ease, transform 120ms ease",opacity:n?1:0,transform:n?"scale(1)":"scale(0.95)",pointerEvents:n?"auto":"none",...N},tabIndex:n?0:-1,"aria-hidden":n?void 0:!0,ref:s,visible:n};return le("div",{className:k,style:{position:"relative",display:"inline-block",...I},...a,children:[d,E?E(P):U("button",{...P,children:x??U("svg",{xmlns:"http://www.w3.org/2000/svg",width:Math.max(12,Math.floor(m*.5)),height:Math.max(12,Math.floor(m*.5)),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:U("path",{d:"M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"})})}),r&&b&&F&&U(J,{...L,onClose:()=>{L?.onClose?.(),M(!1)},anchorRect:L?.anchorRect??(h.current?h.current.getBoundingClientRect():null),children:F})]})});q.displayName="ChatEnabled";import{useCallback as G,useEffect as ee,useMemo as ce,useRef as te,useState as j}from"react";var $="ai-hud:default-chatbot:history:";function Q(d){return`${$}${d}`}function de(d){try{typeof window<"u"&&window.localStorage.removeItem(Q(d))}catch{}}function ue(){try{if(typeof window>"u")return;let d=[];for(let c=0;c<window.localStorage.length;c++){let u=window.localStorage.key(c);u&&u.startsWith($)&&d.push(u)}d.forEach(c=>window.localStorage.removeItem(c))}catch{}}import{jsx as p,jsxs as H}from"react/jsx-runtime";var fe="https://api.openai.com/v1/chat/completions";async function pe(d){return new Promise((c,u)=>{let g=new FileReader;g.onload=()=>c(g.result),g.onerror=u,g.readAsDataURL(d)})}var ge=({model:d="gpt-4o-mini",placeholderApiKey:c="REPLACE_WITH_YOUR_OPENAI_API_KEY",systemPrompt:u="You are a helpful assistant.",welcome:g="Hi! How can I help you today?",className:y,style:x,conversationId:k,context:I})=>{let T=te(null);if(!k&&!T.current){let t=(()=>{try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`conv_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,8)}`})();T.current=t}let N=k??T.current,m=`${$}${N}`,[C,w]=j(()=>{try{let t=typeof window<"u"?window.localStorage.getItem(m):null;if(t){let o=JSON.parse(t);if(Array.isArray(o))return o}}catch{}return[{id:"welcome",role:"assistant",text:g}]}),[R,O]=j(""),[f,E]=j([]),[r,L]=j(!1),F=te(null),v=G(()=>{F.current?.scrollIntoView({behavior:"smooth"})},[]),B=async t=>{let o=Array.from(t.target.files||[]);if(o.length===0)return;let n=await Promise.all(o.map(pe));E(e=>[...e,...n]),t.target.value=""},S=t=>{E(o=>o.filter((n,e)=>e!==t))},b=G((t,o)=>{let n=[];if(u&&n.push({role:"system",content:u}),typeof I<"u"){let e="";try{e=JSON.stringify(I)}catch{e=String(I)}n.push({role:"system",content:`Context: ${e}`})}for(let e of t)if(e.role==="assistant")n.push({role:"assistant",content:e.text||""});else if((e.images?.length||0)>0){let a=[{type:"text",text:e.text||""},...e.images.map(s=>({type:"image_url",image_url:{url:s}}))];n.push({role:"user",content:a})}else n.push({role:"user",content:e.text||""});if(o)if(o.images.length>0){let e=[{type:"text",text:o.text},...o.images.map(a=>({type:"image_url",image_url:{url:a}}))];n.push({role:"user",content:e})}else n.push({role:"user",content:o.text});return n},[u,I]),M=G(async()=>{let t=R.trim();if(!t&&f.length===0)return;let o={id:String(Date.now()),role:"user",text:t||void 0,images:f.length?f:void 0};w(n=>[...n,o]),O(""),E([]),L(!0);try{let n=b(C,{text:o.text||"",images:o.images||[]}),e=await fetch(fe,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({model:d,messages:n,temperature:.7})});if(!e.ok)throw new Error(`OpenAI error: ${e.status}`);let s=(await e.json())?.choices?.[0]?.message?.content??"",P={id:String(Date.now()+1),role:"assistant",text:typeof s=="string"?s:String(s)};w(i=>[...i,P]),setTimeout(v,0)}catch(n){let e={id:String(Date.now()+1),role:"assistant",text:`Error: ${n?.message||"Failed to contact OpenAI"}`};w(a=>[...a,e])}finally{L(!1)}},[b,R,C,f,c,d,v]),h=ce(()=>(R.trim().length>0||f.length>0)&&!r,[R,f.length,r]);return ee(()=>{try{typeof window<"u"&&window.localStorage.setItem(m,JSON.stringify(C))}catch{}},[C,m]),ee(()=>()=>{if(!k)try{typeof window<"u"&&window.localStorage.removeItem(m)}catch{}},[k,m]),H("div",{className:y,style:{display:"flex",flexDirection:"column",height:"100%",...x},children:[H("div",{style:{flex:1,overflow:"auto",padding:12,background:"#ffffff"},children:[C.map(t=>p("div",{style:{marginBottom:10,display:"flex",justifyContent:t.role==="user"?"flex-end":"flex-start"},children:H("div",{style:{maxWidth:"80%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.06)",background:t.role==="user"?"#111827":"#f3f4f6",color:t.role==="user"?"#ffffff":"#111827",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[t.text,t.images&&t.images.length>0&&p("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:t.images.map((o,n)=>p("img",{src:o,alt:"upload",style:{width:96,height:72,objectFit:"cover",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}},n))})]})},t.id)),p("div",{ref:F})]}),H("div",{style:{padding:12,borderTop:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:[H("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[p("input",{type:"file",accept:"image/*",multiple:!0,onChange:B,style:{display:"none"},id:"ai-hud-chatbot-file"}),p("label",{htmlFor:"ai-hud-chatbot-file",children:p("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:36,height:36,border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,background:"white",cursor:"pointer"},children:H("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[p("path",{d:"M18.5 12.5l-5 5-3-3-5 5"}),p("path",{d:"M20 7a4 4 0 0 0-8 0v10a4 4 0 0 0 8 0Z"})]})})}),p("input",{value:R,onChange:t=>O(t.target.value),placeholder:"Type a message...",onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),h&&M())},style:{flex:1,height:36,border:"1px solid rgba(0,0,0,0.15)",borderRadius:8,padding:"0 10px"}}),p("button",{type:"button",disabled:!h,onClick:()=>void M(),style:{height:36,padding:"0 12px",borderRadius:8,border:"1px solid rgba(0,0,0,0.08)",background:h?"#111827":"#e5e7eb",color:h?"#ffffff":"#9ca3af",cursor:h?"pointer":"not-allowed"},children:"Send"})]}),f.length>0&&p("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:f.map((t,o)=>H("div",{style:{position:"relative"},children:[p("img",{src:t,alt:"selected",style:{width:64,height:48,objectFit:"cover",borderRadius:6,border:"1px solid rgba(0,0,0,0.06)"}}),p("button",{type:"button",onClick:()=>S(o),"aria-label":"Remove image",style:{position:"absolute",top:-6,right:-6,width:20,height:20,borderRadius:9999,border:"1px solid rgba(0,0,0,0.08)",background:"white",cursor:"pointer"},children:"\xD7"})]},o))})]})]})};export{$ as CHAT_STORAGE_PREFIX,q as ChatEnabled,ge as DefaultChatbot,J as FloatingWindow,ue as clearAllConversations,de as clearConversation,Q as getConversationStorageKey};
//# sourceMappingURL=index.js.map